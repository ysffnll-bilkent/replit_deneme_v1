var r5=Object.defineProperty;var o5=(s,e,t)=>e in s?r5(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var OV=(s,e,t)=>o5(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();function KN(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var YT={exports:{}},cN={},TT={exports:{}},BR={exports:{}};BR.exports;(function(s,e){/**
 * @license React
 * react.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var t="18.3.1",n=Symbol.for("react.element"),a=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),C=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),w=Symbol.for("react.offscreen"),R=Symbol.iterator,Z="@@iterator";function x(z){if(z===null||typeof z!="object")return null;var ge=R&&z[R]||z[Z];return typeof ge=="function"?ge:null}var W={current:null},N={transition:null},K={current:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1},T={current:null},L={},k=null;function E(z){k=z}L.setExtraStackFrame=function(z){k=z},L.getCurrentStack=null,L.getStackAddendum=function(){var z="";k&&(z+=k);var ge=L.getCurrentStack;return ge&&(z+=ge()||""),z};var F=!1,U=!1,le=!1,ie=!1,Ce=!1,Ge={ReactCurrentDispatcher:W,ReactCurrentBatchConfig:N,ReactCurrentOwner:T};Ge.ReactDebugCurrentFrame=L,Ge.ReactCurrentActQueue=K;function ye(z){{for(var ge=arguments.length,Ke=new Array(ge>1?ge-1:0),je=1;je<ge;je++)Ke[je-1]=arguments[je];de("warn",z,Ke)}}function pe(z){{for(var ge=arguments.length,Ke=new Array(ge>1?ge-1:0),je=1;je<ge;je++)Ke[je-1]=arguments[je];de("error",z,Ke)}}function de(z,ge,Ke){{var je=Ge.ReactDebugCurrentFrame,Ht=je.getStackAddendum();Ht!==""&&(ge+="%s",Ke=Ke.concat([Ht]));var Bn=Ke.map(function(cn){return String(cn)});Bn.unshift("Warning: "+ge),Function.prototype.apply.call(console[z],console,Bn)}}var Oe={};function We(z,ge){{var Ke=z.constructor,je=Ke&&(Ke.displayName||Ke.name)||"ReactClass",Ht=je+"."+ge;if(Oe[Ht])return;pe("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",ge,je),Oe[Ht]=!0}}var ke={isMounted:function(z){return!1},enqueueForceUpdate:function(z,ge,Ke){We(z,"forceUpdate")},enqueueReplaceState:function(z,ge,Ke,je){We(z,"replaceState")},enqueueSetState:function(z,ge,Ke,je){We(z,"setState")}},$e=Object.assign,ot={};Object.freeze(ot);function Ne(z,ge,Ke){this.props=z,this.context=ge,this.refs=ot,this.updater=Ke||ke}Ne.prototype.isReactComponent={},Ne.prototype.setState=function(z,ge){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw new Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,ge,"setState")},Ne.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};{var tt={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},bt=function(z,ge){Object.defineProperty(Ne.prototype,z,{get:function(){ye("%s(...) is deprecated in plain JavaScript React classes. %s",ge[0],ge[1])}})};for(var dt in tt)tt.hasOwnProperty(dt)&&bt(dt,tt[dt])}function yt(){}yt.prototype=Ne.prototype;function zt(z,ge,Ke){this.props=z,this.context=ge,this.refs=ot,this.updater=Ke||ke}var Nt=zt.prototype=new yt;Nt.constructor=zt,$e(Nt,Ne.prototype),Nt.isPureReactComponent=!0;function Lt(){var z={current:null};return Object.seal(z),z}var Ue=Array.isArray;function Pe(z){return Ue(z)}function te(z){{var ge=typeof Symbol=="function"&&Symbol.toStringTag,Ke=ge&&z[Symbol.toStringTag]||z.constructor.name||"Object";return Ke}}function Gt(z){try{return Qe(z),!1}catch{return!0}}function Qe(z){return""+z}function ht(z){if(Gt(z))return pe("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",te(z)),Qe(z)}function Ct(z,ge,Ke){var je=z.displayName;if(je)return je;var Ht=ge.displayName||ge.name||"";return Ht!==""?Ke+"("+Ht+")":Ke}function Tt(z){return z.displayName||"Context"}function Rt(z){if(z==null)return null;if(typeof z.tag=="number"&&pe("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof z=="function")return z.displayName||z.name||null;if(typeof z=="string")return z;switch(z){case o:return"Fragment";case a:return"Portal";case u:return"Profiler";case l:return"StrictMode";case p:return"Suspense";case m:return"SuspenseList"}if(typeof z=="object")switch(z.$$typeof){case C:var ge=z;return Tt(ge)+".Consumer";case d:var Ke=z;return Tt(Ke._context)+".Provider";case A:return Ct(z,z.render,"ForwardRef");case y:var je=z.displayName||null;return je!==null?je:Rt(z.type)||"Memo";case G:{var Ht=z,Bn=Ht._payload,cn=Ht._init;try{return Rt(cn(Bn))}catch{return null}}}return null}var $=Object.prototype.hasOwnProperty,J={key:!0,ref:!0,__self:!0,__source:!0},fe,ze,et;et={};function _e(z){if($.call(z,"ref")){var ge=Object.getOwnPropertyDescriptor(z,"ref").get;if(ge&&ge.isReactWarning)return!1}return z.ref!==void 0}function At(z){if($.call(z,"key")){var ge=Object.getOwnPropertyDescriptor(z,"key").get;if(ge&&ge.isReactWarning)return!1}return z.key!==void 0}function Zt(z,ge){var Ke=function(){fe||(fe=!0,pe("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ge))};Ke.isReactWarning=!0,Object.defineProperty(z,"key",{get:Ke,configurable:!0})}function Xt(z,ge){var Ke=function(){ze||(ze=!0,pe("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ge))};Ke.isReactWarning=!0,Object.defineProperty(z,"ref",{get:Ke,configurable:!0})}function An(z){if(typeof z.ref=="string"&&T.current&&z.__self&&T.current.stateNode!==z.__self){var ge=Rt(T.current.type);et[ge]||(pe('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',ge,z.ref),et[ge]=!0)}}var j=function(z,ge,Ke,je,Ht,Bn,cn){var Wn={$$typeof:n,type:z,key:ge,ref:Ke,props:cn,_owner:Bn};return Wn._store={},Object.defineProperty(Wn._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Wn,"_self",{configurable:!1,enumerable:!1,writable:!1,value:je}),Object.defineProperty(Wn,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Ht}),Object.freeze&&(Object.freeze(Wn.props),Object.freeze(Wn)),Wn};function ue(z,ge,Ke){var je,Ht={},Bn=null,cn=null,Wn=null,$n=null;if(ge!=null){_e(ge)&&(cn=ge.ref,An(ge)),At(ge)&&(ht(ge.key),Bn=""+ge.key),Wn=ge.__self===void 0?null:ge.__self,$n=ge.__source===void 0?null:ge.__source;for(je in ge)$.call(ge,je)&&!J.hasOwnProperty(je)&&(Ht[je]=ge[je])}var wi=arguments.length-2;if(wi===1)Ht.children=Ke;else if(wi>1){for(var Yi=Array(wi),Ti=0;Ti<wi;Ti++)Yi[Ti]=arguments[Ti+2];Object.freeze&&Object.freeze(Yi),Ht.children=Yi}if(z&&z.defaultProps){var Ji=z.defaultProps;for(je in Ji)Ht[je]===void 0&&(Ht[je]=Ji[je])}if(Bn||cn){var ta=typeof z=="function"?z.displayName||z.name||"Unknown":z;Bn&&Zt(Ht,ta),cn&&Xt(Ht,ta)}return j(z,Bn,cn,Wn,$n,T.current,Ht)}function Ve(z,ge){var Ke=j(z.type,ge,z.ref,z._self,z._source,z._owner,z.props);return Ke}function qe(z,ge,Ke){if(z==null)throw new Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var je,Ht=$e({},z.props),Bn=z.key,cn=z.ref,Wn=z._self,$n=z._source,wi=z._owner;if(ge!=null){_e(ge)&&(cn=ge.ref,wi=T.current),At(ge)&&(ht(ge.key),Bn=""+ge.key);var Yi;z.type&&z.type.defaultProps&&(Yi=z.type.defaultProps);for(je in ge)$.call(ge,je)&&!J.hasOwnProperty(je)&&(ge[je]===void 0&&Yi!==void 0?Ht[je]=Yi[je]:Ht[je]=ge[je])}var Ti=arguments.length-2;if(Ti===1)Ht.children=Ke;else if(Ti>1){for(var Ji=Array(Ti),ta=0;ta<Ti;ta++)Ji[ta]=arguments[ta+2];Ht.children=Ji}return j(z.type,Bn,cn,Wn,$n,wi,Ht)}function Me(z){return typeof z=="object"&&z!==null&&z.$$typeof===n}var se=".",Re=":";function De(z){var ge=/[=:]/g,Ke={"=":"=0",":":"=2"},je=z.replace(ge,function(Ht){return Ke[Ht]});return"$"+je}var Q=!1,st=/\/+/g;function be(z){return z.replace(st,"$&/")}function Be(z,ge){return typeof z=="object"&&z!==null&&z.key!=null?(ht(z.key),De(""+z.key)):ge.toString(36)}function Ft(z,ge,Ke,je,Ht){var Bn=typeof z;(Bn==="undefined"||Bn==="boolean")&&(z=null);var cn=!1;if(z===null)cn=!0;else switch(Bn){case"string":case"number":cn=!0;break;case"object":switch(z.$$typeof){case n:case a:cn=!0}}if(cn){var Wn=z,$n=Ht(Wn),wi=je===""?se+Be(Wn,0):je;if(Pe($n)){var Yi="";wi!=null&&(Yi=be(wi)+"/"),Ft($n,ge,Yi,"",function(Gb){return Gb})}else $n!=null&&(Me($n)&&($n.key&&(!Wn||Wn.key!==$n.key)&&ht($n.key),$n=Ve($n,Ke+($n.key&&(!Wn||Wn.key!==$n.key)?be(""+$n.key)+"/":"")+wi)),ge.push($n));return 1}var Ti,Ji,ta=0,hi=je===""?se:je+Re;if(Pe(z))for(var Xs=0;Xs<z.length;Xs++)Ti=z[Xs],Ji=hi+Be(Ti,Xs),ta+=Ft(Ti,ge,Ke,Ji,Ht);else{var YI=x(z);if(typeof YI=="function"){var CC=z;YI===CC.entries&&(Q||ye("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Q=!0);for(var yb=YI.call(CC),Jl,hC=0;!(Jl=yb.next()).done;)Ti=Jl.value,Ji=hi+Be(Ti,hC++),ta+=Ft(Ti,ge,Ke,Ji,Ht)}else if(Bn==="object"){var AC=String(z);throw new Error("Objects are not valid as a React child (found: "+(AC==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":AC)+"). If you meant to render a collection of children, use an array instead.")}}return ta}function wt(z,ge,Ke){if(z==null)return z;var je=[],Ht=0;return Ft(z,je,"","",function(Bn){return ge.call(Ke,Bn,Ht++)}),je}function ln(z){var ge=0;return wt(z,function(){ge++}),ge}function Yn(z,ge,Ke){wt(z,function(){ge.apply(this,arguments)},Ke)}function un(z){return wt(z,function(ge){return ge})||[]}function bn(z){if(!Me(z))throw new Error("React.Children.only expected to receive a single React element child.");return z}function ui(z){var ge={$$typeof:C,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};ge.Provider={$$typeof:d,_context:ge};var Ke=!1,je=!1,Ht=!1;{var Bn={$$typeof:C,_context:ge};Object.defineProperties(Bn,{Provider:{get:function(){return je||(je=!0,pe("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),ge.Provider},set:function(cn){ge.Provider=cn}},_currentValue:{get:function(){return ge._currentValue},set:function(cn){ge._currentValue=cn}},_currentValue2:{get:function(){return ge._currentValue2},set:function(cn){ge._currentValue2=cn}},_threadCount:{get:function(){return ge._threadCount},set:function(cn){ge._threadCount=cn}},Consumer:{get:function(){return Ke||(Ke=!0,pe("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),ge.Consumer}},displayName:{get:function(){return ge.displayName},set:function(cn){Ht||(ye("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",cn),Ht=!0)}}}),ge.Consumer=Bn}return ge._currentRenderer=null,ge._currentRenderer2=null,ge}var bi=-1,aa=0,Ui=1,pa=2;function ua(z){if(z._status===bi){var ge=z._result,Ke=ge();if(Ke.then(function(Bn){if(z._status===aa||z._status===bi){var cn=z;cn._status=Ui,cn._result=Bn}},function(Bn){if(z._status===aa||z._status===bi){var cn=z;cn._status=pa,cn._result=Bn}}),z._status===bi){var je=z;je._status=aa,je._result=Ke}}if(z._status===Ui){var Ht=z._result;return Ht===void 0&&pe(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))

Did you accidentally put curly braces around the import?`,Ht),"default"in Ht||pe(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))`,Ht),Ht.default}else throw z._result}function ce(z){var ge={_status:bi,_result:z},Ke={$$typeof:G,_payload:ge,_init:ua};{var je,Ht;Object.defineProperties(Ke,{defaultProps:{configurable:!0,get:function(){return je},set:function(Bn){pe("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),je=Bn,Object.defineProperty(Ke,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return Ht},set:function(Bn){pe("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),Ht=Bn,Object.defineProperty(Ke,"propTypes",{enumerable:!0})}}})}return Ke}function pt(z){z!=null&&z.$$typeof===y?pe("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):typeof z!="function"?pe("forwardRef requires a render function but was given %s.",z===null?"null":typeof z):z.length!==0&&z.length!==2&&pe("forwardRef render functions accept exactly two parameters: props and ref. %s",z.length===1?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),z!=null&&(z.defaultProps!=null||z.propTypes!=null)&&pe("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?");var ge={$$typeof:A,render:z};{var Ke;Object.defineProperty(ge,"displayName",{enumerable:!1,configurable:!0,get:function(){return Ke},set:function(je){Ke=je,!z.name&&!z.displayName&&(z.displayName=je)}})}return ge}var Kt;Kt=Symbol.for("react.module.reference");function ne(z){return!!(typeof z=="string"||typeof z=="function"||z===o||z===u||Ce||z===l||z===p||z===m||ie||z===w||F||U||le||typeof z=="object"&&z!==null&&(z.$$typeof===G||z.$$typeof===y||z.$$typeof===d||z.$$typeof===C||z.$$typeof===A||z.$$typeof===Kt||z.getModuleId!==void 0))}function Te(z,ge){ne(z)||pe("memo: The first argument must be a component. Instead received: %s",z===null?"null":typeof z);var Ke={$$typeof:y,type:z,compare:ge===void 0?null:ge};{var je;Object.defineProperty(Ke,"displayName",{enumerable:!1,configurable:!0,get:function(){return je},set:function(Ht){je=Ht,!z.name&&!z.displayName&&(z.displayName=Ht)}})}return Ke}function nt(){var z=W.current;return z===null&&pe(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`),z}function Vt(z){var ge=nt();if(z._context!==void 0){var Ke=z._context;Ke.Consumer===z?pe("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):Ke.Provider===z&&pe("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return ge.useContext(z)}function kt(z){var ge=nt();return ge.useState(z)}function dn(z,ge,Ke){var je=nt();return je.useReducer(z,ge,Ke)}function Ut(z){var ge=nt();return ge.useRef(z)}function D(z,ge){var Ke=nt();return Ke.useEffect(z,ge)}function he(z,ge){var Ke=nt();return Ke.useInsertionEffect(z,ge)}function Ze(z,ge){var Ke=nt();return Ke.useLayoutEffect(z,ge)}function Se(z,ge){var Ke=nt();return Ke.useCallback(z,ge)}function Ae(z,ge){var Ke=nt();return Ke.useMemo(z,ge)}function mt(z,ge,Ke){var je=nt();return je.useImperativeHandle(z,ge,Ke)}function Wt(z,ge){{var Ke=nt();return Ke.useDebugValue(z,ge)}}function Dt(){var z=nt();return z.useTransition()}function Ot(z){var ge=nt();return ge.useDeferredValue(z)}function Yt(){var z=nt();return z.useId()}function Rn(z,ge,Ke){var je=nt();return je.useSyncExternalStore(z,ge,Ke)}var sn=0,On,Ii,vi,Va,ti,In,Fi;function ni(){}ni.__reactDisabledLog=!0;function Dr(){{if(sn===0){On=console.log,Ii=console.info,vi=console.warn,Va=console.error,ti=console.group,In=console.groupCollapsed,Fi=console.groupEnd;var z={configurable:!0,enumerable:!0,value:ni,writable:!0};Object.defineProperties(console,{info:z,log:z,warn:z,error:z,group:z,groupCollapsed:z,groupEnd:z})}sn++}}function ls(){{if(sn--,sn===0){var z={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:$e({},z,{value:On}),info:$e({},z,{value:Ii}),warn:$e({},z,{value:vi}),error:$e({},z,{value:Va}),group:$e({},z,{value:ti}),groupCollapsed:$e({},z,{value:In}),groupEnd:$e({},z,{value:Fi})})}sn<0&&pe("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var ma=Ge.ReactCurrentDispatcher,nr;function di(z,ge,Ke){{if(nr===void 0)try{throw Error()}catch(Ht){var je=Ht.stack.trim().match(/\n( *(at )?)/);nr=je&&je[1]||""}return`
`+nr+z}}var ba=!1,Lo;{var za=typeof WeakMap=="function"?WeakMap:Map;Lo=new za}function kr(z,ge){if(!z||ba)return"";{var Ke=Lo.get(z);if(Ke!==void 0)return Ke}var je;ba=!0;var Ht=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var Bn;Bn=ma.current,ma.current=null,Dr();try{if(ge){var cn=function(){throw Error()};if(Object.defineProperty(cn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(cn,[])}catch(hi){je=hi}Reflect.construct(z,[],cn)}else{try{cn.call()}catch(hi){je=hi}z.call(cn.prototype)}}else{try{throw Error()}catch(hi){je=hi}z()}}catch(hi){if(hi&&je&&typeof hi.stack=="string"){for(var Wn=hi.stack.split(`
`),$n=je.stack.split(`
`),wi=Wn.length-1,Yi=$n.length-1;wi>=1&&Yi>=0&&Wn[wi]!==$n[Yi];)Yi--;for(;wi>=1&&Yi>=0;wi--,Yi--)if(Wn[wi]!==$n[Yi]){if(wi!==1||Yi!==1)do if(wi--,Yi--,Yi<0||Wn[wi]!==$n[Yi]){var Ti=`
`+Wn[wi].replace(" at new "," at ");return z.displayName&&Ti.includes("<anonymous>")&&(Ti=Ti.replace("<anonymous>",z.displayName)),typeof z=="function"&&Lo.set(z,Ti),Ti}while(wi>=1&&Yi>=0);break}}}finally{ba=!1,ma.current=Bn,ls(),Error.prepareStackTrace=Ht}var Ji=z?z.displayName||z.name:"",ta=Ji?di(Ji):"";return typeof z=="function"&&Lo.set(z,ta),ta}function Ur(z,ge,Ke){return kr(z,!1)}function ru(z){var ge=z.prototype;return!!(ge&&ge.isReactComponent)}function Jc(z,ge,Ke){if(z==null)return"";if(typeof z=="function")return kr(z,ru(z));if(typeof z=="string")return di(z);switch(z){case p:return di("Suspense");case m:return di("SuspenseList")}if(typeof z=="object")switch(z.$$typeof){case A:return Ur(z.render);case y:return Jc(z.type,ge,Ke);case G:{var je=z,Ht=je._payload,Bn=je._init;try{return Jc(Bn(Ht),ge,Ke)}catch{}}}return""}var NI={},Oc=Ge.ReactDebugCurrentFrame;function HI(z){if(z){var ge=z._owner,Ke=Jc(z.type,z._source,ge?ge.type:null);Oc.setExtraStackFrame(Ke)}else Oc.setExtraStackFrame(null)}function fo(z,ge,Ke,je,Ht){{var Bn=Function.call.bind($);for(var cn in z)if(Bn(z,cn)){var Wn=void 0;try{if(typeof z[cn]!="function"){var $n=Error((je||"React class")+": "+Ke+" type `"+cn+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof z[cn]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw $n.name="Invariant Violation",$n}Wn=z[cn](ge,cn,je,Ke,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(wi){Wn=wi}Wn&&!(Wn instanceof Error)&&(HI(Ht),pe("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",je||"React class",Ke,cn,typeof Wn),HI(null)),Wn instanceof Error&&!(Wn.message in NI)&&(NI[Wn.message]=!0,HI(Ht),pe("Failed %s type: %s",Ke,Wn.message),HI(null))}}}function Pn(z){if(z){var ge=z._owner,Ke=Jc(z.type,z._source,ge?ge.type:null);E(Ke)}else E(null)}var dr;dr=!1;function dC(){if(T.current){var z=Rt(T.current.type);if(z)return`

Check the render method of \``+z+"`."}return""}function Tn(z){if(z!==void 0){var ge=z.fileName.replace(/^.*[\\\/]/,""),Ke=z.lineNumber;return`

Check your code at `+ge+":"+Ke+"."}return""}function nf(z){return z!=null?Tn(z.__source):""}var wr={};function ou(z){var ge=dC();if(!ge){var Ke=typeof z=="string"?z:z.displayName||z.name;Ke&&(ge=`

Check the top-level render call using <`+Ke+">.")}return ge}function Pc(z,ge){if(!(!z._store||z._store.validated||z.key!=null)){z._store.validated=!0;var Ke=ou(ge);if(!wr[Ke]){wr[Ke]=!0;var je="";z&&z._owner&&z._owner!==T.current&&(je=" It was passed a child from "+Rt(z._owner.type)+"."),Pn(z),pe('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Ke,je),Pn(null)}}}function kl(z,ge){if(typeof z=="object"){if(Pe(z))for(var Ke=0;Ke<z.length;Ke++){var je=z[Ke];Me(je)&&Pc(je,ge)}else if(Me(z))z._store&&(z._store.validated=!0);else if(z){var Ht=x(z);if(typeof Ht=="function"&&Ht!==z.entries)for(var Bn=Ht.call(z),cn;!(cn=Bn.next()).done;)Me(cn.value)&&Pc(cn.value,ge)}}}function ir(z){{var ge=z.type;if(ge==null||typeof ge=="string")return;var Ke;if(typeof ge=="function")Ke=ge.propTypes;else if(typeof ge=="object"&&(ge.$$typeof===A||ge.$$typeof===y))Ke=ge.propTypes;else return;if(Ke){var je=Rt(ge);fo(Ke,z.props,"prop",je,z)}else if(ge.PropTypes!==void 0&&!dr){dr=!0;var Ht=Rt(ge);pe("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Ht||"Unknown")}typeof ge.getDefaultProps=="function"&&!ge.getDefaultProps.isReactClassApproved&&pe("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function ra(z){{for(var ge=Object.keys(z.props),Ke=0;Ke<ge.length;Ke++){var je=ge[Ke];if(je!=="children"&&je!=="key"){Pn(z),pe("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",je),Pn(null);break}}z.ref!==null&&(Pn(z),pe("Invalid attribute `ref` supplied to `React.Fragment`."),Pn(null))}}function af(z,ge,Ke){var je=ne(z);if(!je){var Ht="";(z===void 0||typeof z=="object"&&z!==null&&Object.keys(z).length===0)&&(Ht+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Bn=nf(ge);Bn?Ht+=Bn:Ht+=dC();var cn;z===null?cn="null":Pe(z)?cn="array":z!==void 0&&z.$$typeof===n?(cn="<"+(Rt(z.type)||"Unknown")+" />",Ht=" Did you accidentally export a JSX literal instead of a component?"):cn=typeof z,pe("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",cn,Ht)}var Wn=ue.apply(this,arguments);if(Wn==null)return Wn;if(je)for(var $n=2;$n<arguments.length;$n++)kl(arguments[$n],z);return z===o?ra(Wn):ir(Wn),Wn}var Cr=!1;function po(z){var ge=af.bind(null,z);return ge.type=z,Cr||(Cr=!0,ye("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(ge,"type",{enumerable:!1,get:function(){return ye("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:z}),z}}),ge}function fl(z,ge,Ke){for(var je=qe.apply(this,arguments),Ht=2;Ht<arguments.length;Ht++)kl(arguments[Ht],je.type);return ir(je),je}function vb(z,ge){var Ke=N.transition;N.transition={};var je=N.transition;N.transition._updatedFibers=new Set;try{z()}finally{if(N.transition=Ke,Ke===null&&je._updatedFibers){var Ht=je._updatedFibers.size;Ht>10&&ye("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),je._updatedFibers.clear()}}}var XI=!1,su=null;function rf(z){if(su===null)try{var ge=("require"+Math.random()).slice(0,7),Ke=s&&s[ge];su=Ke.call(s,"timers").setImmediate}catch{su=function(Ht){XI===!1&&(XI=!0,typeof MessageChannel>"u"&&pe("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var Bn=new MessageChannel;Bn.port1.onmessage=Ht,Bn.port2.postMessage(void 0)}}return su(z)}var Qc=0,of=!1;function sf(z){{var ge=Qc;Qc++,K.current===null&&(K.current=[]);var Ke=K.isBatchingLegacy,je;try{if(K.isBatchingLegacy=!0,je=z(),!Ke&&K.didScheduleLegacyUpdate){var Ht=K.current;Ht!==null&&(K.didScheduleLegacyUpdate=!1,lu(Ht))}}catch(Ji){throw Ul(ge),Ji}finally{K.isBatchingLegacy=Ke}if(je!==null&&typeof je=="object"&&typeof je.then=="function"){var Bn=je,cn=!1,Wn={then:function(Ji,ta){cn=!0,Bn.then(function(hi){Ul(ge),Qc===0?FI(hi,Ji,ta):Ji(hi)},function(hi){Ul(ge),ta(hi)})}};return!of&&typeof Promise<"u"&&Promise.resolve().then(function(){}).then(function(){cn||(of=!0,pe("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),Wn}else{var $n=je;if(Ul(ge),Qc===0){var wi=K.current;wi!==null&&(lu(wi),K.current=null);var Yi={then:function(Ji,ta){K.current===null?(K.current=[],FI($n,Ji,ta)):Ji($n)}};return Yi}else{var Ti={then:function(Ji,ta){Ji($n)}};return Ti}}}}function Ul(z){z!==Qc-1&&pe("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),Qc=z}function FI(z,ge,Ke){{var je=K.current;if(je!==null)try{lu(je),rf(function(){je.length===0?(K.current=null,ge(z)):FI(z,ge,Ke)})}catch(Ht){Ke(Ht)}else ge(z)}}var jc=!1;function lu(z){if(!jc){jc=!0;var ge=0;try{for(;ge<z.length;ge++){var Ke=z[ge];do Ke=Ke(!0);while(Ke!==null)}z.length=0}catch(je){throw z=z.slice(ge+1),je}finally{jc=!1}}}var lf=af,cf=fl,gf=po,uf={map:wt,forEach:Yn,count:ln,toArray:un,only:bn};e.Children=uf,e.Component=Ne,e.Fragment=o,e.Profiler=u,e.PureComponent=zt,e.StrictMode=l,e.Suspense=p,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ge,e.act=sf,e.cloneElement=cf,e.createContext=ui,e.createElement=lf,e.createFactory=gf,e.createRef=Lt,e.forwardRef=pt,e.isValidElement=Me,e.lazy=ce,e.memo=Te,e.startTransition=vb,e.unstable_act=sf,e.useCallback=Se,e.useContext=Vt,e.useDebugValue=Wt,e.useDeferredValue=Ot,e.useEffect=D,e.useId=Yt,e.useImperativeHandle=mt,e.useInsertionEffect=he,e.useLayoutEffect=Ze,e.useMemo=Ae,e.useReducer=dn,e.useRef=Ut,e.useState=kt,e.useSyncExternalStore=Rn,e.useTransition=Dt,e.version=t,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(BR,BR.exports);var s5=BR.exports;TT.exports=s5;var Fe=TT.exports;const LN=KN(Fe);/**
 * @license React
 * react-jsx-dev-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var s=Fe,e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),G=Symbol.iterator,w="@@iterator";function R(ce){if(ce===null||typeof ce!="object")return null;var pt=G&&ce[G]||ce[w];return typeof pt=="function"?pt:null}var Z=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function x(ce){{for(var pt=arguments.length,Kt=new Array(pt>1?pt-1:0),ne=1;ne<pt;ne++)Kt[ne-1]=arguments[ne];W("error",ce,Kt)}}function W(ce,pt,Kt){{var ne=Z.ReactDebugCurrentFrame,Te=ne.getStackAddendum();Te!==""&&(pt+="%s",Kt=Kt.concat([Te]));var nt=Kt.map(function(Vt){return String(Vt)});nt.unshift("Warning: "+pt),Function.prototype.apply.call(console[ce],console,nt)}}var N=!1,K=!1,T=!1,L=!1,k=!1,E;E=Symbol.for("react.module.reference");function F(ce){return!!(typeof ce=="string"||typeof ce=="function"||ce===n||ce===o||k||ce===a||ce===C||ce===A||L||ce===y||N||K||T||typeof ce=="object"&&ce!==null&&(ce.$$typeof===m||ce.$$typeof===p||ce.$$typeof===l||ce.$$typeof===u||ce.$$typeof===d||ce.$$typeof===E||ce.getModuleId!==void 0))}function U(ce,pt,Kt){var ne=ce.displayName;if(ne)return ne;var Te=pt.displayName||pt.name||"";return Te!==""?Kt+"("+Te+")":Kt}function le(ce){return ce.displayName||"Context"}function ie(ce){if(ce==null)return null;if(typeof ce.tag=="number"&&x("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof ce=="function")return ce.displayName||ce.name||null;if(typeof ce=="string")return ce;switch(ce){case n:return"Fragment";case t:return"Portal";case o:return"Profiler";case a:return"StrictMode";case C:return"Suspense";case A:return"SuspenseList"}if(typeof ce=="object")switch(ce.$$typeof){case u:var pt=ce;return le(pt)+".Consumer";case l:var Kt=ce;return le(Kt._context)+".Provider";case d:return U(ce,ce.render,"ForwardRef");case p:var ne=ce.displayName||null;return ne!==null?ne:ie(ce.type)||"Memo";case m:{var Te=ce,nt=Te._payload,Vt=Te._init;try{return ie(Vt(nt))}catch{return null}}}return null}var Ce=Object.assign,Ge=0,ye,pe,de,Oe,We,ke,$e;function ot(){}ot.__reactDisabledLog=!0;function Ne(){{if(Ge===0){ye=console.log,pe=console.info,de=console.warn,Oe=console.error,We=console.group,ke=console.groupCollapsed,$e=console.groupEnd;var ce={configurable:!0,enumerable:!0,value:ot,writable:!0};Object.defineProperties(console,{info:ce,log:ce,warn:ce,error:ce,group:ce,groupCollapsed:ce,groupEnd:ce})}Ge++}}function tt(){{if(Ge--,Ge===0){var ce={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Ce({},ce,{value:ye}),info:Ce({},ce,{value:pe}),warn:Ce({},ce,{value:de}),error:Ce({},ce,{value:Oe}),group:Ce({},ce,{value:We}),groupCollapsed:Ce({},ce,{value:ke}),groupEnd:Ce({},ce,{value:$e})})}Ge<0&&x("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var bt=Z.ReactCurrentDispatcher,dt;function yt(ce,pt,Kt){{if(dt===void 0)try{throw Error()}catch(Te){var ne=Te.stack.trim().match(/\n( *(at )?)/);dt=ne&&ne[1]||""}return`
`+dt+ce}}var zt=!1,Nt;{var Lt=typeof WeakMap=="function"?WeakMap:Map;Nt=new Lt}function Ue(ce,pt){if(!ce||zt)return"";{var Kt=Nt.get(ce);if(Kt!==void 0)return Kt}var ne;zt=!0;var Te=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var nt;nt=bt.current,bt.current=null,Ne();try{if(pt){var Vt=function(){throw Error()};if(Object.defineProperty(Vt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Vt,[])}catch(Ae){ne=Ae}Reflect.construct(ce,[],Vt)}else{try{Vt.call()}catch(Ae){ne=Ae}ce.call(Vt.prototype)}}else{try{throw Error()}catch(Ae){ne=Ae}ce()}}catch(Ae){if(Ae&&ne&&typeof Ae.stack=="string"){for(var kt=Ae.stack.split(`
`),dn=ne.stack.split(`
`),Ut=kt.length-1,D=dn.length-1;Ut>=1&&D>=0&&kt[Ut]!==dn[D];)D--;for(;Ut>=1&&D>=0;Ut--,D--)if(kt[Ut]!==dn[D]){if(Ut!==1||D!==1)do if(Ut--,D--,D<0||kt[Ut]!==dn[D]){var he=`
`+kt[Ut].replace(" at new "," at ");return ce.displayName&&he.includes("<anonymous>")&&(he=he.replace("<anonymous>",ce.displayName)),typeof ce=="function"&&Nt.set(ce,he),he}while(Ut>=1&&D>=0);break}}}finally{zt=!1,bt.current=nt,tt(),Error.prepareStackTrace=Te}var Ze=ce?ce.displayName||ce.name:"",Se=Ze?yt(Ze):"";return typeof ce=="function"&&Nt.set(ce,Se),Se}function Pe(ce,pt,Kt){return Ue(ce,!1)}function te(ce){var pt=ce.prototype;return!!(pt&&pt.isReactComponent)}function Gt(ce,pt,Kt){if(ce==null)return"";if(typeof ce=="function")return Ue(ce,te(ce));if(typeof ce=="string")return yt(ce);switch(ce){case C:return yt("Suspense");case A:return yt("SuspenseList")}if(typeof ce=="object")switch(ce.$$typeof){case d:return Pe(ce.render);case p:return Gt(ce.type,pt,Kt);case m:{var ne=ce,Te=ne._payload,nt=ne._init;try{return Gt(nt(Te),pt,Kt)}catch{}}}return""}var Qe=Object.prototype.hasOwnProperty,ht={},Ct=Z.ReactDebugCurrentFrame;function Tt(ce){if(ce){var pt=ce._owner,Kt=Gt(ce.type,ce._source,pt?pt.type:null);Ct.setExtraStackFrame(Kt)}else Ct.setExtraStackFrame(null)}function Rt(ce,pt,Kt,ne,Te){{var nt=Function.call.bind(Qe);for(var Vt in ce)if(nt(ce,Vt)){var kt=void 0;try{if(typeof ce[Vt]!="function"){var dn=Error((ne||"React class")+": "+Kt+" type `"+Vt+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof ce[Vt]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw dn.name="Invariant Violation",dn}kt=ce[Vt](pt,Vt,ne,Kt,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Ut){kt=Ut}kt&&!(kt instanceof Error)&&(Tt(Te),x("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",ne||"React class",Kt,Vt,typeof kt),Tt(null)),kt instanceof Error&&!(kt.message in ht)&&(ht[kt.message]=!0,Tt(Te),x("Failed %s type: %s",Kt,kt.message),Tt(null))}}}var $=Array.isArray;function J(ce){return $(ce)}function fe(ce){{var pt=typeof Symbol=="function"&&Symbol.toStringTag,Kt=pt&&ce[Symbol.toStringTag]||ce.constructor.name||"Object";return Kt}}function ze(ce){try{return et(ce),!1}catch{return!0}}function et(ce){return""+ce}function _e(ce){if(ze(ce))return x("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",fe(ce)),et(ce)}var At=Z.ReactCurrentOwner,Zt={key:!0,ref:!0,__self:!0,__source:!0},Xt,An,j;j={};function ue(ce){if(Qe.call(ce,"ref")){var pt=Object.getOwnPropertyDescriptor(ce,"ref").get;if(pt&&pt.isReactWarning)return!1}return ce.ref!==void 0}function Ve(ce){if(Qe.call(ce,"key")){var pt=Object.getOwnPropertyDescriptor(ce,"key").get;if(pt&&pt.isReactWarning)return!1}return ce.key!==void 0}function qe(ce,pt){if(typeof ce.ref=="string"&&At.current&&pt&&At.current.stateNode!==pt){var Kt=ie(At.current.type);j[Kt]||(x('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',ie(At.current.type),ce.ref),j[Kt]=!0)}}function Me(ce,pt){{var Kt=function(){Xt||(Xt=!0,x("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",pt))};Kt.isReactWarning=!0,Object.defineProperty(ce,"key",{get:Kt,configurable:!0})}}function se(ce,pt){{var Kt=function(){An||(An=!0,x("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",pt))};Kt.isReactWarning=!0,Object.defineProperty(ce,"ref",{get:Kt,configurable:!0})}}var Re=function(ce,pt,Kt,ne,Te,nt,Vt){var kt={$$typeof:e,type:ce,key:pt,ref:Kt,props:Vt,_owner:nt};return kt._store={},Object.defineProperty(kt._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(kt,"_self",{configurable:!1,enumerable:!1,writable:!1,value:ne}),Object.defineProperty(kt,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Te}),Object.freeze&&(Object.freeze(kt.props),Object.freeze(kt)),kt};function De(ce,pt,Kt,ne,Te){{var nt,Vt={},kt=null,dn=null;Kt!==void 0&&(_e(Kt),kt=""+Kt),Ve(pt)&&(_e(pt.key),kt=""+pt.key),ue(pt)&&(dn=pt.ref,qe(pt,Te));for(nt in pt)Qe.call(pt,nt)&&!Zt.hasOwnProperty(nt)&&(Vt[nt]=pt[nt]);if(ce&&ce.defaultProps){var Ut=ce.defaultProps;for(nt in Ut)Vt[nt]===void 0&&(Vt[nt]=Ut[nt])}if(kt||dn){var D=typeof ce=="function"?ce.displayName||ce.name||"Unknown":ce;kt&&Me(Vt,D),dn&&se(Vt,D)}return Re(ce,kt,dn,Te,ne,At.current,Vt)}}var Q=Z.ReactCurrentOwner,st=Z.ReactDebugCurrentFrame;function be(ce){if(ce){var pt=ce._owner,Kt=Gt(ce.type,ce._source,pt?pt.type:null);st.setExtraStackFrame(Kt)}else st.setExtraStackFrame(null)}var Be;Be=!1;function Ft(ce){return typeof ce=="object"&&ce!==null&&ce.$$typeof===e}function wt(){{if(Q.current){var ce=ie(Q.current.type);if(ce)return`

Check the render method of \``+ce+"`."}return""}}function ln(ce){{if(ce!==void 0){var pt=ce.fileName.replace(/^.*[\\\/]/,""),Kt=ce.lineNumber;return`

Check your code at `+pt+":"+Kt+"."}return""}}var Yn={};function un(ce){{var pt=wt();if(!pt){var Kt=typeof ce=="string"?ce:ce.displayName||ce.name;Kt&&(pt=`

Check the top-level render call using <`+Kt+">.")}return pt}}function bn(ce,pt){{if(!ce._store||ce._store.validated||ce.key!=null)return;ce._store.validated=!0;var Kt=un(pt);if(Yn[Kt])return;Yn[Kt]=!0;var ne="";ce&&ce._owner&&ce._owner!==Q.current&&(ne=" It was passed a child from "+ie(ce._owner.type)+"."),be(ce),x('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Kt,ne),be(null)}}function ui(ce,pt){{if(typeof ce!="object")return;if(J(ce))for(var Kt=0;Kt<ce.length;Kt++){var ne=ce[Kt];Ft(ne)&&bn(ne,pt)}else if(Ft(ce))ce._store&&(ce._store.validated=!0);else if(ce){var Te=R(ce);if(typeof Te=="function"&&Te!==ce.entries)for(var nt=Te.call(ce),Vt;!(Vt=nt.next()).done;)Ft(Vt.value)&&bn(Vt.value,pt)}}}function bi(ce){{var pt=ce.type;if(pt==null||typeof pt=="string")return;var Kt;if(typeof pt=="function")Kt=pt.propTypes;else if(typeof pt=="object"&&(pt.$$typeof===d||pt.$$typeof===p))Kt=pt.propTypes;else return;if(Kt){var ne=ie(pt);Rt(Kt,ce.props,"prop",ne,ce)}else if(pt.PropTypes!==void 0&&!Be){Be=!0;var Te=ie(pt);x("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Te||"Unknown")}typeof pt.getDefaultProps=="function"&&!pt.getDefaultProps.isReactClassApproved&&x("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function aa(ce){{for(var pt=Object.keys(ce.props),Kt=0;Kt<pt.length;Kt++){var ne=pt[Kt];if(ne!=="children"&&ne!=="key"){be(ce),x("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",ne),be(null);break}}ce.ref!==null&&(be(ce),x("Invalid attribute `ref` supplied to `React.Fragment`."),be(null))}}var Ui={};function pa(ce,pt,Kt,ne,Te,nt){{var Vt=F(ce);if(!Vt){var kt="";(ce===void 0||typeof ce=="object"&&ce!==null&&Object.keys(ce).length===0)&&(kt+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var dn=ln(Te);dn?kt+=dn:kt+=wt();var Ut;ce===null?Ut="null":J(ce)?Ut="array":ce!==void 0&&ce.$$typeof===e?(Ut="<"+(ie(ce.type)||"Unknown")+" />",kt=" Did you accidentally export a JSX literal instead of a component?"):Ut=typeof ce,x("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Ut,kt)}var D=De(ce,pt,Kt,Te,nt);if(D==null)return D;if(Vt){var he=pt.children;if(he!==void 0)if(ne)if(J(he)){for(var Ze=0;Ze<he.length;Ze++)ui(he[Ze],ce);Object.freeze&&Object.freeze(he)}else x("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ui(he,ce)}if(Qe.call(pt,"key")){var Se=ie(ce),Ae=Object.keys(pt).filter(function(Dt){return Dt!=="key"}),mt=Ae.length>0?"{key: someKey, "+Ae.join(": ..., ")+": ...}":"{key: someKey}";if(!Ui[Se+mt]){var Wt=Ae.length>0?"{"+Ae.join(": ..., ")+": ...}":"{}";x(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,mt,Se,Wt,Se),Ui[Se+mt]=!0}}return ce===n?aa(D):bi(D),D}}var ua=pa;cN.Fragment=n,cN.jsxDEV=ua})();YT.exports=cN;var It=YT.exports,ET={exports:{}},ul={},KT={exports:{}},LT={};(function(s){/**
 * @license React
 * scheduler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=!1,t=!1,n=5;function a(j,ue){var Ve=j.length;j.push(ue),u(j,ue,Ve)}function o(j){return j.length===0?null:j[0]}function l(j){if(j.length===0)return null;var ue=j[0],Ve=j.pop();return Ve!==ue&&(j[0]=Ve,d(j,Ve,0)),ue}function u(j,ue,Ve){for(var qe=Ve;qe>0;){var Me=qe-1>>>1,se=j[Me];if(C(se,ue)>0)j[Me]=ue,j[qe]=se,qe=Me;else return}}function d(j,ue,Ve){for(var qe=Ve,Me=j.length,se=Me>>>1;qe<se;){var Re=(qe+1)*2-1,De=j[Re],Q=Re+1,st=j[Q];if(C(De,ue)<0)Q<Me&&C(st,De)<0?(j[qe]=st,j[Q]=ue,qe=Q):(j[qe]=De,j[Re]=ue,qe=Re);else if(Q<Me&&C(st,ue)<0)j[qe]=st,j[Q]=ue,qe=Q;else return}}function C(j,ue){var Ve=j.sortIndex-ue.sortIndex;return Ve!==0?Ve:j.id-ue.id}var A=1,p=2,m=3,y=4,G=5;function w(j,ue){}var R=typeof performance=="object"&&typeof performance.now=="function";if(R){var Z=performance;s.unstable_now=function(){return Z.now()}}else{var x=Date,W=x.now();s.unstable_now=function(){return x.now()-W}}var N=1073741823,K=-1,T=250,L=5e3,k=1e4,E=N,F=[],U=[],le=1,ie=null,Ce=m,Ge=!1,ye=!1,pe=!1,de=typeof setTimeout=="function"?setTimeout:null,Oe=typeof clearTimeout=="function"?clearTimeout:null,We=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ke(j){for(var ue=o(U);ue!==null;){if(ue.callback===null)l(U);else if(ue.startTime<=j)l(U),ue.sortIndex=ue.expirationTime,a(F,ue);else return;ue=o(U)}}function $e(j){if(pe=!1,ke(j),!ye)if(o(F)!==null)ye=!0,_e(ot);else{var ue=o(U);ue!==null&&At($e,ue.startTime-j)}}function ot(j,ue){ye=!1,pe&&(pe=!1,Zt()),Ge=!0;var Ve=Ce;try{var qe;if(!t)return Ne(j,ue)}finally{ie=null,Ce=Ve,Ge=!1}}function Ne(j,ue){var Ve=ue;for(ke(Ve),ie=o(F);ie!==null&&!e&&!(ie.expirationTime>Ve&&(!j||Tt()));){var qe=ie.callback;if(typeof qe=="function"){ie.callback=null,Ce=ie.priorityLevel;var Me=ie.expirationTime<=Ve,se=qe(Me);Ve=s.unstable_now(),typeof se=="function"?ie.callback=se:ie===o(F)&&l(F),ke(Ve)}else l(F);ie=o(F)}if(ie!==null)return!0;var Re=o(U);return Re!==null&&At($e,Re.startTime-Ve),!1}function tt(j,ue){switch(j){case A:case p:case m:case y:case G:break;default:j=m}var Ve=Ce;Ce=j;try{return ue()}finally{Ce=Ve}}function bt(j){var ue;switch(Ce){case A:case p:case m:ue=m;break;default:ue=Ce;break}var Ve=Ce;Ce=ue;try{return j()}finally{Ce=Ve}}function dt(j){var ue=Ce;return function(){var Ve=Ce;Ce=ue;try{return j.apply(this,arguments)}finally{Ce=Ve}}}function yt(j,ue,Ve){var qe=s.unstable_now(),Me;if(typeof Ve=="object"&&Ve!==null){var se=Ve.delay;typeof se=="number"&&se>0?Me=qe+se:Me=qe}else Me=qe;var Re;switch(j){case A:Re=K;break;case p:Re=T;break;case G:Re=E;break;case y:Re=k;break;case m:default:Re=L;break}var De=Me+Re,Q={id:le++,callback:ue,priorityLevel:j,startTime:Me,expirationTime:De,sortIndex:-1};return Me>qe?(Q.sortIndex=Me,a(U,Q),o(F)===null&&Q===o(U)&&(pe?Zt():pe=!0,At($e,Me-qe))):(Q.sortIndex=De,a(F,Q),!ye&&!Ge&&(ye=!0,_e(ot))),Q}function zt(){}function Nt(){!ye&&!Ge&&(ye=!0,_e(ot))}function Lt(){return o(F)}function Ue(j){j.callback=null}function Pe(){return Ce}var te=!1,Gt=null,Qe=-1,ht=n,Ct=-1;function Tt(){var j=s.unstable_now()-Ct;return!(j<ht)}function Rt(){}function $(j){if(j<0||j>125){console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported");return}j>0?ht=Math.floor(1e3/j):ht=n}var J=function(){if(Gt!==null){var j=s.unstable_now();Ct=j;var ue=!0,Ve=!0;try{Ve=Gt(ue,j)}finally{Ve?fe():(te=!1,Gt=null)}}else te=!1},fe;if(typeof We=="function")fe=function(){We(J)};else if(typeof MessageChannel<"u"){var ze=new MessageChannel,et=ze.port2;ze.port1.onmessage=J,fe=function(){et.postMessage(null)}}else fe=function(){de(J,0)};function _e(j){Gt=j,te||(te=!0,fe())}function At(j,ue){Qe=de(function(){j(s.unstable_now())},ue)}function Zt(){Oe(Qe),Qe=-1}var Xt=Rt,An=null;s.unstable_IdlePriority=G,s.unstable_ImmediatePriority=A,s.unstable_LowPriority=y,s.unstable_NormalPriority=m,s.unstable_Profiling=An,s.unstable_UserBlockingPriority=p,s.unstable_cancelCallback=Ue,s.unstable_continueExecution=Nt,s.unstable_forceFrameRate=$,s.unstable_getCurrentPriorityLevel=Pe,s.unstable_getFirstCallbackNode=Lt,s.unstable_next=bt,s.unstable_pauseExecution=zt,s.unstable_requestPaint=Xt,s.unstable_runWithPriority=tt,s.unstable_scheduleCallback=yt,s.unstable_shouldYield=Tt,s.unstable_wrapCallback=dt,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(LT);KT.exports=LT;var l5=KT.exports;/**
 * @license React
 * react-dom.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var s=Fe,e=l5,t=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,n=!1;function a(i){n=i}function o(i){if(!n){for(var r=arguments.length,I=new Array(r>1?r-1:0),h=1;h<r;h++)I[h-1]=arguments[h];u("warn",i,I)}}function l(i){if(!n){for(var r=arguments.length,I=new Array(r>1?r-1:0),h=1;h<r;h++)I[h-1]=arguments[h];u("error",i,I)}}function u(i,r,I){{var h=t.ReactDebugCurrentFrame,b=h.getStackAddendum();b!==""&&(r+="%s",I=I.concat([b]));var S=I.map(function(M){return String(M)});S.unshift("Warning: "+r),Function.prototype.apply.call(console[i],console,S)}}var d=0,C=1,A=2,p=3,m=4,y=5,G=6,w=7,R=8,Z=9,x=10,W=11,N=12,K=13,T=14,L=15,k=16,E=17,F=18,U=19,le=21,ie=22,Ce=23,Ge=24,ye=25,pe=!0,de=!1,Oe=!1,We=!1,ke=!1,$e=!0,ot=!1,Ne=!0,tt=!0,bt=!0,dt=!0,yt=new Set,zt={},Nt={};function Lt(i,r){Ue(i,r),Ue(i+"Capture",r)}function Ue(i,r){zt[i]&&l("EventRegistry: More than one plugin attempted to publish the same registration name, `%s`.",i),zt[i]=r;{var I=i.toLowerCase();Nt[I]=i,i==="onDoubleClick"&&(Nt.ondblclick=i)}for(var h=0;h<r.length;h++)yt.add(r[h])}var Pe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",te=Object.prototype.hasOwnProperty;function Gt(i){{var r=typeof Symbol=="function"&&Symbol.toStringTag,I=r&&i[Symbol.toStringTag]||i.constructor.name||"Object";return I}}function Qe(i){try{return ht(i),!1}catch{return!0}}function ht(i){return""+i}function Ct(i,r){if(Qe(i))return l("The provided `%s` attribute is an unsupported type %s. This value must be coerced to a string before before using it here.",r,Gt(i)),ht(i)}function Tt(i){if(Qe(i))return l("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Gt(i)),ht(i)}function Rt(i,r){if(Qe(i))return l("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.",r,Gt(i)),ht(i)}function $(i,r){if(Qe(i))return l("The provided `%s` CSS property is an unsupported type %s. This value must be coerced to a string before before using it here.",r,Gt(i)),ht(i)}function J(i){if(Qe(i))return l("The provided HTML markup uses a value of unsupported type %s. This value must be coerced to a string before before using it here.",Gt(i)),ht(i)}function fe(i){if(Qe(i))return l("Form field values (value, checked, defaultValue, or defaultChecked props) must be strings, not %s. This value must be coerced to a string before before using it here.",Gt(i)),ht(i)}var ze=0,et=1,_e=2,At=3,Zt=4,Xt=5,An=6,j=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",ue=j+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",Ve=new RegExp("^["+j+"]["+ue+"]*$"),qe={},Me={};function se(i){return te.call(Me,i)?!0:te.call(qe,i)?!1:Ve.test(i)?(Me[i]=!0,!0):(qe[i]=!0,l("Invalid attribute name: `%s`",i),!1)}function Re(i,r,I){return r!==null?r.type===ze:I?!1:i.length>2&&(i[0]==="o"||i[0]==="O")&&(i[1]==="n"||i[1]==="N")}function De(i,r,I,h){if(I!==null&&I.type===ze)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":{if(h)return!1;if(I!==null)return!I.acceptsBooleans;var b=i.toLowerCase().slice(0,5);return b!=="data-"&&b!=="aria-"}default:return!1}}function Q(i,r,I,h){if(r===null||typeof r>"u"||De(i,r,I,h))return!0;if(h)return!1;if(I!==null)switch(I.type){case At:return!r;case Zt:return r===!1;case Xt:return isNaN(r);case An:return isNaN(r)||r<1}return!1}function st(i){return Be.hasOwnProperty(i)?Be[i]:null}function be(i,r,I,h,b,S,M){this.acceptsBooleans=r===_e||r===At||r===Zt,this.attributeName=h,this.attributeNamespace=b,this.mustUseProperty=I,this.propertyName=i,this.type=r,this.sanitizeURL=S,this.removeEmptyString=M}var Be={},Ft=["children","dangerouslySetInnerHTML","defaultValue","defaultChecked","innerHTML","suppressContentEditableWarning","suppressHydrationWarning","style"];Ft.forEach(function(i){Be[i]=new be(i,ze,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var r=i[0],I=i[1];Be[r]=new be(r,et,!1,I,null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){Be[i]=new be(i,_e,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Be[i]=new be(i,_e,!1,i,null,!1,!1)}),["allowFullScreen","async","autoFocus","autoPlay","controls","default","defer","disabled","disablePictureInPicture","disableRemotePlayback","formNoValidate","hidden","loop","noModule","noValidate","open","playsInline","readOnly","required","reversed","scoped","seamless","itemScope"].forEach(function(i){Be[i]=new be(i,At,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){Be[i]=new be(i,At,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){Be[i]=new be(i,Zt,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){Be[i]=new be(i,An,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){Be[i]=new be(i,Xt,!1,i.toLowerCase(),null,!1,!1)});var wt=/[\-\:]([a-z])/g,ln=function(i){return i[1].toUpperCase()};["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","paint-order","panose-1","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","xmlns:xlink","x-height"].forEach(function(i){var r=i.replace(wt,ln);Be[r]=new be(r,et,!1,i,null,!1,!1)}),["xlink:actuate","xlink:arcrole","xlink:role","xlink:show","xlink:title","xlink:type"].forEach(function(i){var r=i.replace(wt,ln);Be[r]=new be(r,et,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var r=i.replace(wt,ln);Be[r]=new be(r,et,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){Be[i]=new be(i,et,!1,i.toLowerCase(),null,!1,!1)});var Yn="xlinkHref";Be[Yn]=new be("xlinkHref",et,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){Be[i]=new be(i,et,!1,i.toLowerCase(),null,!0,!0)});var un=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,bn=!1;function ui(i){!bn&&un.test(i)&&(bn=!0,l("A future version of React will block javascript: URLs as a security precaution. Use event handlers instead if you can. If you need to generate unsafe HTML try using dangerouslySetInnerHTML instead. React was passed %s.",JSON.stringify(i)))}function bi(i,r,I,h){if(h.mustUseProperty){var b=h.propertyName;return i[b]}else{Ct(I,r),h.sanitizeURL&&ui(""+I);var S=h.attributeName,M=null;if(h.type===Zt){if(i.hasAttribute(S)){var X=i.getAttribute(S);return X===""?!0:Q(r,I,h,!1)?X:X===""+I?I:X}}else if(i.hasAttribute(S)){if(Q(r,I,h,!1))return i.getAttribute(S);if(h.type===At)return I;M=i.getAttribute(S)}return Q(r,I,h,!1)?M===null?I:M:M===""+I?I:M}}function aa(i,r,I,h){{if(!se(r))return;if(!i.hasAttribute(r))return I===void 0?void 0:null;var b=i.getAttribute(r);return Ct(I,r),b===""+I?I:b}}function Ui(i,r,I,h){var b=st(r);if(!Re(r,b,h)){if(Q(r,I,b,h)&&(I=null),h||b===null){if(se(r)){var S=r;I===null?i.removeAttribute(S):(Ct(I,r),i.setAttribute(S,""+I))}return}var M=b.mustUseProperty;if(M){var X=b.propertyName;if(I===null){var Y=b.type;i[X]=Y===At?!1:""}else i[X]=I;return}var P=b.attributeName,ee=b.attributeNamespace;if(I===null)i.removeAttribute(P);else{var ve=b.type,me;ve===At||ve===Zt&&I===!0?me="":(Ct(I,P),me=""+I,b.sanitizeURL&&ui(me.toString())),ee?i.setAttributeNS(ee,P,me):i.setAttribute(P,me)}}}var pa=Symbol.for("react.element"),ua=Symbol.for("react.portal"),ce=Symbol.for("react.fragment"),pt=Symbol.for("react.strict_mode"),Kt=Symbol.for("react.profiler"),ne=Symbol.for("react.provider"),Te=Symbol.for("react.context"),nt=Symbol.for("react.forward_ref"),Vt=Symbol.for("react.suspense"),kt=Symbol.for("react.suspense_list"),dn=Symbol.for("react.memo"),Ut=Symbol.for("react.lazy"),D=Symbol.for("react.scope"),he=Symbol.for("react.debug_trace_mode"),Ze=Symbol.for("react.offscreen"),Se=Symbol.for("react.legacy_hidden"),Ae=Symbol.for("react.cache"),mt=Symbol.for("react.tracing_marker"),Wt=Symbol.iterator,Dt="@@iterator";function Ot(i){if(i===null||typeof i!="object")return null;var r=Wt&&i[Wt]||i[Dt];return typeof r=="function"?r:null}var Yt=Object.assign,Rn=0,sn,On,Ii,vi,Va,ti,In;function Fi(){}Fi.__reactDisabledLog=!0;function ni(){{if(Rn===0){sn=console.log,On=console.info,Ii=console.warn,vi=console.error,Va=console.group,ti=console.groupCollapsed,In=console.groupEnd;var i={configurable:!0,enumerable:!0,value:Fi,writable:!0};Object.defineProperties(console,{info:i,log:i,warn:i,error:i,group:i,groupCollapsed:i,groupEnd:i})}Rn++}}function Dr(){{if(Rn--,Rn===0){var i={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Yt({},i,{value:sn}),info:Yt({},i,{value:On}),warn:Yt({},i,{value:Ii}),error:Yt({},i,{value:vi}),group:Yt({},i,{value:Va}),groupCollapsed:Yt({},i,{value:ti}),groupEnd:Yt({},i,{value:In})})}Rn<0&&l("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var ls=t.ReactCurrentDispatcher,ma;function nr(i,r,I){{if(ma===void 0)try{throw Error()}catch(b){var h=b.stack.trim().match(/\n( *(at )?)/);ma=h&&h[1]||""}return`
`+ma+i}}var di=!1,ba;{var Lo=typeof WeakMap=="function"?WeakMap:Map;ba=new Lo}function za(i,r){if(!i||di)return"";{var I=ba.get(i);if(I!==void 0)return I}var h;di=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var S;S=ls.current,ls.current=null,ni();try{if(r){var M=function(){throw Error()};if(Object.defineProperty(M.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(M,[])}catch(Le){h=Le}Reflect.construct(i,[],M)}else{try{M.call()}catch(Le){h=Le}i.call(M.prototype)}}else{try{throw Error()}catch(Le){h=Le}i()}}catch(Le){if(Le&&h&&typeof Le.stack=="string"){for(var X=Le.stack.split(`
`),Y=h.stack.split(`
`),P=X.length-1,ee=Y.length-1;P>=1&&ee>=0&&X[P]!==Y[ee];)ee--;for(;P>=1&&ee>=0;P--,ee--)if(X[P]!==Y[ee]){if(P!==1||ee!==1)do if(P--,ee--,ee<0||X[P]!==Y[ee]){var ve=`
`+X[P].replace(" at new "," at ");return i.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",i.displayName)),typeof i=="function"&&ba.set(i,ve),ve}while(P>=1&&ee>=0);break}}}finally{di=!1,ls.current=S,Dr(),Error.prepareStackTrace=b}var me=i?i.displayName||i.name:"",Ee=me?nr(me):"";return typeof i=="function"&&ba.set(i,Ee),Ee}function kr(i,r,I){return za(i,!0)}function Ur(i,r,I){return za(i,!1)}function ru(i){var r=i.prototype;return!!(r&&r.isReactComponent)}function Jc(i,r,I){if(i==null)return"";if(typeof i=="function")return za(i,ru(i));if(typeof i=="string")return nr(i);switch(i){case Vt:return nr("Suspense");case kt:return nr("SuspenseList")}if(typeof i=="object")switch(i.$$typeof){case nt:return Ur(i.render);case dn:return Jc(i.type,r,I);case Ut:{var h=i,b=h._payload,S=h._init;try{return Jc(S(b),r,I)}catch{}}}return""}function NI(i){switch(i._debugOwner&&i._debugOwner.type,i._debugSource,i.tag){case y:return nr(i.type);case k:return nr("Lazy");case K:return nr("Suspense");case U:return nr("SuspenseList");case d:case A:case L:return Ur(i.type);case W:return Ur(i.type.render);case C:return kr(i.type);default:return""}}function Oc(i){try{var r="",I=i;do r+=NI(I),I=I.return;while(I);return r}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}function HI(i,r,I){var h=i.displayName;if(h)return h;var b=r.displayName||r.name||"";return b!==""?I+"("+b+")":I}function fo(i){return i.displayName||"Context"}function Pn(i){if(i==null)return null;if(typeof i.tag=="number"&&l("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ce:return"Fragment";case ua:return"Portal";case Kt:return"Profiler";case pt:return"StrictMode";case Vt:return"Suspense";case kt:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Te:var r=i;return fo(r)+".Consumer";case ne:var I=i;return fo(I._context)+".Provider";case nt:return HI(i,i.render,"ForwardRef");case dn:var h=i.displayName||null;return h!==null?h:Pn(i.type)||"Memo";case Ut:{var b=i,S=b._payload,M=b._init;try{return Pn(M(S))}catch{return null}}}return null}function dr(i,r,I){var h=r.displayName||r.name||"";return i.displayName||(h!==""?I+"("+h+")":I)}function dC(i){return i.displayName||"Context"}function Tn(i){var r=i.tag,I=i.type;switch(r){case Ge:return"Cache";case Z:var h=I;return dC(h)+".Consumer";case x:var b=I;return dC(b._context)+".Provider";case F:return"DehydratedFragment";case W:return dr(I,I.render,"ForwardRef");case w:return"Fragment";case y:return I;case m:return"Portal";case p:return"Root";case G:return"Text";case k:return Pn(I);case R:return I===pt?"StrictMode":"Mode";case ie:return"Offscreen";case N:return"Profiler";case le:return"Scope";case K:return"Suspense";case U:return"SuspenseList";case ye:return"TracingMarker";case C:case d:case E:case A:case T:case L:if(typeof I=="function")return I.displayName||I.name||null;if(typeof I=="string")return I;break}return null}var nf=t.ReactDebugCurrentFrame,wr=null,ou=!1;function Pc(){{if(wr===null)return null;var i=wr._debugOwner;if(i!==null&&typeof i<"u")return Tn(i)}return null}function kl(){return wr===null?"":Oc(wr)}function ir(){nf.getCurrentStack=null,wr=null,ou=!1}function ra(i){nf.getCurrentStack=i===null?null:kl,wr=i,ou=!1}function af(){return wr}function Cr(i){ou=i}function po(i){return""+i}function fl(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return fe(i),i;default:return""}}var vb={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0};function XI(i,r){vb[r.type]||r.onChange||r.onInput||r.readOnly||r.disabled||r.value==null||l("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`."),r.onChange||r.readOnly||r.disabled||r.checked==null||l("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")}function su(i){var r=i.type,I=i.nodeName;return I&&I.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function rf(i){return i._valueTracker}function Qc(i){i._valueTracker=null}function of(i){var r="";return i&&(su(i)?r=i.checked?"true":"false":r=i.value),r}function sf(i){var r=su(i)?"checked":"value",I=Object.getOwnPropertyDescriptor(i.constructor.prototype,r);fe(i[r]);var h=""+i[r];if(!(i.hasOwnProperty(r)||typeof I>"u"||typeof I.get!="function"||typeof I.set!="function")){var b=I.get,S=I.set;Object.defineProperty(i,r,{configurable:!0,get:function(){return b.call(this)},set:function(X){fe(X),h=""+X,S.call(this,X)}}),Object.defineProperty(i,r,{enumerable:I.enumerable});var M={getValue:function(){return h},setValue:function(X){fe(X),h=""+X},stopTracking:function(){Qc(i),delete i[r]}};return M}}function Ul(i){rf(i)||(i._valueTracker=sf(i))}function FI(i){if(!i)return!1;var r=rf(i);if(!r)return!0;var I=r.getValue(),h=of(i);return h!==I?(r.setValue(h),!0):!1}function jc(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var lu=!1,lf=!1,cf=!1,gf=!1;function uf(i){var r=i.type==="checkbox"||i.type==="radio";return r?i.checked!=null:i.value!=null}function z(i,r){var I=i,h=r.checked,b=Yt({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??I._wrapperState.initialChecked});return b}function ge(i,r){XI("input",r),r.checked!==void 0&&r.defaultChecked!==void 0&&!lf&&(l("%s contains an input of type %s with both checked and defaultChecked props. Input elements must be either controlled or uncontrolled (specify either the checked prop, or the defaultChecked prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",Pc()||"A component",r.type),lf=!0),r.value!==void 0&&r.defaultValue!==void 0&&!lu&&(l("%s contains an input of type %s with both value and defaultValue props. Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",Pc()||"A component",r.type),lu=!0);var I=i,h=r.defaultValue==null?"":r.defaultValue;I._wrapperState={initialChecked:r.checked!=null?r.checked:r.defaultChecked,initialValue:fl(r.value!=null?r.value:h),controlled:uf(r)}}function Ke(i,r){var I=i,h=r.checked;h!=null&&Ui(I,"checked",h,!1)}function je(i,r){var I=i;{var h=uf(r);!I._wrapperState.controlled&&h&&!gf&&(l("A component is changing an uncontrolled input to be controlled. This is likely caused by the value changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),gf=!0),I._wrapperState.controlled&&!h&&!cf&&(l("A component is changing a controlled input to be uncontrolled. This is likely caused by the value changing from a defined to undefined, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),cf=!0)}Ke(i,r);var b=fl(r.value),S=r.type;if(b!=null)S==="number"?(b===0&&I.value===""||I.value!=b)&&(I.value=po(b)):I.value!==po(b)&&(I.value=po(b));else if(S==="submit"||S==="reset"){I.removeAttribute("value");return}r.hasOwnProperty("value")?Wn(I,r.type,b):r.hasOwnProperty("defaultValue")&&Wn(I,r.type,fl(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(I.defaultChecked=!!r.defaultChecked)}function Ht(i,r,I){var h=i;if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var b=r.type,S=b==="submit"||b==="reset";if(S&&(r.value===void 0||r.value===null))return;var M=po(h._wrapperState.initialValue);I||M!==h.value&&(h.value=M),h.defaultValue=M}var X=h.name;X!==""&&(h.name=""),h.defaultChecked=!h.defaultChecked,h.defaultChecked=!!h._wrapperState.initialChecked,X!==""&&(h.name=X)}function Bn(i,r){var I=i;je(I,r),cn(I,r)}function cn(i,r){var I=r.name;if(r.type==="radio"&&I!=null){for(var h=i;h.parentNode;)h=h.parentNode;Ct(I,"name");for(var b=h.querySelectorAll("input[name="+JSON.stringify(""+I)+'][type="radio"]'),S=0;S<b.length;S++){var M=b[S];if(!(M===i||M.form!==i.form)){var X=fs(M);if(!X)throw new Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");FI(M),je(M,X)}}}}function Wn(i,r,I){(r!=="number"||jc(i.ownerDocument)!==i)&&(I==null?i.defaultValue=po(i._wrapperState.initialValue):i.defaultValue!==po(I)&&(i.defaultValue=po(I)))}var $n=!1,wi=!1,Yi=!1;function Ti(i,r){r.value==null&&(typeof r.children=="object"&&r.children!==null?s.Children.forEach(r.children,function(I){I!=null&&(typeof I=="string"||typeof I=="number"||wi||(wi=!0,l("Cannot infer the option value of complex children. Pass a `value` prop or use a plain string as children to <option>.")))}):r.dangerouslySetInnerHTML!=null&&(Yi||(Yi=!0,l("Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected.")))),r.selected!=null&&!$n&&(l("Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."),$n=!0)}function Ji(i,r){r.value!=null&&i.setAttribute("value",po(fl(r.value)))}var ta=Array.isArray;function hi(i){return ta(i)}var Xs;Xs=!1;function YI(){var i=Pc();return i?`

Check the render method of \``+i+"`.":""}var CC=["value","defaultValue"];function yb(i){{XI("select",i);for(var r=0;r<CC.length;r++){var I=CC[r];if(i[I]!=null){var h=hi(i[I]);i.multiple&&!h?l("The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",I,YI()):!i.multiple&&h&&l("The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",I,YI())}}}}function Jl(i,r,I,h){var b=i.options;if(r){for(var S=I,M={},X=0;X<S.length;X++)M["$"+S[X]]=!0;for(var Y=0;Y<b.length;Y++){var P=M.hasOwnProperty("$"+b[Y].value);b[Y].selected!==P&&(b[Y].selected=P),P&&h&&(b[Y].defaultSelected=!0)}}else{for(var ee=po(fl(I)),ve=null,me=0;me<b.length;me++){if(b[me].value===ee){b[me].selected=!0,h&&(b[me].defaultSelected=!0);return}ve===null&&!b[me].disabled&&(ve=b[me])}ve!==null&&(ve.selected=!0)}}function hC(i,r){return Yt({},r,{value:void 0})}function AC(i,r){var I=i;yb(r),I._wrapperState={wasMultiple:!!r.multiple},r.value!==void 0&&r.defaultValue!==void 0&&!Xs&&(l("Select elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled select element and remove one of these props. More info: https://reactjs.org/link/controlled-components"),Xs=!0)}function Gb(i,r){var I=i;I.multiple=!!r.multiple;var h=r.value;h!=null?Jl(I,!!r.multiple,h,!1):r.defaultValue!=null&&Jl(I,!!r.multiple,r.defaultValue,!0)}function TG(i,r){var I=i,h=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!r.multiple;var b=r.value;b!=null?Jl(I,!!r.multiple,b,!1):h!==!!r.multiple&&(r.defaultValue!=null?Jl(I,!!r.multiple,r.defaultValue,!0):Jl(I,!!r.multiple,r.multiple?[]:"",!1))}function tx(i,r){var I=i,h=r.value;h!=null&&Jl(I,!!r.multiple,h,!1)}var EG=!1;function Bb(i,r){var I=i;if(r.dangerouslySetInnerHTML!=null)throw new Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");var h=Yt({},r,{value:void 0,defaultValue:void 0,children:po(I._wrapperState.initialValue)});return h}function KG(i,r){var I=i;XI("textarea",r),r.value!==void 0&&r.defaultValue!==void 0&&!EG&&(l("%s contains a textarea with both value and defaultValue props. Textarea elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled textarea and remove one of these props. More info: https://reactjs.org/link/controlled-components",Pc()||"A component"),EG=!0);var h=r.value;if(h==null){var b=r.children,S=r.defaultValue;if(b!=null){l("Use the `defaultValue` or `value` props instead of setting children on <textarea>.");{if(S!=null)throw new Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(hi(b)){if(b.length>1)throw new Error("<textarea> can only have at most one child.");b=b[0]}S=b}}S==null&&(S=""),h=S}I._wrapperState={initialValue:fl(h)}}function LG(i,r){var I=i,h=fl(r.value),b=fl(r.defaultValue);if(h!=null){var S=po(h);S!==I.value&&(I.value=S),r.defaultValue==null&&I.defaultValue!==S&&(I.defaultValue=S)}b!=null&&(I.defaultValue=po(b))}function zG(i,r){var I=i,h=I.textContent;h===I._wrapperState.initialValue&&h!==""&&h!==null&&(I.value=h)}function nx(i,r){LG(i,r)}var Ol="http://www.w3.org/1999/xhtml",ix="http://www.w3.org/1998/Math/MathML",Zb="http://www.w3.org/2000/svg";function Sb(i){switch(i){case"svg":return Zb;case"math":return ix;default:return Ol}}function Rb(i,r){return i==null||i===Ol?Sb(r):i===Zb&&r==="foreignObject"?Ol:i}var ax=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,I,h,b){MSApp.execUnsafeLocalFunction(function(){return i(r,I,h,b)})}:i},If,_G=ax(function(i,r){if(i.namespaceURI===Zb&&!("innerHTML"in i)){If=If||document.createElement("div"),If.innerHTML="<svg>"+r.valueOf().toString()+"</svg>";for(var I=If.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;I.firstChild;)i.appendChild(I.firstChild);return}i.innerHTML=r}),mo=1,Pl=3,Ma=8,Ql=9,cu=11,fC=function(i,r){if(r){var I=i.firstChild;if(I&&I===i.lastChild&&I.nodeType===Pl){I.nodeValue=r;return}}i.textContent=r},DG={animation:["animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction"],background:["backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize"],backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:["borderBottomColor","borderBottomStyle","borderBottomWidth","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRightColor","borderRightStyle","borderRightWidth","borderTopColor","borderTopStyle","borderTopWidth"],borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:["fontFamily","fontFeatureSettings","fontKerning","fontLanguageOverride","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","lineHeight"],fontVariant:["fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition"],gap:["columnGap","rowGap"],grid:["gridAutoColumns","gridAutoFlow","gridAutoRows","gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:["maskClip","maskComposite","maskImage","maskMode","maskOrigin","maskPositionX","maskPositionY","maskRepeat","maskSize"],maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},TI={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function kG(i,r){return i+r.charAt(0).toUpperCase()+r.substring(1)}var UG=["Webkit","ms","Moz","O"];Object.keys(TI).forEach(function(i){UG.forEach(function(r){TI[kG(r,i)]=TI[i]})});function df(i,r,I){var h=r==null||typeof r=="boolean"||r==="";return h?"":!I&&typeof r=="number"&&r!==0&&!(TI.hasOwnProperty(i)&&TI[i])?r+"px":($(r,i),(""+r).trim())}var JG=/([A-Z])/g,OG=/^ms-/;function rx(i){return i.replace(JG,"-$1").toLowerCase().replace(OG,"-ms-")}var PG=function(){};{var wb=/^(?:webkit|moz|o)[A-Z]/,xb=/^-ms-/,qc=/-(.)/g,Cf=/;\s*$/,jl={},Wb={},hf=!1,QG=!1,Vb=function(i){return i.replace(qc,function(r,I){return I.toUpperCase()})},ox=function(i){jl.hasOwnProperty(i)&&jl[i]||(jl[i]=!0,l("Unsupported style property %s. Did you mean %s?",i,Vb(i.replace(xb,"ms-"))))},Mb=function(i){jl.hasOwnProperty(i)&&jl[i]||(jl[i]=!0,l("Unsupported vendor-prefixed style property %s. Did you mean %s?",i,i.charAt(0).toUpperCase()+i.slice(1)))},jG=function(i,r){Wb.hasOwnProperty(r)&&Wb[r]||(Wb[r]=!0,l(`Style property values shouldn't contain a semicolon. Try "%s: %s" instead.`,i,r.replace(Cf,"")))},qG=function(i,r){hf||(hf=!0,l("`NaN` is an invalid value for the `%s` css style property.",i))},$G=function(i,r){QG||(QG=!0,l("`Infinity` is an invalid value for the `%s` css style property.",i))};PG=function(i,r){i.indexOf("-")>-1?ox(i):wb.test(i)?Mb(i):Cf.test(r)&&jG(i,r),typeof r=="number"&&(isNaN(r)?qG(i,r):isFinite(r)||$G(i,r))}}var Af=PG;function Fs(i){{var r="",I="";for(var h in i)if(i.hasOwnProperty(h)){var b=i[h];if(b!=null){var S=h.indexOf("--")===0;r+=I+(S?h:rx(h))+":",r+=df(h,b,S),I=";"}}return r||null}}function ff(i,r){var I=i.style;for(var h in r)if(r.hasOwnProperty(h)){var b=h.indexOf("--")===0;b||Af(h,r[h]);var S=df(h,r[h],b);h==="float"&&(h="cssFloat"),b?I.setProperty(h,S):I[h]=S}}function pf(i){return i==null||typeof i=="boolean"||i===""}function pl(i){var r={};for(var I in i)for(var h=DG[I]||[I],b=0;b<h.length;b++)r[h[b]]=I;return r}function $c(i,r){{if(!r)return;var I=pl(i),h=pl(r),b={};for(var S in I){var M=I[S],X=h[S];if(X&&M!==X){var Y=M+","+X;if(b[Y])continue;b[Y]=!0,l("%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",pf(i[M])?"Removing":"Updating",M,X)}}}}var xr={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},hr=Yt({menuitem:!0},xr),Nb="__html";function Jr(i,r){if(r){if(hr[i]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw new Error(i+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if(typeof r.dangerouslySetInnerHTML!="object"||!(Nb in r.dangerouslySetInnerHTML))throw new Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.")}if(!r.suppressContentEditableWarning&&r.contentEditable&&r.children!=null&&l("A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional."),r.style!=null&&typeof r.style!="object")throw new Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.")}}function Or(i,r){if(i.indexOf("-")===-1)return typeof r.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zo={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback",download:"download",draggable:"draggable",enctype:"encType",enterkeyhint:"enterKeyHint",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",imagesizes:"imageSizes",imagesrcset:"imageSrcSet",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},mf={"aria-current":0,"aria-description":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},Ys={},eB=new RegExp("^(aria)-["+ue+"]*$"),EI=new RegExp("^(aria)[A-Z]["+ue+"]*$");function bf(i,r){{if(te.call(Ys,r)&&Ys[r])return!0;if(EI.test(r)){var I="aria-"+r.slice(4).toLowerCase(),h=mf.hasOwnProperty(I)?I:null;if(h==null)return l("Invalid ARIA attribute `%s`. ARIA attributes follow the pattern aria-* and must be lowercase.",r),Ys[r]=!0,!0;if(r!==h)return l("Invalid ARIA attribute `%s`. Did you mean `%s`?",r,h),Ys[r]=!0,!0}if(eB.test(r)){var b=r.toLowerCase(),S=mf.hasOwnProperty(b)?b:null;if(S==null)return Ys[r]=!0,!1;if(r!==S)return l("Unknown ARIA attribute `%s`. Did you mean `%s`?",r,S),Ys[r]=!0,!0}}return!0}function ml(i,r){{var I=[];for(var h in r){var b=bf(i,h);b||I.push(h)}var S=I.map(function(M){return"`"+M+"`"}).join(", ");I.length===1?l("Invalid aria prop %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",S,i):I.length>1&&l("Invalid aria props %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",S,i)}}function vf(i,r){Or(i,r)||ml(i,r)}var yf=!1;function tB(i,r){{if(i!=="input"&&i!=="textarea"&&i!=="select")return;r!=null&&r.value===null&&!yf&&(yf=!0,i==="select"&&r.multiple?l("`value` prop on `%s` should not be null. Consider using an empty array when `multiple` is set to `true` to clear the component or `undefined` for uncontrolled components.",i):l("`value` prop on `%s` should not be null. Consider using an empty string to clear the component or `undefined` for uncontrolled components.",i))}}var Hb=function(){};{var ar={},Xb=/^on./,sx=/^on[^A-Z]/,KI=new RegExp("^(aria)-["+ue+"]*$"),nB=new RegExp("^(aria)[A-Z]["+ue+"]*$");Hb=function(i,r,I,h){if(te.call(ar,r)&&ar[r])return!0;var b=r.toLowerCase();if(b==="onfocusin"||b==="onfocusout")return l("React uses onFocus and onBlur instead of onFocusIn and onFocusOut. All React events are normalized to bubble, so onFocusIn and onFocusOut are not needed/supported by React."),ar[r]=!0,!0;if(h!=null){var S=h.registrationNameDependencies,M=h.possibleRegistrationNames;if(S.hasOwnProperty(r))return!0;var X=M.hasOwnProperty(b)?M[b]:null;if(X!=null)return l("Invalid event handler property `%s`. Did you mean `%s`?",r,X),ar[r]=!0,!0;if(Xb.test(r))return l("Unknown event handler property `%s`. It will be ignored.",r),ar[r]=!0,!0}else if(Xb.test(r))return sx.test(r)&&l("Invalid event handler property `%s`. React events use the camelCase naming convention, for example `onClick`.",r),ar[r]=!0,!0;if(KI.test(r)||nB.test(r))return!0;if(b==="innerhtml")return l("Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."),ar[r]=!0,!0;if(b==="aria")return l("The `aria` attribute is reserved for future use in React. Pass individual `aria-` attributes instead."),ar[r]=!0,!0;if(b==="is"&&I!==null&&I!==void 0&&typeof I!="string")return l("Received a `%s` for a string attribute `is`. If this is expected, cast the value to a string.",typeof I),ar[r]=!0,!0;if(typeof I=="number"&&isNaN(I))return l("Received NaN for the `%s` attribute. If this is expected, cast the value to a string.",r),ar[r]=!0,!0;var Y=st(r),P=Y!==null&&Y.type===ze;if(zo.hasOwnProperty(b)){var ee=zo[b];if(ee!==r)return l("Invalid DOM property `%s`. Did you mean `%s`?",r,ee),ar[r]=!0,!0}else if(!P&&r!==b)return l("React does not recognize the `%s` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `%s` instead. If you accidentally passed it from a parent component, remove it from the DOM element.",r,b),ar[r]=!0,!0;return typeof I=="boolean"&&De(r,I,Y,!1)?(I?l('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.',I,r,r,I,r):l('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.',I,r,r,I,r,r,r),ar[r]=!0,!0):P?!0:De(r,I,Y,!1)?(ar[r]=!0,!1):((I==="false"||I==="true")&&Y!==null&&Y.type===At&&(l("Received the string `%s` for the boolean attribute `%s`. %s Did you mean %s={%s}?",I,r,I==="false"?"The browser will interpret it as a truthy value.":'Although this works, it will not work as expected if you pass the string "false".',r,I),ar[r]=!0),!0)}}var Nn=function(i,r,I){{var h=[];for(var b in r){var S=Hb(i,b,r[b],I);S||h.push(b)}var M=h.map(function(X){return"`"+X+"`"}).join(", ");h.length===1?l("Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",M,i):h.length>1&&l("Invalid values for props %s on <%s> tag. Either remove them from the element, or pass a string or number value to keep them in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",M,i)}};function Hi(i,r,I){Or(i,r)||Nn(i,r,I)}var Ai=1,Ia=2,bo=4,iB=Ai|Ia|bo,pC=null;function lx(i){pC!==null&&l("Expected currently replaying event to be null. This error is likely caused by a bug in React. Please file an issue."),pC=i}function cx(){pC===null&&l("Expected currently replaying event to not be null. This error is likely caused by a bug in React. Please file an issue."),pC=null}function Fb(i){return i===pC}function Bt(i){var r=i.target||i.srcElement||window;return r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===Pl?r.parentNode:r}var Na=null,zn=null,Ts=null;function ql(i){var r=Zg(i);if(r){if(typeof Na!="function")throw new Error("setRestoreImplementation() needs to be called to handle a target for controlled events. This error is likely caused by a bug in React. Please file an issue.");var I=r.stateNode;if(I){var h=fs(I);Na(r.stateNode,r.type,h)}}}function gu(i){Na=i}function bl(i){zn?Ts?Ts.push(i):Ts=[i]:zn=i}function mC(){return zn!==null||Ts!==null}function uu(){if(zn){var i=zn,r=Ts;if(zn=null,Ts=null,ql(i),r)for(var I=0;I<r.length;I++)ql(r[I])}}var LI=function(i,r){return i(r)},Gf=function(){},bC=!1;function Yb(){var i=mC();i&&(Gf(),uu())}function Bf(i,r,I){if(bC)return i(r,I);bC=!0;try{return LI(i,r,I)}finally{bC=!1,Yb()}}function Tb(i,r,I){LI=i,Gf=I}function Eb(i){return i==="button"||i==="input"||i==="select"||i==="textarea"}function Kb(i,r,I){switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":return!!(I.disabled&&Eb(r));default:return!1}}function Iu(i,r){var I=i.stateNode;if(I===null)return null;var h=fs(I);if(h===null)return null;var b=h[r];if(Kb(r,i.type,h))return null;if(b&&typeof b!="function")throw new Error("Expected `"+r+"` listener to be a function, instead got a value of `"+typeof b+"` type.");return b}var vC=!1;if(Pe)try{var du={};Object.defineProperty(du,"passive",{get:function(){vC=!0}}),window.addEventListener("test",du,du),window.removeEventListener("test",du,du)}catch{vC=!1}function Zf(i,r,I,h,b,S,M,X,Y){var P=Array.prototype.slice.call(arguments,3);try{r.apply(I,P)}catch(ee){this.onError(ee)}}var Sf=Zf;if(typeof window<"u"&&typeof window.dispatchEvent=="function"&&typeof document<"u"&&typeof document.createEvent=="function"){var yC=document.createElement("react");Sf=function(r,I,h,b,S,M,X,Y,P){if(typeof document>"u"||document===null)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var ee=document.createEvent("Event"),ve=!1,me=!0,Ee=window.event,Le=Object.getOwnPropertyDescriptor(window,"event");function at(){yC.removeEventListener(rt,yn,!1),typeof window.event<"u"&&window.hasOwnProperty("event")&&(window.event=Ee)}var jt=Array.prototype.slice.call(arguments,3);function yn(){ve=!0,at(),I.apply(h,jt),me=!1}var Cn,li=!1,ii=!1;function He(Xe){if(Cn=Xe.error,li=!0,Cn===null&&Xe.colno===0&&Xe.lineno===0&&(ii=!0),Xe.defaultPrevented&&Cn!=null&&typeof Cn=="object")try{Cn._suppressLogging=!0}catch{}}var rt="react-"+(r||"invokeguardedcallback");if(window.addEventListener("error",He),yC.addEventListener(rt,yn,!1),ee.initEvent(rt,!1,!1),yC.dispatchEvent(ee),Le&&Object.defineProperty(window,"event",Le),ve&&me&&(li?ii&&(Cn=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):Cn=new Error(`An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the "Pause on exceptions" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue.`),this.onError(Cn)),window.removeEventListener("error",He),!ve)return at(),Zf.apply(this,arguments)}}var Lb=Sf,eg=!1,Cu=null,$l=!1,GC=null,zb={onError:function(i){eg=!0,Cu=i}};function BC(i,r,I,h,b,S,M,X,Y){eg=!1,Cu=null,Lb.apply(zb,arguments)}function _b(i,r,I,h,b,S,M,X,Y){if(BC.apply(this,arguments),eg){var P=Rf();$l||($l=!0,GC=P)}}function aB(){if($l){var i=GC;throw $l=!1,GC=null,i}}function ZC(){return eg}function Rf(){if(eg){var i=Cu;return eg=!1,Cu=null,i}else throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}function vl(i){return i._reactInternals}function hu(i){return i._reactInternals!==void 0}function _o(i,r){i._reactInternals=r}var Zn=0,Zi=1,oa=2,Qn=4,Es=16,tg=32,Db=64,fi=128,ec=256,ng=512,tc=1024,Ks=2048,Ls=4096,ig=8192,wf=16384,xf=Ks|Qn|Db|ng|tc|wf,gx=32767,zI=32768,Pr=65536,kb=131072,ag=1048576,Au=2097152,Do=4194304,SC=8388608,va=16777216,nc=33554432,En=Qn|tc|0,_I=oa|Qn|Es|tg|ng|Ls|ig,DI=Qn|Db|ng|ig,RC=Ks|Es,ic=Do|SC|Au,Ub=t.ReactCurrentOwner;function zs(i){var r=i,I=i;if(i.alternate)for(;r.return;)r=r.return;else{var h=r;do r=h,(r.flags&(oa|Ls))!==Zn&&(I=r.return),h=r.return;while(h)}return r.tag===p?I:null}function rB(i){if(i.tag===K){var r=i.memoizedState;if(r===null){var I=i.alternate;I!==null&&(r=I.memoizedState)}if(r!==null)return r.dehydrated}return null}function Jb(i){return i.tag===p?i.stateNode.containerInfo:null}function ux(i){return zs(i)===i}function Ob(i){{var r=Ub.current;if(r!==null&&r.tag===C){var I=r,h=I.stateNode;h._warnedAboutRefsInRender||l("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Tn(I)||"A component"),h._warnedAboutRefsInRender=!0}}var b=vl(i);return b?zs(b)===b:!1}function oB(i){if(zs(i)!==i)throw new Error("Unable to find node on an unmounted component.")}function Pb(i){var r=i.alternate;if(!r){var I=zs(i);if(I===null)throw new Error("Unable to find node on an unmounted component.");return I!==i?null:i}for(var h=i,b=r;;){var S=h.return;if(S===null)break;var M=S.alternate;if(M===null){var X=S.return;if(X!==null){h=b=X;continue}break}if(S.child===M.child){for(var Y=S.child;Y;){if(Y===h)return oB(S),i;if(Y===b)return oB(S),r;Y=Y.sibling}throw new Error("Unable to find node on an unmounted component.")}if(h.return!==b.return)h=S,b=M;else{for(var P=!1,ee=S.child;ee;){if(ee===h){P=!0,h=S,b=M;break}if(ee===b){P=!0,b=S,h=M;break}ee=ee.sibling}if(!P){for(ee=M.child;ee;){if(ee===h){P=!0,h=M,b=S;break}if(ee===b){P=!0,b=M,h=S;break}ee=ee.sibling}if(!P)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(h.alternate!==b)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(h.tag!==p)throw new Error("Unable to find node on an unmounted component.");return h.stateNode.current===h?i:r}function Qb(i){var r=Pb(i);return r!==null?_s(r):null}function _s(i){if(i.tag===y||i.tag===G)return i;for(var r=i.child;r!==null;){var I=_s(r);if(I!==null)return I;r=r.sibling}return null}function wC(i){var r=Pb(i);return r!==null?kI(r):null}function kI(i){if(i.tag===y||i.tag===G)return i;for(var r=i.child;r!==null;){if(r.tag!==m){var I=kI(r);if(I!==null)return I}r=r.sibling}return null}var Wf=e.unstable_scheduleCallback,xC=e.unstable_cancelCallback,Ds=e.unstable_shouldYield,rr=e.unstable_requestPaint,or=e.unstable_now,Ix=e.unstable_getCurrentPriorityLevel,Vf=e.unstable_ImmediatePriority,Mf=e.unstable_UserBlockingPriority,rg=e.unstable_NormalPriority,sB=e.unstable_LowPriority,jb=e.unstable_IdlePriority,dx=e.unstable_yieldValue,Cx=e.unstable_setDisableYieldValue,sa=null,_a=null,Pt=null,Qr=!1,cs=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u";function hx(i){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var r=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(r.isDisabled)return!0;if(!r.supportsFiber)return l("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{tt&&(i=Yt({},i,{getLaneLabelMap:fx,injectProfilingHooks:ks})),sa=r.inject(i),_a=r}catch(I){l("React instrumentation encountered an error: %s.",I)}return!!r.checkDCE}function Ax(i,r){if(_a&&typeof _a.onScheduleFiberRoot=="function")try{_a.onScheduleFiberRoot(sa,i,r)}catch(I){Qr||(Qr=!0,l("React instrumentation encountered an error: %s",I))}}function UI(i,r){if(_a&&typeof _a.onCommitFiberRoot=="function")try{var I=(i.current.flags&fi)===fi;if(bt){var h;switch(r){case jr:h=Vf;break;case Os:h=Mf;break;case Ps:h=rg;break;case nd:h=jb;break;default:h=rg;break}_a.onCommitFiberRoot(sa,i,h,I)}}catch(b){Qr||(Qr=!0,l("React instrumentation encountered an error: %s",b))}}function Wr(i){if(_a&&typeof _a.onPostCommitFiberRoot=="function")try{_a.onPostCommitFiberRoot(sa,i)}catch(r){Qr||(Qr=!0,l("React instrumentation encountered an error: %s",r))}}function en(i){if(_a&&typeof _a.onCommitFiberUnmount=="function")try{_a.onCommitFiberUnmount(sa,i)}catch(r){Qr||(Qr=!0,l("React instrumentation encountered an error: %s",r))}}function Ei(i){if(typeof dx=="function"&&(Cx(i),a(i)),_a&&typeof _a.setStrictMode=="function")try{_a.setStrictMode(sa,i)}catch(r){Qr||(Qr=!0,l("React instrumentation encountered an error: %s",r))}}function ks(i){Pt=i}function fx(){{for(var i=new Map,r=1,I=0;I<Us;I++){var h=Vx(r);i.set(r,h),r*=2}return i}}function px(i){Pt!==null&&typeof Pt.markCommitStarted=="function"&&Pt.markCommitStarted(i)}function lB(){Pt!==null&&typeof Pt.markCommitStopped=="function"&&Pt.markCommitStopped()}function WC(i){Pt!==null&&typeof Pt.markComponentRenderStarted=="function"&&Pt.markComponentRenderStarted(i)}function JI(){Pt!==null&&typeof Pt.markComponentRenderStopped=="function"&&Pt.markComponentRenderStopped()}function sr(i){Pt!==null&&typeof Pt.markComponentPassiveEffectMountStarted=="function"&&Pt.markComponentPassiveEffectMountStarted(i)}function mx(){Pt!==null&&typeof Pt.markComponentPassiveEffectMountStopped=="function"&&Pt.markComponentPassiveEffectMountStopped()}function bx(i){Pt!==null&&typeof Pt.markComponentPassiveEffectUnmountStarted=="function"&&Pt.markComponentPassiveEffectUnmountStarted(i)}function vx(){Pt!==null&&typeof Pt.markComponentPassiveEffectUnmountStopped=="function"&&Pt.markComponentPassiveEffectUnmountStopped()}function cB(i){Pt!==null&&typeof Pt.markComponentLayoutEffectMountStarted=="function"&&Pt.markComponentLayoutEffectMountStarted(i)}function VC(){Pt!==null&&typeof Pt.markComponentLayoutEffectMountStopped=="function"&&Pt.markComponentLayoutEffectMountStopped()}function fu(i){Pt!==null&&typeof Pt.markComponentLayoutEffectUnmountStarted=="function"&&Pt.markComponentLayoutEffectUnmountStarted(i)}function gB(){Pt!==null&&typeof Pt.markComponentLayoutEffectUnmountStopped=="function"&&Pt.markComponentLayoutEffectUnmountStopped()}function yx(i,r,I){Pt!==null&&typeof Pt.markComponentErrored=="function"&&Pt.markComponentErrored(i,r,I)}function Gx(i,r,I){Pt!==null&&typeof Pt.markComponentSuspended=="function"&&Pt.markComponentSuspended(i,r,I)}function Bx(i){Pt!==null&&typeof Pt.markLayoutEffectsStarted=="function"&&Pt.markLayoutEffectsStarted(i)}function Zx(){Pt!==null&&typeof Pt.markLayoutEffectsStopped=="function"&&Pt.markLayoutEffectsStopped()}function Sx(i){Pt!==null&&typeof Pt.markPassiveEffectsStarted=="function"&&Pt.markPassiveEffectsStarted(i)}function uB(){Pt!==null&&typeof Pt.markPassiveEffectsStopped=="function"&&Pt.markPassiveEffectsStopped()}function qb(i){Pt!==null&&typeof Pt.markRenderStarted=="function"&&Pt.markRenderStarted(i)}function Rx(){Pt!==null&&typeof Pt.markRenderYielded=="function"&&Pt.markRenderYielded()}function IB(){Pt!==null&&typeof Pt.markRenderStopped=="function"&&Pt.markRenderStopped()}function wx(i){Pt!==null&&typeof Pt.markRenderScheduled=="function"&&Pt.markRenderScheduled(i)}function xx(i,r){Pt!==null&&typeof Pt.markForceUpdateScheduled=="function"&&Pt.markForceUpdateScheduled(i,r)}function $b(i,r){Pt!==null&&typeof Pt.markStateUpdateScheduled=="function"&&Pt.markStateUpdateScheduled(i,r)}var vn=0,ei=1,xi=2,la=8,yl=16,dB=Math.clz32?Math.clz32:gs,ev=Math.log,Wx=Math.LN2;function gs(i){var r=i>>>0;return r===0?32:31-(ev(r)/Wx|0)|0}var Us=31,ft=0,Ha=0,Vn=1,OI=2,Gl=4,Vr=8,Js=16,MC=32,PI=4194240,NC=64,QI=128,tv=256,Nf=512,Hf=1024,vo=2048,pu=4096,nv=8192,iv=16384,lr=32768,Xa=65536,us=131072,ko=262144,av=524288,ac=1048576,mu=2097152,og=130023424,Bl=4194304,bu=8388608,vu=16777216,yu=33554432,rc=67108864,HC=Bl,jI=134217728,rv=268435455,qI=268435456,oc=536870912,Uo=1073741824;function Vx(i){{if(i&Vn)return"Sync";if(i&OI)return"InputContinuousHydration";if(i&Gl)return"InputContinuous";if(i&Vr)return"DefaultHydration";if(i&Js)return"Default";if(i&MC)return"TransitionHydration";if(i&PI)return"Transition";if(i&og)return"Retry";if(i&jI)return"SelectiveHydration";if(i&qI)return"IdleHydration";if(i&oc)return"Idle";if(i&Uo)return"Offscreen"}}var ai=-1,Gu=NC,sg=Bl;function lg(i){switch(gg(i)){case Vn:return Vn;case OI:return OI;case Gl:return Gl;case Vr:return Vr;case Js:return Js;case MC:return MC;case NC:case QI:case tv:case Nf:case Hf:case vo:case pu:case nv:case iv:case lr:case Xa:case us:case ko:case av:case ac:case mu:return i&PI;case Bl:case bu:case vu:case yu:case rc:return i&og;case jI:return jI;case qI:return qI;case oc:return oc;case Uo:return Uo;default:return l("Should have found matching lanes. This is a bug in React."),i}}function sc(i,r){var I=i.pendingLanes;if(I===ft)return ft;var h=ft,b=i.suspendedLanes,S=i.pingedLanes,M=I&rv;if(M!==ft){var X=M&~b;if(X!==ft)h=lg(X);else{var Y=M&S;Y!==ft&&(h=lg(Y))}}else{var P=I&~b;P!==ft?h=lg(P):S!==ft&&(h=lg(S))}if(h===ft)return ft;if(r!==ft&&r!==h&&(r&b)===ft){var ee=gg(h),ve=gg(r);if(ee>=ve||ee===Js&&(ve&PI)!==ft)return r}(h&Gl)!==ft&&(h|=I&Js);var me=i.entangledLanes;if(me!==ft)for(var Ee=i.entanglements,Le=h&me;Le>0;){var at=Zl(Le),jt=1<<at;h|=Ee[at],Le&=~jt}return h}function ov(i,r){for(var I=i.eventTimes,h=ai;r>0;){var b=Zl(r),S=1<<b,M=I[b];M>h&&(h=M),r&=~S}return h}function Xf(i,r){switch(i){case Vn:case OI:case Gl:return r+250;case Vr:case Js:case MC:case NC:case QI:case tv:case Nf:case Hf:case vo:case pu:case nv:case iv:case lr:case Xa:case us:case ko:case av:case ac:case mu:return r+5e3;case Bl:case bu:case vu:case yu:case rc:return ai;case jI:case qI:case oc:case Uo:return ai;default:return l("Should have found matching lanes. This is a bug in React."),ai}}function Ff(i,r){for(var I=i.pendingLanes,h=i.suspendedLanes,b=i.pingedLanes,S=i.expirationTimes,M=I;M>0;){var X=Zl(M),Y=1<<X,P=S[X];P===ai?((Y&h)===ft||(Y&b)!==ft)&&(S[X]=Xf(Y,r)):P<=r&&(i.expiredLanes|=Y),M&=~Y}}function CB(i){return lg(i.pendingLanes)}function Yf(i){var r=i.pendingLanes&~Uo;return r!==ft?r:r&Uo?Uo:ft}function hB(i){return(i&Vn)!==ft}function XC(i){return(i&rv)!==ft}function Tf(i){return(i&og)===i}function Mx(i){var r=Vn|Gl|Js;return(i&r)===ft}function Nx(i){return(i&PI)===i}function lc(i,r){var I=OI|Gl|Vr|Js;return(r&I)!==ft}function Fa(i,r){return(r&i.expiredLanes)!==ft}function cg(i){return(i&PI)!==ft}function sv(){var i=Gu;return Gu<<=1,(Gu&PI)===ft&&(Gu=NC),i}function Hx(){var i=sg;return sg<<=1,(sg&og)===ft&&(sg=Bl),i}function gg(i){return i&-i}function $I(i){return gg(i)}function Zl(i){return 31-dB(i)}function FC(i){return Zl(i)}function Mr(i,r){return(i&r)!==ft}function ug(i,r){return(i&r)===r}function Hn(i,r){return i|r}function ed(i,r){return i&~r}function lv(i,r){return i&r}function Ig(i){return i}function dg(i,r){return i!==Ha&&i<r?i:r}function td(i){for(var r=[],I=0;I<Us;I++)r.push(i);return r}function Bu(i,r,I){i.pendingLanes|=r,r!==oc&&(i.suspendedLanes=ft,i.pingedLanes=ft);var h=i.eventTimes,b=FC(r);h[b]=I}function Xx(i,r){i.suspendedLanes|=r,i.pingedLanes&=~r;for(var I=i.expirationTimes,h=r;h>0;){var b=Zl(h),S=1<<b;I[b]=ai,h&=~S}}function YC(i,r,I){i.pingedLanes|=i.suspendedLanes&r}function Fx(i,r){var I=i.pendingLanes&~r;i.pendingLanes=r,i.suspendedLanes=ft,i.pingedLanes=ft,i.expiredLanes&=r,i.mutableReadLanes&=r,i.entangledLanes&=r;for(var h=i.entanglements,b=i.eventTimes,S=i.expirationTimes,M=I;M>0;){var X=Zl(M),Y=1<<X;h[X]=ft,b[X]=ai,S[X]=ai,M&=~Y}}function Ef(i,r){for(var I=i.entangledLanes|=r,h=i.entanglements,b=I;b;){var S=Zl(b),M=1<<S;M&r|h[S]&r&&(h[S]|=r),b&=~M}}function Kf(i,r){var I=gg(r),h;switch(I){case Gl:h=OI;break;case Js:h=Vr;break;case NC:case QI:case tv:case Nf:case Hf:case vo:case pu:case nv:case iv:case lr:case Xa:case us:case ko:case av:case ac:case mu:case Bl:case bu:case vu:case yu:case rc:h=MC;break;case oc:h=qI;break;default:h=Ha;break}return(h&(i.suspendedLanes|r))!==Ha?Ha:h}function cv(i,r,I){if(cs)for(var h=i.pendingUpdatersLaneMap;I>0;){var b=FC(I),S=1<<b,M=h[b];M.add(r),I&=~S}}function Lf(i,r){if(cs)for(var I=i.pendingUpdatersLaneMap,h=i.memoizedUpdaters;r>0;){var b=FC(r),S=1<<b,M=I[b];M.size>0&&(M.forEach(function(X){var Y=X.alternate;(Y===null||!h.has(Y))&&h.add(X)}),M.clear()),r&=~S}}function gv(i,r){return null}var jr=Vn,Os=Gl,Ps=Js,nd=oc,Zu=Ha;function Is(){return Zu}function ya(i){Zu=i}function uv(i,r){var I=Zu;try{return Zu=i,r()}finally{Zu=I}}function Iv(i,r){return i!==0&&i<r?i:r}function dv(i,r){return i>r?i:r}function zf(i,r){return i!==0&&i<r}function _f(i){var r=gg(i);return zf(jr,r)?zf(Os,r)?XC(r)?Ps:nd:Os:jr}function id(i){var r=i.current.memoizedState;return r.isDehydrated}var Cv;function Yx(i){Cv=i}function AB(i){Cv(i)}var Df;function Tx(i){Df=i}var hv;function Av(i){hv=i}var fB;function Ex(i){fB=i}var Su;function ad(i){Su=i}var rd=!1,Ru=[],Da=null,ka=null,yo=null,Jo=new Map,Oo=new Map,Cg=[],Kx=["mousedown","mouseup","touchcancel","touchend","touchstart","auxclick","dblclick","pointercancel","pointerdown","pointerup","dragend","dragstart","drop","compositionend","compositionstart","keydown","keypress","keyup","input","textInput","copy","cut","paste","click","change","contextmenu","reset","submit"];function Lx(i){return Kx.indexOf(i)>-1}function wu(i,r,I,h,b){return{blockedOn:i,domEventName:r,eventSystemFlags:I,nativeEvent:b,targetContainers:[h]}}function fv(i,r){switch(i){case"focusin":case"focusout":Da=null;break;case"dragenter":case"dragleave":ka=null;break;case"mouseover":case"mouseout":yo=null;break;case"pointerover":case"pointerout":{var I=r.pointerId;Jo.delete(I);break}case"gotpointercapture":case"lostpointercapture":{var h=r.pointerId;Oo.delete(h);break}}}function xu(i,r,I,h,b,S){if(i===null||i.nativeEvent!==S){var M=wu(r,I,h,b,S);if(r!==null){var X=Zg(r);X!==null&&Df(X)}return M}i.eventSystemFlags|=h;var Y=i.targetContainers;return b!==null&&Y.indexOf(b)===-1&&Y.push(b),i}function kf(i,r,I,h,b){switch(r){case"focusin":{var S=b;return Da=xu(Da,i,r,I,h,S),!0}case"dragenter":{var M=b;return ka=xu(ka,i,r,I,h,M),!0}case"mouseover":{var X=b;return yo=xu(yo,i,r,I,h,X),!0}case"pointerover":{var Y=b,P=Y.pointerId;return Jo.set(P,xu(Jo.get(P)||null,i,r,I,h,Y)),!0}case"gotpointercapture":{var ee=b,ve=ee.pointerId;return Oo.set(ve,xu(Oo.get(ve)||null,i,r,I,h,ee)),!0}}return!1}function pB(i){var r=_u(i.target);if(r!==null){var I=zs(r);if(I!==null){var h=I.tag;if(h===K){var b=rB(I);if(b!==null){i.blockedOn=b,Su(i.priority,function(){hv(I)});return}}else if(h===p){var S=I.stateNode;if(id(S)){i.blockedOn=Jb(I);return}}}}i.blockedOn=null}function pv(i){for(var r=fB(),I={blockedOn:null,target:i,priority:r},h=0;h<Cg.length&&zf(r,Cg[h].priority);h++);Cg.splice(h,0,I),h===0&&pB(I)}function Uf(i){if(i.blockedOn!==null)return!1;for(var r=i.targetContainers;r.length>0;){var I=r[0],h=Of(i.domEventName,i.eventSystemFlags,I,i.nativeEvent);if(h===null){var b=i.nativeEvent,S=new b.constructor(b.type,b);lx(S),b.target.dispatchEvent(S),cx()}else{var M=Zg(h);return M!==null&&Df(M),i.blockedOn=h,!1}r.shift()}return!0}function mB(i,r,I){Uf(i)&&I.delete(r)}function Wu(){rd=!1,Da!==null&&Uf(Da)&&(Da=null),ka!==null&&Uf(ka)&&(ka=null),yo!==null&&Uf(yo)&&(yo=null),Jo.forEach(mB),Oo.forEach(mB)}function Ga(i,r){i.blockedOn===r&&(i.blockedOn=null,rd||(rd=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Wu)))}function Nr(i){if(Ru.length>0){Ga(Ru[0],i);for(var r=1;r<Ru.length;r++){var I=Ru[r];I.blockedOn===i&&(I.blockedOn=null)}}Da!==null&&Ga(Da,i),ka!==null&&Ga(ka,i),yo!==null&&Ga(yo,i);var h=function(X){return Ga(X,i)};Jo.forEach(h),Oo.forEach(h);for(var b=0;b<Cg.length;b++){var S=Cg[b];S.blockedOn===i&&(S.blockedOn=null)}for(;Cg.length>0;){var M=Cg[0];if(M.blockedOn!==null)break;pB(M),M.blockedOn===null&&Cg.shift()}}var Hr=t.ReactCurrentBatchConfig,cc=!0;function gc(i){cc=!!i}function zx(){return cc}function _x(i,r,I){var h=mv(r),b;switch(h){case jr:b=Dx;break;case Os:b=kx;break;case Ps:default:b=Jf;break}return b.bind(null,r,I,i)}function Dx(i,r,I,h){var b=Is(),S=Hr.transition;Hr.transition=null;try{ya(jr),Jf(i,r,I,h)}finally{ya(b),Hr.transition=S}}function kx(i,r,I,h){var b=Is(),S=Hr.transition;Hr.transition=null;try{ya(Os),Jf(i,r,I,h)}finally{ya(b),Hr.transition=S}}function Jf(i,r,I,h){cc&&bB(i,r,I,h)}function bB(i,r,I,h){var b=Of(i,r,I,h);if(b===null){wn(i,r,h,od,I),fv(i,h);return}if(kf(b,i,r,I,h)){h.stopPropagation();return}if(fv(i,h),r&bo&&Lx(i)){for(;b!==null;){var S=Zg(b);S!==null&&AB(S);var M=Of(i,r,I,h);if(M===null&&wn(i,r,h,od,I),M===b)break;b=M}b!==null&&h.stopPropagation();return}wn(i,r,h,null,I)}var od=null;function Of(i,r,I,h){od=null;var b=Bt(h),S=_u(b);if(S!==null){var M=zs(S);if(M===null)S=null;else{var X=M.tag;if(X===K){var Y=rB(M);if(Y!==null)return Y;S=null}else if(X===p){var P=M.stateNode;if(id(P))return Jb(M);S=null}else M!==S&&(S=null)}}return od=S,null}function mv(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return jr;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return Os;case"message":{var r=Ix();switch(r){case Vf:return jr;case Mf:return Os;case rg:case sB:return Ps;case jb:return nd;default:return Ps}}default:return Ps}}function bv(i,r,I){return i.addEventListener(r,I,!1),I}function vv(i,r,I){return i.addEventListener(r,I,!0),I}function yv(i,r,I,h){return i.addEventListener(r,I,{capture:!0,passive:h}),I}function Ux(i,r,I,h){return i.addEventListener(r,I,{passive:h}),I}var TC=null,Gv=null,EC=null;function vB(i){return TC=i,Gv=Bv(),!0}function KC(){TC=null,Gv=null,EC=null}function yB(){if(EC)return EC;var i,r=Gv,I=r.length,h,b=Bv(),S=b.length;for(i=0;i<I&&r[i]===b[i];i++);var M=I-i;for(h=1;h<=M&&r[I-h]===b[S-h];h++);var X=h>1?1-h:void 0;return EC=b.slice(i,X),EC}function Bv(){return"value"in TC?TC.value:TC.textContent}function uc(i){var r,I=i.keyCode;return"charCode"in i?(r=i.charCode,r===0&&I===13&&(r=13)):r=I,r===10&&(r=13),r>=32||r===13?r:0}function LC(){return!0}function Ar(){return!1}function qr(i){function r(I,h,b,S,M){this._reactName=I,this._targetInst=b,this.type=h,this.nativeEvent=S,this.target=M,this.currentTarget=null;for(var X in i)if(i.hasOwnProperty(X)){var Y=i[X];Y?this[X]=Y(S):this[X]=S[X]}var P=S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1;return P?this.isDefaultPrevented=LC:this.isDefaultPrevented=Ar,this.isPropagationStopped=Ar,this}return Yt(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var I=this.nativeEvent;I&&(I.preventDefault?I.preventDefault():typeof I.returnValue!="unknown"&&(I.returnValue=!1),this.isDefaultPrevented=LC)},stopPropagation:function(){var I=this.nativeEvent;I&&(I.stopPropagation?I.stopPropagation():typeof I.cancelBubble!="unknown"&&(I.cancelBubble=!0),this.isPropagationStopped=LC)},persist:function(){},isPersistent:LC}),r}var hg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zC=qr(hg),Vu=Yt({},hg,{view:0,detail:0}),Zv=qr(Vu),_C,Pf,Ic;function Qf(i){i!==Ic&&(Ic&&i.type==="mousemove"?(_C=i.screenX-Ic.screenX,Pf=i.screenY-Ic.screenY):(_C=0,Pf=0),Ic=i)}var Mu=Yt({},Vu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vv,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(Qf(i),_C)},movementY:function(i){return"movementY"in i?i.movementY:Pf}}),Sv=qr(Mu),GB=Yt({},Mu,{dataTransfer:0}),sd=qr(GB),BB=Yt({},Vu,{relatedTarget:0}),Rv=qr(BB),Jx=Yt({},hg,{animationName:0,elapsedTime:0,pseudoElement:0}),DC=qr(Jx),Ag=Yt({},hg,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),kC=qr(Ag),jf=Yt({},hg,{data:0}),UC=qr(jf),wv=UC,xv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ld={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function JC(i){if(i.key){var r=xv[i.key]||i.key;if(r!=="Unidentified")return r}if(i.type==="keypress"){var I=uc(i);return I===13?"Enter":String.fromCharCode(I)}return i.type==="keydown"||i.type==="keyup"?ld[i.keyCode]||"Unidentified":""}var ZB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wv(i){var r=this,I=r.nativeEvent;if(I.getModifierState)return I.getModifierState(i);var h=ZB[i];return h?!!I[h]:!1}function Vv(i){return Wv}var SB=Yt({},Vu,{key:JC,code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vv,charCode:function(i){return i.type==="keypress"?uc(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?uc(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),RB=qr(SB),OC=Yt({},Mu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ds=qr(OC),Mv=Yt({},Vu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vv}),cd=qr(Mv),Nv=Yt({},hg,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ox=qr(Nv),fg=Yt({},Mu,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),gd=qr(fg),Px=[9,13,27,32],PC=229,Cs=Pe&&"CompositionEvent"in window,Ki=null;Pe&&"documentMode"in document&&(Ki=document.documentMode);var pg=Pe&&"TextEvent"in window&&!Ki,da=Pe&&(!Cs||Ki&&Ki>8&&Ki<=11),cr=32,qf=String.fromCharCode(cr);function Hv(){Lt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Lt("onCompositionEnd",["compositionend","focusout","keydown","keypress","keyup","mousedown"]),Lt("onCompositionStart",["compositionstart","focusout","keydown","keypress","keyup","mousedown"]),Lt("onCompositionUpdate",["compositionupdate","focusout","keydown","keypress","keyup","mousedown"])}var wB=!1;function tn(i){return(i.ctrlKey||i.altKey||i.metaKey)&&!(i.ctrlKey&&i.altKey)}function Go(i){switch(i){case"compositionstart":return"onCompositionStart";case"compositionend":return"onCompositionEnd";case"compositionupdate":return"onCompositionUpdate"}}function Xv(i,r){return i==="keydown"&&r.keyCode===PC}function Nu(i,r){switch(i){case"keyup":return Px.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==PC;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hu(i){var r=i.detail;return typeof r=="object"&&"data"in r?r.data:null}function Mi(i){return i.locale==="ko"}var Ba=!1;function Ua(i,r,I,h,b){var S,M;if(Cs?S=Go(r):Ba?Nu(r,h)&&(S="onCompositionEnd"):Xv(r,h)&&(S="onCompositionStart"),!S)return null;da&&!Mi(h)&&(!Ba&&S==="onCompositionStart"?Ba=vB(b):S==="onCompositionEnd"&&Ba&&(M=yB()));var X=Eu(I,S);if(X.length>0){var Y=new UC(S,r,null,h,b);if(i.push({event:Y,listeners:X}),M)Y.data=M;else{var P=Hu(h);P!==null&&(Y.data=P)}}}function $f(i,r){switch(i){case"compositionend":return Hu(r);case"keypress":var I=r.which;return I!==cr?null:(wB=!0,qf);case"textInput":var h=r.data;return h===qf&&wB?null:h;default:return null}}function QC(i,r){if(Ba){if(i==="compositionend"||!Cs&&Nu(i,r)){var I=yB();return KC(),Ba=!1,I}return null}switch(i){case"paste":return null;case"keypress":if(!tn(r)){if(r.char&&r.char.length>1)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return da&&!Mi(r)?null:r.data;default:return null}}function jC(i,r,I,h,b){var S;if(pg?S=$f(r,h):S=QC(r,h),!S)return null;var M=Eu(I,"onBeforeInput");if(M.length>0){var X=new wv("onBeforeInput","beforeinput",null,h,b);i.push({event:X,listeners:M}),X.data=S}}function Qx(i,r,I,h,b,S,M){Ua(i,r,I,h,b),jC(i,r,I,h,b)}var jx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ct(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r==="input"?!!jx[i.type]:r==="textarea"}/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function hs(i){if(!Pe)return!1;var r="on"+i,I=r in document;if(!I){var h=document.createElement("div");h.setAttribute(r,"return;"),I=typeof h[r]=="function"}return I}function mg(){Lt("onChange",["change","click","focusin","focusout","input","keydown","keyup","selectionchange"])}function ep(i,r,I,h){bl(h);var b=Eu(r,"onChange");if(b.length>0){var S=new zC("onChange","change",null,I,h);i.push({event:S,listeners:b})}}var ri=null,Et=null;function ud(i){var r=i.nodeName&&i.nodeName.toLowerCase();return r==="select"||r==="input"&&i.type==="file"}function qx(i){var r=[];ep(r,Et,i,Bt(i)),Bf(Xr,r)}function Xr(i){jv(i,0)}function Id(i){var r=Oa(i);if(FI(r))return i}function dd(i,r){if(i==="change")return r}var Xu=!1;Pe&&(Xu=hs("input")&&(!document.documentMode||document.documentMode>9));function xB(i,r){ri=i,Et=r,ri.attachEvent("onpropertychange",Sl)}function Fv(){ri&&(ri.detachEvent("onpropertychange",Sl),ri=null,Et=null)}function Sl(i){i.propertyName==="value"&&Id(Et)&&qx(i)}function Rl(i,r,I){i==="focusin"?(Fv(),xB(r,I)):i==="focusout"&&Fv()}function WB(i,r){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Id(Et)}function Yv(i){var r=i.nodeName;return r&&r.toLowerCase()==="input"&&(i.type==="checkbox"||i.type==="radio")}function Tv(i,r){if(i==="click")return Id(r)}function Ev(i,r){if(i==="input"||i==="change")return Id(r)}function Kv(i){var r=i._wrapperState;!r||!r.controlled||i.type!=="number"||Wn(i,"number",i.value)}function qH(i,r,I,h,b,S,M){var X=I?Oa(I):window,Y,P;if(ud(X)?Y=dd:ct(X)?Xu?Y=Ev:(Y=WB,P=Rl):Yv(X)&&(Y=Tv),Y){var ee=Y(r,I);if(ee){ep(i,ee,h,b);return}}P&&P(r,X,I),r==="focusout"&&Kv(X)}function $H(){Ue("onMouseEnter",["mouseout","mouseover"]),Ue("onMouseLeave",["mouseout","mouseover"]),Ue("onPointerEnter",["pointerout","pointerover"]),Ue("onPointerLeave",["pointerout","pointerover"])}function Lv(i,r,I,h,b,S,M){var X=r==="mouseover"||r==="pointerover",Y=r==="mouseout"||r==="pointerout";if(X&&!Fb(h)){var P=h.relatedTarget||h.fromElement;if(P&&(_u(P)||fh(P)))return}if(!(!Y&&!X)){var ee;if(b.window===b)ee=b;else{var ve=b.ownerDocument;ve?ee=ve.defaultView||ve.parentWindow:ee=window}var me,Ee;if(Y){var Le=h.relatedTarget||h.toElement;if(me=I,Ee=Le?_u(Le):null,Ee!==null){var at=zs(Ee);(Ee!==at||Ee.tag!==y&&Ee.tag!==G)&&(Ee=null)}}else me=null,Ee=I;if(me!==Ee){var jt=Sv,yn="onMouseLeave",Cn="onMouseEnter",li="mouse";(r==="pointerout"||r==="pointerover")&&(jt=ds,yn="onPointerLeave",Cn="onPointerEnter",li="pointer");var ii=me==null?ee:Oa(me),He=Ee==null?ee:Oa(Ee),rt=new jt(yn,li+"leave",me,h,b);rt.target=ii,rt.relatedTarget=He;var Xe=null,St=_u(b);if(St===I){var on=new jt(Cn,li+"enter",Ee,h,b);on.target=He,on.relatedTarget=ii,Xe=on}mp(i,rt,Xe,me,Ee)}}}function tp(i,r){return i===r&&(i!==0||1/i===1/r)||i!==i&&r!==r}var Bo=typeof Object.is=="function"?Object.is:tp;function Cd(i,r){if(Bo(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;var I=Object.keys(i),h=Object.keys(r);if(I.length!==h.length)return!1;for(var b=0;b<I.length;b++){var S=I[b];if(!te.call(r,S)||!Bo(i[S],r[S]))return!1}return!0}function zv(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function VB(i){for(;i;){if(i.nextSibling)return i.nextSibling;i=i.parentNode}}function _v(i,r){for(var I=zv(i),h=0,b=0;I;){if(I.nodeType===Pl){if(b=h+I.textContent.length,h<=r&&b>=r)return{node:I,offset:r-h};h=b}I=zv(VB(I))}}function qC(i){var r=i.ownerDocument,I=r&&r.defaultView||window,h=I.getSelection&&I.getSelection();if(!h||h.rangeCount===0)return null;var b=h.anchorNode,S=h.anchorOffset,M=h.focusNode,X=h.focusOffset;try{b.nodeType,M.nodeType}catch{return null}return np(i,b,S,M,X)}function np(i,r,I,h,b){var S=0,M=-1,X=-1,Y=0,P=0,ee=i,ve=null;e:for(;;){for(var me=null;ee===r&&(I===0||ee.nodeType===Pl)&&(M=S+I),ee===h&&(b===0||ee.nodeType===Pl)&&(X=S+b),ee.nodeType===Pl&&(S+=ee.nodeValue.length),(me=ee.firstChild)!==null;)ve=ee,ee=me;for(;;){if(ee===i)break e;if(ve===r&&++Y===I&&(M=S),ve===h&&++P===b&&(X=S),(me=ee.nextSibling)!==null)break;ee=ve,ve=ee.parentNode}ee=me}return M===-1||X===-1?null:{start:M,end:X}}function ip(i,r){var I=i.ownerDocument||document,h=I&&I.defaultView||window;if(h.getSelection){var b=h.getSelection(),S=i.textContent.length,M=Math.min(r.start,S),X=r.end===void 0?M:Math.min(r.end,S);if(!b.extend&&M>X){var Y=X;X=M,M=Y}var P=_v(i,M),ee=_v(i,X);if(P&&ee){if(b.rangeCount===1&&b.anchorNode===P.node&&b.anchorOffset===P.offset&&b.focusNode===ee.node&&b.focusOffset===ee.offset)return;var ve=I.createRange();ve.setStart(P.node,P.offset),b.removeAllRanges(),M>X?(b.addRange(ve),b.extend(ee.node,ee.offset)):(ve.setEnd(ee.node,ee.offset),b.addRange(ve))}}}function hd(i){return i&&i.nodeType===Pl}function ap(i,r){return!i||!r?!1:i===r?!0:hd(i)?!1:hd(r)?ap(i,r.parentNode):"contains"in i?i.contains(r):i.compareDocumentPosition?!!(i.compareDocumentPosition(r)&16):!1}function rp(i){return i&&i.ownerDocument&&ap(i.ownerDocument.documentElement,i)}function $C(i){try{return typeof i.contentWindow.location.href=="string"}catch{return!1}}function eh(){for(var i=window,r=jc();r instanceof i.HTMLIFrameElement;){if($C(r))i=r.contentWindow;else return r;r=jc(i.document)}return r}function Fu(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r&&(r==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||r==="textarea"||i.contentEditable==="true")}function Yu(){var i=eh();return{focusedElem:i,selectionRange:Fu(i)?op(i):null}}function Dv(i){var r=eh(),I=i.focusedElem,h=i.selectionRange;if(r!==I&&rp(I)){h!==null&&Fu(I)&&kv(I,h);for(var b=[],S=I;S=S.parentNode;)S.nodeType===mo&&b.push({element:S,left:S.scrollLeft,top:S.scrollTop});typeof I.focus=="function"&&I.focus();for(var M=0;M<b.length;M++){var X=b[M];X.element.scrollLeft=X.left,X.element.scrollTop=X.top}}}function op(i){var r;return"selectionStart"in i?r={start:i.selectionStart,end:i.selectionEnd}:r=qC(i),r||{start:0,end:0}}function kv(i,r){var I=r.start,h=r.end;h===void 0&&(h=I),"selectionStart"in i?(i.selectionStart=I,i.selectionEnd=Math.min(h,i.value.length)):ip(i,r)}var sp=Pe&&"documentMode"in document&&document.documentMode<=11;function MB(){Lt("onSelect",["focusout","contextmenu","dragend","focusin","keydown","keyup","mousedown","mouseup","selectionchange"])}var bg=null,Ad=null,th=null,fd=!1;function Uv(i){if("selectionStart"in i&&Fu(i))return{start:i.selectionStart,end:i.selectionEnd};var r=i.ownerDocument&&i.ownerDocument.defaultView||window,I=r.getSelection();return{anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}}function lp(i){return i.window===i?i.document:i.nodeType===Ql?i:i.ownerDocument}function cp(i,r,I){var h=lp(I);if(!(fd||bg==null||bg!==jc(h))){var b=Uv(bg);if(!th||!Cd(th,b)){th=b;var S=Eu(Ad,"onSelect");if(S.length>0){var M=new zC("onSelect","select",null,r,I);i.push({event:M,listeners:S}),M.target=bg}}}}function gp(i,r,I,h,b,S,M){var X=I?Oa(I):window;switch(r){case"focusin":(ct(X)||X.contentEditable==="true")&&(bg=X,Ad=I,th=null);break;case"focusout":bg=null,Ad=null,th=null;break;case"mousedown":fd=!0;break;case"contextmenu":case"mouseup":case"dragend":fd=!1,cp(i,h,b);break;case"selectionchange":if(sp)break;case"keydown":case"keyup":cp(i,h,b)}}function pd(i,r){var I={};return I[i.toLowerCase()]=r.toLowerCase(),I["Webkit"+i]="webkit"+r,I["Moz"+i]="moz"+r,I}var Tu={animationend:pd("Animation","AnimationEnd"),animationiteration:pd("Animation","AnimationIteration"),animationstart:pd("Animation","AnimationStart"),transitionend:pd("Transition","TransitionEnd")},up={},NB={};Pe&&(NB=document.createElement("div").style,"AnimationEvent"in window||(delete Tu.animationend.animation,delete Tu.animationiteration.animation,delete Tu.animationstart.animation),"TransitionEvent"in window||delete Tu.transitionend.transition);function md(i){if(up[i])return up[i];if(!Tu[i])return i;var r=Tu[i];for(var I in r)if(r.hasOwnProperty(I)&&I in NB)return up[i]=r[I];return i}var Jv=md("animationend"),Ov=md("animationiteration"),Pv=md("animationstart"),HB=md("transitionend"),Ip=new Map,nh=["abort","auxClick","cancel","canPlay","canPlayThrough","click","close","contextMenu","copy","cut","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","gotPointerCapture","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","lostPointerCapture","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","pointerCancel","pointerDown","pointerMove","pointerOut","pointerOver","pointerUp","progress","rateChange","reset","resize","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchStart","volumeChange","scroll","toggle","touchMove","waiting","wheel"];function vg(i,r){Ip.set(i,r),Lt(r,[i])}function $x(){for(var i=0;i<nh.length;i++){var r=nh[i],I=r.toLowerCase(),h=r[0].toUpperCase()+r.slice(1);vg(I,"on"+h)}vg(Jv,"onAnimationEnd"),vg(Ov,"onAnimationIteration"),vg(Pv,"onAnimationStart"),vg("dblclick","onDoubleClick"),vg("focusin","onFocus"),vg("focusout","onBlur"),vg(HB,"onTransitionEnd")}function XB(i,r,I,h,b,S,M){var X=Ip.get(r);if(X!==void 0){var Y=zC,P=r;switch(r){case"keypress":if(uc(h)===0)return;case"keydown":case"keyup":Y=RB;break;case"focusin":P="focus",Y=Rv;break;case"focusout":P="blur",Y=Rv;break;case"beforeblur":case"afterblur":Y=Rv;break;case"click":if(h.button===2)return;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=Sv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=sd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=cd;break;case Jv:case Ov:case Pv:Y=DC;break;case HB:Y=Ox;break;case"scroll":Y=Zv;break;case"wheel":Y=gd;break;case"copy":case"cut":case"paste":Y=kC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=ds;break}var ee=(S&bo)!==0;{var ve=!ee&&r==="scroll",me=TB(I,X,h.type,ee,ve);if(me.length>0){var Ee=new Y(X,P,null,h,b);i.push({event:Ee,listeners:me})}}}}$x(),$H(),mg(),MB(),Hv();function FB(i,r,I,h,b,S,M){XB(i,r,I,h,b,S);var X=(S&iB)===0;X&&(Lv(i,r,I,h,b),qH(i,r,I,h,b),gp(i,r,I,h,b),Qx(i,r,I,h,b))}var bd=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","resize","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],dp=new Set(["cancel","close","invalid","load","scroll","toggle"].concat(bd));function Qv(i,r,I){var h=i.type||"unknown-event";i.currentTarget=I,_b(h,r,void 0,i),i.currentTarget=null}function Cp(i,r,I){var h;if(I)for(var b=r.length-1;b>=0;b--){var S=r[b],M=S.instance,X=S.currentTarget,Y=S.listener;if(M!==h&&i.isPropagationStopped())return;Qv(i,Y,X),h=M}else for(var P=0;P<r.length;P++){var ee=r[P],ve=ee.instance,me=ee.currentTarget,Ee=ee.listener;if(ve!==h&&i.isPropagationStopped())return;Qv(i,Ee,me),h=ve}}function jv(i,r){for(var I=(r&bo)!==0,h=0;h<i.length;h++){var b=i[h],S=b.event,M=b.listeners;Cp(S,M,I)}aB()}function YB(i,r,I,h,b){var S=Bt(I),M=[];FB(M,i,h,I,S,r),jv(M,r)}function Oi(i,r){dp.has(i)||l('Did not expect a listenToNonDelegatedEvent() call for "%s". This is a bug in React. Please file an issue.',i);var I=!1,h=RW(r),b=EB(i);h.has(b)||(ih(r,i,Ia,I),h.add(b))}function hp(i,r,I){dp.has(i)&&!r&&l('Did not expect a listenToNativeEvent() call for "%s" in the bubble phase. This is a bug in React. Please file an issue.',i);var h=0;r&&(h|=bo),ih(I,i,h,r)}var Po="_reactListening"+Math.random().toString(36).slice(2);function $r(i){if(!i[Po]){i[Po]=!0,yt.forEach(function(I){I!=="selectionchange"&&(dp.has(I)||hp(I,!1,i),hp(I,!0,i))});var r=i.nodeType===Ql?i:i.ownerDocument;r!==null&&(r[Po]||(r[Po]=!0,hp("selectionchange",!1,r)))}}function ih(i,r,I,h,b){var S=_x(i,r,I),M=void 0;vC&&(r==="touchstart"||r==="touchmove"||r==="wheel")&&(M=!0),i=i,h?M!==void 0?yv(i,r,S,M):vv(i,r,S):M!==void 0?Ux(i,r,S,M):bv(i,r,S)}function Ap(i,r){return i===r||i.nodeType===Ma&&i.parentNode===r}function wn(i,r,I,h,b){var S=h;if(!(r&Ai)&&!(r&Ia)){var M=b;if(h!==null){var X=h;e:for(;;){if(X===null)return;var Y=X.tag;if(Y===p||Y===m){var P=X.stateNode.containerInfo;if(Ap(P,M))break;if(Y===m)for(var ee=X.return;ee!==null;){var ve=ee.tag;if(ve===p||ve===m){var me=ee.stateNode.containerInfo;if(Ap(me,M))return}ee=ee.return}for(;P!==null;){var Ee=_u(P);if(Ee===null)return;var Le=Ee.tag;if(Le===y||Le===G){X=S=Ee;continue e}P=P.parentNode}}X=X.return}}}Bf(function(){return YB(i,r,I,S)})}function As(i,r,I){return{instance:i,listener:r,currentTarget:I}}function TB(i,r,I,h,b,S){for(var M=r!==null?r+"Capture":null,X=h?M:r,Y=[],P=i,ee=null;P!==null;){var ve=P,me=ve.stateNode,Ee=ve.tag;if(Ee===y&&me!==null&&(ee=me,X!==null)){var Le=Iu(P,X);Le!=null&&Y.push(As(P,Le,ee))}if(b)break;P=P.return}return Y}function Eu(i,r){for(var I=r+"Capture",h=[],b=i;b!==null;){var S=b,M=S.stateNode,X=S.tag;if(X===y&&M!==null){var Y=M,P=Iu(b,I);P!=null&&h.unshift(As(b,P,Y));var ee=Iu(b,r);ee!=null&&h.push(As(b,ee,Y))}b=b.return}return h}function wl(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==y);return i||null}function fp(i,r){for(var I=i,h=r,b=0,S=I;S;S=wl(S))b++;for(var M=0,X=h;X;X=wl(X))M++;for(;b-M>0;)I=wl(I),b--;for(;M-b>0;)h=wl(h),M--;for(var Y=b;Y--;){if(I===h||h!==null&&I===h.alternate)return I;I=wl(I),h=wl(h)}return null}function pp(i,r,I,h,b){for(var S=r._reactName,M=[],X=I;X!==null&&X!==h;){var Y=X,P=Y.alternate,ee=Y.stateNode,ve=Y.tag;if(P!==null&&P===h)break;if(ve===y&&ee!==null){var me=ee;if(b){var Ee=Iu(X,S);Ee!=null&&M.unshift(As(X,Ee,me))}else if(!b){var Le=Iu(X,S);Le!=null&&M.push(As(X,Le,me))}}X=X.return}M.length!==0&&i.push({event:r,listeners:M})}function mp(i,r,I,h,b){var S=h&&b?fp(h,b):null;h!==null&&pp(i,r,h,S,!1),b!==null&&I!==null&&pp(i,I,b,S,!0)}function EB(i,r){return i+"__bubble"}var Zo=!1,ah="dangerouslySetInnerHTML",bp="suppressContentEditableWarning",dc="suppressHydrationWarning",qv="autoFocus",Cc="children",yg="style",Ku="__html",So,vd,Fr,vp,yd,rh,KB;So={dialog:!0,webview:!0},vd=function(i,r){vf(i,r),tB(i,r),Hi(i,r,{registrationNameDependencies:zt,possibleRegistrationNames:Nt})},rh=Pe&&!document.documentMode,Fr=function(i,r,I){if(!Zo){var h=oh(I),b=oh(r);b!==h&&(Zo=!0,l("Prop `%s` did not match. Server: %s Client: %s",i,JSON.stringify(b),JSON.stringify(h)))}},vp=function(i){if(!Zo){Zo=!0;var r=[];i.forEach(function(I){r.push(I)}),l("Extra attributes from the server: %s",r)}},yd=function(i,r){r===!1?l("Expected `%s` listener to be a function, instead got `false`.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.",i,i,i):l("Expected `%s` listener to be a function, instead got a value of `%s` type.",i,typeof r)},KB=function(i,r){var I=i.namespaceURI===Ol?i.ownerDocument.createElement(i.tagName):i.ownerDocument.createElementNS(i.namespaceURI,i.tagName);return I.innerHTML=r,I.innerHTML};var $v=/\r\n?/g,eW=/\u0000|\uFFFD/g;function oh(i){J(i);var r=typeof i=="string"?i:""+i;return r.replace($v,`
`).replace(eW,"")}function Gd(i,r,I,h){var b=oh(r),S=oh(i);if(S!==b&&(h&&(Zo||(Zo=!0,l('Text content did not match. Server: "%s" Client: "%s"',S,b))),I&&pe))throw new Error("Text content does not match server-rendered HTML.")}function ey(i){return i.nodeType===Ql?i:i.ownerDocument}function tW(){}function yp(i){i.onclick=tW}function LB(i,r,I,h,b){for(var S in h)if(h.hasOwnProperty(S)){var M=h[S];if(S===yg)M&&Object.freeze(M),ff(r,M);else if(S===ah){var X=M?M[Ku]:void 0;X!=null&&_G(r,X)}else if(S===Cc)if(typeof M=="string"){var Y=i!=="textarea"||M!=="";Y&&fC(r,M)}else typeof M=="number"&&fC(r,""+M);else S===bp||S===dc||S===qv||(zt.hasOwnProperty(S)?M!=null&&(typeof M!="function"&&yd(S,M),S==="onScroll"&&Oi("scroll",r)):M!=null&&Ui(r,S,M,b))}}function zB(i,r,I,h){for(var b=0;b<r.length;b+=2){var S=r[b],M=r[b+1];S===yg?ff(i,M):S===ah?_G(i,M):S===Cc?fC(i,M):Ui(i,S,M,h)}}function nW(i,r,I,h){var b,S=ey(I),M,X=h;if(X===Ol&&(X=Sb(i)),X===Ol){if(b=Or(i,r),!b&&i!==i.toLowerCase()&&l("<%s /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.",i),i==="script"){var Y=S.createElement("div");Y.innerHTML="<script><\/script>";var P=Y.firstChild;M=Y.removeChild(P)}else if(typeof r.is=="string")M=S.createElement(i,{is:r.is});else if(M=S.createElement(i),i==="select"){var ee=M;r.multiple?ee.multiple=!0:r.size&&(ee.size=r.size)}}else M=S.createElementNS(X,i);return X===Ol&&!b&&Object.prototype.toString.call(M)==="[object HTMLUnknownElement]"&&!te.call(So,i)&&(So[i]=!0,l("The tag <%s> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.",i)),M}function iW(i,r){return ey(r).createTextNode(i)}function xl(i,r,I,h){var b=Or(r,I);vd(r,I);var S;switch(r){case"dialog":Oi("cancel",i),Oi("close",i),S=I;break;case"iframe":case"object":case"embed":Oi("load",i),S=I;break;case"video":case"audio":for(var M=0;M<bd.length;M++)Oi(bd[M],i);S=I;break;case"source":Oi("error",i),S=I;break;case"img":case"image":case"link":Oi("error",i),Oi("load",i),S=I;break;case"details":Oi("toggle",i),S=I;break;case"input":ge(i,I),S=z(i,I),Oi("invalid",i);break;case"option":Ti(i,I),S=I;break;case"select":AC(i,I),S=hC(i,I),Oi("invalid",i);break;case"textarea":KG(i,I),S=Bb(i,I),Oi("invalid",i);break;default:S=I}switch(Jr(r,S),LB(r,i,h,S,b),r){case"input":Ul(i),Ht(i,I,!1);break;case"textarea":Ul(i),zG(i);break;case"option":Ji(i,I);break;case"select":Gb(i,I);break;default:typeof S.onClick=="function"&&yp(i);break}}function _B(i,r,I,h,b){vd(r,h);var S=null,M,X;switch(r){case"input":M=z(i,I),X=z(i,h),S=[];break;case"select":M=hC(i,I),X=hC(i,h),S=[];break;case"textarea":M=Bb(i,I),X=Bb(i,h),S=[];break;default:M=I,X=h,typeof M.onClick!="function"&&typeof X.onClick=="function"&&yp(i);break}Jr(r,X);var Y,P,ee=null;for(Y in M)if(!(X.hasOwnProperty(Y)||!M.hasOwnProperty(Y)||M[Y]==null))if(Y===yg){var ve=M[Y];for(P in ve)ve.hasOwnProperty(P)&&(ee||(ee={}),ee[P]="")}else Y===ah||Y===Cc||Y===bp||Y===dc||Y===qv||(zt.hasOwnProperty(Y)?S||(S=[]):(S=S||[]).push(Y,null));for(Y in X){var me=X[Y],Ee=M!=null?M[Y]:void 0;if(!(!X.hasOwnProperty(Y)||me===Ee||me==null&&Ee==null))if(Y===yg)if(me&&Object.freeze(me),Ee){for(P in Ee)Ee.hasOwnProperty(P)&&(!me||!me.hasOwnProperty(P))&&(ee||(ee={}),ee[P]="");for(P in me)me.hasOwnProperty(P)&&Ee[P]!==me[P]&&(ee||(ee={}),ee[P]=me[P])}else ee||(S||(S=[]),S.push(Y,ee)),ee=me;else if(Y===ah){var Le=me?me[Ku]:void 0,at=Ee?Ee[Ku]:void 0;Le!=null&&at!==Le&&(S=S||[]).push(Y,Le)}else Y===Cc?(typeof me=="string"||typeof me=="number")&&(S=S||[]).push(Y,""+me):Y===bp||Y===dc||(zt.hasOwnProperty(Y)?(me!=null&&(typeof me!="function"&&yd(Y,me),Y==="onScroll"&&Oi("scroll",i)),!S&&Ee!==me&&(S=[])):(S=S||[]).push(Y,me))}return ee&&($c(ee,X[yg]),(S=S||[]).push(yg,ee)),S}function DB(i,r,I,h,b){I==="input"&&b.type==="radio"&&b.name!=null&&Ke(i,b);var S=Or(I,h),M=Or(I,b);switch(zB(i,r,S,M),I){case"input":je(i,b);break;case"textarea":LG(i,b);break;case"select":TG(i,b);break}}function sh(i){{var r=i.toLowerCase();return zo.hasOwnProperty(r)&&zo[r]||null}}function lh(i,r,I,h,b,S,M){var X,Y;switch(X=Or(r,I),vd(r,I),r){case"dialog":Oi("cancel",i),Oi("close",i);break;case"iframe":case"object":case"embed":Oi("load",i);break;case"video":case"audio":for(var P=0;P<bd.length;P++)Oi(bd[P],i);break;case"source":Oi("error",i);break;case"img":case"image":case"link":Oi("error",i),Oi("load",i);break;case"details":Oi("toggle",i);break;case"input":ge(i,I),Oi("invalid",i);break;case"option":Ti(i,I);break;case"select":AC(i,I),Oi("invalid",i);break;case"textarea":KG(i,I),Oi("invalid",i);break}Jr(r,I);{Y=new Set;for(var ee=i.attributes,ve=0;ve<ee.length;ve++){var me=ee[ve].name.toLowerCase();switch(me){case"value":break;case"checked":break;case"selected":break;default:Y.add(ee[ve].name)}}}var Ee=null;for(var Le in I)if(I.hasOwnProperty(Le)){var at=I[Le];if(Le===Cc)typeof at=="string"?i.textContent!==at&&(I[dc]!==!0&&Gd(i.textContent,at,S,M),Ee=[Cc,at]):typeof at=="number"&&i.textContent!==""+at&&(I[dc]!==!0&&Gd(i.textContent,at,S,M),Ee=[Cc,""+at]);else if(zt.hasOwnProperty(Le))at!=null&&(typeof at!="function"&&yd(Le,at),Le==="onScroll"&&Oi("scroll",i));else if(M&&typeof X=="boolean"){var jt=void 0,yn=X&&ot?null:st(Le);if(I[dc]!==!0){if(!(Le===bp||Le===dc||Le==="value"||Le==="checked"||Le==="selected")){if(Le===ah){var Cn=i.innerHTML,li=at?at[Ku]:void 0;if(li!=null){var ii=KB(i,li);ii!==Cn&&Fr(Le,Cn,ii)}}else if(Le===yg){if(Y.delete(Le),rh){var He=Fs(at);jt=i.getAttribute("style"),He!==jt&&Fr(Le,jt,He)}}else if(X&&!ot)Y.delete(Le.toLowerCase()),jt=aa(i,Le,at),at!==jt&&Fr(Le,jt,at);else if(!Re(Le,yn,X)&&!Q(Le,at,yn,X)){var rt=!1;if(yn!==null)Y.delete(yn.attributeName),jt=bi(i,Le,at,yn);else{var Xe=h;if(Xe===Ol&&(Xe=Sb(r)),Xe===Ol)Y.delete(Le.toLowerCase());else{var St=sh(Le);St!==null&&St!==Le&&(rt=!0,Y.delete(St)),Y.delete(Le)}jt=aa(i,Le,at)}var on=ot;!on&&at!==jt&&!rt&&Fr(Le,jt,at)}}}}}switch(M&&Y.size>0&&I[dc]!==!0&&vp(Y),r){case"input":Ul(i),Ht(i,I,!0);break;case"textarea":Ul(i),zG(i);break;case"select":case"option":break;default:typeof I.onClick=="function"&&yp(i);break}return Ee}function Gp(i,r,I){var h=i.nodeValue!==r;return h}function Bd(i,r){{if(Zo)return;Zo=!0,l("Did not expect server HTML to contain a <%s> in <%s>.",r.nodeName.toLowerCase(),i.nodeName.toLowerCase())}}function Bp(i,r){{if(Zo)return;Zo=!0,l('Did not expect server HTML to contain the text node "%s" in <%s>.',r.nodeValue,i.nodeName.toLowerCase())}}function Lu(i,r,I){{if(Zo)return;Zo=!0,l("Expected server HTML to contain a matching <%s> in <%s>.",r,i.nodeName.toLowerCase())}}function Ja(i,r){{if(r===""||Zo)return;Zo=!0,l('Expected server HTML to contain a matching text node for "%s" in <%s>.',r,i.nodeName.toLowerCase())}}function kB(i,r,I){switch(r){case"input":Bn(i,I);return;case"textarea":nx(i,I);return;case"select":tx(i,I);return}}var hc=function(){},eo=function(){};{var ty=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"],Zd=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"],ny=Zd.concat(["button"]),iy=["dd","dt","li","option","optgroup","p","rp","rt"],Zp={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};eo=function(i,r){var I=Yt({},i||Zp),h={tag:r};return Zd.indexOf(r)!==-1&&(I.aTagInScope=null,I.buttonTagInScope=null,I.nobrTagInScope=null),ny.indexOf(r)!==-1&&(I.pTagInButtonScope=null),ty.indexOf(r)!==-1&&r!=="address"&&r!=="div"&&r!=="p"&&(I.listItemTagAutoclosing=null,I.dlItemTagAutoclosing=null),I.current=h,r==="form"&&(I.formTag=h),r==="a"&&(I.aTagInScope=h),r==="button"&&(I.buttonTagInScope=h),r==="nobr"&&(I.nobrTagInScope=h),r==="p"&&(I.pTagInButtonScope=h),r==="li"&&(I.listItemTagAutoclosing=h),(r==="dd"||r==="dt")&&(I.dlItemTagAutoclosing=h),I};var zu=function(i,r){switch(r){case"select":return i==="option"||i==="optgroup"||i==="#text";case"optgroup":return i==="option"||i==="#text";case"option":return i==="#text";case"tr":return i==="th"||i==="td"||i==="style"||i==="script"||i==="template";case"tbody":case"thead":case"tfoot":return i==="tr"||i==="style"||i==="script"||i==="template";case"colgroup":return i==="col"||i==="template";case"table":return i==="caption"||i==="colgroup"||i==="tbody"||i==="tfoot"||i==="thead"||i==="style"||i==="script"||i==="template";case"head":return i==="base"||i==="basefont"||i==="bgsound"||i==="link"||i==="meta"||i==="title"||i==="noscript"||i==="noframes"||i==="style"||i==="script"||i==="template";case"html":return i==="head"||i==="body"||i==="frameset";case"frameset":return i==="frame";case"#document":return i==="html"}switch(i){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return r!=="h1"&&r!=="h2"&&r!=="h3"&&r!=="h4"&&r!=="h5"&&r!=="h6";case"rp":case"rt":return iy.indexOf(r)===-1;case"body":case"caption":case"col":case"colgroup":case"frameset":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return r==null}return!0},ay=function(i,r){switch(i){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return r.pTagInButtonScope;case"form":return r.formTag||r.pTagInButtonScope;case"li":return r.listItemTagAutoclosing;case"dd":case"dt":return r.dlItemTagAutoclosing;case"button":return r.buttonTagInScope;case"a":return r.aTagInScope;case"nobr":return r.nobrTagInScope}return null},ch={};hc=function(i,r,I){I=I||Zp;var h=I.current,b=h&&h.tag;r!=null&&(i!=null&&l("validateDOMNesting: when childText is passed, childTag should be null"),i="#text");var S=zu(i,b)?null:h,M=S?null:ay(i,I),X=S||M;if(X){var Y=X.tag,P=!!S+"|"+i+"|"+Y;if(!ch[P]){ch[P]=!0;var ee=i,ve="";if(i==="#text"?/\S/.test(r)?ee="Text nodes":(ee="Whitespace text nodes",ve=" Make sure you don't have any extra whitespace between tags on each line of your source code."):ee="<"+i+">",S){var me="";Y==="table"&&i==="tr"&&(me+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser."),l("validateDOMNesting(...): %s cannot appear as a child of <%s>.%s%s",ee,Y,ve,me)}else l("validateDOMNesting(...): %s cannot appear as a descendant of <%s>.",ee,Y)}}}}var gr="suppressHydrationWarning",Sp="$",gh="/$",Sd="$?",Rd="$!",UB="style",ry=null,oy=null;function aW(i){var r,I,h=i.nodeType;switch(h){case Ql:case cu:{r=h===Ql?"#document":"#fragment";var b=i.documentElement;I=b?b.namespaceURI:Rb(null,"");break}default:{var S=h===Ma?i.parentNode:i,M=S.namespaceURI||null;r=S.tagName,I=Rb(M,r);break}}{var X=r.toLowerCase(),Y=eo(null,X);return{namespace:I,ancestorInfo:Y}}}function JB(i,r,I){{var h=i,b=Rb(h.namespace,r),S=eo(h.ancestorInfo,r);return{namespace:b,ancestorInfo:S}}}function OB(i){return i}function PB(i){ry=zx(),oy=Yu();var r=null;return gc(!1),r}function sy(i){Dv(oy),gc(ry),ry=null,oy=null}function QB(i,r,I,h,b){var S;{var M=h;if(hc(i,null,M.ancestorInfo),typeof r.children=="string"||typeof r.children=="number"){var X=""+r.children,Y=eo(M.ancestorInfo,i);hc(null,X,Y)}S=M.namespace}var P=nW(i,r,I,S);return Bg(b,P),by(P,r),P}function rW(i,r){i.appendChild(r)}function jB(i,r,I,h,b){switch(xl(i,r,I,h),r){case"button":case"input":case"select":case"textarea":return!!I.autoFocus;case"img":return!0;default:return!1}}function oW(i,r,I,h,b,S){{var M=S;if(typeof h.children!=typeof I.children&&(typeof h.children=="string"||typeof h.children=="number")){var X=""+h.children,Y=eo(M.ancestorInfo,r);hc(null,X,Y)}}return _B(i,r,I,h)}function ly(i,r){return i==="textarea"||i==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}function sW(i,r,I,h){{var b=I;hc(null,i,b.ancestorInfo)}var S=iW(i,r);return Bg(h,S),S}function lW(){var i=window.event;return i===void 0?Ps:mv(i.type)}var cy=typeof setTimeout=="function"?setTimeout:void 0,gy=typeof clearTimeout=="function"?clearTimeout:void 0,wd=-1,uh=typeof Promise=="function"?Promise:void 0,qB=typeof queueMicrotask=="function"?queueMicrotask:typeof uh<"u"?function(i){return uh.resolve(null).then(i).catch(cW)}:cy;function cW(i){setTimeout(function(){throw i})}function $B(i,r,I,h){switch(r){case"button":case"input":case"select":case"textarea":I.autoFocus&&i.focus();return;case"img":{I.src&&(i.src=I.src);return}}}function eZ(i,r,I,h,b,S){DB(i,r,I,h,b),by(i,b)}function Rp(i){fC(i,"")}function gW(i,r,I){i.nodeValue=I}function uy(i,r){i.appendChild(r)}function tZ(i,r){var I;i.nodeType===Ma?(I=i.parentNode,I.insertBefore(r,i)):(I=i,I.appendChild(r));var h=i._reactRootContainer;h==null&&I.onclick===null&&yp(I)}function nZ(i,r,I){i.insertBefore(r,I)}function iZ(i,r,I){i.nodeType===Ma?i.parentNode.insertBefore(r,I):i.insertBefore(r,I)}function wp(i,r){i.removeChild(r)}function uW(i,r){i.nodeType===Ma?i.parentNode.removeChild(r):i.removeChild(r)}function Iy(i,r){var I=r,h=0;do{var b=I.nextSibling;if(i.removeChild(I),b&&b.nodeType===Ma){var S=b.data;if(S===gh)if(h===0){i.removeChild(b),Nr(r);return}else h--;else(S===Sp||S===Sd||S===Rd)&&h++}I=b}while(I);Nr(r)}function IW(i,r){i.nodeType===Ma?Iy(i.parentNode,r):i.nodeType===mo&&Iy(i,r),Nr(i)}function aZ(i){i=i;var r=i.style;typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"}function dW(i){i.nodeValue=""}function CW(i,r){i=i;var I=r[UB],h=I!=null&&I.hasOwnProperty("display")?I.display:null;i.style.display=df("display",h)}function hW(i,r){i.nodeValue=r}function AW(i){i.nodeType===mo?i.textContent="":i.nodeType===Ql&&i.documentElement&&i.removeChild(i.documentElement)}function rZ(i,r,I){return i.nodeType!==mo||r.toLowerCase()!==i.nodeName.toLowerCase()?null:i}function fW(i,r){return r===""||i.nodeType!==Pl?null:i}function dy(i){return i.nodeType!==Ma?null:i}function Cy(i){return i.data===Sd}function hy(i){return i.data===Rd}function oZ(i){var r=i.nextSibling&&i.nextSibling.dataset,I,h,b;return r&&(I=r.dgst,h=r.msg,b=r.stck),{message:h,digest:I,stack:b}}function pW(i,r){i._reactRetry=r}function Ih(i){for(;i!=null;i=i.nextSibling){var r=i.nodeType;if(r===mo||r===Pl)break;if(r===Ma){var I=i.data;if(I===Sp||I===Rd||I===Sd)break;if(I===gh)return null}}return i}function dh(i){return Ih(i.nextSibling)}function xp(i){return Ih(i.firstChild)}function Ac(i){return Ih(i.firstChild)}function mW(i){return Ih(i.nextSibling)}function Ay(i,r,I,h,b,S,M){Bg(S,i),by(i,I);var X;{var Y=b;X=Y.namespace}var P=(S.mode&ei)!==vn;return lh(i,r,I,X,h,P,M)}function bW(i,r,I,h){return Bg(I,i),I.mode&ei,Gp(i,r)}function sZ(i,r){Bg(r,i)}function vW(i){for(var r=i.nextSibling,I=0;r;){if(r.nodeType===Ma){var h=r.data;if(h===gh){if(I===0)return dh(r);I--}else(h===Sp||h===Rd||h===Sd)&&I++}r=r.nextSibling}return null}function fy(i){for(var r=i.previousSibling,I=0;r;){if(r.nodeType===Ma){var h=r.data;if(h===Sp||h===Rd||h===Sd){if(I===0)return r;I--}else h===gh&&I++}r=r.previousSibling}return null}function lZ(i){Nr(i)}function cZ(i){Nr(i)}function py(i){return i!=="head"&&i!=="body"}function yW(i,r,I,h){var b=!0;Gd(r.nodeValue,I,h,b)}function Ch(i,r,I,h,b,S){if(r[gr]!==!0){var M=!0;Gd(h.nodeValue,b,S,M)}}function Wp(i,r){r.nodeType===mo?Bd(i,r):r.nodeType===Ma||Bp(i,r)}function GW(i,r){{var I=i.parentNode;I!==null&&(r.nodeType===mo?Bd(I,r):r.nodeType===Ma||Bp(I,r))}}function gZ(i,r,I,h,b){(b||r[gr]!==!0)&&(h.nodeType===mo?Bd(I,h):h.nodeType===Ma||Bp(I,h))}function BW(i,r,I){Lu(i,r)}function uZ(i,r){Ja(i,r)}function IZ(i,r,I){{var h=i.parentNode;h!==null&&Lu(h,r)}}function Vp(i,r){{var I=i.parentNode;I!==null&&Ja(I,r)}}function Gg(i,r,I,h,b,S){(S||r[gr]!==!0)&&Lu(I,h)}function ZW(i,r,I,h,b){(b||r[gr]!==!0)&&Ja(I,h)}function Qt(i){l("An error occurred during hydration. The server HTML was replaced with client content in <%s>.",i.nodeName.toLowerCase())}function xd(i){$r(i)}var Qs=Math.random().toString(36).slice(2),Ca="__reactFiber$"+Qs,my="__reactProps$"+Qs,Wd="__reactContainer$"+Qs,hh="__reactEvents$"+Qs,SW="__reactListeners$"+Qs,dZ="__reactHandles$"+Qs;function Mp(i){delete i[Ca],delete i[my],delete i[hh],delete i[SW],delete i[dZ]}function Bg(i,r){r[Ca]=i}function Ah(i,r){r[Wd]=i}function CZ(i){i[Wd]=null}function fh(i){return!!i[Wd]}function _u(i){var r=i[Ca];if(r)return r;for(var I=i.parentNode;I;){if(r=I[Wd]||I[Ca],r){var h=r.alternate;if(r.child!==null||h!==null&&h.child!==null)for(var b=fy(i);b!==null;){var S=b[Ca];if(S)return S;b=fy(b)}return r}i=I,I=i.parentNode}return null}function Zg(i){var r=i[Ca]||i[Wd];return r&&(r.tag===y||r.tag===G||r.tag===K||r.tag===p)?r:null}function Oa(i){if(i.tag===y||i.tag===G)return i.stateNode;throw new Error("getNodeFromInstance: Invalid argument.")}function fs(i){return i[my]||null}function by(i,r){i[my]=r}function RW(i){var r=i[hh];return r===void 0&&(r=i[hh]=new Set),r}var hZ={},AZ=t.ReactDebugCurrentFrame;function ph(i){if(i){var r=i._owner,I=Jc(i.type,i._source,r?r.type:null);AZ.setExtraStackFrame(I)}else AZ.setExtraStackFrame(null)}function js(i,r,I,h,b){{var S=Function.call.bind(te);for(var M in i)if(S(i,M)){var X=void 0;try{if(typeof i[M]!="function"){var Y=Error((h||"React class")+": "+I+" type `"+M+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof i[M]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Y.name="Invariant Violation",Y}X=i[M](r,M,h,I,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(P){X=P}X&&!(X instanceof Error)&&(ph(b),l("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",h||"React class",I,M,typeof X),ph(null)),X instanceof Error&&!(X.message in hZ)&&(hZ[X.message]=!0,ph(b),l("Failed %s type: %s",I,X.message),ph(null))}}}var Np=[],mh;mh=[];var fc=-1;function pc(i){return{current:i}}function Yr(i,r){if(fc<0){l("Unexpected pop.");return}r!==mh[fc]&&l("Unexpected Fiber popped."),i.current=Np[fc],Np[fc]=null,mh[fc]=null,fc--}function Tr(i,r,I){fc++,Np[fc]=i.current,mh[fc]=I,i.current=r}var vy;vy={};var Ro={};Object.freeze(Ro);var Wl=pc(Ro),qs=pc(!1),bh=Ro;function Sg(i,r,I){return I&&$s(r)?bh:Wl.current}function yy(i,r,I){{var h=i.stateNode;h.__reactInternalMemoizedUnmaskedChildContext=r,h.__reactInternalMemoizedMaskedChildContext=I}}function Vd(i,r){{var I=i.type,h=I.contextTypes;if(!h)return Ro;var b=i.stateNode;if(b&&b.__reactInternalMemoizedUnmaskedChildContext===r)return b.__reactInternalMemoizedMaskedChildContext;var S={};for(var M in h)S[M]=r[M];{var X=Tn(i)||"Unknown";js(h,S,"context",X)}return b&&yy(i,r,S),S}}function Md(){return qs.current}function $s(i){{var r=i.childContextTypes;return r!=null}}function Hp(i){Yr(qs,i),Yr(Wl,i)}function Nd(i){Yr(qs,i),Yr(Wl,i)}function fZ(i,r,I){{if(Wl.current!==Ro)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");Tr(Wl,r,i),Tr(qs,I,i)}}function pZ(i,r,I){{var h=i.stateNode,b=r.childContextTypes;if(typeof h.getChildContext!="function"){{var S=Tn(i)||"Unknown";vy[S]||(vy[S]=!0,l("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",S,S))}return I}var M=h.getChildContext();for(var X in M)if(!(X in b))throw new Error((Tn(i)||"Unknown")+'.getChildContext(): key "'+X+'" is not defined in childContextTypes.');{var Y=Tn(i)||"Unknown";js(b,M,"child context",Y)}return Yt({},I,M)}}function Xp(i){{var r=i.stateNode,I=r&&r.__reactInternalMemoizedMergedChildContext||Ro;return bh=Wl.current,Tr(Wl,I,i),Tr(qs,qs.current,i),!0}}function mZ(i,r,I){{var h=i.stateNode;if(!h)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(I){var b=pZ(i,r,bh);h.__reactInternalMemoizedMergedChildContext=b,Yr(qs,i),Yr(Wl,i),Tr(Wl,b,i),Tr(qs,I,i)}else Yr(qs,i),Tr(qs,I,i)}}function wW(i){{if(!ux(i)||i.tag!==C)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var r=i;do{switch(r.tag){case p:return r.stateNode.context;case C:{var I=r.type;if($s(I))return r.stateNode.__reactInternalMemoizedMergedChildContext;break}}r=r.return}while(r!==null);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}}var Rg=0,vh=1,el=null,Gy=!1,Fp=!1;function bZ(i){el===null?el=[i]:el.push(i)}function vZ(i){Gy=!0,bZ(i)}function yZ(){Gy&&wg()}function wg(){if(!Fp&&el!==null){Fp=!0;var i=0,r=Is();try{var I=!0,h=el;for(ya(jr);i<h.length;i++){var b=h[i];do b=b(I);while(b!==null)}el=null,Gy=!1}catch(S){throw el!==null&&(el=el.slice(i+1)),Wf(Vf,wg),S}finally{ya(r),Fp=!1}}return null}var Hd=[],Xd=0,Yp=null,Tp=0,ps=[],ms=0,Du=null,mc=1,bc="";function GZ(i){return tl(),(i.flags&ag)!==Zn}function bs(i){return tl(),Tp}function xW(){var i=bc,r=mc,I=r&~Ep(r);return I.toString(32)+i}function ku(i,r){tl(),Hd[Xd++]=Tp,Hd[Xd++]=Yp,Yp=i,Tp=r}function BZ(i,r,I){tl(),ps[ms++]=mc,ps[ms++]=bc,ps[ms++]=Du,Du=i;var h=mc,b=bc,S=Uu(h)-1,M=h&~(1<<S),X=I+1,Y=Uu(r)+S;if(Y>30){var P=S-S%5,ee=(1<<P)-1,ve=(M&ee).toString(32),me=M>>P,Ee=S-P,Le=Uu(r)+Ee,at=X<<Ee,jt=at|me,yn=ve+b;mc=1<<Le|jt,bc=yn}else{var Cn=X<<S,li=Cn|M,ii=b;mc=1<<Y|li,bc=ii}}function By(i){tl();var r=i.return;if(r!==null){var I=1,h=0;ku(i,I),BZ(i,I,h)}}function Uu(i){return 32-dB(i)}function Ep(i){return 1<<Uu(i)-1}function Fd(i){for(;i===Yp;)Yp=Hd[--Xd],Hd[Xd]=null,Tp=Hd[--Xd],Hd[Xd]=null;for(;i===Du;)Du=ps[--ms],ps[ms]=null,bc=ps[--ms],ps[ms]=null,mc=ps[--ms],ps[ms]=null}function Kp(){return tl(),Du!==null?{id:mc,overflow:bc}:null}function Lp(i,r){tl(),ps[ms++]=mc,ps[ms++]=bc,ps[ms++]=Du,mc=r.id,bc=r.overflow,Du=i}function tl(){Li()||l("Expected to be hydrating. This is a bug in React. Please file an issue.")}var fr=null,vs=null,nl=!1,Ju=!1,xg=null;function Zy(){nl&&l("We should not be hydrating here. This is a bug in React. Please file a bug.")}function zp(){Ju=!0}function Sy(){return Ju}function ZZ(i){var r=i.stateNode.containerInfo;return vs=Ac(r),fr=i,nl=!0,xg=null,Ju=!1,!0}function WW(i,r,I){return vs=mW(r),fr=i,nl=!0,xg=null,Ju=!1,I!==null&&Lp(i,I),!0}function yh(i,r){switch(i.tag){case p:{Wp(i.stateNode.containerInfo,r);break}case y:{var I=(i.mode&ei)!==vn;gZ(i.type,i.memoizedProps,i.stateNode,r,I);break}case K:{var h=i.memoizedState;h.dehydrated!==null&&GW(h.dehydrated,r);break}}}function SZ(i,r){yh(i,r);var I=Sz();I.stateNode=r,I.return=i;var h=i.deletions;h===null?(i.deletions=[I],i.flags|=Es):h.push(I)}function Ry(i,r){{if(Ju)return;switch(i.tag){case p:{var I=i.stateNode.containerInfo;switch(r.tag){case y:var h=r.type;r.pendingProps,BW(I,h);break;case G:var b=r.pendingProps;uZ(I,b);break}break}case y:{var S=i.type,M=i.memoizedProps,X=i.stateNode;switch(r.tag){case y:{var Y=r.type,P=r.pendingProps,ee=(i.mode&ei)!==vn;Gg(S,M,X,Y,P,ee);break}case G:{var ve=r.pendingProps,me=(i.mode&ei)!==vn;ZW(S,M,X,ve,me);break}}break}case K:{var Ee=i.memoizedState,Le=Ee.dehydrated;if(Le!==null)switch(r.tag){case y:var at=r.type;r.pendingProps,IZ(Le,at);break;case G:var jt=r.pendingProps;Vp(Le,jt);break}break}default:return}}}function RZ(i,r){r.flags=r.flags&~Ls|oa,Ry(i,r)}function Gh(i,r){switch(i.tag){case y:{var I=i.type;i.pendingProps;var h=rZ(r,I);return h!==null?(i.stateNode=h,fr=i,vs=xp(h),!0):!1}case G:{var b=i.pendingProps,S=fW(r,b);return S!==null?(i.stateNode=S,fr=i,vs=null,!0):!1}case K:{var M=dy(r);if(M!==null){var X={dehydrated:M,treeContext:Kp(),retryLane:Uo};i.memoizedState=X;var Y=Rz(M);return Y.return=i,i.child=Y,fr=i,vs=null,!0}return!1}default:return!1}}function wy(i){return(i.mode&ei)!==vn&&(i.flags&fi)===Zn}function xy(i){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function Wy(i){if(nl){var r=vs;if(!r){wy(i)&&(Ry(fr,i),xy()),RZ(fr,i),nl=!1,fr=i;return}var I=r;if(!Gh(i,r)){wy(i)&&(Ry(fr,i),xy()),r=dh(I);var h=fr;if(!r||!Gh(i,r)){RZ(fr,i),nl=!1,fr=i;return}SZ(h,I)}}}function VW(i,r,I){var h=i.stateNode,b=!Ju,S=Ay(h,i.type,i.memoizedProps,r,I,i,b);return i.updateQueue=S,S!==null}function wZ(i){var r=i.stateNode,I=i.memoizedProps,h=bW(r,I,i);if(h){var b=fr;if(b!==null)switch(b.tag){case p:{var S=b.stateNode.containerInfo,M=(b.mode&ei)!==vn;yW(S,r,I,M);break}case y:{var X=b.type,Y=b.memoizedProps,P=b.stateNode,ee=(b.mode&ei)!==vn;Ch(X,Y,P,r,I,ee);break}}}return h}function MW(i){var r=i.memoizedState,I=r!==null?r.dehydrated:null;if(!I)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");sZ(I,i)}function Vy(i){var r=i.memoizedState,I=r!==null?r.dehydrated:null;if(!I)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return vW(I)}function _p(i){for(var r=i.return;r!==null&&r.tag!==y&&r.tag!==p&&r.tag!==K;)r=r.return;fr=r}function Pi(i){if(i!==fr)return!1;if(!nl)return _p(i),nl=!0,!1;if(i.tag!==p&&(i.tag!==y||py(i.type)&&!ly(i.type,i.memoizedProps))){var r=vs;if(r)if(wy(i))Za(i),xy();else for(;r;)SZ(i,r),r=dh(r)}return _p(i),i.tag===K?vs=Vy(i):vs=fr?dh(i.stateNode):null,!0}function il(){return nl&&vs!==null}function Za(i){for(var r=vs;r;)yh(i,r),r=dh(r)}function Wg(){fr=null,vs=null,nl=!1,Ju=!1}function pr(){xg!==null&&(Q2(xg),xg=null)}function Li(){return nl}function al(i){xg===null?xg=[i]:xg.push(i)}var Bh=t.ReactCurrentBatchConfig,Ou=null;function Dp(){return Bh.transition}var to={recordUnsafeLifecycleWarnings:function(i,r){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(i,r){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}};{var xZ=function(i){for(var r=null,I=i;I!==null;)I.mode&la&&(r=I),I=I.return;return r},vc=function(i){var r=[];return i.forEach(function(I){r.push(I)}),r.sort().join(", ")},Xn=[],Ya=[],zi=[],ca=[],wo=[],Pu=[],qi=new Set;to.recordUnsafeLifecycleWarnings=function(i,r){qi.has(i.type)||(typeof r.componentWillMount=="function"&&r.componentWillMount.__suppressDeprecationWarning!==!0&&Xn.push(i),i.mode&la&&typeof r.UNSAFE_componentWillMount=="function"&&Ya.push(i),typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps.__suppressDeprecationWarning!==!0&&zi.push(i),i.mode&la&&typeof r.UNSAFE_componentWillReceiveProps=="function"&&ca.push(i),typeof r.componentWillUpdate=="function"&&r.componentWillUpdate.__suppressDeprecationWarning!==!0&&wo.push(i),i.mode&la&&typeof r.UNSAFE_componentWillUpdate=="function"&&Pu.push(i))},to.flushPendingUnsafeLifecycleWarnings=function(){var i=new Set;Xn.length>0&&(Xn.forEach(function(me){i.add(Tn(me)||"Component"),qi.add(me.type)}),Xn=[]);var r=new Set;Ya.length>0&&(Ya.forEach(function(me){r.add(Tn(me)||"Component"),qi.add(me.type)}),Ya=[]);var I=new Set;zi.length>0&&(zi.forEach(function(me){I.add(Tn(me)||"Component"),qi.add(me.type)}),zi=[]);var h=new Set;ca.length>0&&(ca.forEach(function(me){h.add(Tn(me)||"Component"),qi.add(me.type)}),ca=[]);var b=new Set;wo.length>0&&(wo.forEach(function(me){b.add(Tn(me)||"Component"),qi.add(me.type)}),wo=[]);var S=new Set;if(Pu.length>0&&(Pu.forEach(function(me){S.add(Tn(me)||"Component"),qi.add(me.type)}),Pu=[]),r.size>0){var M=vc(r);l(`Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.

Please update the following components: %s`,M)}if(h.size>0){var X=vc(h);l(`Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state

Please update the following components: %s`,X)}if(S.size>0){var Y=vc(S);l(`Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.

Please update the following components: %s`,Y)}if(i.size>0){var P=vc(i);o(`componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.
* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,P)}if(I.size>0){var ee=vc(I);o(`componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state
* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,ee)}if(b.size>0){var ve=vc(b);o(`componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,ve)}};var Vg=new Map,Zh=new Set;to.recordLegacyContextWarning=function(i,r){var I=xZ(i);if(I===null){l("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.");return}if(!Zh.has(i.type)){var h=Vg.get(I);(i.type.contextTypes!=null||i.type.childContextTypes!=null||r!==null&&typeof r.getChildContext=="function")&&(h===void 0&&(h=[],Vg.set(I,h)),h.push(i))}},to.flushLegacyContextWarning=function(){Vg.forEach(function(i,r){if(i.length!==0){var I=i[0],h=new Set;i.forEach(function(S){h.add(Tn(S)||"Component"),Zh.add(S.type)});var b=vc(h);try{ra(I),l(`Legacy context API has been detected within a strict-mode tree.

The old API will be supported in all 16.x releases, but applications using it should migrate to the new version.

Please update the following components: %s

Learn more about this warning here: https://reactjs.org/link/legacy-context`,b)}finally{ir()}}})},to.discardPendingWarnings=function(){Xn=[],Ya=[],zi=[],ca=[],wo=[],Pu=[],Vg=new Map}}var Qu,Yd,ju,Er,Sh,My=function(i,r){};Qu=!1,Yd=!1,ju={},Er={},Sh={},My=function(i,r){if(!(i===null||typeof i!="object")&&!(!i._store||i._store.validated||i.key!=null)){if(typeof i._store!="object")throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");i._store.validated=!0;var I=Tn(r)||"Component";Er[I]||(Er[I]=!0,l('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};function WZ(i){return i.prototype&&i.prototype.isReactComponent}function Rh(i,r,I){var h=I.ref;if(h!==null&&typeof h!="function"&&typeof h!="object"){if((i.mode&la||Ne)&&!(I._owner&&I._self&&I._owner.stateNode!==I._self)&&!(I._owner&&I._owner.tag!==C)&&!(typeof I.type=="function"&&!WZ(I.type))&&I._owner){var b=Tn(i)||"Component";ju[b]||(l('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',b,h),ju[b]=!0)}if(I._owner){var S=I._owner,M;if(S){var X=S;if(X.tag!==C)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");M=X.stateNode}if(!M)throw new Error("Missing owner for string ref "+h+". This error is likely caused by a bug in React. Please file an issue.");var Y=M;Rt(h,"ref");var P=""+h;if(r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===P)return r.ref;var ee=function(ve){var me=Y.refs;ve===null?delete me[P]:me[P]=ve};return ee._stringRef=P,ee}else{if(typeof h!="string")throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!I._owner)throw new Error("Element ref was specified as a string ("+h+`) but no owner was set. This could happen for one of the following reasons:
1. You may be adding a ref to a function component
2. You may be adding a ref to a component that was not created inside a component's render method
3. You have multiple copies of React loaded
See https://reactjs.org/link/refs-must-have-owner for more information.`)}}return h}function yc(i,r){var I=Object.prototype.toString.call(r);throw new Error("Objects are not valid as a React child (found: "+(I==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":I)+"). If you meant to render a collection of children, use an array instead.")}function wh(i){{var r=Tn(i)||"Component";if(Sh[r])return;Sh[r]=!0,l("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it.")}}function xh(i){var r=i._payload,I=i._init;return I(r)}function kp(i){function r(He,rt){if(i){var Xe=He.deletions;Xe===null?(He.deletions=[rt],He.flags|=Es):Xe.push(rt)}}function I(He,rt){if(!i)return null;for(var Xe=rt;Xe!==null;)r(He,Xe),Xe=Xe.sibling;return null}function h(He,rt){for(var Xe=new Map,St=rt;St!==null;)St.key!==null?Xe.set(St.key,St):Xe.set(St.index,St),St=St.sibling;return Xe}function b(He,rt){var Xe=oA(He,rt);return Xe.index=0,Xe.sibling=null,Xe}function S(He,rt,Xe){if(He.index=Xe,!i)return He.flags|=ag,rt;var St=He.alternate;if(St!==null){var on=St.index;return on<rt?(He.flags|=oa,rt):on}else return He.flags|=oa,rt}function M(He){return i&&He.alternate===null&&(He.flags|=oa),He}function X(He,rt,Xe,St){if(rt===null||rt.tag!==G){var on=TV(Xe,He.mode,St);return on.return=He,on}else{var an=b(rt,Xe);return an.return=He,an}}function Y(He,rt,Xe,St){var on=Xe.type;if(on===ce)return ee(He,rt,Xe.props.children,St,Xe.key);if(rt!==null&&(rt.elementType===on||IX(rt,Xe)||typeof on=="object"&&on!==null&&on.$$typeof===Ut&&xh(on)===rt.type)){var an=b(rt,Xe.props);return an.ref=Rh(He,rt,Xe),an.return=He,an._debugSource=Xe._source,an._debugOwner=Xe._owner,an}var Mn=YV(Xe,He.mode,St);return Mn.ref=Rh(He,rt,Xe),Mn.return=He,Mn}function P(He,rt,Xe,St){if(rt===null||rt.tag!==m||rt.stateNode.containerInfo!==Xe.containerInfo||rt.stateNode.implementation!==Xe.implementation){var on=EV(Xe,He.mode,St);return on.return=He,on}else{var an=b(rt,Xe.children||[]);return an.return=He,an}}function ee(He,rt,Xe,St,on){if(rt===null||rt.tag!==w){var an=Qd(Xe,He.mode,St,on);return an.return=He,an}else{var Mn=b(rt,Xe);return Mn.return=He,Mn}}function ve(He,rt,Xe){if(typeof rt=="string"&&rt!==""||typeof rt=="number"){var St=TV(""+rt,He.mode,Xe);return St.return=He,St}if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case pa:{var on=YV(rt,He.mode,Xe);return on.ref=Rh(He,null,rt),on.return=He,on}case ua:{var an=EV(rt,He.mode,Xe);return an.return=He,an}case Ut:{var Mn=rt._payload,Fn=rt._init;return ve(He,Fn(Mn),Xe)}}if(hi(rt)||Ot(rt)){var Xi=Qd(rt,He.mode,Xe,null);return Xi.return=He,Xi}yc(He,rt)}return typeof rt=="function"&&wh(He),null}function me(He,rt,Xe,St){var on=rt!==null?rt.key:null;if(typeof Xe=="string"&&Xe!==""||typeof Xe=="number")return on!==null?null:X(He,rt,""+Xe,St);if(typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case pa:return Xe.key===on?Y(He,rt,Xe,St):null;case ua:return Xe.key===on?P(He,rt,Xe,St):null;case Ut:{var an=Xe._payload,Mn=Xe._init;return me(He,rt,Mn(an),St)}}if(hi(Xe)||Ot(Xe))return on!==null?null:ee(He,rt,Xe,St,null);yc(He,Xe)}return typeof Xe=="function"&&wh(He),null}function Ee(He,rt,Xe,St,on){if(typeof St=="string"&&St!==""||typeof St=="number"){var an=He.get(Xe)||null;return X(rt,an,""+St,on)}if(typeof St=="object"&&St!==null){switch(St.$$typeof){case pa:{var Mn=He.get(St.key===null?Xe:St.key)||null;return Y(rt,Mn,St,on)}case ua:{var Fn=He.get(St.key===null?Xe:St.key)||null;return P(rt,Fn,St,on)}case Ut:var Xi=St._payload,yi=St._init;return Ee(He,rt,Xe,yi(Xi),on)}if(hi(St)||Ot(St)){var qa=He.get(Xe)||null;return ee(rt,qa,St,on,null)}yc(rt,St)}return typeof St=="function"&&wh(rt),null}function Le(He,rt,Xe){{if(typeof He!="object"||He===null)return rt;switch(He.$$typeof){case pa:case ua:My(He,Xe);var St=He.key;if(typeof St!="string")break;if(rt===null){rt=new Set,rt.add(St);break}if(!rt.has(St)){rt.add(St);break}l("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.",St);break;case Ut:var on=He._payload,an=He._init;Le(an(on),rt,Xe);break}}return rt}function at(He,rt,Xe,St){for(var on=null,an=0;an<Xe.length;an++){var Mn=Xe[an];on=Le(Mn,on,He)}for(var Fn=null,Xi=null,yi=rt,qa=0,Gi=0,Ea=null;yi!==null&&Gi<Xe.length;Gi++){yi.index>Gi?(Ea=yi,yi=null):Ea=yi.sibling;var Vo=me(He,yi,Xe[Gi],St);if(Vo===null){yi===null&&(yi=Ea);break}i&&yi&&Vo.alternate===null&&r(He,yi),qa=S(Vo,qa,Gi),Xi===null?Fn=Vo:Xi.sibling=Vo,Xi=Vo,yi=Ea}if(Gi===Xe.length){if(I(He,yi),Li()){var Io=Gi;ku(He,Io)}return Fn}if(yi===null){for(;Gi<Xe.length;Gi++){var ll=ve(He,Xe[Gi],St);ll!==null&&(qa=S(ll,qa,Gi),Xi===null?Fn=ll:Xi.sibling=ll,Xi=ll)}if(Li()){var es=Gi;ku(He,es)}return Fn}for(var ts=h(He,yi);Gi<Xe.length;Gi++){var Mo=Ee(ts,He,Gi,Xe[Gi],St);Mo!==null&&(i&&Mo.alternate!==null&&ts.delete(Mo.key===null?Gi:Mo.key),qa=S(Mo,qa,Gi),Xi===null?Fn=Mo:Xi.sibling=Mo,Xi=Mo)}if(i&&ts.forEach(function(Sm){return r(He,Sm)}),Li()){var II=Gi;ku(He,II)}return Fn}function jt(He,rt,Xe,St){var on=Ot(Xe);if(typeof on!="function")throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");{typeof Symbol=="function"&&Xe[Symbol.toStringTag]==="Generator"&&(Yd||l("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),Yd=!0),Xe.entries===on&&(Qu||l("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Qu=!0);var an=on.call(Xe);if(an)for(var Mn=null,Fn=an.next();!Fn.done;Fn=an.next()){var Xi=Fn.value;Mn=Le(Xi,Mn,He)}}var yi=on.call(Xe);if(yi==null)throw new Error("An iterable object provided no iterator.");for(var qa=null,Gi=null,Ea=rt,Vo=0,Io=0,ll=null,es=yi.next();Ea!==null&&!es.done;Io++,es=yi.next()){Ea.index>Io?(ll=Ea,Ea=null):ll=Ea.sibling;var ts=me(He,Ea,es.value,St);if(ts===null){Ea===null&&(Ea=ll);break}i&&Ea&&ts.alternate===null&&r(He,Ea),Vo=S(ts,Vo,Io),Gi===null?qa=ts:Gi.sibling=ts,Gi=ts,Ea=ll}if(es.done){if(I(He,Ea),Li()){var Mo=Io;ku(He,Mo)}return qa}if(Ea===null){for(;!es.done;Io++,es=yi.next()){var II=ve(He,es.value,St);II!==null&&(Vo=S(II,Vo,Io),Gi===null?qa=II:Gi.sibling=II,Gi=II)}if(Li()){var Sm=Io;ku(He,Sm)}return qa}for(var M0=h(He,Ea);!es.done;Io++,es=yi.next()){var Og=Ee(M0,He,Io,es.value,St);Og!==null&&(i&&Og.alternate!==null&&M0.delete(Og.key===null?Io:Og.key),Vo=S(Og,Vo,Io),Gi===null?qa=Og:Gi.sibling=Og,Gi=Og)}if(i&&M0.forEach(function(a5){return r(He,a5)}),Li()){var i5=Io;ku(He,i5)}return qa}function yn(He,rt,Xe,St){if(rt!==null&&rt.tag===G){I(He,rt.sibling);var on=b(rt,Xe);return on.return=He,on}I(He,rt);var an=TV(Xe,He.mode,St);return an.return=He,an}function Cn(He,rt,Xe,St){for(var on=Xe.key,an=rt;an!==null;){if(an.key===on){var Mn=Xe.type;if(Mn===ce){if(an.tag===w){I(He,an.sibling);var Fn=b(an,Xe.props.children);return Fn.return=He,Fn._debugSource=Xe._source,Fn._debugOwner=Xe._owner,Fn}}else if(an.elementType===Mn||IX(an,Xe)||typeof Mn=="object"&&Mn!==null&&Mn.$$typeof===Ut&&xh(Mn)===an.type){I(He,an.sibling);var Xi=b(an,Xe.props);return Xi.ref=Rh(He,an,Xe),Xi.return=He,Xi._debugSource=Xe._source,Xi._debugOwner=Xe._owner,Xi}I(He,an);break}else r(He,an);an=an.sibling}if(Xe.type===ce){var yi=Qd(Xe.props.children,He.mode,St,Xe.key);return yi.return=He,yi}else{var qa=YV(Xe,He.mode,St);return qa.ref=Rh(He,rt,Xe),qa.return=He,qa}}function li(He,rt,Xe,St){for(var on=Xe.key,an=rt;an!==null;){if(an.key===on)if(an.tag===m&&an.stateNode.containerInfo===Xe.containerInfo&&an.stateNode.implementation===Xe.implementation){I(He,an.sibling);var Mn=b(an,Xe.children||[]);return Mn.return=He,Mn}else{I(He,an);break}else r(He,an);an=an.sibling}var Fn=EV(Xe,He.mode,St);return Fn.return=He,Fn}function ii(He,rt,Xe,St){var on=typeof Xe=="object"&&Xe!==null&&Xe.type===ce&&Xe.key===null;if(on&&(Xe=Xe.props.children),typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case pa:return M(Cn(He,rt,Xe,St));case ua:return M(li(He,rt,Xe,St));case Ut:var an=Xe._payload,Mn=Xe._init;return ii(He,rt,Mn(an),St)}if(hi(Xe))return at(He,rt,Xe,St);if(Ot(Xe))return jt(He,rt,Xe,St);yc(He,Xe)}return typeof Xe=="string"&&Xe!==""||typeof Xe=="number"?M(yn(He,rt,""+Xe,St)):(typeof Xe=="function"&&wh(He),I(He,rt))}return ii}var rl=kp(!0),Mg=kp(!1);function Gc(i,r){if(i!==null&&r.child!==i.child)throw new Error("Resuming work not yet implemented.");if(r.child!==null){var I=r.child,h=oA(I,I.pendingProps);for(r.child=h,h.return=r;I.sibling!==null;)I=I.sibling,h=h.sibling=oA(I,I.pendingProps),h.return=r;h.sibling=null}}function Wh(i,r){for(var I=i.child;I!==null;)vz(I,r),I=I.sibling}var Vh=pc(null),Ny;Ny={};var Ng=null,Hg=null,Hy=null,qu=!1;function Xg(){Ng=null,Hg=null,Hy=null,qu=!1}function Mh(){qu=!0}function Nh(){qu=!1}function Kr(i,r,I){Tr(Vh,r._currentValue,i),r._currentValue=I,r._currentRenderer!==void 0&&r._currentRenderer!==null&&r._currentRenderer!==Ny&&l("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),r._currentRenderer=Ny}function Vl(i,r){var I=Vh.current;Yr(Vh,r),i._currentValue=I}function Xy(i,r,I){for(var h=i;h!==null;){var b=h.alternate;if(ug(h.childLanes,r)?b!==null&&!ug(b.childLanes,r)&&(b.childLanes=Hn(b.childLanes,r)):(h.childLanes=Hn(h.childLanes,r),b!==null&&(b.childLanes=Hn(b.childLanes,r))),h===I)break;h=h.return}h!==I&&l("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function Pa(i,r,I){NW(i,r,I)}function NW(i,r,I){var h=i.child;for(h!==null&&(h.return=i);h!==null;){var b=void 0,S=h.dependencies;if(S!==null){b=h.child;for(var M=S.firstContext;M!==null;){if(M.context===r){if(h.tag===C){var X=$I(I),Y=Ml(ai,X);Y.tag=Op;var P=h.updateQueue;if(P!==null){var ee=P.shared,ve=ee.pending;ve===null?Y.next=Y:(Y.next=ve.next,ve.next=Y),ee.pending=Y}}h.lanes=Hn(h.lanes,I);var me=h.alternate;me!==null&&(me.lanes=Hn(me.lanes,I)),Xy(h.return,I,i),S.lanes=Hn(S.lanes,I);break}M=M.next}}else if(h.tag===x)b=h.type===i.type?null:h.child;else if(h.tag===F){var Ee=h.return;if(Ee===null)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");Ee.lanes=Hn(Ee.lanes,I);var Le=Ee.alternate;Le!==null&&(Le.lanes=Hn(Le.lanes,I)),Xy(Ee,I,i),b=h.sibling}else b=h.child;if(b!==null)b.return=h;else for(b=h;b!==null;){if(b===i){b=null;break}var at=b.sibling;if(at!==null){at.return=b.return,b=at;break}b=b.return}h=b}}function Bc(i,r){Ng=i,Hg=null,Hy=null;var I=i.dependencies;if(I!==null){var h=I.firstContext;h!==null&&(Mr(I.lanes,r)&&h0(),I.firstContext=null)}}function Sa(i){qu&&l("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var r=i._currentValue;if(Hy!==i){var I={context:i,memoizedValue:r,next:null};if(Hg===null){if(Ng===null)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");Hg=I,Ng.dependencies={lanes:ft,firstContext:I}}else Hg=Hg.next=I}return r}var Ta=null;function Up(i){Ta===null?Ta=[i]:Ta.push(i)}function Fy(){if(Ta!==null){for(var i=0;i<Ta.length;i++){var r=Ta[i],I=r.interleaved;if(I!==null){r.interleaved=null;var h=I.next,b=r.pending;if(b!==null){var S=b.next;b.next=h,I.next=S}r.pending=I}}Ta=null}}function Yy(i,r,I,h){var b=r.interleaved;return b===null?(I.next=I,Up(r)):(I.next=b.next,b.next=I),r.interleaved=I,Jp(i,h)}function HW(i,r,I,h){var b=r.interleaved;b===null?(I.next=I,Up(r)):(I.next=b.next,b.next=I),r.interleaved=I}function XW(i,r,I,h){var b=r.interleaved;return b===null?(I.next=I,Up(r)):(I.next=b.next,b.next=I),r.interleaved=I,Jp(i,h)}function Ra(i,r){return Jp(i,r)}var VZ=Jp;function Jp(i,r){i.lanes=Hn(i.lanes,r);var I=i.alternate;I!==null&&(I.lanes=Hn(I.lanes,r)),I===null&&(i.flags&(oa|Ls))!==Zn&&lX(i);for(var h=i,b=i.return;b!==null;)b.childLanes=Hn(b.childLanes,r),I=b.alternate,I!==null?I.childLanes=Hn(I.childLanes,r):(b.flags&(oa|Ls))!==Zn&&lX(i),h=b,b=b.return;if(h.tag===p){var S=h.stateNode;return S}else return null}var MZ=0,NZ=1,Op=2,Td=3,Pp=!1,Ty,$u;Ty=!1,$u=null;function Hh(i){var r={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:ft},effects:null};i.updateQueue=r}function Fg(i,r){var I=r.updateQueue,h=i.updateQueue;if(I===h){var b={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects};r.updateQueue=b}}function Ml(i,r){var I={eventTime:i,lane:r,tag:MZ,payload:null,callback:null,next:null};return I}function Zc(i,r,I){var h=i.updateQueue;if(h===null)return null;var b=h.shared;if($u===b&&!Ty&&(l("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),Ty=!0),TL()){var S=b.pending;return S===null?r.next=r:(r.next=S.next,S.next=r),b.pending=r,VZ(i,I)}else return XW(i,b,r,I)}function Xh(i,r,I){var h=r.updateQueue;if(h!==null){var b=h.shared;if(cg(I)){var S=b.lanes;S=lv(S,i.pendingLanes);var M=Hn(S,I);b.lanes=M,Ef(i,M)}}}function Ey(i,r){var I=i.updateQueue,h=i.alternate;if(h!==null){var b=h.updateQueue;if(I===b){var S=null,M=null,X=I.firstBaseUpdate;if(X!==null){var Y=X;do{var P={eventTime:Y.eventTime,lane:Y.lane,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null};M===null?S=M=P:(M.next=P,M=P),Y=Y.next}while(Y!==null);M===null?S=M=r:(M.next=r,M=r)}else S=M=r;I={baseState:b.baseState,firstBaseUpdate:S,lastBaseUpdate:M,shared:b.shared,effects:b.effects},i.updateQueue=I;return}}var ee=I.lastBaseUpdate;ee===null?I.firstBaseUpdate=r:ee.next=r,I.lastBaseUpdate=r}function Qp(i,r,I,h,b,S){switch(I.tag){case NZ:{var M=I.payload;if(typeof M=="function"){Mh();var X=M.call(S,h,b);{if(i.mode&la){Ei(!0);try{M.call(S,h,b)}finally{Ei(!1)}}Nh()}return X}return M}case Td:i.flags=i.flags&~Pr|fi;case MZ:{var Y=I.payload,P;if(typeof Y=="function"){Mh(),P=Y.call(S,h,b);{if(i.mode&la){Ei(!0);try{Y.call(S,h,b)}finally{Ei(!1)}}Nh()}}else P=Y;return P==null?h:Yt({},h,P)}case Op:return Pp=!0,h}return h}function jp(i,r,I,h){var b=i.updateQueue;Pp=!1,$u=b.shared;var S=b.firstBaseUpdate,M=b.lastBaseUpdate,X=b.shared.pending;if(X!==null){b.shared.pending=null;var Y=X,P=Y.next;Y.next=null,M===null?S=P:M.next=P,M=Y;var ee=i.alternate;if(ee!==null){var ve=ee.updateQueue,me=ve.lastBaseUpdate;me!==M&&(me===null?ve.firstBaseUpdate=P:me.next=P,ve.lastBaseUpdate=Y)}}if(S!==null){var Ee=b.baseState,Le=ft,at=null,jt=null,yn=null,Cn=S;do{var li=Cn.lane,ii=Cn.eventTime;if(ug(h,li)){if(yn!==null){var rt={eventTime:ii,lane:Ha,tag:Cn.tag,payload:Cn.payload,callback:Cn.callback,next:null};yn=yn.next=rt}Ee=Qp(i,b,Cn,Ee,r,I);var Xe=Cn.callback;if(Xe!==null&&Cn.lane!==Ha){i.flags|=Db;var St=b.effects;St===null?b.effects=[Cn]:St.push(Cn)}}else{var He={eventTime:ii,lane:li,tag:Cn.tag,payload:Cn.payload,callback:Cn.callback,next:null};yn===null?(jt=yn=He,at=Ee):yn=yn.next=He,Le=Hn(Le,li)}if(Cn=Cn.next,Cn===null){if(X=b.shared.pending,X===null)break;var on=X,an=on.next;on.next=null,Cn=an,b.lastBaseUpdate=on,b.shared.pending=null}}while(!0);yn===null&&(at=Ee),b.baseState=at,b.firstBaseUpdate=jt,b.lastBaseUpdate=yn;var Mn=b.shared.interleaved;if(Mn!==null){var Fn=Mn;do Le=Hn(Le,Fn.lane),Fn=Fn.next;while(Fn!==Mn)}else S===null&&(b.shared.lanes=ft);R0(Le),i.lanes=Le,i.memoizedState=Ee}$u=null}function Ky(i,r){if(typeof i!="function")throw new Error("Invalid argument passed as callback. Expected a function. Instead "+("received: "+i));i.call(r)}function HZ(){Pp=!1}function qp(){return Pp}function Fh(i,r,I){var h=r.effects;if(r.effects=null,h!==null)for(var b=0;b<h.length;b++){var S=h[b],M=S.callback;M!==null&&(S.callback=null,Ky(M,I))}}var Yh={},Yg=pc(Yh),Th=pc(Yh),Eh=pc(Yh);function Kh(i){if(i===Yh)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return i}function Tg(){var i=Kh(Eh.current);return i}function Ly(i,r){Tr(Eh,r,i),Tr(Th,i,i),Tr(Yg,Yh,i);var I=aW(r);Yr(Yg,i),Tr(Yg,I,i)}function no(i){Yr(Yg,i),Yr(Th,i),Yr(Eh,i)}function zy(){var i=Kh(Yg.current);return i}function XZ(i){Kh(Eh.current);var r=Kh(Yg.current),I=JB(r,i.type);r!==I&&(Tr(Th,i,i),Tr(Yg,I,i))}function $p(i){Th.current===i&&(Yr(Yg,i),Yr(Th,i))}var FW=0,FZ=1,YZ=1,Ed=2,_i=pc(FW);function _y(i,r){return(i&r)!==0}function eI(i){return i&FZ}function Dy(i,r){return i&FZ|r}function YW(i,r){return i|r}function Eg(i,r){Tr(_i,r,i)}function Kd(i){Yr(_i,i)}function TW(i,r){var I=i.memoizedState;return I!==null?I.dehydrated!==null:(i.memoizedProps,!0)}function Lh(i){for(var r=i;r!==null;){if(r.tag===K){var I=r.memoizedState;if(I!==null){var h=I.dehydrated;if(h===null||Cy(h)||hy(h))return r}}else if(r.tag===U&&r.memoizedProps.revealOrder!==void 0){var b=(r.flags&fi)!==Zn;if(b)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)return null;for(;r.sibling===null;){if(r.return===null||r.return===i)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var mr=0,ha=1,ol=2,wa=4,br=8,em=[];function zh(){for(var i=0;i<em.length;i++){var r=em[i];r._workInProgressVersionPrimary=null}em.length=0}function EW(i,r){var I=r._getVersion,h=I(r._source);i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[r,h]:i.mutableSourceEagerHydrationData.push(r,h)}var Jt=t.ReactCurrentDispatcher,tI=t.ReactCurrentBatchConfig,Ld,nI;Ld=new Set;var Kg=ft,Wi=null,Qa=null,Vi=null,Sc=!1,_h=!1,Nl=0,ky=0,Uy=25,gt=null,Qo=null,Lg=-1,Jy=!1;function Ci(){{var i=gt;Qo===null?Qo=[i]:Qo.push(i)}}function _t(){{var i=gt;Qo!==null&&(Lg++,Qo[Lg]!==i&&KW(i))}}function zg(i){i!=null&&!hi(i)&&l("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",gt,typeof i)}function KW(i){{var r=Tn(Wi);if(!Ld.has(r)&&(Ld.add(r),Qo!==null)){for(var I="",h=30,b=0;b<=Lg;b++){for(var S=Qo[b],M=b===Lg?i:S,X=b+1+". "+S;X.length<h;)X+=" ";X+=M+`
`,I+=X}l(`React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks

   Previous render            Next render
   ------------------------------------------------------
%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
`,r,I)}}}function Lr(){throw new Error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`)}function Dh(i,r){if(Jy)return!1;if(r===null)return l("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",gt),!1;i.length!==r.length&&l(`The final argument passed to %s changed size between renders. The order and size of this array must remain constant.

Previous: %s
Incoming: %s`,gt,"["+r.join(", ")+"]","["+i.join(", ")+"]");for(var I=0;I<r.length&&I<i.length;I++)if(!Bo(i[I],r[I]))return!1;return!0}function iI(i,r,I,h,b,S){Kg=S,Wi=r,Qo=i!==null?i._debugHookTypes:null,Lg=-1,Jy=i!==null&&i.type!==r.type,r.memoizedState=null,r.updateQueue=null,r.lanes=ft,i!==null&&i.memoizedState!==null?Jt.current=c:Qo!==null?Jt.current=JZ:Jt.current=UZ;var M=I(h,b);if(_h){var X=0;do{if(_h=!1,Nl=0,X>=Uy)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");X+=1,Jy=!1,Qa=null,Vi=null,r.updateQueue=null,Lg=-1,Jt.current=g,M=I(h,b)}while(_h)}Jt.current=fm,r._debugHookTypes=Qo;var Y=Qa!==null&&Qa.next!==null;if(Kg=ft,Wi=null,Qa=null,Vi=null,gt=null,Qo=null,Lg=-1,i!==null&&(i.flags&ic)!==(r.flags&ic)&&(i.mode&ei)!==vn&&l("Internal React error: Expected static flag was missing. Please notify the React team."),Sc=!1,Y)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return M}function zd(){var i=Nl!==0;return Nl=0,i}function xo(i,r,I){r.updateQueue=i.updateQueue,(r.mode&yl)!==vn?r.flags&=~(nc|va|Ks|Qn):r.flags&=~(Ks|Qn),i.lanes=ed(i.lanes,I)}function tm(){if(Jt.current=fm,Sc){for(var i=Wi.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Sc=!1}Kg=ft,Wi=null,Qa=null,Vi=null,Qo=null,Lg=-1,gt=null,s0=!1,_h=!1,Nl=0}function Hl(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vi===null?Wi.memoizedState=Vi=i:Vi=Vi.next=i,Vi}function ys(){var i;if(Qa===null){var r=Wi.alternate;r!==null?i=r.memoizedState:i=null}else i=Qa.next;var I;if(Vi===null?I=Wi.memoizedState:I=Vi.next,I!==null)Vi=I,I=Vi.next,Qa=i;else{if(i===null)throw new Error("Rendered more hooks than during the previous render.");Qa=i;var h={memoizedState:Qa.memoizedState,baseState:Qa.baseState,baseQueue:Qa.baseQueue,queue:Qa.queue,next:null};Vi===null?Wi.memoizedState=Vi=h:Vi=Vi.next=h}return Vi}function _g(){return{lastEffect:null,stores:null}}function Oy(i,r){return typeof r=="function"?r(i):r}function Py(i,r,I){var h=Hl(),b;I!==void 0?b=I(r):b=r,h.memoizedState=h.baseState=b;var S={pending:null,interleaved:null,lanes:ft,dispatch:null,lastRenderedReducer:i,lastRenderedState:b};h.queue=S;var M=S.dispatch=_Z.bind(null,Wi,S);return[h.memoizedState,M]}function kh(i,r,I){var h=ys(),b=h.queue;if(b===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");b.lastRenderedReducer=i;var S=Qa,M=S.baseQueue,X=b.pending;if(X!==null){if(M!==null){var Y=M.next,P=X.next;M.next=P,X.next=Y}S.baseQueue!==M&&l("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),S.baseQueue=M=X,b.pending=null}if(M!==null){var ee=M.next,ve=S.baseState,me=null,Ee=null,Le=null,at=ee;do{var jt=at.lane;if(ug(Kg,jt)){if(Le!==null){var Cn={lane:Ha,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null};Le=Le.next=Cn}if(at.hasEagerState)ve=at.eagerState;else{var li=at.action;ve=i(ve,li)}}else{var yn={lane:jt,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null};Le===null?(Ee=Le=yn,me=ve):Le=Le.next=yn,Wi.lanes=Hn(Wi.lanes,jt),R0(jt)}at=at.next}while(at!==null&&at!==ee);Le===null?me=ve:Le.next=Ee,Bo(ve,h.memoizedState)||h0(),h.memoizedState=ve,h.baseState=me,h.baseQueue=Le,b.lastRenderedState=ve}var ii=b.interleaved;if(ii!==null){var He=ii;do{var rt=He.lane;Wi.lanes=Hn(Wi.lanes,rt),R0(rt),He=He.next}while(He!==ii)}else M===null&&(b.lanes=ft);var Xe=b.dispatch;return[h.memoizedState,Xe]}function Uh(i,r,I){var h=ys(),b=h.queue;if(b===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");b.lastRenderedReducer=i;var S=b.dispatch,M=b.pending,X=h.memoizedState;if(M!==null){b.pending=null;var Y=M.next,P=Y;do{var ee=P.action;X=i(X,ee),P=P.next}while(P!==Y);Bo(X,h.memoizedState)||h0(),h.memoizedState=X,h.baseQueue===null&&(h.baseState=X),b.lastRenderedState=X}return[X,S]}function aI(i,r,I){}function e2(i,r,I){}function Qy(i,r,I){var h=Wi,b=Hl(),S,M=Li();if(M){if(I===void 0)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");S=I(),nI||S!==I()&&(l("The result of getServerSnapshot should be cached to avoid an infinite loop"),nI=!0)}else{if(S=r(),!nI){var X=r();Bo(S,X)||(l("The result of getSnapshot should be cached to avoid an infinite loop"),nI=!0)}var Y=sS();if(Y===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");lc(Y,Kg)||jy(h,r,S)}b.memoizedState=S;var P={value:S,getSnapshot:r};return b.queue=P,om(TZ.bind(null,h,P,i),[i]),h.flags|=Ks,Oh(ha|br,im.bind(null,h,P,S,r),void 0,null),S}function nm(i,r,I){var h=Wi,b=ys(),S=r();if(!nI){var M=r();Bo(S,M)||(l("The result of getSnapshot should be cached to avoid an infinite loop"),nI=!0)}var X=b.memoizedState,Y=!Bo(X,S);Y&&(b.memoizedState=S,h0());var P=b.queue;if(Qh(TZ.bind(null,h,P,i),[i]),P.getSnapshot!==r||Y||Vi!==null&&Vi.memoizedState.tag&ha){h.flags|=Ks,Oh(ha|br,im.bind(null,h,P,S,r),void 0,null);var ee=sS();if(ee===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");lc(ee,Kg)||jy(h,r,S)}return S}function jy(i,r,I){i.flags|=wf;var h={getSnapshot:r,value:I},b=Wi.updateQueue;if(b===null)b=_g(),Wi.updateQueue=b,b.stores=[h];else{var S=b.stores;S===null?b.stores=[h]:S.push(h)}}function im(i,r,I,h){r.value=I,r.getSnapshot=h,EZ(r)&&am(i)}function TZ(i,r,I){var h=function(){EZ(r)&&am(i)};return I(h)}function EZ(i){var r=i.getSnapshot,I=i.value;try{var h=r();return!Bo(I,h)}catch{return!0}}function am(i){var r=Ra(i,Vn);r!==null&&Br(r,i,Vn,ai)}function Jh(i){var r=Hl();typeof i=="function"&&(i=i()),r.memoizedState=r.baseState=i;var I={pending:null,interleaved:null,lanes:ft,dispatch:null,lastRenderedReducer:Oy,lastRenderedState:i};r.queue=I;var h=I.dispatch=DZ.bind(null,Wi,I);return[r.memoizedState,h]}function qy(i){return kh(Oy)}function rm(i){return Uh(Oy)}function Oh(i,r,I,h){var b={tag:i,create:r,destroy:I,deps:h,next:null},S=Wi.updateQueue;if(S===null)S=_g(),Wi.updateQueue=S,S.lastEffect=b.next=b;else{var M=S.lastEffect;if(M===null)S.lastEffect=b.next=b;else{var X=M.next;M.next=b,b.next=X,S.lastEffect=b}}return b}function $y(i){var r=Hl();{var I={current:i};return r.memoizedState=I,I}}function _d(i){var r=ys();return r.memoizedState}function rI(i,r,I,h){var b=Hl(),S=h===void 0?null:h;Wi.flags|=i,b.memoizedState=Oh(ha|r,I,void 0,S)}function Ph(i,r,I,h){var b=ys(),S=h===void 0?null:h,M=void 0;if(Qa!==null){var X=Qa.memoizedState;if(M=X.destroy,S!==null){var Y=X.deps;if(Dh(S,Y)){b.memoizedState=Oh(r,I,M,S);return}}}Wi.flags|=i,b.memoizedState=Oh(ha|r,I,M,S)}function om(i,r){return(Wi.mode&yl)!==vn?rI(nc|Ks|SC,br,i,r):rI(Ks|SC,br,i,r)}function Qh(i,r){return Ph(Ks,br,i,r)}function e0(i,r){return rI(Qn,ol,i,r)}function sm(i,r){return Ph(Qn,ol,i,r)}function lm(i,r){var I=Qn;return I|=Do,(Wi.mode&yl)!==vn&&(I|=va),rI(I,wa,i,r)}function cm(i,r){return Ph(Qn,wa,i,r)}function KZ(i,r){if(typeof r=="function"){var I=r,h=i();return I(h),function(){I(null)}}else if(r!=null){var b=r;b.hasOwnProperty("current")||l("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(b).join(", ")+"}");var S=i();return b.current=S,function(){b.current=null}}}function gm(i,r,I){typeof r!="function"&&l("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",r!==null?typeof r:"null");var h=I!=null?I.concat([i]):null,b=Qn;return b|=Do,(Wi.mode&yl)!==vn&&(b|=va),rI(b,wa,KZ.bind(null,r,i),h)}function Dd(i,r,I){typeof r!="function"&&l("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",r!==null?typeof r:"null");var h=I!=null?I.concat([i]):null;return Ph(Qn,wa,KZ.bind(null,r,i),h)}function LW(i,r){}var um=LW;function t0(i,r){var I=Hl(),h=r===void 0?null:r;return I.memoizedState=[i,h],i}function jh(i,r){var I=ys(),h=r===void 0?null:r,b=I.memoizedState;if(b!==null&&h!==null){var S=b[1];if(Dh(h,S))return b[0]}return I.memoizedState=[i,h],i}function Im(i,r){var I=Hl(),h=r===void 0?null:r,b=i();return I.memoizedState=[b,h],b}function qh(i,r){var I=ys(),h=r===void 0?null:r,b=I.memoizedState;if(b!==null&&h!==null){var S=b[1];if(Dh(h,S))return b[0]}var M=i();return I.memoizedState=[M,h],M}function dm(i){var r=Hl();return r.memoizedState=i,i}function n0(i){var r=ys(),I=Qa,h=I.memoizedState;return a0(r,h,i)}function i0(i){var r=ys();if(Qa===null)return r.memoizedState=i,i;var I=Qa.memoizedState;return a0(r,I,i)}function a0(i,r,I){var h=!Mx(Kg);if(h){if(!Bo(I,r)){var b=sv();Wi.lanes=Hn(Wi.lanes,b),R0(b),i.baseState=!0}return r}else return i.baseState&&(i.baseState=!1,h0()),i.memoizedState=I,I}function LZ(i,r,I){var h=Is();ya(Iv(h,Os)),i(!0);var b=tI.transition;tI.transition={};var S=tI.transition;tI.transition._updatedFibers=new Set;try{i(!1),r()}finally{if(ya(h),tI.transition=b,b===null&&S._updatedFibers){var M=S._updatedFibers.size;M>10&&o("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),S._updatedFibers.clear()}}}function Cm(){var i=Jh(!1),r=i[0],I=i[1],h=LZ.bind(null,I),b=Hl();return b.memoizedState=h,[r,h]}function r0(){var i=qy(),r=i[0],I=ys(),h=I.memoizedState;return[r,h]}function o0(){var i=rm(),r=i[0],I=ys(),h=I.memoizedState;return[r,h]}var s0=!1;function zZ(){return s0}function hm(){var i=Hl(),r=sS(),I=r.identifierPrefix,h;if(Li()){var b=xW();h=":"+I+"R"+b;var S=Nl++;S>0&&(h+="H"+S.toString(32)),h+=":"}else{var M=ky++;h=":"+I+"r"+M.toString(32)+":"}return i.memoizedState=h,h}function $h(){var i=ys(),r=i.memoizedState;return r}function _Z(i,r,I){typeof arguments[3]=="function"&&l("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var h=Od(i),b={lane:h,action:I,hasEagerState:!1,eagerState:null,next:null};if(l0(i))c0(r,b);else{var S=Yy(i,r,b,h);if(S!==null){var M=$o();Br(S,i,h,M),Am(S,r,h)}}kZ(i,h)}function DZ(i,r,I){typeof arguments[3]=="function"&&l("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var h=Od(i),b={lane:h,action:I,hasEagerState:!1,eagerState:null,next:null};if(l0(i))c0(r,b);else{var S=i.alternate;if(i.lanes===ft&&(S===null||S.lanes===ft)){var M=r.lastRenderedReducer;if(M!==null){var X;X=Jt.current,Jt.current=v;try{var Y=r.lastRenderedState,P=M(Y,I);if(b.hasEagerState=!0,b.eagerState=P,Bo(P,Y)){HW(i,r,b,h);return}}catch{}finally{Jt.current=X}}}var ee=Yy(i,r,b,h);if(ee!==null){var ve=$o();Br(ee,i,h,ve),Am(ee,r,h)}}kZ(i,h)}function l0(i){var r=i.alternate;return i===Wi||r!==null&&r===Wi}function c0(i,r){_h=Sc=!0;var I=i.pending;I===null?r.next=r:(r.next=I.next,I.next=r),i.pending=r}function Am(i,r,I){if(cg(I)){var h=r.lanes;h=lv(h,i.pendingLanes);var b=Hn(h,I);r.lanes=b,Ef(i,b)}}function kZ(i,r,I){$b(i,r)}var fm={readContext:Sa,useCallback:Lr,useContext:Lr,useEffect:Lr,useImperativeHandle:Lr,useInsertionEffect:Lr,useLayoutEffect:Lr,useMemo:Lr,useReducer:Lr,useRef:Lr,useState:Lr,useDebugValue:Lr,useDeferredValue:Lr,useTransition:Lr,useMutableSource:Lr,useSyncExternalStore:Lr,useId:Lr,unstable_isNewReconciler:de},UZ=null,JZ=null,c=null,g=null,f=null,v=null,B=null;{var V=function(){l("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},H=function(){l("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};UZ={readContext:function(i){return Sa(i)},useCallback:function(i,r){return gt="useCallback",Ci(),zg(r),t0(i,r)},useContext:function(i){return gt="useContext",Ci(),Sa(i)},useEffect:function(i,r){return gt="useEffect",Ci(),zg(r),om(i,r)},useImperativeHandle:function(i,r,I){return gt="useImperativeHandle",Ci(),zg(I),gm(i,r,I)},useInsertionEffect:function(i,r){return gt="useInsertionEffect",Ci(),zg(r),e0(i,r)},useLayoutEffect:function(i,r){return gt="useLayoutEffect",Ci(),zg(r),lm(i,r)},useMemo:function(i,r){gt="useMemo",Ci(),zg(r);var I=Jt.current;Jt.current=f;try{return Im(i,r)}finally{Jt.current=I}},useReducer:function(i,r,I){gt="useReducer",Ci();var h=Jt.current;Jt.current=f;try{return Py(i,r,I)}finally{Jt.current=h}},useRef:function(i){return gt="useRef",Ci(),$y(i)},useState:function(i){gt="useState",Ci();var r=Jt.current;Jt.current=f;try{return Jh(i)}finally{Jt.current=r}},useDebugValue:function(i,r){return gt="useDebugValue",Ci(),void 0},useDeferredValue:function(i){return gt="useDeferredValue",Ci(),dm(i)},useTransition:function(){return gt="useTransition",Ci(),Cm()},useMutableSource:function(i,r,I){return gt="useMutableSource",Ci(),void 0},useSyncExternalStore:function(i,r,I){return gt="useSyncExternalStore",Ci(),Qy(i,r,I)},useId:function(){return gt="useId",Ci(),hm()},unstable_isNewReconciler:de},JZ={readContext:function(i){return Sa(i)},useCallback:function(i,r){return gt="useCallback",_t(),t0(i,r)},useContext:function(i){return gt="useContext",_t(),Sa(i)},useEffect:function(i,r){return gt="useEffect",_t(),om(i,r)},useImperativeHandle:function(i,r,I){return gt="useImperativeHandle",_t(),gm(i,r,I)},useInsertionEffect:function(i,r){return gt="useInsertionEffect",_t(),e0(i,r)},useLayoutEffect:function(i,r){return gt="useLayoutEffect",_t(),lm(i,r)},useMemo:function(i,r){gt="useMemo",_t();var I=Jt.current;Jt.current=f;try{return Im(i,r)}finally{Jt.current=I}},useReducer:function(i,r,I){gt="useReducer",_t();var h=Jt.current;Jt.current=f;try{return Py(i,r,I)}finally{Jt.current=h}},useRef:function(i){return gt="useRef",_t(),$y(i)},useState:function(i){gt="useState",_t();var r=Jt.current;Jt.current=f;try{return Jh(i)}finally{Jt.current=r}},useDebugValue:function(i,r){return gt="useDebugValue",_t(),void 0},useDeferredValue:function(i){return gt="useDeferredValue",_t(),dm(i)},useTransition:function(){return gt="useTransition",_t(),Cm()},useMutableSource:function(i,r,I){return gt="useMutableSource",_t(),void 0},useSyncExternalStore:function(i,r,I){return gt="useSyncExternalStore",_t(),Qy(i,r,I)},useId:function(){return gt="useId",_t(),hm()},unstable_isNewReconciler:de},c={readContext:function(i){return Sa(i)},useCallback:function(i,r){return gt="useCallback",_t(),jh(i,r)},useContext:function(i){return gt="useContext",_t(),Sa(i)},useEffect:function(i,r){return gt="useEffect",_t(),Qh(i,r)},useImperativeHandle:function(i,r,I){return gt="useImperativeHandle",_t(),Dd(i,r,I)},useInsertionEffect:function(i,r){return gt="useInsertionEffect",_t(),sm(i,r)},useLayoutEffect:function(i,r){return gt="useLayoutEffect",_t(),cm(i,r)},useMemo:function(i,r){gt="useMemo",_t();var I=Jt.current;Jt.current=v;try{return qh(i,r)}finally{Jt.current=I}},useReducer:function(i,r,I){gt="useReducer",_t();var h=Jt.current;Jt.current=v;try{return kh(i,r,I)}finally{Jt.current=h}},useRef:function(i){return gt="useRef",_t(),_d()},useState:function(i){gt="useState",_t();var r=Jt.current;Jt.current=v;try{return qy(i)}finally{Jt.current=r}},useDebugValue:function(i,r){return gt="useDebugValue",_t(),um()},useDeferredValue:function(i){return gt="useDeferredValue",_t(),n0(i)},useTransition:function(){return gt="useTransition",_t(),r0()},useMutableSource:function(i,r,I){return gt="useMutableSource",_t(),void 0},useSyncExternalStore:function(i,r,I){return gt="useSyncExternalStore",_t(),nm(i,r)},useId:function(){return gt="useId",_t(),$h()},unstable_isNewReconciler:de},g={readContext:function(i){return Sa(i)},useCallback:function(i,r){return gt="useCallback",_t(),jh(i,r)},useContext:function(i){return gt="useContext",_t(),Sa(i)},useEffect:function(i,r){return gt="useEffect",_t(),Qh(i,r)},useImperativeHandle:function(i,r,I){return gt="useImperativeHandle",_t(),Dd(i,r,I)},useInsertionEffect:function(i,r){return gt="useInsertionEffect",_t(),sm(i,r)},useLayoutEffect:function(i,r){return gt="useLayoutEffect",_t(),cm(i,r)},useMemo:function(i,r){gt="useMemo",_t();var I=Jt.current;Jt.current=B;try{return qh(i,r)}finally{Jt.current=I}},useReducer:function(i,r,I){gt="useReducer",_t();var h=Jt.current;Jt.current=B;try{return Uh(i,r,I)}finally{Jt.current=h}},useRef:function(i){return gt="useRef",_t(),_d()},useState:function(i){gt="useState",_t();var r=Jt.current;Jt.current=B;try{return rm(i)}finally{Jt.current=r}},useDebugValue:function(i,r){return gt="useDebugValue",_t(),um()},useDeferredValue:function(i){return gt="useDeferredValue",_t(),i0(i)},useTransition:function(){return gt="useTransition",_t(),o0()},useMutableSource:function(i,r,I){return gt="useMutableSource",_t(),void 0},useSyncExternalStore:function(i,r,I){return gt="useSyncExternalStore",_t(),nm(i,r)},useId:function(){return gt="useId",_t(),$h()},unstable_isNewReconciler:de},f={readContext:function(i){return V(),Sa(i)},useCallback:function(i,r){return gt="useCallback",H(),Ci(),t0(i,r)},useContext:function(i){return gt="useContext",H(),Ci(),Sa(i)},useEffect:function(i,r){return gt="useEffect",H(),Ci(),om(i,r)},useImperativeHandle:function(i,r,I){return gt="useImperativeHandle",H(),Ci(),gm(i,r,I)},useInsertionEffect:function(i,r){return gt="useInsertionEffect",H(),Ci(),e0(i,r)},useLayoutEffect:function(i,r){return gt="useLayoutEffect",H(),Ci(),lm(i,r)},useMemo:function(i,r){gt="useMemo",H(),Ci();var I=Jt.current;Jt.current=f;try{return Im(i,r)}finally{Jt.current=I}},useReducer:function(i,r,I){gt="useReducer",H(),Ci();var h=Jt.current;Jt.current=f;try{return Py(i,r,I)}finally{Jt.current=h}},useRef:function(i){return gt="useRef",H(),Ci(),$y(i)},useState:function(i){gt="useState",H(),Ci();var r=Jt.current;Jt.current=f;try{return Jh(i)}finally{Jt.current=r}},useDebugValue:function(i,r){return gt="useDebugValue",H(),Ci(),void 0},useDeferredValue:function(i){return gt="useDeferredValue",H(),Ci(),dm(i)},useTransition:function(){return gt="useTransition",H(),Ci(),Cm()},useMutableSource:function(i,r,I){return gt="useMutableSource",H(),Ci(),void 0},useSyncExternalStore:function(i,r,I){return gt="useSyncExternalStore",H(),Ci(),Qy(i,r,I)},useId:function(){return gt="useId",H(),Ci(),hm()},unstable_isNewReconciler:de},v={readContext:function(i){return V(),Sa(i)},useCallback:function(i,r){return gt="useCallback",H(),_t(),jh(i,r)},useContext:function(i){return gt="useContext",H(),_t(),Sa(i)},useEffect:function(i,r){return gt="useEffect",H(),_t(),Qh(i,r)},useImperativeHandle:function(i,r,I){return gt="useImperativeHandle",H(),_t(),Dd(i,r,I)},useInsertionEffect:function(i,r){return gt="useInsertionEffect",H(),_t(),sm(i,r)},useLayoutEffect:function(i,r){return gt="useLayoutEffect",H(),_t(),cm(i,r)},useMemo:function(i,r){gt="useMemo",H(),_t();var I=Jt.current;Jt.current=v;try{return qh(i,r)}finally{Jt.current=I}},useReducer:function(i,r,I){gt="useReducer",H(),_t();var h=Jt.current;Jt.current=v;try{return kh(i,r,I)}finally{Jt.current=h}},useRef:function(i){return gt="useRef",H(),_t(),_d()},useState:function(i){gt="useState",H(),_t();var r=Jt.current;Jt.current=v;try{return qy(i)}finally{Jt.current=r}},useDebugValue:function(i,r){return gt="useDebugValue",H(),_t(),um()},useDeferredValue:function(i){return gt="useDeferredValue",H(),_t(),n0(i)},useTransition:function(){return gt="useTransition",H(),_t(),r0()},useMutableSource:function(i,r,I){return gt="useMutableSource",H(),_t(),void 0},useSyncExternalStore:function(i,r,I){return gt="useSyncExternalStore",H(),_t(),nm(i,r)},useId:function(){return gt="useId",H(),_t(),$h()},unstable_isNewReconciler:de},B={readContext:function(i){return V(),Sa(i)},useCallback:function(i,r){return gt="useCallback",H(),_t(),jh(i,r)},useContext:function(i){return gt="useContext",H(),_t(),Sa(i)},useEffect:function(i,r){return gt="useEffect",H(),_t(),Qh(i,r)},useImperativeHandle:function(i,r,I){return gt="useImperativeHandle",H(),_t(),Dd(i,r,I)},useInsertionEffect:function(i,r){return gt="useInsertionEffect",H(),_t(),sm(i,r)},useLayoutEffect:function(i,r){return gt="useLayoutEffect",H(),_t(),cm(i,r)},useMemo:function(i,r){gt="useMemo",H(),_t();var I=Jt.current;Jt.current=v;try{return qh(i,r)}finally{Jt.current=I}},useReducer:function(i,r,I){gt="useReducer",H(),_t();var h=Jt.current;Jt.current=v;try{return Uh(i,r,I)}finally{Jt.current=h}},useRef:function(i){return gt="useRef",H(),_t(),_d()},useState:function(i){gt="useState",H(),_t();var r=Jt.current;Jt.current=v;try{return rm(i)}finally{Jt.current=r}},useDebugValue:function(i,r){return gt="useDebugValue",H(),_t(),um()},useDeferredValue:function(i){return gt="useDeferredValue",H(),_t(),i0(i)},useTransition:function(){return gt="useTransition",H(),_t(),o0()},useMutableSource:function(i,r,I){return gt="useMutableSource",H(),_t(),void 0},useSyncExternalStore:function(i,r,I){return gt="useSyncExternalStore",H(),_t(),nm(i,r)},useId:function(){return gt="useId",H(),_t(),$h()},unstable_isNewReconciler:de}}var _=e.unstable_now,O=0,oe=-1,Ie=-1,xe=-1,Je=!1,it=!1;function vt(){return Je}function xt(){it=!0}function fn(){Je=!1,it=!1}function Kn(){Je=it,it=!1}function Gn(){return O}function Qi(){O=_()}function Di(i){Ie=_(),i.actualStartTime<0&&(i.actualStartTime=_())}function Ye(i){Ie=-1}function lt(i,r){if(Ie>=0){var I=_()-Ie;i.actualDuration+=I,r&&(i.selfBaseDuration=I),Ie=-1}}function we(i){if(oe>=0){var r=_()-oe;oe=-1;for(var I=i.return;I!==null;){switch(I.tag){case p:var h=I.stateNode;h.effectDuration+=r;return;case N:var b=I.stateNode;b.effectDuration+=r;return}I=I.return}}}function Mt(i){if(xe>=0){var r=_()-xe;xe=-1;for(var I=i.return;I!==null;){switch(I.tag){case p:var h=I.stateNode;h!==null&&(h.passiveEffectDuration+=r);return;case N:var b=I.stateNode;b!==null&&(b.passiveEffectDuration+=r);return}I=I.return}}}function rn(){oe=_()}function nn(){xe=_()}function jn(i){for(var r=i.child;r;)i.actualDuration+=r.actualDuration,r=r.sibling}function _n(i,r){if(i&&i.defaultProps){var I=Yt({},r),h=i.defaultProps;for(var b in h)I[b]===void 0&&(I[b]=h[b]);return I}return r}var Ni={},pi,$i,oi,Dn,ga,na,io,ja,ao,ro,Wo;{pi=new Set,$i=new Set,oi=new Set,Dn=new Set,ja=new Set,ga=new Set,ao=new Set,ro=new Set,Wo=new Set;var oI=new Set;io=function(i,r){if(!(i===null||typeof i=="function")){var I=r+"_"+i;oI.has(I)||(oI.add(I),l("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",r,i))}},na=function(i,r){if(r===void 0){var I=Pn(i)||"Component";ga.has(I)||(ga.add(I),l("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",I))}},Object.defineProperty(Ni,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(Ni)}function Dg(i,r,I,h){var b=i.memoizedState,S=I(h,b);{if(i.mode&la){Ei(!0);try{S=I(h,b)}finally{Ei(!1)}}na(r,S)}var M=S==null?b:Yt({},b,S);if(i.memoizedState=M,i.lanes===ft){var X=i.updateQueue;X.baseState=M}}var oo={isMounted:Ob,enqueueSetState:function(i,r,I){var h=vl(i),b=$o(),S=Od(h),M=Ml(b,S);M.payload=r,I!=null&&(io(I,"setState"),M.callback=I);var X=Zc(h,M,S);X!==null&&(Br(X,h,S,b),Xh(X,h,S)),$b(h,S)},enqueueReplaceState:function(i,r,I){var h=vl(i),b=$o(),S=Od(h),M=Ml(b,S);M.tag=NZ,M.payload=r,I!=null&&(io(I,"replaceState"),M.callback=I);var X=Zc(h,M,S);X!==null&&(Br(X,h,S,b),Xh(X,h,S)),$b(h,S)},enqueueForceUpdate:function(i,r){var I=vl(i),h=$o(),b=Od(I),S=Ml(h,b);S.tag=Op,r!=null&&(io(r,"forceUpdate"),S.callback=r);var M=Zc(I,S,b);M!==null&&(Br(M,I,b,h),Xh(M,I,b)),xx(I,b)}};function kg(i,r,I,h,b,S,M){var X=i.stateNode;if(typeof X.shouldComponentUpdate=="function"){var Y=X.shouldComponentUpdate(h,S,M);{if(i.mode&la){Ei(!0);try{Y=X.shouldComponentUpdate(h,S,M)}finally{Ei(!1)}}Y===void 0&&l("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",Pn(r)||"Component")}return Y}return r.prototype&&r.prototype.isPureReactComponent?!Cd(I,h)||!Cd(b,S):!0}function g0(i,r,I){var h=i.stateNode;{var b=Pn(r)||"Component",S=h.render;S||(r.prototype&&typeof r.prototype.render=="function"?l("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",b):l("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",b)),h.getInitialState&&!h.getInitialState.isReactClassApproved&&!h.state&&l("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",b),h.getDefaultProps&&!h.getDefaultProps.isReactClassApproved&&l("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",b),h.propTypes&&l("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",b),h.contextType&&l("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",b),r.childContextTypes&&!Wo.has(r)&&(i.mode&la)===vn&&(Wo.add(r),l(`%s uses the legacy childContextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() instead

.Learn more about this warning here: https://reactjs.org/link/legacy-context`,b)),r.contextTypes&&!Wo.has(r)&&(i.mode&la)===vn&&(Wo.add(r),l(`%s uses the legacy contextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() with static contextType instead.

Learn more about this warning here: https://reactjs.org/link/legacy-context`,b)),h.contextTypes&&l("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",b),r.contextType&&r.contextTypes&&!ao.has(r)&&(ao.add(r),l("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",b)),typeof h.componentShouldUpdate=="function"&&l("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",b),r.prototype&&r.prototype.isPureReactComponent&&typeof h.shouldComponentUpdate<"u"&&l("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",Pn(r)||"A pure component"),typeof h.componentDidUnmount=="function"&&l("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",b),typeof h.componentDidReceiveProps=="function"&&l("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",b),typeof h.componentWillRecieveProps=="function"&&l("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",b),typeof h.UNSAFE_componentWillRecieveProps=="function"&&l("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",b);var M=h.props!==I;h.props!==void 0&&M&&l("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",b,b),h.defaultProps&&l("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",b,b),typeof h.getSnapshotBeforeUpdate=="function"&&typeof h.componentDidUpdate!="function"&&!oi.has(r)&&(oi.add(r),l("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",Pn(r))),typeof h.getDerivedStateFromProps=="function"&&l("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",b),typeof h.getDerivedStateFromError=="function"&&l("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",b),typeof r.getSnapshotBeforeUpdate=="function"&&l("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",b);var X=h.state;X&&(typeof X!="object"||hi(X))&&l("%s.state: must be set to an object or null",b),typeof h.getChildContext=="function"&&typeof r.childContextTypes!="object"&&l("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",b)}}function u0(i,r){r.updater=oo,i.stateNode=r,_o(r,i),r._reactInternalInstance=Ni}function OZ(i,r,I){var h=!1,b=Ro,S=Ro,M=r.contextType;if("contextType"in r){var X=M===null||M!==void 0&&M.$$typeof===Te&&M._context===void 0;if(!X&&!ro.has(r)){ro.add(r);var Y="";M===void 0?Y=" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":typeof M!="object"?Y=" However, it is set to a "+typeof M+".":M.$$typeof===ne?Y=" Did you accidentally pass the Context.Provider instead?":M._context!==void 0?Y=" Did you accidentally pass the Context.Consumer instead?":Y=" However, it is set to an object with keys {"+Object.keys(M).join(", ")+"}.",l("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",Pn(r)||"Component",Y)}}if(typeof M=="object"&&M!==null)S=Sa(M);else{b=Sg(i,r,!0);var P=r.contextTypes;h=P!=null,S=h?Vd(i,b):Ro}var ee=new r(I,S);if(i.mode&la){Ei(!0);try{ee=new r(I,S)}finally{Ei(!1)}}var ve=i.memoizedState=ee.state!==null&&ee.state!==void 0?ee.state:null;u0(i,ee);{if(typeof r.getDerivedStateFromProps=="function"&&ve===null){var me=Pn(r)||"Component";$i.has(me)||($i.add(me),l("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",me,ee.state===null?"null":"undefined",me))}if(typeof r.getDerivedStateFromProps=="function"||typeof ee.getSnapshotBeforeUpdate=="function"){var Ee=null,Le=null,at=null;if(typeof ee.componentWillMount=="function"&&ee.componentWillMount.__suppressDeprecationWarning!==!0?Ee="componentWillMount":typeof ee.UNSAFE_componentWillMount=="function"&&(Ee="UNSAFE_componentWillMount"),typeof ee.componentWillReceiveProps=="function"&&ee.componentWillReceiveProps.__suppressDeprecationWarning!==!0?Le="componentWillReceiveProps":typeof ee.UNSAFE_componentWillReceiveProps=="function"&&(Le="UNSAFE_componentWillReceiveProps"),typeof ee.componentWillUpdate=="function"&&ee.componentWillUpdate.__suppressDeprecationWarning!==!0?at="componentWillUpdate":typeof ee.UNSAFE_componentWillUpdate=="function"&&(at="UNSAFE_componentWillUpdate"),Ee!==null||Le!==null||at!==null){var jt=Pn(r)||"Component",yn=typeof r.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";Dn.has(jt)||(Dn.add(jt),l(`Unsafe legacy lifecycles will not be called for components using new component APIs.

%s uses %s but also contains the following legacy lifecycles:%s%s%s

The above lifecycles should be removed. Learn more about this warning here:
https://reactjs.org/link/unsafe-component-lifecycles`,jt,yn,Ee!==null?`
  `+Ee:"",Le!==null?`
  `+Le:"",at!==null?`
  `+at:""))}}}return h&&yy(i,b,S),ee}function zW(i,r){var I=r.state;typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),I!==r.state&&(l("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",Tn(i)||"Component"),oo.enqueueReplaceState(r,r.state,null))}function t2(i,r,I,h){var b=r.state;if(typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(I,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(I,h),r.state!==b){{var S=Tn(i)||"Component";pi.has(S)||(pi.add(S),l("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",S))}oo.enqueueReplaceState(r,r.state,null)}}function _W(i,r,I,h){g0(i,r,I);var b=i.stateNode;b.props=I,b.state=i.memoizedState,b.refs={},Hh(i);var S=r.contextType;if(typeof S=="object"&&S!==null)b.context=Sa(S);else{var M=Sg(i,r,!0);b.context=Vd(i,M)}{if(b.state===I){var X=Pn(r)||"Component";ja.has(X)||(ja.add(X),l("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",X))}i.mode&la&&to.recordLegacyContextWarning(i,b),to.recordUnsafeLifecycleWarnings(i,b)}b.state=i.memoizedState;var Y=r.getDerivedStateFromProps;if(typeof Y=="function"&&(Dg(i,r,Y,I),b.state=i.memoizedState),typeof r.getDerivedStateFromProps!="function"&&typeof b.getSnapshotBeforeUpdate!="function"&&(typeof b.UNSAFE_componentWillMount=="function"||typeof b.componentWillMount=="function")&&(zW(i,b),jp(i,I,b,h),b.state=i.memoizedState),typeof b.componentDidMount=="function"){var P=Qn;P|=Do,(i.mode&yl)!==vn&&(P|=va),i.flags|=P}}function o1(i,r,I,h){var b=i.stateNode,S=i.memoizedProps;b.props=S;var M=b.context,X=r.contextType,Y=Ro;if(typeof X=="object"&&X!==null)Y=Sa(X);else{var P=Sg(i,r,!0);Y=Vd(i,P)}var ee=r.getDerivedStateFromProps,ve=typeof ee=="function"||typeof b.getSnapshotBeforeUpdate=="function";!ve&&(typeof b.UNSAFE_componentWillReceiveProps=="function"||typeof b.componentWillReceiveProps=="function")&&(S!==I||M!==Y)&&t2(i,b,I,Y),HZ();var me=i.memoizedState,Ee=b.state=me;if(jp(i,I,b,h),Ee=i.memoizedState,S===I&&me===Ee&&!Md()&&!qp()){if(typeof b.componentDidMount=="function"){var Le=Qn;Le|=Do,(i.mode&yl)!==vn&&(Le|=va),i.flags|=Le}return!1}typeof ee=="function"&&(Dg(i,r,ee,I),Ee=i.memoizedState);var at=qp()||kg(i,r,S,I,me,Ee,Y);if(at){if(!ve&&(typeof b.UNSAFE_componentWillMount=="function"||typeof b.componentWillMount=="function")&&(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"){var jt=Qn;jt|=Do,(i.mode&yl)!==vn&&(jt|=va),i.flags|=jt}}else{if(typeof b.componentDidMount=="function"){var yn=Qn;yn|=Do,(i.mode&yl)!==vn&&(yn|=va),i.flags|=yn}i.memoizedProps=I,i.memoizedState=Ee}return b.props=I,b.state=Ee,b.context=Y,at}function s1(i,r,I,h,b){var S=r.stateNode;Fg(i,r);var M=r.memoizedProps,X=r.type===r.elementType?M:_n(r.type,M);S.props=X;var Y=r.pendingProps,P=S.context,ee=I.contextType,ve=Ro;if(typeof ee=="object"&&ee!==null)ve=Sa(ee);else{var me=Sg(r,I,!0);ve=Vd(r,me)}var Ee=I.getDerivedStateFromProps,Le=typeof Ee=="function"||typeof S.getSnapshotBeforeUpdate=="function";!Le&&(typeof S.UNSAFE_componentWillReceiveProps=="function"||typeof S.componentWillReceiveProps=="function")&&(M!==Y||P!==ve)&&t2(r,S,h,ve),HZ();var at=r.memoizedState,jt=S.state=at;if(jp(r,h,S,b),jt=r.memoizedState,M===Y&&at===jt&&!Md()&&!qp()&&!Oe)return typeof S.componentDidUpdate=="function"&&(M!==i.memoizedProps||at!==i.memoizedState)&&(r.flags|=Qn),typeof S.getSnapshotBeforeUpdate=="function"&&(M!==i.memoizedProps||at!==i.memoizedState)&&(r.flags|=tc),!1;typeof Ee=="function"&&(Dg(r,I,Ee,h),jt=r.memoizedState);var yn=qp()||kg(r,I,X,h,at,jt,ve)||Oe;return yn?(!Le&&(typeof S.UNSAFE_componentWillUpdate=="function"||typeof S.componentWillUpdate=="function")&&(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(h,jt,ve),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(h,jt,ve)),typeof S.componentDidUpdate=="function"&&(r.flags|=Qn),typeof S.getSnapshotBeforeUpdate=="function"&&(r.flags|=tc)):(typeof S.componentDidUpdate=="function"&&(M!==i.memoizedProps||at!==i.memoizedState)&&(r.flags|=Qn),typeof S.getSnapshotBeforeUpdate=="function"&&(M!==i.memoizedProps||at!==i.memoizedState)&&(r.flags|=tc),r.memoizedProps=h,r.memoizedState=jt),S.props=h,S.state=jt,S.context=ve,yn}function eA(i,r){return{value:i,source:r,stack:Oc(r),digest:null}}function DW(i,r,I){return{value:i,source:null,stack:I??null,digest:r??null}}function l1(i,r){return!0}function kW(i,r){try{var I=l1(i,r);if(I===!1)return;var h=r.value,b=r.source,S=r.stack,M=S!==null?S:"";if(h!=null&&h._suppressLogging){if(i.tag===C)return;console.error(h)}var X=b?Tn(b):null,Y=X?"The above error occurred in the <"+X+"> component:":"The above error occurred in one of your React components:",P;if(i.tag===p)P=`Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.`;else{var ee=Tn(i)||"Anonymous";P="React will try to recreate this component tree from scratch "+("using the error boundary you provided, "+ee+".")}var ve=Y+`
`+M+`

`+(""+P);console.error(ve)}catch(me){setTimeout(function(){throw me})}}var c1=typeof WeakMap=="function"?WeakMap:Map;function n2(i,r,I){var h=Ml(ai,I);h.tag=Td,h.payload={element:null};var b=r.value;return h.callback=function(){tz(b),kW(i,r)},h}function UW(i,r,I){var h=Ml(ai,I);h.tag=Td;var b=i.type.getDerivedStateFromError;if(typeof b=="function"){var S=r.value;h.payload=function(){return b(S)},h.callback=function(){dX(i),kW(i,r)}}var M=i.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(h.callback=function(){dX(i),kW(i,r),typeof b!="function"&&$L(this);var Y=r.value,P=r.stack;this.componentDidCatch(Y,{componentStack:P!==null?P:""}),typeof b!="function"&&(Mr(i.lanes,Vn)||l("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",Tn(i)||"Unknown"))}),h}function i2(i,r,I){var h=i.pingCache,b;if(h===null?(h=i.pingCache=new c1,b=new Set,h.set(r,b)):(b=h.get(r),b===void 0&&(b=new Set,h.set(r,b))),!b.has(I)){b.add(I);var S=nz.bind(null,i,r,I);cs&&w0(i,I),r.then(S,S)}}function g1(i,r,I,h){var b=i.updateQueue;if(b===null){var S=new Set;S.add(I),i.updateQueue=S}else b.add(I)}function u1(i,r){var I=i.tag;if((i.mode&ei)===vn&&(I===d||I===W||I===L)){var h=i.alternate;h?(i.updateQueue=h.updateQueue,i.memoizedState=h.memoizedState,i.lanes=h.lanes):(i.updateQueue=null,i.memoizedState=null)}}function a2(i){var r=i;do{if(r.tag===K&&TW(r))return r;r=r.return}while(r!==null);return null}function r2(i,r,I,h,b){if((i.mode&ei)===vn){if(i===r)i.flags|=Pr;else{if(i.flags|=fi,I.flags|=kb,I.flags&=~(xf|zI),I.tag===C){var S=I.alternate;if(S===null)I.tag=E;else{var M=Ml(ai,Vn);M.tag=Op,Zc(I,M,Vn)}}I.lanes=Hn(I.lanes,Vn)}return i}return i.flags|=Pr,i.lanes=b,i}function I1(i,r,I,h,b){if(I.flags|=zI,cs&&w0(i,b),h!==null&&typeof h=="object"&&typeof h.then=="function"){var S=h;u1(I),Li()&&I.mode&ei&&zp();var M=a2(r);if(M!==null){M.flags&=~ec,r2(M,r,I,i,b),M.mode&ei&&i2(i,S,b),g1(M,i,S);return}else{if(!hB(b)){i2(i,S,b),ZV();return}var X=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.");h=X}}else if(Li()&&I.mode&ei){zp();var Y=a2(r);if(Y!==null){(Y.flags&Pr)===Zn&&(Y.flags|=ec),r2(Y,r,I,i,b),al(eA(h,I));return}}h=eA(h,I),kL(h);var P=r;do{switch(P.tag){case p:{var ee=h;P.flags|=Pr;var ve=$I(b);P.lanes=Hn(P.lanes,ve);var me=n2(P,ee,ve);Ey(P,me);return}case C:var Ee=h,Le=P.type,at=P.stateNode;if((P.flags&fi)===Zn&&(typeof Le.getDerivedStateFromError=="function"||at!==null&&typeof at.componentDidCatch=="function"&&!aX(at))){P.flags|=Pr;var jt=$I(b);P.lanes=Hn(P.lanes,jt);var yn=UW(P,Ee,jt);Ey(P,yn);return}break}P=P.return}while(P!==null)}function d1(){return null}var I0=t.ReactCurrentOwner,Rc=!1,JW,d0,OW,PW,QW,tA,jW,PZ,C0;JW={},d0={},OW={},PW={},QW={},tA=!1,jW={},PZ={},C0={};function jo(i,r,I,h){i===null?r.child=Mg(r,null,I,h):r.child=rl(r,i.child,I,h)}function C1(i,r,I,h){r.child=rl(r,i.child,null,h),r.child=rl(r,null,I,h)}function o2(i,r,I,h,b){if(r.type!==r.elementType){var S=I.propTypes;S&&js(S,h,"prop",Pn(I))}var M=I.render,X=r.ref,Y,P;Bc(r,b),WC(r);{if(I0.current=r,Cr(!0),Y=iI(i,r,M,h,X,b),P=zd(),r.mode&la){Ei(!0);try{Y=iI(i,r,M,h,X,b),P=zd()}finally{Ei(!1)}}Cr(!1)}return JI(),i!==null&&!Rc?(xo(i,r,b),sI(i,r,b)):(Li()&&P&&By(r),r.flags|=Zi,jo(i,r,Y,b),r.child)}function s2(i,r,I,h,b){if(i===null){var S=I.type;if(mz(S)&&I.compare===null&&I.defaultProps===void 0){var M=S;return M=Zm(S),r.tag=L,r.type=M,eV(r,S),l2(i,r,M,h,b)}{var X=S.propTypes;if(X&&js(X,h,"prop",Pn(S)),I.defaultProps!==void 0){var Y=Pn(S)||"Unknown";C0[Y]||(l("%s: Support for defaultProps will be removed from memo components in a future major release. Use JavaScript default parameters instead.",Y),C0[Y]=!0)}}var P=FV(I.type,null,h,r,r.mode,b);return P.ref=r.ref,P.return=r,r.child=P,P}{var ee=I.type,ve=ee.propTypes;ve&&js(ve,h,"prop",Pn(ee))}var me=i.child,Ee=oV(i,b);if(!Ee){var Le=me.memoizedProps,at=I.compare;if(at=at!==null?at:Cd,at(Le,h)&&i.ref===r.ref)return sI(i,r,b)}r.flags|=Zi;var jt=oA(me,h);return jt.ref=r.ref,jt.return=r,r.child=jt,jt}function l2(i,r,I,h,b){if(r.type!==r.elementType){var S=r.elementType;if(S.$$typeof===Ut){var M=S,X=M._payload,Y=M._init;try{S=Y(X)}catch{S=null}var P=S&&S.propTypes;P&&js(P,h,"prop",Pn(S))}}if(i!==null){var ee=i.memoizedProps;if(Cd(ee,h)&&i.ref===r.ref&&r.type===i.type)if(Rc=!1,r.pendingProps=h=ee,oV(i,b))(i.flags&kb)!==Zn&&(Rc=!0);else return r.lanes=i.lanes,sI(i,r,b)}return qW(i,r,I,h,b)}function c2(i,r,I){var h=r.pendingProps,b=h.children,S=i!==null?i.memoizedState:null;if(h.mode==="hidden"||We)if((r.mode&ei)===vn){var M={baseLanes:ft,cachePool:null,transitions:null};r.memoizedState=M,lS(r,I)}else if(Mr(I,Uo)){var ve={baseLanes:ft,cachePool:null,transitions:null};r.memoizedState=ve;var me=S!==null?S.baseLanes:I;lS(r,me)}else{var X=null,Y;if(S!==null){var P=S.baseLanes;Y=Hn(P,I)}else Y=I;r.lanes=r.childLanes=Uo;var ee={baseLanes:Y,cachePool:X,transitions:null};return r.memoizedState=ee,r.updateQueue=null,lS(r,Y),null}else{var Ee;S!==null?(Ee=Hn(S.baseLanes,I),r.memoizedState=null):Ee=I,lS(r,Ee)}return jo(i,r,b,I),r.child}function h1(i,r,I){var h=r.pendingProps;return jo(i,r,h,I),r.child}function A1(i,r,I){var h=r.pendingProps.children;return jo(i,r,h,I),r.child}function f1(i,r,I){{r.flags|=Qn;{var h=r.stateNode;h.effectDuration=0,h.passiveEffectDuration=0}}var b=r.pendingProps,S=b.children;return jo(i,r,S,I),r.child}function g2(i,r){var I=r.ref;(i===null&&I!==null||i!==null&&i.ref!==I)&&(r.flags|=ng,r.flags|=Au)}function qW(i,r,I,h,b){if(r.type!==r.elementType){var S=I.propTypes;S&&js(S,h,"prop",Pn(I))}var M;{var X=Sg(r,I,!0);M=Vd(r,X)}var Y,P;Bc(r,b),WC(r);{if(I0.current=r,Cr(!0),Y=iI(i,r,I,h,M,b),P=zd(),r.mode&la){Ei(!0);try{Y=iI(i,r,I,h,M,b),P=zd()}finally{Ei(!1)}}Cr(!1)}return JI(),i!==null&&!Rc?(xo(i,r,b),sI(i,r,b)):(Li()&&P&&By(r),r.flags|=Zi,jo(i,r,Y,b),r.child)}function u2(i,r,I,h,b){{switch(Hz(r)){case!1:{var S=r.stateNode,M=r.type,X=new M(r.memoizedProps,S.context),Y=X.state;S.updater.enqueueSetState(S,Y,null);break}case!0:{r.flags|=fi,r.flags|=Pr;var P=new Error("Simulated error coming from DevTools"),ee=$I(b);r.lanes=Hn(r.lanes,ee);var ve=UW(r,eA(P,r),ee);Ey(r,ve);break}}if(r.type!==r.elementType){var me=I.propTypes;me&&js(me,h,"prop",Pn(I))}}var Ee;$s(I)?(Ee=!0,Xp(r)):Ee=!1,Bc(r,b);var Le=r.stateNode,at;Le===null?(jZ(i,r),OZ(r,I,h),_W(r,I,h,b),at=!0):i===null?at=o1(r,I,h,b):at=s1(i,r,I,h,b);var jt=$W(i,r,I,at,Ee,b);{var yn=r.stateNode;at&&yn.props!==h&&(tA||l("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",Tn(r)||"a component"),tA=!0)}return jt}function $W(i,r,I,h,b,S){g2(i,r);var M=(r.flags&fi)!==Zn;if(!h&&!M)return b&&mZ(r,I,!1),sI(i,r,S);var X=r.stateNode;I0.current=r;var Y;if(M&&typeof I.getDerivedStateFromError!="function")Y=null,Ye();else{WC(r);{if(Cr(!0),Y=X.render(),r.mode&la){Ei(!0);try{X.render()}finally{Ei(!1)}}Cr(!1)}JI()}return r.flags|=Zi,i!==null&&M?C1(i,r,Y,S):jo(i,r,Y,S),r.memoizedState=X.state,b&&mZ(r,I,!0),r.child}function I2(i){var r=i.stateNode;r.pendingContext?fZ(i,r.pendingContext,r.pendingContext!==r.context):r.context&&fZ(i,r.context,!1),Ly(i,r.containerInfo)}function p1(i,r,I){if(I2(r),i===null)throw new Error("Should have a current fiber. This is a bug in React.");var h=r.pendingProps,b=r.memoizedState,S=b.element;Fg(i,r),jp(r,h,null,I);var M=r.memoizedState;r.stateNode;var X=M.element;if(b.isDehydrated){var Y={element:X,isDehydrated:!1,cache:M.cache,pendingSuspenseBoundaries:M.pendingSuspenseBoundaries,transitions:M.transitions},P=r.updateQueue;if(P.baseState=Y,r.memoizedState=Y,r.flags&ec){var ee=eA(new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering."),r);return d2(i,r,X,I,ee)}else if(X!==S){var ve=eA(new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."),r);return d2(i,r,X,I,ve)}else{ZZ(r);var me=Mg(r,null,X,I);r.child=me;for(var Ee=me;Ee;)Ee.flags=Ee.flags&~oa|Ls,Ee=Ee.sibling}}else{if(Wg(),X===S)return sI(i,r,I);jo(i,r,X,I)}return r.child}function d2(i,r,I,h,b){return Wg(),al(b),r.flags|=ec,jo(i,r,I,h),r.child}function m1(i,r,I){XZ(r),i===null&&Wy(r);var h=r.type,b=r.pendingProps,S=i!==null?i.memoizedProps:null,M=b.children,X=ly(h,b);return X?M=null:S!==null&&ly(h,S)&&(r.flags|=tg),g2(i,r),jo(i,r,M,I),r.child}function b1(i,r){return i===null&&Wy(r),null}function v1(i,r,I,h){jZ(i,r);var b=r.pendingProps,S=I,M=S._payload,X=S._init,Y=X(M);r.type=Y;var P=r.tag=bz(Y),ee=_n(Y,b),ve;switch(P){case d:return eV(r,Y),r.type=Y=Zm(Y),ve=qW(null,r,Y,ee,h),ve;case C:return r.type=Y=WV(Y),ve=u2(null,r,Y,ee,h),ve;case W:return r.type=Y=VV(Y),ve=o2(null,r,Y,ee,h),ve;case T:{if(r.type!==r.elementType){var me=Y.propTypes;me&&js(me,ee,"prop",Pn(Y))}return ve=s2(null,r,Y,_n(Y.type,ee),h),ve}}var Ee="";throw Y!==null&&typeof Y=="object"&&Y.$$typeof===Ut&&(Ee=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+Y+". "+("Lazy element type must resolve to a class or function."+Ee))}function y1(i,r,I,h,b){jZ(i,r),r.tag=C;var S;return $s(I)?(S=!0,Xp(r)):S=!1,Bc(r,b),OZ(r,I,h),_W(r,I,h,b),$W(null,r,I,!0,S,b)}function G1(i,r,I,h){jZ(i,r);var b=r.pendingProps,S;{var M=Sg(r,I,!1);S=Vd(r,M)}Bc(r,h);var X,Y;WC(r);{if(I.prototype&&typeof I.prototype.render=="function"){var P=Pn(I)||"Unknown";JW[P]||(l("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",P,P),JW[P]=!0)}r.mode&la&&to.recordLegacyContextWarning(r,null),Cr(!0),I0.current=r,X=iI(null,r,I,b,S,h),Y=zd(),Cr(!1)}if(JI(),r.flags|=Zi,typeof X=="object"&&X!==null&&typeof X.render=="function"&&X.$$typeof===void 0){var ee=Pn(I)||"Unknown";d0[ee]||(l("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",ee,ee,ee),d0[ee]=!0)}if(typeof X=="object"&&X!==null&&typeof X.render=="function"&&X.$$typeof===void 0){{var ve=Pn(I)||"Unknown";d0[ve]||(l("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",ve,ve,ve),d0[ve]=!0)}r.tag=C,r.memoizedState=null,r.updateQueue=null;var me=!1;return $s(I)?(me=!0,Xp(r)):me=!1,r.memoizedState=X.state!==null&&X.state!==void 0?X.state:null,Hh(r),u0(r,X),_W(r,I,b,h),$W(null,r,I,!0,me,h)}else{if(r.tag=d,r.mode&la){Ei(!0);try{X=iI(null,r,I,b,S,h),Y=zd()}finally{Ei(!1)}}return Li()&&Y&&By(r),jo(null,r,X,h),eV(r,I),r.child}}function eV(i,r){{if(r&&r.childContextTypes&&l("%s(...): childContextTypes cannot be defined on a function component.",r.displayName||r.name||"Component"),i.ref!==null){var I="",h=Pc();h&&(I+=`

Check the render method of \``+h+"`.");var b=h||"",S=i._debugSource;S&&(b=S.fileName+":"+S.lineNumber),QW[b]||(QW[b]=!0,l("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",I))}if(r.defaultProps!==void 0){var M=Pn(r)||"Unknown";C0[M]||(l("%s: Support for defaultProps will be removed from function components in a future major release. Use JavaScript default parameters instead.",M),C0[M]=!0)}if(typeof r.getDerivedStateFromProps=="function"){var X=Pn(r)||"Unknown";PW[X]||(l("%s: Function components do not support getDerivedStateFromProps.",X),PW[X]=!0)}if(typeof r.contextType=="object"&&r.contextType!==null){var Y=Pn(r)||"Unknown";OW[Y]||(l("%s: Function components do not support contextType.",Y),OW[Y]=!0)}}}var tV={dehydrated:null,treeContext:null,retryLane:Ha};function nV(i){return{baseLanes:i,cachePool:d1(),transitions:null}}function B1(i,r){var I=null;return{baseLanes:Hn(i.baseLanes,r),cachePool:I,transitions:i.transitions}}function Z1(i,r,I,h){if(r!==null){var b=r.memoizedState;if(b===null)return!1}return _y(i,Ed)}function S1(i,r){return ed(i.childLanes,r)}function C2(i,r,I){var h=r.pendingProps;Xz(r)&&(r.flags|=fi);var b=_i.current,S=!1,M=(r.flags&fi)!==Zn;if(M||Z1(b,i)?(S=!0,r.flags&=~fi):(i===null||i.memoizedState!==null)&&(b=YW(b,YZ)),b=eI(b),Eg(r,b),i===null){Wy(r);var X=r.memoizedState;if(X!==null){var Y=X.dehydrated;if(Y!==null)return V1(r,Y)}var P=h.children,ee=h.fallback;if(S){var ve=R1(r,P,ee,I),me=r.child;return me.memoizedState=nV(I),r.memoizedState=tV,ve}else return iV(r,P)}else{var Ee=i.memoizedState;if(Ee!==null){var Le=Ee.dehydrated;if(Le!==null)return M1(i,r,M,h,Le,Ee,I)}if(S){var at=h.fallback,jt=h.children,yn=x1(i,r,jt,at,I),Cn=r.child,li=i.child.memoizedState;return Cn.memoizedState=li===null?nV(I):B1(li,I),Cn.childLanes=S1(i,I),r.memoizedState=tV,yn}else{var ii=h.children,He=w1(i,r,ii,I);return r.memoizedState=null,He}}}function iV(i,r,I){var h=i.mode,b={mode:"visible",children:r},S=aV(b,h);return S.return=i,i.child=S,S}function R1(i,r,I,h){var b=i.mode,S=i.child,M={mode:"hidden",children:r},X,Y;return(b&ei)===vn&&S!==null?(X=S,X.childLanes=ft,X.pendingProps=M,i.mode&xi&&(X.actualDuration=0,X.actualStartTime=-1,X.selfBaseDuration=0,X.treeBaseDuration=0),Y=Qd(I,b,h,null)):(X=aV(M,b),Y=Qd(I,b,h,null)),X.return=i,Y.return=i,X.sibling=Y,i.child=X,Y}function aV(i,r,I){return hX(i,r,ft,null)}function h2(i,r){return oA(i,r)}function w1(i,r,I,h){var b=i.child,S=b.sibling,M=h2(b,{mode:"visible",children:I});if((r.mode&ei)===vn&&(M.lanes=h),M.return=r,M.sibling=null,S!==null){var X=r.deletions;X===null?(r.deletions=[S],r.flags|=Es):X.push(S)}return r.child=M,M}function x1(i,r,I,h,b){var S=r.mode,M=i.child,X=M.sibling,Y={mode:"hidden",children:I},P;if((S&ei)===vn&&r.child!==M){var ee=r.child;P=ee,P.childLanes=ft,P.pendingProps=Y,r.mode&xi&&(P.actualDuration=0,P.actualStartTime=-1,P.selfBaseDuration=M.selfBaseDuration,P.treeBaseDuration=M.treeBaseDuration),r.deletions=null}else P=h2(M,Y),P.subtreeFlags=M.subtreeFlags&ic;var ve;return X!==null?ve=oA(X,h):(ve=Qd(h,S,b,null),ve.flags|=oa),ve.return=r,P.return=r,P.sibling=ve,r.child=P,ve}function QZ(i,r,I,h){h!==null&&al(h),rl(r,i.child,null,I);var b=r.pendingProps,S=b.children,M=iV(r,S);return M.flags|=oa,r.memoizedState=null,M}function W1(i,r,I,h,b){var S=r.mode,M={mode:"visible",children:I},X=aV(M,S),Y=Qd(h,S,b,null);return Y.flags|=oa,X.return=r,Y.return=r,X.sibling=Y,r.child=X,(r.mode&ei)!==vn&&rl(r,i.child,null,b),Y}function V1(i,r,I){return(i.mode&ei)===vn?(l("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),i.lanes=Vn):hy(r)?i.lanes=Vr:i.lanes=Uo,null}function M1(i,r,I,h,b,S,M){if(I)if(r.flags&ec){r.flags&=~ec;var He=DW(new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering."));return QZ(i,r,M,He)}else{if(r.memoizedState!==null)return r.child=i.child,r.flags|=fi,null;var rt=h.children,Xe=h.fallback,St=W1(i,r,rt,Xe,M),on=r.child;return on.memoizedState=nV(M),r.memoizedState=tV,St}else{if(Zy(),(r.mode&ei)===vn)return QZ(i,r,M,null);if(hy(b)){var X,Y,P;{var ee=oZ(b);X=ee.digest,Y=ee.message,P=ee.stack}var ve;Y?ve=new Error(Y):ve=new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering.");var me=DW(ve,X,P);return QZ(i,r,M,me)}var Ee=Mr(M,i.childLanes);if(Rc||Ee){var Le=sS();if(Le!==null){var at=Kf(Le,M);if(at!==Ha&&at!==S.retryLane){S.retryLane=at;var jt=ai;Ra(i,at),Br(Le,i,at,jt)}}ZV();var yn=DW(new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition."));return QZ(i,r,M,yn)}else if(Cy(b)){r.flags|=fi,r.child=i.child;var Cn=iz.bind(null,i);return pW(b,Cn),null}else{WW(r,b,S.treeContext);var li=h.children,ii=iV(r,li);return ii.flags|=Ls,ii}}}function A2(i,r,I){i.lanes=Hn(i.lanes,r);var h=i.alternate;h!==null&&(h.lanes=Hn(h.lanes,r)),Xy(i.return,r,I)}function N1(i,r,I){for(var h=r;h!==null;){if(h.tag===K){var b=h.memoizedState;b!==null&&A2(h,I,i)}else if(h.tag===U)A2(h,I,i);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===i)return;for(;h.sibling===null;){if(h.return===null||h.return===i)return;h=h.return}h.sibling.return=h.return,h=h.sibling}}function H1(i){for(var r=i,I=null;r!==null;){var h=r.alternate;h!==null&&Lh(h)===null&&(I=r),r=r.sibling}return I}function X1(i){if(i!==void 0&&i!=="forwards"&&i!=="backwards"&&i!=="together"&&!jW[i])if(jW[i]=!0,typeof i=="string")switch(i.toLowerCase()){case"together":case"forwards":case"backwards":{l('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',i,i.toLowerCase());break}case"forward":case"backward":{l('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',i,i.toLowerCase());break}default:l('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',i);break}else l('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',i)}function F1(i,r){i!==void 0&&!PZ[i]&&(i!=="collapsed"&&i!=="hidden"?(PZ[i]=!0,l('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',i)):r!=="forwards"&&r!=="backwards"&&(PZ[i]=!0,l('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',i)))}function f2(i,r){{var I=hi(i),h=!I&&typeof Ot(i)=="function";if(I||h){var b=I?"array":"iterable";return l("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",b,r,b),!1}}return!0}function Y1(i,r){if((r==="forwards"||r==="backwards")&&i!==void 0&&i!==null&&i!==!1)if(hi(i)){for(var I=0;I<i.length;I++)if(!f2(i[I],I))return}else{var h=Ot(i);if(typeof h=="function"){var b=h.call(i);if(b)for(var S=b.next(),M=0;!S.done;S=b.next()){if(!f2(S.value,M))return;M++}}else l('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',r)}}function rV(i,r,I,h,b){var S=i.memoizedState;S===null?i.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:I,tailMode:b}:(S.isBackwards=r,S.rendering=null,S.renderingStartTime=0,S.last=h,S.tail=I,S.tailMode=b)}function p2(i,r,I){var h=r.pendingProps,b=h.revealOrder,S=h.tail,M=h.children;X1(b),F1(S,b),Y1(M,b),jo(i,r,M,I);var X=_i.current,Y=_y(X,Ed);if(Y)X=Dy(X,Ed),r.flags|=fi;else{var P=i!==null&&(i.flags&fi)!==Zn;P&&N1(r,r.child,I),X=eI(X)}if(Eg(r,X),(r.mode&ei)===vn)r.memoizedState=null;else switch(b){case"forwards":{var ee=H1(r.child),ve;ee===null?(ve=r.child,r.child=null):(ve=ee.sibling,ee.sibling=null),rV(r,!1,ve,ee,S);break}case"backwards":{var me=null,Ee=r.child;for(r.child=null;Ee!==null;){var Le=Ee.alternate;if(Le!==null&&Lh(Le)===null){r.child=Ee;break}var at=Ee.sibling;Ee.sibling=me,me=Ee,Ee=at}rV(r,!0,me,null,S);break}case"together":{rV(r,!1,null,null,void 0);break}default:r.memoizedState=null}return r.child}function T1(i,r,I){Ly(r,r.stateNode.containerInfo);var h=r.pendingProps;return i===null?r.child=rl(r,null,h,I):jo(i,r,h,I),r.child}var m2=!1;function E1(i,r,I){var h=r.type,b=h._context,S=r.pendingProps,M=r.memoizedProps,X=S.value;{"value"in S||m2||(m2=!0,l("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var Y=r.type.propTypes;Y&&js(Y,S,"prop","Context.Provider")}if(Kr(r,b,X),M!==null){var P=M.value;if(Bo(P,X)){if(M.children===S.children&&!Md())return sI(i,r,I)}else Pa(r,b,I)}var ee=S.children;return jo(i,r,ee,I),r.child}var b2=!1;function K1(i,r,I){var h=r.type;h._context===void 0?h!==h.Consumer&&(b2||(b2=!0,l("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):h=h._context;var b=r.pendingProps,S=b.children;typeof S!="function"&&l("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),Bc(r,I);var M=Sa(h);WC(r);var X;return I0.current=r,Cr(!0),X=S(M),Cr(!1),JI(),r.flags|=Zi,jo(i,r,X,I),r.child}function h0(){Rc=!0}function jZ(i,r){(r.mode&ei)===vn&&i!==null&&(i.alternate=null,r.alternate=null,r.flags|=oa)}function sI(i,r,I){return i!==null&&(r.dependencies=i.dependencies),Ye(),R0(r.lanes),Mr(I,r.childLanes)?(Gc(i,r),r.child):null}function L1(i,r,I){{var h=r.return;if(h===null)throw new Error("Cannot swap the root fiber.");if(i.alternate=null,r.alternate=null,I.index=r.index,I.sibling=r.sibling,I.return=r.return,I.ref=r.ref,r===h.child)h.child=I;else{var b=h.child;if(b===null)throw new Error("Expected parent to have a child.");for(;b.sibling!==r;)if(b=b.sibling,b===null)throw new Error("Expected to find the previous sibling.");b.sibling=I}var S=h.deletions;return S===null?(h.deletions=[i],h.flags|=Es):S.push(i),I.flags|=oa,I}}function oV(i,r){var I=i.lanes;return!!Mr(I,r)}function z1(i,r,I){switch(r.tag){case p:I2(r),r.stateNode,Wg();break;case y:XZ(r);break;case C:{var h=r.type;$s(h)&&Xp(r);break}case m:Ly(r,r.stateNode.containerInfo);break;case x:{var b=r.memoizedProps.value,S=r.type._context;Kr(r,S,b);break}case N:{var M=Mr(I,r.childLanes);M&&(r.flags|=Qn);{var X=r.stateNode;X.effectDuration=0,X.passiveEffectDuration=0}}break;case K:{var Y=r.memoizedState;if(Y!==null){if(Y.dehydrated!==null)return Eg(r,eI(_i.current)),r.flags|=fi,null;var P=r.child,ee=P.childLanes;if(Mr(I,ee))return C2(i,r,I);Eg(r,eI(_i.current));var ve=sI(i,r,I);return ve!==null?ve.sibling:null}else Eg(r,eI(_i.current));break}case U:{var me=(i.flags&fi)!==Zn,Ee=Mr(I,r.childLanes);if(me){if(Ee)return p2(i,r,I);r.flags|=fi}var Le=r.memoizedState;if(Le!==null&&(Le.rendering=null,Le.tail=null,Le.lastEffect=null),Eg(r,_i.current),Ee)break;return null}case ie:case Ce:return r.lanes=ft,c2(i,r,I)}return sI(i,r,I)}function v2(i,r,I){if(r._debugNeedsRemount&&i!==null)return L1(i,r,FV(r.type,r.key,r.pendingProps,r._debugOwner||null,r.mode,r.lanes));if(i!==null){var h=i.memoizedProps,b=r.pendingProps;if(h!==b||Md()||r.type!==i.type)Rc=!0;else{var S=oV(i,I);if(!S&&(r.flags&fi)===Zn)return Rc=!1,z1(i,r,I);(i.flags&kb)!==Zn?Rc=!0:Rc=!1}}else if(Rc=!1,Li()&&GZ(r)){var M=r.index,X=bs();BZ(r,X,M)}switch(r.lanes=ft,r.tag){case A:return G1(i,r,r.type,I);case k:{var Y=r.elementType;return v1(i,r,Y,I)}case d:{var P=r.type,ee=r.pendingProps,ve=r.elementType===P?ee:_n(P,ee);return qW(i,r,P,ve,I)}case C:{var me=r.type,Ee=r.pendingProps,Le=r.elementType===me?Ee:_n(me,Ee);return u2(i,r,me,Le,I)}case p:return p1(i,r,I);case y:return m1(i,r,I);case G:return b1(i,r);case K:return C2(i,r,I);case m:return T1(i,r,I);case W:{var at=r.type,jt=r.pendingProps,yn=r.elementType===at?jt:_n(at,jt);return o2(i,r,at,yn,I)}case w:return h1(i,r,I);case R:return A1(i,r,I);case N:return f1(i,r,I);case x:return E1(i,r,I);case Z:return K1(i,r,I);case T:{var Cn=r.type,li=r.pendingProps,ii=_n(Cn,li);if(r.type!==r.elementType){var He=Cn.propTypes;He&&js(He,ii,"prop",Pn(Cn))}return ii=_n(Cn.type,ii),s2(i,r,Cn,ii,I)}case L:return l2(i,r,r.type,r.pendingProps,I);case E:{var rt=r.type,Xe=r.pendingProps,St=r.elementType===rt?Xe:_n(rt,Xe);return y1(i,r,rt,St,I)}case U:return p2(i,r,I);case le:break;case ie:return c2(i,r,I)}throw new Error("Unknown unit of work tag ("+r.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function pm(i){i.flags|=Qn}function y2(i){i.flags|=ng,i.flags|=Au}var G2,sV,B2,Z2;G2=function(i,r,I,h){for(var b=r.child;b!==null;){if(b.tag===y||b.tag===G)rW(i,b.stateNode);else if(b.tag!==m){if(b.child!==null){b.child.return=b,b=b.child;continue}}if(b===r)return;for(;b.sibling===null;){if(b.return===null||b.return===r)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},sV=function(i,r){},B2=function(i,r,I,h,b){var S=i.memoizedProps;if(S!==h){var M=r.stateNode,X=zy(),Y=oW(M,I,S,h,b,X);r.updateQueue=Y,Y&&pm(r)}},Z2=function(i,r,I,h){I!==h&&pm(r)};function A0(i,r){if(!Li())switch(i.tailMode){case"hidden":{for(var I=i.tail,h=null;I!==null;)I.alternate!==null&&(h=I),I=I.sibling;h===null?i.tail=null:h.sibling=null;break}case"collapsed":{for(var b=i.tail,S=null;b!==null;)b.alternate!==null&&(S=b),b=b.sibling;S===null?!r&&i.tail!==null?i.tail.sibling=null:i.tail=null:S.sibling=null;break}}}function so(i){var r=i.alternate!==null&&i.alternate.child===i.child,I=ft,h=Zn;if(r){if((i.mode&xi)!==vn){for(var Y=i.selfBaseDuration,P=i.child;P!==null;)I=Hn(I,Hn(P.lanes,P.childLanes)),h|=P.subtreeFlags&ic,h|=P.flags&ic,Y+=P.treeBaseDuration,P=P.sibling;i.treeBaseDuration=Y}else for(var ee=i.child;ee!==null;)I=Hn(I,Hn(ee.lanes,ee.childLanes)),h|=ee.subtreeFlags&ic,h|=ee.flags&ic,ee.return=i,ee=ee.sibling;i.subtreeFlags|=h}else{if((i.mode&xi)!==vn){for(var b=i.actualDuration,S=i.selfBaseDuration,M=i.child;M!==null;)I=Hn(I,Hn(M.lanes,M.childLanes)),h|=M.subtreeFlags,h|=M.flags,b+=M.actualDuration,S+=M.treeBaseDuration,M=M.sibling;i.actualDuration=b,i.treeBaseDuration=S}else for(var X=i.child;X!==null;)I=Hn(I,Hn(X.lanes,X.childLanes)),h|=X.subtreeFlags,h|=X.flags,X.return=i,X=X.sibling;i.subtreeFlags|=h}return i.childLanes=I,r}function _1(i,r,I){if(il()&&(r.mode&ei)!==vn&&(r.flags&fi)===Zn)return Za(r),Wg(),r.flags|=ec|zI|Pr,!1;var h=Pi(r);if(I!==null&&I.dehydrated!==null)if(i===null){if(!h)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(MW(r),so(r),(r.mode&xi)!==vn){var b=I!==null;if(b){var S=r.child;S!==null&&(r.treeBaseDuration-=S.treeBaseDuration)}}return!1}else{if(Wg(),(r.flags&fi)===Zn&&(r.memoizedState=null),r.flags|=Qn,so(r),(r.mode&xi)!==vn){var M=I!==null;if(M){var X=r.child;X!==null&&(r.treeBaseDuration-=X.treeBaseDuration)}}return!1}else return pr(),!0}function S2(i,r,I){var h=r.pendingProps;switch(Fd(r),r.tag){case A:case k:case L:case d:case W:case w:case R:case N:case Z:case T:return so(r),null;case C:{var b=r.type;return $s(b)&&Hp(r),so(r),null}case p:{var S=r.stateNode;if(no(r),Nd(r),zh(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),i===null||i.child===null){var M=Pi(r);if(M)pm(r);else if(i!==null){var X=i.memoizedState;(!X.isDehydrated||(r.flags&ec)!==Zn)&&(r.flags|=tc,pr())}}return sV(i,r),so(r),null}case y:{$p(r);var Y=Tg(),P=r.type;if(i!==null&&r.stateNode!=null)B2(i,r,P,h,Y),i.ref!==r.ref&&y2(r);else{if(!h){if(r.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return so(r),null}var ee=zy(),ve=Pi(r);if(ve)VW(r,Y,ee)&&pm(r);else{var me=QB(P,h,Y,ee,r);G2(me,r,!1,!1),r.stateNode=me,jB(me,P,h,Y)&&pm(r)}r.ref!==null&&y2(r)}return so(r),null}case G:{var Ee=h;if(i&&r.stateNode!=null){var Le=i.memoizedProps;Z2(i,r,Le,Ee)}else{if(typeof Ee!="string"&&r.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var at=Tg(),jt=zy(),yn=Pi(r);yn?wZ(r)&&pm(r):r.stateNode=sW(Ee,at,jt,r)}return so(r),null}case K:{Kd(r);var Cn=r.memoizedState;if(i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){var li=_1(i,r,Cn);if(!li)return r.flags&Pr?r:null}if((r.flags&fi)!==Zn)return r.lanes=I,(r.mode&xi)!==vn&&jn(r),r;var ii=Cn!==null,He=i!==null&&i.memoizedState!==null;if(ii!==He&&ii){var rt=r.child;if(rt.flags|=ig,(r.mode&ei)!==vn){var Xe=i===null&&(r.memoizedProps.unstable_avoidThisFallback!==!0||!ke);Xe||_y(_i.current,YZ)?DL():ZV()}}var St=r.updateQueue;if(St!==null&&(r.flags|=Qn),so(r),(r.mode&xi)!==vn&&ii){var on=r.child;on!==null&&(r.treeBaseDuration-=on.treeBaseDuration)}return null}case m:return no(r),sV(i,r),i===null&&xd(r.stateNode.containerInfo),so(r),null;case x:var an=r.type._context;return Vl(an,r),so(r),null;case E:{var Mn=r.type;return $s(Mn)&&Hp(r),so(r),null}case U:{Kd(r);var Fn=r.memoizedState;if(Fn===null)return so(r),null;var Xi=(r.flags&fi)!==Zn,yi=Fn.rendering;if(yi===null)if(Xi)A0(Fn,!1);else{var qa=UL()&&(i===null||(i.flags&fi)===Zn);if(!qa)for(var Gi=r.child;Gi!==null;){var Ea=Lh(Gi);if(Ea!==null){Xi=!0,r.flags|=fi,A0(Fn,!1);var Vo=Ea.updateQueue;return Vo!==null&&(r.updateQueue=Vo,r.flags|=Qn),r.subtreeFlags=Zn,Wh(r,I),Eg(r,Dy(_i.current,Ed)),r.child}Gi=Gi.sibling}Fn.tail!==null&&or()>J2()&&(r.flags|=fi,Xi=!0,A0(Fn,!1),r.lanes=HC)}else{if(!Xi){var Io=Lh(yi);if(Io!==null){r.flags|=fi,Xi=!0;var ll=Io.updateQueue;if(ll!==null&&(r.updateQueue=ll,r.flags|=Qn),A0(Fn,!0),Fn.tail===null&&Fn.tailMode==="hidden"&&!yi.alternate&&!Li())return so(r),null}else or()*2-Fn.renderingStartTime>J2()&&I!==Uo&&(r.flags|=fi,Xi=!0,A0(Fn,!1),r.lanes=HC)}if(Fn.isBackwards)yi.sibling=r.child,r.child=yi;else{var es=Fn.last;es!==null?es.sibling=yi:r.child=yi,Fn.last=yi}}if(Fn.tail!==null){var ts=Fn.tail;Fn.rendering=ts,Fn.tail=ts.sibling,Fn.renderingStartTime=or(),ts.sibling=null;var Mo=_i.current;return Xi?Mo=Dy(Mo,Ed):Mo=eI(Mo),Eg(r,Mo),ts}return so(r),null}case le:break;case ie:case Ce:{BV(r);var II=r.memoizedState,Sm=II!==null;if(i!==null){var M0=i.memoizedState,Og=M0!==null;Og!==Sm&&!We&&(r.flags|=ig)}return!Sm||(r.mode&ei)===vn?so(r):Mr(Jg,Uo)&&(so(r),r.subtreeFlags&(oa|Qn)&&(r.flags|=ig)),null}case Ge:return null;case ye:return null}throw new Error("Unknown unit of work tag ("+r.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function D1(i,r,I){switch(Fd(r),r.tag){case C:{var h=r.type;$s(h)&&Hp(r);var b=r.flags;return b&Pr?(r.flags=b&~Pr|fi,(r.mode&xi)!==vn&&jn(r),r):null}case p:{r.stateNode,no(r),Nd(r),zh();var S=r.flags;return(S&Pr)!==Zn&&(S&fi)===Zn?(r.flags=S&~Pr|fi,r):null}case y:return $p(r),null;case K:{Kd(r);var M=r.memoizedState;if(M!==null&&M.dehydrated!==null){if(r.alternate===null)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");Wg()}var X=r.flags;return X&Pr?(r.flags=X&~Pr|fi,(r.mode&xi)!==vn&&jn(r),r):null}case U:return Kd(r),null;case m:return no(r),null;case x:var Y=r.type._context;return Vl(Y,r),null;case ie:case Ce:return BV(r),null;case Ge:return null;default:return null}}function R2(i,r,I){switch(Fd(r),r.tag){case C:{var h=r.type.childContextTypes;h!=null&&Hp(r);break}case p:{r.stateNode,no(r),Nd(r),zh();break}case y:{$p(r);break}case m:no(r);break;case K:Kd(r);break;case U:Kd(r);break;case x:var b=r.type._context;Vl(b,r);break;case ie:case Ce:BV(r);break}}var w2=null;w2=new Set;var qZ=!1,lo=!1,k1=typeof WeakSet=="function"?WeakSet:Set,gn=null,mm=null,bm=null;function U1(i){BC(null,function(){throw i}),Rf()}var J1=function(i,r){if(r.props=i.memoizedProps,r.state=i.memoizedState,i.mode&xi)try{rn(),r.componentWillUnmount()}finally{we(i)}else r.componentWillUnmount()};function x2(i,r){try{kd(wa,i)}catch(I){ea(i,r,I)}}function lV(i,r,I){try{J1(i,I)}catch(h){ea(i,r,h)}}function O1(i,r,I){try{I.componentDidMount()}catch(h){ea(i,r,h)}}function W2(i,r){try{M2(i)}catch(I){ea(i,r,I)}}function vm(i,r){var I=i.ref;if(I!==null)if(typeof I=="function"){var h;try{if(bt&&dt&&i.mode&xi)try{rn(),h=I(null)}finally{we(i)}else h=I(null)}catch(b){ea(i,r,b)}typeof h=="function"&&l("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",Tn(i))}else I.current=null}function $Z(i,r,I){try{I()}catch(h){ea(i,r,h)}}var V2=!1;function P1(i,r){PB(i.containerInfo),gn=r,Q1();var I=V2;return V2=!1,I}function Q1(){for(;gn!==null;){var i=gn,r=i.child;(i.subtreeFlags&En)!==Zn&&r!==null?(r.return=i,gn=r):j1()}}function j1(){for(;gn!==null;){var i=gn;ra(i);try{q1(i)}catch(I){ea(i,i.return,I)}ir();var r=i.sibling;if(r!==null){r.return=i.return,gn=r;return}gn=i.return}}function q1(i){var r=i.alternate,I=i.flags;if((I&tc)!==Zn){switch(ra(i),i.tag){case d:case W:case L:break;case C:{if(r!==null){var h=r.memoizedProps,b=r.memoizedState,S=i.stateNode;i.type===i.elementType&&!tA&&(S.props!==i.memoizedProps&&l("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Tn(i)||"instance"),S.state!==i.memoizedState&&l("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Tn(i)||"instance"));var M=S.getSnapshotBeforeUpdate(i.elementType===i.type?h:_n(i.type,h),b);{var X=w2;M===void 0&&!X.has(i.type)&&(X.add(i.type),l("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",Tn(i)))}S.__reactInternalSnapshotBeforeUpdate=M}break}case p:{{var Y=i.stateNode;AW(Y.containerInfo)}break}case y:case G:case m:case E:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}ir()}}function wc(i,r,I){var h=r.updateQueue,b=h!==null?h.lastEffect:null;if(b!==null){var S=b.next,M=S;do{if((M.tag&i)===i){var X=M.destroy;M.destroy=void 0,X!==void 0&&((i&br)!==mr?bx(r):(i&wa)!==mr&&fu(r),(i&ol)!==mr&&x0(!0),$Z(r,I,X),(i&ol)!==mr&&x0(!1),(i&br)!==mr?vx():(i&wa)!==mr&&gB())}M=M.next}while(M!==S)}}function kd(i,r){var I=r.updateQueue,h=I!==null?I.lastEffect:null;if(h!==null){var b=h.next,S=b;do{if((S.tag&i)===i){(i&br)!==mr?sr(r):(i&wa)!==mr&&cB(r);var M=S.create;(i&ol)!==mr&&x0(!0),S.destroy=M(),(i&ol)!==mr&&x0(!1),(i&br)!==mr?mx():(i&wa)!==mr&&VC();{var X=S.destroy;if(X!==void 0&&typeof X!="function"){var Y=void 0;(S.tag&wa)!==Zn?Y="useLayoutEffect":(S.tag&ol)!==Zn?Y="useInsertionEffect":Y="useEffect";var P=void 0;X===null?P=" You returned null. If your effect does not require clean up, return undefined (or nothing).":typeof X.then=="function"?P=`

It looks like you wrote `+Y+`(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:

`+Y+`(() => {
  async function fetchData() {
    // You can await here
    const response = await MyAPI.getData(someId);
    // ...
  }
  fetchData();
}, [someId]); // Or [] if effect doesn't need props or state

Learn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching`:P=" You returned: "+X,l("%s must not return anything besides a function, which is used for clean-up.%s",Y,P)}}}S=S.next}while(S!==b)}}function $1(i,r){if((r.flags&Qn)!==Zn)switch(r.tag){case N:{var I=r.stateNode.passiveEffectDuration,h=r.memoizedProps,b=h.id,S=h.onPostCommit,M=Gn(),X=r.alternate===null?"mount":"update";vt()&&(X="nested-update"),typeof S=="function"&&S(b,X,I,M);var Y=r.return;e:for(;Y!==null;){switch(Y.tag){case p:var P=Y.stateNode;P.passiveEffectDuration+=I;break e;case N:var ee=Y.stateNode;ee.passiveEffectDuration+=I;break e}Y=Y.return}break}}}function eL(i,r,I,h){if((I.flags&DI)!==Zn)switch(I.tag){case d:case W:case L:{if(!lo)if(I.mode&xi)try{rn(),kd(wa|ha,I)}finally{we(I)}else kd(wa|ha,I);break}case C:{var b=I.stateNode;if(I.flags&Qn&&!lo)if(r===null)if(I.type===I.elementType&&!tA&&(b.props!==I.memoizedProps&&l("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Tn(I)||"instance"),b.state!==I.memoizedState&&l("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Tn(I)||"instance")),I.mode&xi)try{rn(),b.componentDidMount()}finally{we(I)}else b.componentDidMount();else{var S=I.elementType===I.type?r.memoizedProps:_n(I.type,r.memoizedProps),M=r.memoizedState;if(I.type===I.elementType&&!tA&&(b.props!==I.memoizedProps&&l("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Tn(I)||"instance"),b.state!==I.memoizedState&&l("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Tn(I)||"instance")),I.mode&xi)try{rn(),b.componentDidUpdate(S,M,b.__reactInternalSnapshotBeforeUpdate)}finally{we(I)}else b.componentDidUpdate(S,M,b.__reactInternalSnapshotBeforeUpdate)}var X=I.updateQueue;X!==null&&(I.type===I.elementType&&!tA&&(b.props!==I.memoizedProps&&l("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Tn(I)||"instance"),b.state!==I.memoizedState&&l("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Tn(I)||"instance")),Fh(I,X,b));break}case p:{var Y=I.updateQueue;if(Y!==null){var P=null;if(I.child!==null)switch(I.child.tag){case y:P=I.child.stateNode;break;case C:P=I.child.stateNode;break}Fh(I,Y,P)}break}case y:{var ee=I.stateNode;if(r===null&&I.flags&Qn){var ve=I.type,me=I.memoizedProps;$B(ee,ve,me)}break}case G:break;case m:break;case N:{{var Ee=I.memoizedProps,Le=Ee.onCommit,at=Ee.onRender,jt=I.stateNode.effectDuration,yn=Gn(),Cn=r===null?"mount":"update";vt()&&(Cn="nested-update"),typeof at=="function"&&at(I.memoizedProps.id,Cn,I.actualDuration,I.treeBaseDuration,I.actualStartTime,yn);{typeof Le=="function"&&Le(I.memoizedProps.id,Cn,jt,yn),jL(I);var li=I.return;e:for(;li!==null;){switch(li.tag){case p:var ii=li.stateNode;ii.effectDuration+=jt;break e;case N:var He=li.stateNode;He.effectDuration+=jt;break e}li=li.return}}}break}case K:{lL(i,I);break}case U:case E:case le:case ie:case Ce:case ye:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}lo||I.flags&ng&&M2(I)}function tL(i){switch(i.tag){case d:case W:case L:{if(i.mode&xi)try{rn(),x2(i,i.return)}finally{we(i)}else x2(i,i.return);break}case C:{var r=i.stateNode;typeof r.componentDidMount=="function"&&O1(i,i.return,r),W2(i,i.return);break}case y:{W2(i,i.return);break}}}function nL(i,r){for(var I=null,h=i;;){if(h.tag===y){if(I===null){I=h;try{var b=h.stateNode;r?aZ(b):CW(h.stateNode,h.memoizedProps)}catch(M){ea(i,i.return,M)}}}else if(h.tag===G){if(I===null)try{var S=h.stateNode;r?dW(S):hW(S,h.memoizedProps)}catch(M){ea(i,i.return,M)}}else if(!((h.tag===ie||h.tag===Ce)&&h.memoizedState!==null&&h!==i)){if(h.child!==null){h.child.return=h,h=h.child;continue}}if(h===i)return;for(;h.sibling===null;){if(h.return===null||h.return===i)return;I===h&&(I=null),h=h.return}I===h&&(I=null),h.sibling.return=h.return,h=h.sibling}}function M2(i){var r=i.ref;if(r!==null){var I=i.stateNode,h;switch(i.tag){case y:h=I;break;default:h=I}if(typeof r=="function"){var b;if(i.mode&xi)try{rn(),b=r(h)}finally{we(i)}else b=r(h);typeof b=="function"&&l("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",Tn(i))}else r.hasOwnProperty("current")||l("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",Tn(i)),r.current=h}}function iL(i){var r=i.alternate;r!==null&&(r.return=null),i.return=null}function N2(i){var r=i.alternate;r!==null&&(i.alternate=null,N2(r));{if(i.child=null,i.deletions=null,i.sibling=null,i.tag===y){var I=i.stateNode;I!==null&&Mp(I)}i.stateNode=null,i._debugOwner=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}}function aL(i){for(var r=i.return;r!==null;){if(H2(r))return r;r=r.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}function H2(i){return i.tag===y||i.tag===p||i.tag===m}function X2(i){var r=i;e:for(;;){for(;r.sibling===null;){if(r.return===null||H2(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==y&&r.tag!==G&&r.tag!==F;){if(r.flags&oa||r.child===null||r.tag===m)continue e;r.child.return=r,r=r.child}if(!(r.flags&oa))return r.stateNode}}function rL(i){var r=aL(i);switch(r.tag){case y:{var I=r.stateNode;r.flags&tg&&(Rp(I),r.flags&=~tg);var h=X2(i);gV(i,h,I);break}case p:case m:{var b=r.stateNode.containerInfo,S=X2(i);cV(i,S,b);break}default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}function cV(i,r,I){var h=i.tag,b=h===y||h===G;if(b){var S=i.stateNode;r?iZ(I,S,r):tZ(I,S)}else if(h!==m){var M=i.child;if(M!==null){cV(M,r,I);for(var X=M.sibling;X!==null;)cV(X,r,I),X=X.sibling}}}function gV(i,r,I){var h=i.tag,b=h===y||h===G;if(b){var S=i.stateNode;r?nZ(I,S,r):uy(I,S)}else if(h!==m){var M=i.child;if(M!==null){gV(M,r,I);for(var X=M.sibling;X!==null;)gV(X,r,I),X=X.sibling}}}var co=null,xc=!1;function oL(i,r,I){{var h=r;e:for(;h!==null;){switch(h.tag){case y:{co=h.stateNode,xc=!1;break e}case p:{co=h.stateNode.containerInfo,xc=!0;break e}case m:{co=h.stateNode.containerInfo,xc=!0;break e}}h=h.return}if(co===null)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");F2(i,r,I),co=null,xc=!1}iL(I)}function Ud(i,r,I){for(var h=I.child;h!==null;)F2(i,r,h),h=h.sibling}function F2(i,r,I){switch(en(I),I.tag){case y:lo||vm(I,r);case G:{{var h=co,b=xc;co=null,Ud(i,r,I),co=h,xc=b,co!==null&&(xc?uW(co,I.stateNode):wp(co,I.stateNode))}return}case F:{co!==null&&(xc?IW(co,I.stateNode):Iy(co,I.stateNode));return}case m:{{var S=co,M=xc;co=I.stateNode.containerInfo,xc=!0,Ud(i,r,I),co=S,xc=M}return}case d:case W:case T:case L:{if(!lo){var X=I.updateQueue;if(X!==null){var Y=X.lastEffect;if(Y!==null){var P=Y.next,ee=P;do{var ve=ee,me=ve.destroy,Ee=ve.tag;me!==void 0&&((Ee&ol)!==mr?$Z(I,r,me):(Ee&wa)!==mr&&(fu(I),I.mode&xi?(rn(),$Z(I,r,me),we(I)):$Z(I,r,me),gB())),ee=ee.next}while(ee!==P)}}}Ud(i,r,I);return}case C:{if(!lo){vm(I,r);var Le=I.stateNode;typeof Le.componentWillUnmount=="function"&&lV(I,r,Le)}Ud(i,r,I);return}case le:{Ud(i,r,I);return}case ie:{if(I.mode&ei){var at=lo;lo=at||I.memoizedState!==null,Ud(i,r,I),lo=at}else Ud(i,r,I);break}default:{Ud(i,r,I);return}}}function sL(i){i.memoizedState}function lL(i,r){var I=r.memoizedState;if(I===null){var h=r.alternate;if(h!==null){var b=h.memoizedState;if(b!==null){var S=b.dehydrated;S!==null&&cZ(S)}}}}function Y2(i){var r=i.updateQueue;if(r!==null){i.updateQueue=null;var I=i.stateNode;I===null&&(I=i.stateNode=new k1),r.forEach(function(h){var b=az.bind(null,i,h);if(!I.has(h)){if(I.add(h),cs)if(mm!==null&&bm!==null)w0(bm,mm);else throw Error("Expected finished root and lanes to be set. This is a bug in React.");h.then(b,b)}})}}function cL(i,r,I){mm=I,bm=i,ra(r),T2(r,i),ra(r),mm=null,bm=null}function Wc(i,r,I){var h=r.deletions;if(h!==null)for(var b=0;b<h.length;b++){var S=h[b];try{oL(i,r,S)}catch(Y){ea(S,r,Y)}}var M=af();if(r.subtreeFlags&_I)for(var X=r.child;X!==null;)ra(X),T2(X,i),X=X.sibling;ra(M)}function T2(i,r,I){var h=i.alternate,b=i.flags;switch(i.tag){case d:case W:case T:case L:{if(Wc(r,i),Ug(i),b&Qn){try{wc(ol|ha,i,i.return),kd(ol|ha,i)}catch(Mn){ea(i,i.return,Mn)}if(i.mode&xi){try{rn(),wc(wa|ha,i,i.return)}catch(Mn){ea(i,i.return,Mn)}we(i)}else try{wc(wa|ha,i,i.return)}catch(Mn){ea(i,i.return,Mn)}}return}case C:{Wc(r,i),Ug(i),b&ng&&h!==null&&vm(h,h.return);return}case y:{Wc(r,i),Ug(i),b&ng&&h!==null&&vm(h,h.return);{if(i.flags&tg){var S=i.stateNode;try{Rp(S)}catch(Mn){ea(i,i.return,Mn)}}if(b&Qn){var M=i.stateNode;if(M!=null){var X=i.memoizedProps,Y=h!==null?h.memoizedProps:X,P=i.type,ee=i.updateQueue;if(i.updateQueue=null,ee!==null)try{eZ(M,ee,P,Y,X,i)}catch(Mn){ea(i,i.return,Mn)}}}}return}case G:{if(Wc(r,i),Ug(i),b&Qn){if(i.stateNode===null)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var ve=i.stateNode,me=i.memoizedProps,Ee=h!==null?h.memoizedProps:me;try{gW(ve,Ee,me)}catch(Mn){ea(i,i.return,Mn)}}return}case p:{if(Wc(r,i),Ug(i),b&Qn&&h!==null){var Le=h.memoizedState;if(Le.isDehydrated)try{lZ(r.containerInfo)}catch(Mn){ea(i,i.return,Mn)}}return}case m:{Wc(r,i),Ug(i);return}case K:{Wc(r,i),Ug(i);var at=i.child;if(at.flags&ig){var jt=at.stateNode,yn=at.memoizedState,Cn=yn!==null;if(jt.isHidden=Cn,Cn){var li=at.alternate!==null&&at.alternate.memoizedState!==null;li||_L()}}if(b&Qn){try{sL(i)}catch(Mn){ea(i,i.return,Mn)}Y2(i)}return}case ie:{var ii=h!==null&&h.memoizedState!==null;if(i.mode&ei){var He=lo;lo=He||ii,Wc(r,i),lo=He}else Wc(r,i);if(Ug(i),b&ig){var rt=i.stateNode,Xe=i.memoizedState,St=Xe!==null,on=i;if(rt.isHidden=St,St&&!ii&&(on.mode&ei)!==vn){gn=on;for(var an=on.child;an!==null;)gn=an,uL(an),an=an.sibling}nL(on,St)}return}case U:{Wc(r,i),Ug(i),b&Qn&&Y2(i);return}case le:return;default:{Wc(r,i),Ug(i);return}}}function Ug(i){var r=i.flags;if(r&oa){try{rL(i)}catch(I){ea(i,i.return,I)}i.flags&=~oa}r&Ls&&(i.flags&=~Ls)}function gL(i,r,I){mm=I,bm=r,gn=i,E2(i,r,I),mm=null,bm=null}function E2(i,r,I){for(var h=(i.mode&ei)!==vn;gn!==null;){var b=gn,S=b.child;if(b.tag===ie&&h){var M=b.memoizedState!==null,X=M||qZ;if(X){uV(i,r,I);continue}else{var Y=b.alternate,P=Y!==null&&Y.memoizedState!==null,ee=P||lo,ve=qZ,me=lo;qZ=X,lo=ee,lo&&!me&&(gn=b,IL(b));for(var Ee=S;Ee!==null;)gn=Ee,E2(Ee,r,I),Ee=Ee.sibling;gn=b,qZ=ve,lo=me,uV(i,r,I);continue}}(b.subtreeFlags&DI)!==Zn&&S!==null?(S.return=b,gn=S):uV(i,r,I)}}function uV(i,r,I){for(;gn!==null;){var h=gn;if((h.flags&DI)!==Zn){var b=h.alternate;ra(h);try{eL(r,b,h,I)}catch(M){ea(h,h.return,M)}ir()}if(h===i){gn=null;return}var S=h.sibling;if(S!==null){S.return=h.return,gn=S;return}gn=h.return}}function uL(i){for(;gn!==null;){var r=gn,I=r.child;switch(r.tag){case d:case W:case T:case L:{if(r.mode&xi)try{rn(),wc(wa,r,r.return)}finally{we(r)}else wc(wa,r,r.return);break}case C:{vm(r,r.return);var h=r.stateNode;typeof h.componentWillUnmount=="function"&&lV(r,r.return,h);break}case y:{vm(r,r.return);break}case ie:{var b=r.memoizedState!==null;if(b){K2(i);continue}break}}I!==null?(I.return=r,gn=I):K2(i)}}function K2(i){for(;gn!==null;){var r=gn;if(r===i){gn=null;return}var I=r.sibling;if(I!==null){I.return=r.return,gn=I;return}gn=r.return}}function IL(i){for(;gn!==null;){var r=gn,I=r.child;if(r.tag===ie){var h=r.memoizedState!==null;if(h){L2(i);continue}}I!==null?(I.return=r,gn=I):L2(i)}}function L2(i){for(;gn!==null;){var r=gn;ra(r);try{tL(r)}catch(h){ea(r,r.return,h)}if(ir(),r===i){gn=null;return}var I=r.sibling;if(I!==null){I.return=r.return,gn=I;return}gn=r.return}}function dL(i,r,I,h){gn=r,CL(r,i,I,h)}function CL(i,r,I,h){for(;gn!==null;){var b=gn,S=b.child;(b.subtreeFlags&RC)!==Zn&&S!==null?(S.return=b,gn=S):hL(i,r,I,h)}}function hL(i,r,I,h){for(;gn!==null;){var b=gn;if((b.flags&Ks)!==Zn){ra(b);try{AL(r,b,I,h)}catch(M){ea(b,b.return,M)}ir()}if(b===i){gn=null;return}var S=b.sibling;if(S!==null){S.return=b.return,gn=S;return}gn=b.return}}function AL(i,r,I,h){switch(r.tag){case d:case W:case L:{if(r.mode&xi){nn();try{kd(br|ha,r)}finally{Mt(r)}}else kd(br|ha,r);break}}}function fL(i){gn=i,pL()}function pL(){for(;gn!==null;){var i=gn,r=i.child;if((gn.flags&Es)!==Zn){var I=i.deletions;if(I!==null){for(var h=0;h<I.length;h++){var b=I[h];gn=b,vL(b,i)}{var S=i.alternate;if(S!==null){var M=S.child;if(M!==null){S.child=null;do{var X=M.sibling;M.sibling=null,M=X}while(M!==null)}}}gn=i}}(i.subtreeFlags&RC)!==Zn&&r!==null?(r.return=i,gn=r):mL()}}function mL(){for(;gn!==null;){var i=gn;(i.flags&Ks)!==Zn&&(ra(i),bL(i),ir());var r=i.sibling;if(r!==null){r.return=i.return,gn=r;return}gn=i.return}}function bL(i){switch(i.tag){case d:case W:case L:{i.mode&xi?(nn(),wc(br|ha,i,i.return),Mt(i)):wc(br|ha,i,i.return);break}}}function vL(i,r){for(;gn!==null;){var I=gn;ra(I),GL(I,r),ir();var h=I.child;h!==null?(h.return=I,gn=h):yL(i)}}function yL(i){for(;gn!==null;){var r=gn,I=r.sibling,h=r.return;if(N2(r),r===i){gn=null;return}if(I!==null){I.return=h,gn=I;return}gn=h}}function GL(i,r){switch(i.tag){case d:case W:case L:{i.mode&xi?(nn(),wc(br,i,r),Mt(i)):wc(br,i,r);break}}}function BL(i){switch(i.tag){case d:case W:case L:{try{kd(wa|ha,i)}catch(I){ea(i,i.return,I)}break}case C:{var r=i.stateNode;try{r.componentDidMount()}catch(I){ea(i,i.return,I)}break}}}function ZL(i){switch(i.tag){case d:case W:case L:{try{kd(br|ha,i)}catch(r){ea(i,i.return,r)}break}}}function SL(i){switch(i.tag){case d:case W:case L:{try{wc(wa|ha,i,i.return)}catch(I){ea(i,i.return,I)}break}case C:{var r=i.stateNode;typeof r.componentWillUnmount=="function"&&lV(i,i.return,r);break}}}function RL(i){switch(i.tag){case d:case W:case L:try{wc(br|ha,i,i.return)}catch(r){ea(i,i.return,r)}}}if(typeof Symbol=="function"&&Symbol.for){var f0=Symbol.for;f0("selector.component"),f0("selector.has_pseudo_class"),f0("selector.role"),f0("selector.test_id"),f0("selector.text")}var wL=[];function xL(){wL.forEach(function(i){return i()})}var WL=t.ReactCurrentActQueue;function VL(i){{var r=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0,I=typeof jest<"u";return I&&r!==!1}}function z2(){{var i=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0;return!i&&WL.current!==null&&l("The current testing environment is not configured to support act(...)"),i}}var ML=Math.ceil,IV=t.ReactCurrentDispatcher,dV=t.ReactCurrentOwner,go=t.ReactCurrentBatchConfig,Vc=t.ReactCurrentActQueue,vr=0,_2=1,uo=2,Xl=4,lI=0,p0=1,nA=2,eS=3,m0=4,D2=5,CV=6,si=vr,qo=null,xa=null,yr=ft,Jg=ft,hV=pc(ft),Gr=lI,b0=null,tS=ft,v0=ft,nS=ft,y0=null,Gs=null,AV=0,k2=500,U2=1/0,NL=500,cI=null;function G0(){U2=or()+NL}function J2(){return U2}var iS=!1,fV=null,ym=null,iA=!1,Jd=null,B0=ft,pV=[],mV=null,HL=50,Z0=0,bV=null,vV=!1,aS=!1,XL=50,Gm=0,rS=null,S0=ai,oS=ft,O2=!1;function sS(){return qo}function $o(){return(si&(uo|Xl))!==vr?or():(S0!==ai||(S0=or()),S0)}function Od(i){var r=i.mode;if((r&ei)===vn)return Vn;if((si&uo)!==vr&&yr!==ft)return $I(yr);var I=Dp()!==Ou;if(I){if(go.transition!==null){var h=go.transition;h._updatedFibers||(h._updatedFibers=new Set),h._updatedFibers.add(i)}return oS===Ha&&(oS=sv()),oS}var b=Is();if(b!==Ha)return b;var S=lW();return S}function FL(i){var r=i.mode;return(r&ei)===vn?Vn:Hx()}function Br(i,r,I,h){oz(),O2&&l("useInsertionEffect must not schedule updates."),vV&&(aS=!0),Bu(i,I,h),(si&uo)!==ft&&i===qo?cz(r):(cs&&cv(i,r,I),gz(r),i===qo&&((si&uo)===vr&&(v0=Hn(v0,I)),Gr===m0&&Pd(i,yr)),Bs(i,h),I===Vn&&si===vr&&(r.mode&ei)===vn&&!Vc.isBatchingLegacy&&(G0(),yZ()))}function YL(i,r,I){var h=i.current;h.lanes=r,Bu(i,r,I),Bs(i,I)}function TL(i){return(si&uo)!==vr}function Bs(i,r){var I=i.callbackNode;Ff(i,r);var h=sc(i,i===qo?yr:ft);if(h===ft){I!==null&&gX(I),i.callbackNode=null,i.callbackPriority=Ha;return}var b=gg(h),S=i.callbackPriority;if(S===b&&!(Vc.current!==null&&I!==wV)){I==null&&S!==Vn&&l("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.");return}I!=null&&gX(I);var M;if(b===Vn)i.tag===Rg?(Vc.isBatchingLegacy!==null&&(Vc.didScheduleLegacyUpdate=!0),vZ(j2.bind(null,i))):bZ(j2.bind(null,i)),Vc.current!==null?Vc.current.push(wg):qB(function(){(si&(uo|Xl))===vr&&wg()}),M=null;else{var X;switch(_f(h)){case jr:X=Vf;break;case Os:X=Mf;break;case Ps:X=rg;break;case nd:X=jb;break;default:X=rg;break}M=xV(X,P2.bind(null,i))}i.callbackPriority=b,i.callbackNode=M}function P2(i,r){if(fn(),S0=ai,oS=ft,(si&(uo|Xl))!==vr)throw new Error("Should not already be working.");var I=i.callbackNode,h=uI();if(h&&i.callbackNode!==I)return null;var b=sc(i,i===qo?yr:ft);if(b===ft)return null;var S=!lc(i,b)&&!Fa(i,b)&&!r,M=S?OL(i,b):cS(i,b);if(M!==lI){if(M===nA){var X=Yf(i);X!==ft&&(b=X,M=yV(i,X))}if(M===p0){var Y=b0;throw aA(i,ft),Pd(i,b),Bs(i,or()),Y}if(M===CV)Pd(i,b);else{var P=!lc(i,b),ee=i.current.alternate;if(P&&!KL(ee)){if(M=cS(i,b),M===nA){var ve=Yf(i);ve!==ft&&(b=ve,M=yV(i,ve))}if(M===p0){var me=b0;throw aA(i,ft),Pd(i,b),Bs(i,or()),me}}i.finishedWork=ee,i.finishedLanes=b,EL(i,M,b)}}return Bs(i,or()),i.callbackNode===I?P2.bind(null,i):null}function yV(i,r){var I=y0;if(id(i)){var h=aA(i,r);h.flags|=ec,Qt(i.containerInfo)}var b=cS(i,r);if(b!==nA){var S=Gs;Gs=I,S!==null&&Q2(S)}return b}function Q2(i){Gs===null?Gs=i:Gs.push.apply(Gs,i)}function EL(i,r,I){switch(r){case lI:case p0:throw new Error("Root did not complete. This is a bug in React.");case nA:{rA(i,Gs,cI);break}case eS:{if(Pd(i,I),Tf(I)&&!uX()){var h=AV+k2-or();if(h>10){var b=sc(i,ft);if(b!==ft)break;var S=i.suspendedLanes;if(!ug(S,I)){$o(),YC(i,S);break}i.timeoutHandle=cy(rA.bind(null,i,Gs,cI),h);break}}rA(i,Gs,cI);break}case m0:{if(Pd(i,I),Nx(I))break;if(!uX()){var M=ov(i,I),X=M,Y=or()-X,P=rz(Y)-Y;if(P>10){i.timeoutHandle=cy(rA.bind(null,i,Gs,cI),P);break}}rA(i,Gs,cI);break}case D2:{rA(i,Gs,cI);break}default:throw new Error("Unknown root exit status.")}}function KL(i){for(var r=i;;){if(r.flags&wf){var I=r.updateQueue;if(I!==null){var h=I.stores;if(h!==null)for(var b=0;b<h.length;b++){var S=h[b],M=S.getSnapshot,X=S.value;try{if(!Bo(M(),X))return!1}catch{return!1}}}}var Y=r.child;if(r.subtreeFlags&wf&&Y!==null){Y.return=r,r=Y;continue}if(r===i)return!0;for(;r.sibling===null;){if(r.return===null||r.return===i)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}return!0}function Pd(i,r){r=ed(r,nS),r=ed(r,v0),Xx(i,r)}function j2(i){if(Kn(),(si&(uo|Xl))!==vr)throw new Error("Should not already be working.");uI();var r=sc(i,ft);if(!Mr(r,Vn))return Bs(i,or()),null;var I=cS(i,r);if(i.tag!==Rg&&I===nA){var h=Yf(i);h!==ft&&(r=h,I=yV(i,h))}if(I===p0){var b=b0;throw aA(i,ft),Pd(i,r),Bs(i,or()),b}if(I===CV)throw new Error("Root did not complete. This is a bug in React.");var S=i.current.alternate;return i.finishedWork=S,i.finishedLanes=r,rA(i,Gs,cI),Bs(i,or()),null}function LL(i,r){r!==ft&&(Ef(i,Hn(r,Vn)),Bs(i,or()),(si&(uo|Xl))===vr&&(G0(),wg()))}function GV(i,r){var I=si;si|=_2;try{return i(r)}finally{si=I,si===vr&&!Vc.isBatchingLegacy&&(G0(),yZ())}}function zL(i,r,I,h,b){var S=Is(),M=go.transition;try{return go.transition=null,ya(jr),i(r,I,h,b)}finally{ya(S),go.transition=M,si===vr&&G0()}}function gI(i){Jd!==null&&Jd.tag===Rg&&(si&(uo|Xl))===vr&&uI();var r=si;si|=_2;var I=go.transition,h=Is();try{return go.transition=null,ya(jr),i?i():void 0}finally{ya(h),go.transition=I,si=r,(si&(uo|Xl))===vr&&wg()}}function q2(){return(si&(uo|Xl))!==vr}function lS(i,r){Tr(hV,Jg,i),Jg=Hn(Jg,r)}function BV(i){Jg=hV.current,Yr(hV,i)}function aA(i,r){i.finishedWork=null,i.finishedLanes=ft;var I=i.timeoutHandle;if(I!==wd&&(i.timeoutHandle=wd,gy(I)),xa!==null)for(var h=xa.return;h!==null;){var b=h.alternate;R2(b,h),h=h.return}qo=i;var S=oA(i.current,null);return xa=S,yr=Jg=r,Gr=lI,b0=null,tS=ft,v0=ft,nS=ft,y0=null,Gs=null,Fy(),to.discardPendingWarnings(),S}function $2(i,r){do{var I=xa;try{if(Xg(),tm(),ir(),dV.current=null,I===null||I.return===null){Gr=p0,b0=r,xa=null;return}if(bt&&I.mode&xi&&lt(I,!0),tt)if(JI(),r!==null&&typeof r=="object"&&typeof r.then=="function"){var h=r;Gx(I,h,yr)}else yx(I,r,yr);I1(i,I.return,I,r,yr),iX(I)}catch(b){r=b,xa===I&&I!==null?(I=I.return,xa=I):I=xa;continue}return}while(!0)}function eX(){var i=IV.current;return IV.current=fm,i===null?fm:i}function tX(i){IV.current=i}function _L(){AV=or()}function R0(i){tS=Hn(i,tS)}function DL(){Gr===lI&&(Gr=eS)}function ZV(){(Gr===lI||Gr===eS||Gr===nA)&&(Gr=m0),qo!==null&&(XC(tS)||XC(v0))&&Pd(qo,yr)}function kL(i){Gr!==m0&&(Gr=nA),y0===null?y0=[i]:y0.push(i)}function UL(){return Gr===lI}function cS(i,r){var I=si;si|=uo;var h=eX();if(qo!==i||yr!==r){if(cs){var b=i.memoizedUpdaters;b.size>0&&(w0(i,yr),b.clear()),Lf(i,r)}cI=gv(),aA(i,r)}qb(r);do try{JL();break}catch(S){$2(i,S)}while(!0);if(Xg(),si=I,tX(h),xa!==null)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return IB(),qo=null,yr=ft,Gr}function JL(){for(;xa!==null;)nX(xa)}function OL(i,r){var I=si;si|=uo;var h=eX();if(qo!==i||yr!==r){if(cs){var b=i.memoizedUpdaters;b.size>0&&(w0(i,yr),b.clear()),Lf(i,r)}cI=gv(),G0(),aA(i,r)}qb(r);do try{PL();break}catch(S){$2(i,S)}while(!0);return Xg(),tX(h),si=I,xa!==null?(Rx(),lI):(IB(),qo=null,yr=ft,Gr)}function PL(){for(;xa!==null&&!Ds();)nX(xa)}function nX(i){var r=i.alternate;ra(i);var I;(i.mode&xi)!==vn?(Di(i),I=SV(r,i,Jg),lt(i,!0)):I=SV(r,i,Jg),ir(),i.memoizedProps=i.pendingProps,I===null?iX(i):xa=I,dV.current=null}function iX(i){var r=i;do{var I=r.alternate,h=r.return;if((r.flags&zI)===Zn){ra(r);var b=void 0;if((r.mode&xi)===vn?b=S2(I,r,Jg):(Di(r),b=S2(I,r,Jg),lt(r,!1)),ir(),b!==null){xa=b;return}}else{var S=D1(I,r);if(S!==null){S.flags&=gx,xa=S;return}if((r.mode&xi)!==vn){lt(r,!1);for(var M=r.actualDuration,X=r.child;X!==null;)M+=X.actualDuration,X=X.sibling;r.actualDuration=M}if(h!==null)h.flags|=zI,h.subtreeFlags=Zn,h.deletions=null;else{Gr=CV,xa=null;return}}var Y=r.sibling;if(Y!==null){xa=Y;return}r=h,xa=r}while(r!==null);Gr===lI&&(Gr=D2)}function rA(i,r,I){var h=Is(),b=go.transition;try{go.transition=null,ya(jr),QL(i,r,I,h)}finally{go.transition=b,ya(h)}return null}function QL(i,r,I,h){do uI();while(Jd!==null);if(sz(),(si&(uo|Xl))!==vr)throw new Error("Should not already be working.");var b=i.finishedWork,S=i.finishedLanes;if(px(S),b===null)return lB(),null;if(S===ft&&l("root.finishedLanes should not be empty during a commit. This is a bug in React."),i.finishedWork=null,i.finishedLanes=ft,b===i.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");i.callbackNode=null,i.callbackPriority=Ha;var M=Hn(b.lanes,b.childLanes);Fx(i,M),i===qo&&(qo=null,xa=null,yr=ft),((b.subtreeFlags&RC)!==Zn||(b.flags&RC)!==Zn)&&(iA||(iA=!0,mV=I,xV(rg,function(){return uI(),null})));var X=(b.subtreeFlags&(En|_I|DI|RC))!==Zn,Y=(b.flags&(En|_I|DI|RC))!==Zn;if(X||Y){var P=go.transition;go.transition=null;var ee=Is();ya(jr);var ve=si;si|=Xl,dV.current=null,P1(i,b),Qi(),cL(i,b,S),sy(i.containerInfo),i.current=b,Bx(S),gL(b,i,S),Zx(),rr(),si=ve,ya(ee),go.transition=P}else i.current=b,Qi();var me=iA;if(iA?(iA=!1,Jd=i,B0=S):(Gm=0,rS=null),M=i.pendingLanes,M===ft&&(ym=null),me||sX(i.current,!1),UI(b.stateNode,h),cs&&i.memoizedUpdaters.clear(),xL(),Bs(i,or()),r!==null)for(var Ee=i.onRecoverableError,Le=0;Le<r.length;Le++){var at=r[Le],jt=at.stack,yn=at.digest;Ee(at.value,{componentStack:jt,digest:yn})}if(iS){iS=!1;var Cn=fV;throw fV=null,Cn}return Mr(B0,Vn)&&i.tag!==Rg&&uI(),M=i.pendingLanes,Mr(M,Vn)?(xt(),i===bV?Z0++:(Z0=0,bV=i)):Z0=0,wg(),lB(),null}function uI(){if(Jd!==null){var i=_f(B0),r=dv(Ps,i),I=go.transition,h=Is();try{return go.transition=null,ya(r),qL()}finally{ya(h),go.transition=I}}return!1}function jL(i){pV.push(i),iA||(iA=!0,xV(rg,function(){return uI(),null}))}function qL(){if(Jd===null)return!1;var i=mV;mV=null;var r=Jd,I=B0;if(Jd=null,B0=ft,(si&(uo|Xl))!==vr)throw new Error("Cannot flush passive effects while already rendering.");vV=!0,aS=!1,Sx(I);var h=si;si|=Xl,fL(r.current),dL(r,r.current,I,i);{var b=pV;pV=[];for(var S=0;S<b.length;S++){var M=b[S];$1(r,M)}}uB(),sX(r.current,!0),si=h,wg(),aS?r===rS?Gm++:(Gm=0,rS=r):Gm=0,vV=!1,aS=!1,Wr(r);{var X=r.current.stateNode;X.effectDuration=0,X.passiveEffectDuration=0}return!0}function aX(i){return ym!==null&&ym.has(i)}function $L(i){ym===null?ym=new Set([i]):ym.add(i)}function ez(i){iS||(iS=!0,fV=i)}var tz=ez;function rX(i,r,I){var h=eA(I,r),b=n2(i,h,Vn),S=Zc(i,b,Vn),M=$o();S!==null&&(Bu(S,Vn,M),Bs(S,M))}function ea(i,r,I){if(U1(I),x0(!1),i.tag===p){rX(i,i,I);return}var h=null;for(h=r;h!==null;){if(h.tag===p){rX(h,i,I);return}else if(h.tag===C){var b=h.type,S=h.stateNode;if(typeof b.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&!aX(S)){var M=eA(I,i),X=UW(h,M,Vn),Y=Zc(h,X,Vn),P=$o();Y!==null&&(Bu(Y,Vn,P),Bs(Y,P));return}}h=h.return}l(`Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.

Error message:

%s`,I)}function nz(i,r,I){var h=i.pingCache;h!==null&&h.delete(r);var b=$o();YC(i,I),uz(i),qo===i&&ug(yr,I)&&(Gr===m0||Gr===eS&&Tf(yr)&&or()-AV<k2?aA(i,ft):nS=Hn(nS,I)),Bs(i,b)}function oX(i,r){r===Ha&&(r=FL(i));var I=$o(),h=Ra(i,r);h!==null&&(Bu(h,r,I),Bs(h,I))}function iz(i){var r=i.memoizedState,I=Ha;r!==null&&(I=r.retryLane),oX(i,I)}function az(i,r){var I=Ha,h;switch(i.tag){case K:h=i.stateNode;var b=i.memoizedState;b!==null&&(I=b.retryLane);break;case U:h=i.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}h!==null&&h.delete(r),oX(i,I)}function rz(i){return i<120?120:i<480?480:i<1080?1080:i<1920?1920:i<3e3?3e3:i<4320?4320:ML(i/1960)*1960}function oz(){if(Z0>HL)throw Z0=0,bV=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");Gm>XL&&(Gm=0,rS=null,l("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}function sz(){to.flushLegacyContextWarning(),to.flushPendingUnsafeLifecycleWarnings()}function sX(i,r){ra(i),gS(i,va,SL),r&&gS(i,nc,RL),gS(i,va,BL),r&&gS(i,nc,ZL),ir()}function gS(i,r,I){for(var h=i,b=null;h!==null;){var S=h.subtreeFlags&r;h!==b&&h.child!==null&&S!==Zn?h=h.child:((h.flags&r)!==Zn&&I(h),h.sibling!==null?h=h.sibling:h=b=h.return)}}var uS=null;function lX(i){{if((si&uo)!==vr||!(i.mode&ei))return;var r=i.tag;if(r!==A&&r!==p&&r!==C&&r!==d&&r!==W&&r!==T&&r!==L)return;var I=Tn(i)||"ReactComponent";if(uS!==null){if(uS.has(I))return;uS.add(I)}else uS=new Set([I]);var h=wr;try{ra(i),l("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{h?ra(i):ir()}}}var SV;{var lz=null;SV=function(i,r,I){var h=AX(lz,r);try{return v2(i,r,I)}catch(S){if(Sy()||S!==null&&typeof S=="object"&&typeof S.then=="function")throw S;if(Xg(),tm(),R2(i,r),AX(r,h),r.mode&xi&&Di(r),BC(null,v2,null,i,r,I),ZC()){var b=Rf();typeof b=="object"&&b!==null&&b._suppressLogging&&typeof S=="object"&&S!==null&&!S._suppressLogging&&(S._suppressLogging=!0)}throw S}}}var cX=!1,RV;RV=new Set;function cz(i){if(ou&&!zZ())switch(i.tag){case d:case W:case L:{var r=xa&&Tn(xa)||"Unknown",I=r;if(!RV.has(I)){RV.add(I);var h=Tn(i)||"Unknown";l("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",h,r,r)}break}case C:{cX||(l("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),cX=!0);break}}}function w0(i,r){if(cs){var I=i.memoizedUpdaters;I.forEach(function(h){cv(i,h,r)})}}var wV={};function xV(i,r){{var I=Vc.current;return I!==null?(I.push(r),wV):Wf(i,r)}}function gX(i){if(i!==wV)return xC(i)}function uX(){return Vc.current!==null}function gz(i){{if(i.mode&ei){if(!z2())return}else if(!VL()||si!==vr||i.tag!==d&&i.tag!==W&&i.tag!==L)return;if(Vc.current===null){var r=wr;try{ra(i),l(`An update to %s inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`,Tn(i))}finally{r?ra(i):ir()}}}}function uz(i){i.tag!==Rg&&z2()&&Vc.current===null&&l(`A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`)}function x0(i){O2=i}var Fl=null,Bm=null,Iz=function(i){Fl=i};function Zm(i){{if(Fl===null)return i;var r=Fl(i);return r===void 0?i:r.current}}function WV(i){return Zm(i)}function VV(i){{if(Fl===null)return i;var r=Fl(i);if(r===void 0){if(i!=null&&typeof i.render=="function"){var I=Zm(i.render);if(i.render!==I){var h={$$typeof:nt,render:I};return i.displayName!==void 0&&(h.displayName=i.displayName),h}}return i}return r.current}}function IX(i,r){{if(Fl===null)return!1;var I=i.elementType,h=r.type,b=!1,S=typeof h=="object"&&h!==null?h.$$typeof:null;switch(i.tag){case C:{typeof h=="function"&&(b=!0);break}case d:{(typeof h=="function"||S===Ut)&&(b=!0);break}case W:{(S===nt||S===Ut)&&(b=!0);break}case T:case L:{(S===dn||S===Ut)&&(b=!0);break}default:return!1}if(b){var M=Fl(I);if(M!==void 0&&M===Fl(h))return!0}return!1}}function dX(i){{if(Fl===null||typeof WeakSet!="function")return;Bm===null&&(Bm=new WeakSet),Bm.add(i)}}var dz=function(i,r){{if(Fl===null)return;var I=r.staleFamilies,h=r.updatedFamilies;uI(),gI(function(){MV(i.current,h,I)})}},Cz=function(i,r){{if(i.context!==Ro)return;uI(),gI(function(){W0(r,i,null,null)})}};function MV(i,r,I){{var h=i.alternate,b=i.child,S=i.sibling,M=i.tag,X=i.type,Y=null;switch(M){case d:case L:case C:Y=X;break;case W:Y=X.render;break}if(Fl===null)throw new Error("Expected resolveFamily to be set during hot reload.");var P=!1,ee=!1;if(Y!==null){var ve=Fl(Y);ve!==void 0&&(I.has(ve)?ee=!0:r.has(ve)&&(M===C?ee=!0:P=!0))}if(Bm!==null&&(Bm.has(i)||h!==null&&Bm.has(h))&&(ee=!0),ee&&(i._debugNeedsRemount=!0),ee||P){var me=Ra(i,Vn);me!==null&&Br(me,i,Vn,ai)}b!==null&&!ee&&MV(b,r,I),S!==null&&MV(S,r,I)}}var hz=function(i,r){{var I=new Set,h=new Set(r.map(function(b){return b.current}));return NV(i.current,h,I),I}};function NV(i,r,I){{var h=i.child,b=i.sibling,S=i.tag,M=i.type,X=null;switch(S){case d:case L:case C:X=M;break;case W:X=M.render;break}var Y=!1;X!==null&&r.has(X)&&(Y=!0),Y?Az(i,I):h!==null&&NV(h,r,I),b!==null&&NV(b,r,I)}}function Az(i,r){{var I=fz(i,r);if(I)return;for(var h=i;;){switch(h.tag){case y:r.add(h.stateNode);return;case m:r.add(h.stateNode.containerInfo);return;case p:r.add(h.stateNode.containerInfo);return}if(h.return===null)throw new Error("Expected to reach root first.");h=h.return}}}function fz(i,r){for(var I=i,h=!1;;){if(I.tag===y)h=!0,r.add(I.stateNode);else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===i)return h;for(;I.sibling===null;){if(I.return===null||I.return===i)return h;I=I.return}I.sibling.return=I.return,I=I.sibling}return!1}var HV;{HV=!1;try{var CX=Object.preventExtensions({})}catch{HV=!0}}function pz(i,r,I,h){this.tag=i,this.key=I,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=r,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=h,this.flags=Zn,this.subtreeFlags=Zn,this.deletions=null,this.lanes=ft,this.childLanes=ft,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,!HV&&typeof Object.preventExtensions=="function"&&Object.preventExtensions(this)}var sl=function(i,r,I,h){return new pz(i,r,I,h)};function XV(i){var r=i.prototype;return!!(r&&r.isReactComponent)}function mz(i){return typeof i=="function"&&!XV(i)&&i.defaultProps===void 0}function bz(i){if(typeof i=="function")return XV(i)?C:d;if(i!=null){var r=i.$$typeof;if(r===nt)return W;if(r===dn)return T}return A}function oA(i,r){var I=i.alternate;I===null?(I=sl(i.tag,r,i.key,i.mode),I.elementType=i.elementType,I.type=i.type,I.stateNode=i.stateNode,I._debugSource=i._debugSource,I._debugOwner=i._debugOwner,I._debugHookTypes=i._debugHookTypes,I.alternate=i,i.alternate=I):(I.pendingProps=r,I.type=i.type,I.flags=Zn,I.subtreeFlags=Zn,I.deletions=null,I.actualDuration=0,I.actualStartTime=-1),I.flags=i.flags&ic,I.childLanes=i.childLanes,I.lanes=i.lanes,I.child=i.child,I.memoizedProps=i.memoizedProps,I.memoizedState=i.memoizedState,I.updateQueue=i.updateQueue;var h=i.dependencies;switch(I.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},I.sibling=i.sibling,I.index=i.index,I.ref=i.ref,I.selfBaseDuration=i.selfBaseDuration,I.treeBaseDuration=i.treeBaseDuration,I._debugNeedsRemount=i._debugNeedsRemount,I.tag){case A:case d:case L:I.type=Zm(i.type);break;case C:I.type=WV(i.type);break;case W:I.type=VV(i.type);break}return I}function vz(i,r){i.flags&=ic|oa;var I=i.alternate;if(I===null)i.childLanes=ft,i.lanes=r,i.child=null,i.subtreeFlags=Zn,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null,i.selfBaseDuration=0,i.treeBaseDuration=0;else{i.childLanes=I.childLanes,i.lanes=I.lanes,i.child=I.child,i.subtreeFlags=Zn,i.deletions=null,i.memoizedProps=I.memoizedProps,i.memoizedState=I.memoizedState,i.updateQueue=I.updateQueue,i.type=I.type;var h=I.dependencies;i.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},i.selfBaseDuration=I.selfBaseDuration,i.treeBaseDuration=I.treeBaseDuration}return i}function yz(i,r,I){var h;return i===vh?(h=ei,r===!0&&(h|=la,h|=yl)):h=vn,cs&&(h|=xi),sl(p,null,null,h)}function FV(i,r,I,h,b,S){var M=A,X=i;if(typeof i=="function")XV(i)?(M=C,X=WV(X)):X=Zm(X);else if(typeof i=="string")M=y;else e:switch(i){case ce:return Qd(I.children,b,S,r);case pt:M=R,b|=la,(b&ei)!==vn&&(b|=yl);break;case Kt:return Gz(I,b,S,r);case Vt:return Bz(I,b,S,r);case kt:return Zz(I,b,S,r);case Ze:return hX(I,b,S,r);case Se:case D:case Ae:case mt:case he:default:{if(typeof i=="object"&&i!==null)switch(i.$$typeof){case ne:M=x;break e;case Te:M=Z;break e;case nt:M=W,X=VV(X);break e;case dn:M=T;break e;case Ut:M=k,X=null;break e}var Y="";{(i===void 0||typeof i=="object"&&i!==null&&Object.keys(i).length===0)&&(Y+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var P=h?Tn(h):null;P&&(Y+=`

Check the render method of \``+P+"`.")}throw new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) "+("but got: "+(i==null?i:typeof i)+"."+Y))}}var ee=sl(M,I,r,b);return ee.elementType=i,ee.type=X,ee.lanes=S,ee._debugOwner=h,ee}function YV(i,r,I){var h=null;h=i._owner;var b=i.type,S=i.key,M=i.props,X=FV(b,S,M,h,r,I);return X._debugSource=i._source,X._debugOwner=i._owner,X}function Qd(i,r,I,h){var b=sl(w,i,h,r);return b.lanes=I,b}function Gz(i,r,I,h){typeof i.id!="string"&&l('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof i.id);var b=sl(N,i,h,r|xi);return b.elementType=Kt,b.lanes=I,b.stateNode={effectDuration:0,passiveEffectDuration:0},b}function Bz(i,r,I,h){var b=sl(K,i,h,r);return b.elementType=Vt,b.lanes=I,b}function Zz(i,r,I,h){var b=sl(U,i,h,r);return b.elementType=kt,b.lanes=I,b}function hX(i,r,I,h){var b=sl(ie,i,h,r);b.elementType=Ze,b.lanes=I;var S={isHidden:!1};return b.stateNode=S,b}function TV(i,r,I){var h=sl(G,i,null,r);return h.lanes=I,h}function Sz(){var i=sl(y,null,null,vn);return i.elementType="DELETED",i}function Rz(i){var r=sl(F,null,null,vn);return r.stateNode=i,r}function EV(i,r,I){var h=i.children!==null?i.children:[],b=sl(m,h,i.key,r);return b.lanes=I,b.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},b}function AX(i,r){return i===null&&(i=sl(A,null,null,vn)),i.tag=r.tag,i.key=r.key,i.elementType=r.elementType,i.type=r.type,i.stateNode=r.stateNode,i.return=r.return,i.child=r.child,i.sibling=r.sibling,i.index=r.index,i.ref=r.ref,i.pendingProps=r.pendingProps,i.memoizedProps=r.memoizedProps,i.updateQueue=r.updateQueue,i.memoizedState=r.memoizedState,i.dependencies=r.dependencies,i.mode=r.mode,i.flags=r.flags,i.subtreeFlags=r.subtreeFlags,i.deletions=r.deletions,i.lanes=r.lanes,i.childLanes=r.childLanes,i.alternate=r.alternate,i.actualDuration=r.actualDuration,i.actualStartTime=r.actualStartTime,i.selfBaseDuration=r.selfBaseDuration,i.treeBaseDuration=r.treeBaseDuration,i._debugSource=r._debugSource,i._debugOwner=r._debugOwner,i._debugNeedsRemount=r._debugNeedsRemount,i._debugHookTypes=r._debugHookTypes,i}function wz(i,r,I,h,b){this.tag=r,this.containerInfo=i,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=wd,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=Ha,this.eventTimes=td(ft),this.expirationTimes=td(ai),this.pendingLanes=ft,this.suspendedLanes=ft,this.pingedLanes=ft,this.expiredLanes=ft,this.mutableReadLanes=ft,this.finishedLanes=ft,this.entangledLanes=ft,this.entanglements=td(ft),this.identifierPrefix=h,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null,this.effectDuration=0,this.passiveEffectDuration=0;{this.memoizedUpdaters=new Set;for(var S=this.pendingUpdatersLaneMap=[],M=0;M<Us;M++)S.push(new Set)}switch(r){case vh:this._debugRootType=I?"hydrateRoot()":"createRoot()";break;case Rg:this._debugRootType=I?"hydrate()":"render()";break}}function fX(i,r,I,h,b,S,M,X,Y,P){var ee=new wz(i,r,I,X,Y),ve=yz(r,S);ee.current=ve,ve.stateNode=ee;{var me={element:h,isDehydrated:I,cache:null,transitions:null,pendingSuspenseBoundaries:null};ve.memoizedState=me}return Hh(ve),ee}var KV="18.3.1";function xz(i,r,I){var h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return Tt(h),{$$typeof:ua,key:h==null?null:""+h,children:i,containerInfo:r,implementation:I}}var LV,zV;LV=!1,zV={};function pX(i){if(!i)return Ro;var r=vl(i),I=wW(r);if(r.tag===C){var h=r.type;if($s(h))return pZ(r,h,I)}return I}function Wz(i,r){{var I=vl(i);if(I===void 0){if(typeof i.render=="function")throw new Error("Unable to find node on an unmounted component.");var h=Object.keys(i).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+h)}var b=Qb(I);if(b===null)return null;if(b.mode&la){var S=Tn(I)||"Component";if(!zV[S]){zV[S]=!0;var M=wr;try{ra(b),I.mode&la?l("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",r,r,S):l("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",r,r,S)}finally{M?ra(M):ir()}}}return b.stateNode}}function mX(i,r,I,h,b,S,M,X){var Y=!1,P=null;return fX(i,r,Y,P,I,h,b,S,M)}function bX(i,r,I,h,b,S,M,X,Y,P){var ee=!0,ve=fX(I,h,ee,i,b,S,M,X,Y);ve.context=pX(null);var me=ve.current,Ee=$o(),Le=Od(me),at=Ml(Ee,Le);return at.callback=r??null,Zc(me,at,Le),YL(ve,Le,Ee),ve}function W0(i,r,I,h){Ax(r,i);var b=r.current,S=$o(),M=Od(b);wx(M);var X=pX(I);r.context===null?r.context=X:r.pendingContext=X,ou&&wr!==null&&!LV&&(LV=!0,l(`Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.

Check the render method of %s.`,Tn(wr)||"Unknown"));var Y=Ml(S,M);Y.payload={element:i},h=h===void 0?null:h,h!==null&&(typeof h!="function"&&l("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",h),Y.callback=h);var P=Zc(b,Y,M);return P!==null&&(Br(P,b,M,S),Xh(P,b,M)),M}function IS(i){var r=i.current;if(!r.child)return null;switch(r.child.tag){case y:return r.child.stateNode;default:return r.child.stateNode}}function Vz(i){switch(i.tag){case p:{var r=i.stateNode;if(id(r)){var I=CB(r);LL(r,I)}break}case K:{gI(function(){var b=Ra(i,Vn);if(b!==null){var S=$o();Br(b,i,Vn,S)}});var h=Vn;_V(i,h);break}}}function vX(i,r){var I=i.memoizedState;I!==null&&I.dehydrated!==null&&(I.retryLane=dg(I.retryLane,r))}function _V(i,r){vX(i,r);var I=i.alternate;I&&vX(I,r)}function Mz(i){if(i.tag===K){var r=jI,I=Ra(i,r);if(I!==null){var h=$o();Br(I,i,r,h)}_V(i,r)}}function Nz(i){if(i.tag===K){var r=Od(i),I=Ra(i,r);if(I!==null){var h=$o();Br(I,i,r,h)}_V(i,r)}}function yX(i){var r=wC(i);return r===null?null:r.stateNode}var GX=function(i){return null};function Hz(i){return GX(i)}var BX=function(i){return!1};function Xz(i){return BX(i)}var ZX=null,SX=null,RX=null,wX=null,xX=null,WX=null,VX=null,MX=null,NX=null;{var HX=function(i,r,I){var h=r[I],b=hi(i)?i.slice():Yt({},i);return I+1===r.length?(hi(b)?b.splice(h,1):delete b[h],b):(b[h]=HX(i[h],r,I+1),b)},XX=function(i,r){return HX(i,r,0)},FX=function(i,r,I,h){var b=r[h],S=hi(i)?i.slice():Yt({},i);if(h+1===r.length){var M=I[h];S[M]=S[b],hi(S)?S.splice(b,1):delete S[b]}else S[b]=FX(i[b],r,I,h+1);return S},YX=function(i,r,I){if(r.length!==I.length){o("copyWithRename() expects paths of the same length");return}else for(var h=0;h<I.length-1;h++)if(r[h]!==I[h]){o("copyWithRename() expects paths to be the same except for the deepest key");return}return FX(i,r,I,0)},TX=function(i,r,I,h){if(I>=r.length)return h;var b=r[I],S=hi(i)?i.slice():Yt({},i);return S[b]=TX(i[b],r,I+1,h),S},EX=function(i,r,I){return TX(i,r,0,I)},DV=function(i,r){for(var I=i.memoizedState;I!==null&&r>0;)I=I.next,r--;return I};ZX=function(i,r,I,h){var b=DV(i,r);if(b!==null){var S=EX(b.memoizedState,I,h);b.memoizedState=S,b.baseState=S,i.memoizedProps=Yt({},i.memoizedProps);var M=Ra(i,Vn);M!==null&&Br(M,i,Vn,ai)}},SX=function(i,r,I){var h=DV(i,r);if(h!==null){var b=XX(h.memoizedState,I);h.memoizedState=b,h.baseState=b,i.memoizedProps=Yt({},i.memoizedProps);var S=Ra(i,Vn);S!==null&&Br(S,i,Vn,ai)}},RX=function(i,r,I,h){var b=DV(i,r);if(b!==null){var S=YX(b.memoizedState,I,h);b.memoizedState=S,b.baseState=S,i.memoizedProps=Yt({},i.memoizedProps);var M=Ra(i,Vn);M!==null&&Br(M,i,Vn,ai)}},wX=function(i,r,I){i.pendingProps=EX(i.memoizedProps,r,I),i.alternate&&(i.alternate.pendingProps=i.pendingProps);var h=Ra(i,Vn);h!==null&&Br(h,i,Vn,ai)},xX=function(i,r){i.pendingProps=XX(i.memoizedProps,r),i.alternate&&(i.alternate.pendingProps=i.pendingProps);var I=Ra(i,Vn);I!==null&&Br(I,i,Vn,ai)},WX=function(i,r,I){i.pendingProps=YX(i.memoizedProps,r,I),i.alternate&&(i.alternate.pendingProps=i.pendingProps);var h=Ra(i,Vn);h!==null&&Br(h,i,Vn,ai)},VX=function(i){var r=Ra(i,Vn);r!==null&&Br(r,i,Vn,ai)},MX=function(i){GX=i},NX=function(i){BX=i}}function Fz(i){var r=Qb(i);return r===null?null:r.stateNode}function Yz(i){return null}function Tz(){return wr}function Ez(i){var r=i.findFiberByHostInstance,I=t.ReactCurrentDispatcher;return hx({bundleType:i.bundleType,version:i.version,rendererPackageName:i.rendererPackageName,rendererConfig:i.rendererConfig,overrideHookState:ZX,overrideHookStateDeletePath:SX,overrideHookStateRenamePath:RX,overrideProps:wX,overridePropsDeletePath:xX,overridePropsRenamePath:WX,setErrorHandler:MX,setSuspenseHandler:NX,scheduleUpdate:VX,currentDispatcherRef:I,findHostInstanceByFiber:Fz,findFiberByHostInstance:r||Yz,findHostInstancesForRefresh:hz,scheduleRefresh:dz,scheduleRoot:Cz,setRefreshHandler:Iz,getCurrentFiber:Tz,reconcilerVersion:KV})}var KX=typeof reportError=="function"?reportError:function(i){console.error(i)};function kV(i){this._internalRoot=i}dS.prototype.render=kV.prototype.render=function(i){var r=this._internalRoot;if(r===null)throw new Error("Cannot update an unmounted root.");{typeof arguments[1]=="function"?l("render(...): does not support the second callback argument. To execute a side effect after rendering, declare it in a component body with useEffect()."):CS(arguments[1])?l("You passed a container to the second argument of root.render(...). You don't need to pass it again since you already passed it to create the root."):typeof arguments[1]<"u"&&l("You passed a second argument to root.render(...) but it only accepts one argument.");var I=r.containerInfo;if(I.nodeType!==Ma){var h=yX(r.current);h&&h.parentNode!==I&&l("render(...): It looks like the React-rendered content of the root container was removed without using React. This is not supported and will cause errors. Instead, call root.unmount() to empty a root's container.")}}W0(i,r,null,null)},dS.prototype.unmount=kV.prototype.unmount=function(){typeof arguments[0]=="function"&&l("unmount(...): does not support a callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var i=this._internalRoot;if(i!==null){this._internalRoot=null;var r=i.containerInfo;q2()&&l("Attempted to synchronously unmount a root while React was already rendering. React cannot finish unmounting the root until the current render has completed, which may lead to a race condition."),gI(function(){W0(null,i,null,null)}),CZ(r)}};function Kz(i,r){if(!CS(i))throw new Error("createRoot(...): Target container is not a DOM element.");LX(i);var I=!1,h=!1,b="",S=KX;r!=null&&(r.hydrate?o("hydrate through createRoot is deprecated. Use ReactDOMClient.hydrateRoot(container, <App />) instead."):typeof r=="object"&&r!==null&&r.$$typeof===pa&&l(`You passed a JSX element to createRoot. You probably meant to call root.render instead. Example usage:

  let root = createRoot(domContainer);
  root.render(<App />);`),r.unstable_strictMode===!0&&(I=!0),r.identifierPrefix!==void 0&&(b=r.identifierPrefix),r.onRecoverableError!==void 0&&(S=r.onRecoverableError),r.transitionCallbacks!==void 0&&r.transitionCallbacks);var M=mX(i,vh,null,I,h,b,S);Ah(M.current,i);var X=i.nodeType===Ma?i.parentNode:i;return $r(X),new kV(M)}function dS(i){this._internalRoot=i}function Lz(i){i&&pv(i)}dS.prototype.unstable_scheduleHydration=Lz;function zz(i,r,I){if(!CS(i))throw new Error("hydrateRoot(...): Target container is not a DOM element.");LX(i),r===void 0&&l("Must provide initial children as second argument to hydrateRoot. Example usage: hydrateRoot(domContainer, <App />)");var h=I??null,b=I!=null&&I.hydratedSources||null,S=!1,M=!1,X="",Y=KX;I!=null&&(I.unstable_strictMode===!0&&(S=!0),I.identifierPrefix!==void 0&&(X=I.identifierPrefix),I.onRecoverableError!==void 0&&(Y=I.onRecoverableError));var P=bX(r,null,i,vh,h,S,M,X,Y);if(Ah(P.current,i),$r(i),b)for(var ee=0;ee<b.length;ee++){var ve=b[ee];EW(P,ve)}return new dS(P)}function CS(i){return!!(i&&(i.nodeType===mo||i.nodeType===Ql||i.nodeType===cu||!$e))}function V0(i){return!!(i&&(i.nodeType===mo||i.nodeType===Ql||i.nodeType===cu||i.nodeType===Ma&&i.nodeValue===" react-mount-point-unstable "))}function LX(i){i.nodeType===mo&&i.tagName&&i.tagName.toUpperCase()==="BODY"&&l("createRoot(): Creating roots directly with document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try using a container element created for your app."),fh(i)&&(i._reactRootContainer?l("You are calling ReactDOMClient.createRoot() on a container that was previously passed to ReactDOM.render(). This is not supported."):l("You are calling ReactDOMClient.createRoot() on a container that has already been passed to createRoot() before. Instead, call root.render() on the existing root instead if you want to update it."))}var _z=t.ReactCurrentOwner,zX;zX=function(i){if(i._reactRootContainer&&i.nodeType!==Ma){var r=yX(i._reactRootContainer.current);r&&r.parentNode!==i&&l("render(...): It looks like the React-rendered content of this container was removed without using React. This is not supported and will cause errors. Instead, call ReactDOM.unmountComponentAtNode to empty a container.")}var I=!!i._reactRootContainer,h=UV(i),b=!!(h&&Zg(h));b&&!I&&l("render(...): Replacing React-rendered children with a new root component. If you intended to update the children of this node, you should instead have the existing children update their state and render the new components instead of calling ReactDOM.render."),i.nodeType===mo&&i.tagName&&i.tagName.toUpperCase()==="BODY"&&l("render(): Rendering components directly into document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try rendering into a container element created for your app.")};function UV(i){return i?i.nodeType===Ql?i.documentElement:i.firstChild:null}function _X(){}function Dz(i,r,I,h,b){if(b){if(typeof h=="function"){var S=h;h=function(){var me=IS(M);S.call(me)}}var M=bX(r,h,i,Rg,null,!1,!1,"",_X);i._reactRootContainer=M,Ah(M.current,i);var X=i.nodeType===Ma?i.parentNode:i;return $r(X),gI(),M}else{for(var Y;Y=i.lastChild;)i.removeChild(Y);if(typeof h=="function"){var P=h;h=function(){var me=IS(ee);P.call(me)}}var ee=mX(i,Rg,null,!1,!1,"",_X);i._reactRootContainer=ee,Ah(ee.current,i);var ve=i.nodeType===Ma?i.parentNode:i;return $r(ve),gI(function(){W0(r,ee,I,h)}),ee}}function kz(i,r){i!==null&&typeof i!="function"&&l("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",r,i)}function hS(i,r,I,h,b){zX(I),kz(b===void 0?null:b,"render");var S=I._reactRootContainer,M;if(!S)M=Dz(I,r,i,b,h);else{if(M=S,typeof b=="function"){var X=b;b=function(){var Y=IS(M);X.call(Y)}}W0(r,M,i,b)}return IS(M)}var DX=!1;function Uz(i){{DX||(DX=!0,l("findDOMNode is deprecated and will be removed in the next major release. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node"));var r=_z.current;if(r!==null&&r.stateNode!==null){var I=r.stateNode._warnedAboutRefsInRender;I||l("%s is accessing findDOMNode inside its render(). render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Pn(r.type)||"A component"),r.stateNode._warnedAboutRefsInRender=!0}}return i==null?null:i.nodeType===mo?i:Wz(i,"findDOMNode")}function Jz(i,r,I){if(l("ReactDOM.hydrate is no longer supported in React 18. Use hydrateRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!V0(r))throw new Error("Target container is not a DOM element.");{var h=fh(r)&&r._reactRootContainer===void 0;h&&l("You are calling ReactDOM.hydrate() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call hydrateRoot(container, element)?")}return hS(null,i,r,!0,I)}function Oz(i,r,I){if(l("ReactDOM.render is no longer supported in React 18. Use createRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!V0(r))throw new Error("Target container is not a DOM element.");{var h=fh(r)&&r._reactRootContainer===void 0;h&&l("You are calling ReactDOM.render() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.render(element)?")}return hS(null,i,r,!1,I)}function Pz(i,r,I,h){if(l("ReactDOM.unstable_renderSubtreeIntoContainer() is no longer supported in React 18. Consider using a portal instead. Until you switch to the createRoot API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!V0(I))throw new Error("Target container is not a DOM element.");if(i==null||!hu(i))throw new Error("parentComponent must be a valid React Component");return hS(i,r,I,!1,h)}var kX=!1;function Qz(i){if(kX||(kX=!0,l("unmountComponentAtNode is deprecated and will be removed in the next major release. Switch to the createRoot API. Learn more: https://reactjs.org/link/switch-to-createroot")),!V0(i))throw new Error("unmountComponentAtNode(...): Target container is not a DOM element.");{var r=fh(i)&&i._reactRootContainer===void 0;r&&l("You are calling ReactDOM.unmountComponentAtNode() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.unmount()?")}if(i._reactRootContainer){{var I=UV(i),h=I&&!Zg(I);h&&l("unmountComponentAtNode(): The node you're attempting to unmount was rendered by another copy of React.")}return gI(function(){hS(null,null,i,!1,function(){i._reactRootContainer=null,CZ(i)})}),!0}else{{var b=UV(i),S=!!(b&&Zg(b)),M=i.nodeType===mo&&V0(i.parentNode)&&!!i.parentNode._reactRootContainer;S&&l("unmountComponentAtNode(): The node you're attempting to unmount was rendered by React and is not a top-level container. %s",M?"You may have accidentally passed in a React root node instead of its container.":"Instead, have the parent component update its state and rerender in order to remove this component.")}return!1}}Yx(Vz),Tx(Mz),Av(Nz),Ex(Is),ad(uv),(typeof Map!="function"||Map.prototype==null||typeof Map.prototype.forEach!="function"||typeof Set!="function"||Set.prototype==null||typeof Set.prototype.clear!="function"||typeof Set.prototype.forEach!="function")&&l("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),gu(kB),Tb(GV,zL,gI);function jz(i,r){var I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!CS(r))throw new Error("Target container is not a DOM element.");return xz(i,r,null,I)}function qz(i,r,I,h){return Pz(i,r,I,h)}var JV={usingClientEntryPoint:!1,Events:[Zg,Oa,fs,bl,uu,GV]};function $z(i,r){return JV.usingClientEntryPoint||l('You are importing createRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),Kz(i,r)}function e5(i,r,I){return JV.usingClientEntryPoint||l('You are importing hydrateRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),zz(i,r,I)}function t5(i){return q2()&&l("flushSync was called from inside a lifecycle method. React cannot flush when React is already rendering. Consider moving this call to a scheduler task or micro task."),gI(i)}var n5=Ez({findFiberByHostInstance:_u,bundleType:1,version:KV,rendererPackageName:"react-dom"});if(!n5&&Pe&&window.top===window.self&&(navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Edge")===-1||navigator.userAgent.indexOf("Firefox")>-1)){var UX=window.location.protocol;/^(https?|file):$/.test(UX)&&console.info("%cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools"+(UX==="file:"?`
You might need to use a local HTTP server (instead of file://): https://reactjs.org/link/react-devtools-faq`:""),"font-weight:bold")}ul.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=JV,ul.createPortal=jz,ul.createRoot=$z,ul.findDOMNode=Uz,ul.flushSync=t5,ul.hydrate=Jz,ul.hydrateRoot=e5,ul.render=Oz,ul.unmountComponentAtNode=Qz,ul.unstable_batchedUpdates=GV,ul.unstable_renderSubtreeIntoContainer=qz,ul.version=KV,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})();ET.exports=ul;var c5=ET.exports,zN,JX=c5;{var OX=JX.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;zN=function(s,e){OX.usingClientEntryPoint=!0;try{return JX.createRoot(s,e)}finally{OX.usingClientEntryPoint=!1}}}const zT=Fe.createContext({dragDropManager:void 0});var _T={exports:{}},pR={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var s=Fe,e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),G=Symbol.iterator,w="@@iterator";function R(ne){if(ne===null||typeof ne!="object")return null;var Te=G&&ne[G]||ne[w];return typeof Te=="function"?Te:null}var Z=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function x(ne){{for(var Te=arguments.length,nt=new Array(Te>1?Te-1:0),Vt=1;Vt<Te;Vt++)nt[Vt-1]=arguments[Vt];W("error",ne,nt)}}function W(ne,Te,nt){{var Vt=Z.ReactDebugCurrentFrame,kt=Vt.getStackAddendum();kt!==""&&(Te+="%s",nt=nt.concat([kt]));var dn=nt.map(function(Ut){return String(Ut)});dn.unshift("Warning: "+Te),Function.prototype.apply.call(console[ne],console,dn)}}var N=!1,K=!1,T=!1,L=!1,k=!1,E;E=Symbol.for("react.module.reference");function F(ne){return!!(typeof ne=="string"||typeof ne=="function"||ne===n||ne===o||k||ne===a||ne===C||ne===A||L||ne===y||N||K||T||typeof ne=="object"&&ne!==null&&(ne.$$typeof===m||ne.$$typeof===p||ne.$$typeof===l||ne.$$typeof===u||ne.$$typeof===d||ne.$$typeof===E||ne.getModuleId!==void 0))}function U(ne,Te,nt){var Vt=ne.displayName;if(Vt)return Vt;var kt=Te.displayName||Te.name||"";return kt!==""?nt+"("+kt+")":nt}function le(ne){return ne.displayName||"Context"}function ie(ne){if(ne==null)return null;if(typeof ne.tag=="number"&&x("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof ne=="function")return ne.displayName||ne.name||null;if(typeof ne=="string")return ne;switch(ne){case n:return"Fragment";case t:return"Portal";case o:return"Profiler";case a:return"StrictMode";case C:return"Suspense";case A:return"SuspenseList"}if(typeof ne=="object")switch(ne.$$typeof){case u:var Te=ne;return le(Te)+".Consumer";case l:var nt=ne;return le(nt._context)+".Provider";case d:return U(ne,ne.render,"ForwardRef");case p:var Vt=ne.displayName||null;return Vt!==null?Vt:ie(ne.type)||"Memo";case m:{var kt=ne,dn=kt._payload,Ut=kt._init;try{return ie(Ut(dn))}catch{return null}}}return null}var Ce=Object.assign,Ge=0,ye,pe,de,Oe,We,ke,$e;function ot(){}ot.__reactDisabledLog=!0;function Ne(){{if(Ge===0){ye=console.log,pe=console.info,de=console.warn,Oe=console.error,We=console.group,ke=console.groupCollapsed,$e=console.groupEnd;var ne={configurable:!0,enumerable:!0,value:ot,writable:!0};Object.defineProperties(console,{info:ne,log:ne,warn:ne,error:ne,group:ne,groupCollapsed:ne,groupEnd:ne})}Ge++}}function tt(){{if(Ge--,Ge===0){var ne={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Ce({},ne,{value:ye}),info:Ce({},ne,{value:pe}),warn:Ce({},ne,{value:de}),error:Ce({},ne,{value:Oe}),group:Ce({},ne,{value:We}),groupCollapsed:Ce({},ne,{value:ke}),groupEnd:Ce({},ne,{value:$e})})}Ge<0&&x("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var bt=Z.ReactCurrentDispatcher,dt;function yt(ne,Te,nt){{if(dt===void 0)try{throw Error()}catch(kt){var Vt=kt.stack.trim().match(/\n( *(at )?)/);dt=Vt&&Vt[1]||""}return`
`+dt+ne}}var zt=!1,Nt;{var Lt=typeof WeakMap=="function"?WeakMap:Map;Nt=new Lt}function Ue(ne,Te){if(!ne||zt)return"";{var nt=Nt.get(ne);if(nt!==void 0)return nt}var Vt;zt=!0;var kt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var dn;dn=bt.current,bt.current=null,Ne();try{if(Te){var Ut=function(){throw Error()};if(Object.defineProperty(Ut.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ut,[])}catch(Dt){Vt=Dt}Reflect.construct(ne,[],Ut)}else{try{Ut.call()}catch(Dt){Vt=Dt}ne.call(Ut.prototype)}}else{try{throw Error()}catch(Dt){Vt=Dt}ne()}}catch(Dt){if(Dt&&Vt&&typeof Dt.stack=="string"){for(var D=Dt.stack.split(`
`),he=Vt.stack.split(`
`),Ze=D.length-1,Se=he.length-1;Ze>=1&&Se>=0&&D[Ze]!==he[Se];)Se--;for(;Ze>=1&&Se>=0;Ze--,Se--)if(D[Ze]!==he[Se]){if(Ze!==1||Se!==1)do if(Ze--,Se--,Se<0||D[Ze]!==he[Se]){var Ae=`
`+D[Ze].replace(" at new "," at ");return ne.displayName&&Ae.includes("<anonymous>")&&(Ae=Ae.replace("<anonymous>",ne.displayName)),typeof ne=="function"&&Nt.set(ne,Ae),Ae}while(Ze>=1&&Se>=0);break}}}finally{zt=!1,bt.current=dn,tt(),Error.prepareStackTrace=kt}var mt=ne?ne.displayName||ne.name:"",Wt=mt?yt(mt):"";return typeof ne=="function"&&Nt.set(ne,Wt),Wt}function Pe(ne,Te,nt){return Ue(ne,!1)}function te(ne){var Te=ne.prototype;return!!(Te&&Te.isReactComponent)}function Gt(ne,Te,nt){if(ne==null)return"";if(typeof ne=="function")return Ue(ne,te(ne));if(typeof ne=="string")return yt(ne);switch(ne){case C:return yt("Suspense");case A:return yt("SuspenseList")}if(typeof ne=="object")switch(ne.$$typeof){case d:return Pe(ne.render);case p:return Gt(ne.type,Te,nt);case m:{var Vt=ne,kt=Vt._payload,dn=Vt._init;try{return Gt(dn(kt),Te,nt)}catch{}}}return""}var Qe=Object.prototype.hasOwnProperty,ht={},Ct=Z.ReactDebugCurrentFrame;function Tt(ne){if(ne){var Te=ne._owner,nt=Gt(ne.type,ne._source,Te?Te.type:null);Ct.setExtraStackFrame(nt)}else Ct.setExtraStackFrame(null)}function Rt(ne,Te,nt,Vt,kt){{var dn=Function.call.bind(Qe);for(var Ut in ne)if(dn(ne,Ut)){var D=void 0;try{if(typeof ne[Ut]!="function"){var he=Error((Vt||"React class")+": "+nt+" type `"+Ut+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof ne[Ut]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw he.name="Invariant Violation",he}D=ne[Ut](Te,Ut,Vt,nt,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Ze){D=Ze}D&&!(D instanceof Error)&&(Tt(kt),x("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Vt||"React class",nt,Ut,typeof D),Tt(null)),D instanceof Error&&!(D.message in ht)&&(ht[D.message]=!0,Tt(kt),x("Failed %s type: %s",nt,D.message),Tt(null))}}}var $=Array.isArray;function J(ne){return $(ne)}function fe(ne){{var Te=typeof Symbol=="function"&&Symbol.toStringTag,nt=Te&&ne[Symbol.toStringTag]||ne.constructor.name||"Object";return nt}}function ze(ne){try{return et(ne),!1}catch{return!0}}function et(ne){return""+ne}function _e(ne){if(ze(ne))return x("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",fe(ne)),et(ne)}var At=Z.ReactCurrentOwner,Zt={key:!0,ref:!0,__self:!0,__source:!0},Xt,An,j;j={};function ue(ne){if(Qe.call(ne,"ref")){var Te=Object.getOwnPropertyDescriptor(ne,"ref").get;if(Te&&Te.isReactWarning)return!1}return ne.ref!==void 0}function Ve(ne){if(Qe.call(ne,"key")){var Te=Object.getOwnPropertyDescriptor(ne,"key").get;if(Te&&Te.isReactWarning)return!1}return ne.key!==void 0}function qe(ne,Te){if(typeof ne.ref=="string"&&At.current&&Te&&At.current.stateNode!==Te){var nt=ie(At.current.type);j[nt]||(x('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',ie(At.current.type),ne.ref),j[nt]=!0)}}function Me(ne,Te){{var nt=function(){Xt||(Xt=!0,x("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",Te))};nt.isReactWarning=!0,Object.defineProperty(ne,"key",{get:nt,configurable:!0})}}function se(ne,Te){{var nt=function(){An||(An=!0,x("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",Te))};nt.isReactWarning=!0,Object.defineProperty(ne,"ref",{get:nt,configurable:!0})}}var Re=function(ne,Te,nt,Vt,kt,dn,Ut){var D={$$typeof:e,type:ne,key:Te,ref:nt,props:Ut,_owner:dn};return D._store={},Object.defineProperty(D._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(D,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Vt}),Object.defineProperty(D,"_source",{configurable:!1,enumerable:!1,writable:!1,value:kt}),Object.freeze&&(Object.freeze(D.props),Object.freeze(D)),D};function De(ne,Te,nt,Vt,kt){{var dn,Ut={},D=null,he=null;nt!==void 0&&(_e(nt),D=""+nt),Ve(Te)&&(_e(Te.key),D=""+Te.key),ue(Te)&&(he=Te.ref,qe(Te,kt));for(dn in Te)Qe.call(Te,dn)&&!Zt.hasOwnProperty(dn)&&(Ut[dn]=Te[dn]);if(ne&&ne.defaultProps){var Ze=ne.defaultProps;for(dn in Ze)Ut[dn]===void 0&&(Ut[dn]=Ze[dn])}if(D||he){var Se=typeof ne=="function"?ne.displayName||ne.name||"Unknown":ne;D&&Me(Ut,Se),he&&se(Ut,Se)}return Re(ne,D,he,kt,Vt,At.current,Ut)}}var Q=Z.ReactCurrentOwner,st=Z.ReactDebugCurrentFrame;function be(ne){if(ne){var Te=ne._owner,nt=Gt(ne.type,ne._source,Te?Te.type:null);st.setExtraStackFrame(nt)}else st.setExtraStackFrame(null)}var Be;Be=!1;function Ft(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===e}function wt(){{if(Q.current){var ne=ie(Q.current.type);if(ne)return`

Check the render method of \``+ne+"`."}return""}}function ln(ne){return""}var Yn={};function un(ne){{var Te=wt();if(!Te){var nt=typeof ne=="string"?ne:ne.displayName||ne.name;nt&&(Te=`

Check the top-level render call using <`+nt+">.")}return Te}}function bn(ne,Te){{if(!ne._store||ne._store.validated||ne.key!=null)return;ne._store.validated=!0;var nt=un(Te);if(Yn[nt])return;Yn[nt]=!0;var Vt="";ne&&ne._owner&&ne._owner!==Q.current&&(Vt=" It was passed a child from "+ie(ne._owner.type)+"."),be(ne),x('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',nt,Vt),be(null)}}function ui(ne,Te){{if(typeof ne!="object")return;if(J(ne))for(var nt=0;nt<ne.length;nt++){var Vt=ne[nt];Ft(Vt)&&bn(Vt,Te)}else if(Ft(ne))ne._store&&(ne._store.validated=!0);else if(ne){var kt=R(ne);if(typeof kt=="function"&&kt!==ne.entries)for(var dn=kt.call(ne),Ut;!(Ut=dn.next()).done;)Ft(Ut.value)&&bn(Ut.value,Te)}}}function bi(ne){{var Te=ne.type;if(Te==null||typeof Te=="string")return;var nt;if(typeof Te=="function")nt=Te.propTypes;else if(typeof Te=="object"&&(Te.$$typeof===d||Te.$$typeof===p))nt=Te.propTypes;else return;if(nt){var Vt=ie(Te);Rt(nt,ne.props,"prop",Vt,ne)}else if(Te.PropTypes!==void 0&&!Be){Be=!0;var kt=ie(Te);x("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",kt||"Unknown")}typeof Te.getDefaultProps=="function"&&!Te.getDefaultProps.isReactClassApproved&&x("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function aa(ne){{for(var Te=Object.keys(ne.props),nt=0;nt<Te.length;nt++){var Vt=Te[nt];if(Vt!=="children"&&Vt!=="key"){be(ne),x("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Vt),be(null);break}}ne.ref!==null&&(be(ne),x("Invalid attribute `ref` supplied to `React.Fragment`."),be(null))}}var Ui={};function pa(ne,Te,nt,Vt,kt,dn){{var Ut=F(ne);if(!Ut){var D="";(ne===void 0||typeof ne=="object"&&ne!==null&&Object.keys(ne).length===0)&&(D+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var he=ln();he?D+=he:D+=wt();var Ze;ne===null?Ze="null":J(ne)?Ze="array":ne!==void 0&&ne.$$typeof===e?(Ze="<"+(ie(ne.type)||"Unknown")+" />",D=" Did you accidentally export a JSX literal instead of a component?"):Ze=typeof ne,x("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Ze,D)}var Se=De(ne,Te,nt,kt,dn);if(Se==null)return Se;if(Ut){var Ae=Te.children;if(Ae!==void 0)if(Vt)if(J(Ae)){for(var mt=0;mt<Ae.length;mt++)ui(Ae[mt],ne);Object.freeze&&Object.freeze(Ae)}else x("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ui(Ae,ne)}if(Qe.call(Te,"key")){var Wt=ie(ne),Dt=Object.keys(Te).filter(function(Rn){return Rn!=="key"}),Ot=Dt.length>0?"{key: someKey, "+Dt.join(": ..., ")+": ...}":"{key: someKey}";if(!Ui[Wt+Ot]){var Yt=Dt.length>0?"{"+Dt.join(": ..., ")+": ...}":"{}";x(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ot,Wt,Yt,Wt),Ui[Wt+Ot]=!0}}return ne===n?aa(Se):bi(Se),Se}}function ua(ne,Te,nt){return pa(ne,Te,nt,!0)}function ce(ne,Te,nt){return pa(ne,Te,nt,!1)}var pt=ce,Kt=ua;pR.Fragment=n,pR.jsx=pt,pR.jsxs=Kt})();_T.exports=pR;var Il=_T.exports,PX=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),PV=function(){return Math.random().toString(36).substring(7).split("").join(".")},QX={INIT:"@@redux/INIT"+PV(),REPLACE:"@@redux/REPLACE"+PV(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+PV()}};function g5(s){if(typeof s!="object"||s===null)return!1;for(var e=s;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(s)===e}function u5(s){if(s===void 0)return"undefined";if(s===null)return"null";var e=typeof s;switch(e){case"boolean":case"string":case"number":case"symbol":case"function":return e}if(Array.isArray(s))return"array";if(C5(s))return"date";if(d5(s))return"error";var t=I5(s);switch(t){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return t}return e.slice(8,-1).toLowerCase().replace(/\s/g,"")}function I5(s){return typeof s.constructor=="function"?s.constructor.name:null}function d5(s){return s instanceof Error||typeof s.message=="string"&&s.constructor&&typeof s.constructor.stackTraceLimit=="number"}function C5(s){return s instanceof Date?!0:typeof s.toDateString=="function"&&typeof s.getDate=="function"&&typeof s.setDate=="function"}function Rm(s){var e=typeof s;return e=u5(s),e}function DT(s,e,t){var n;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error("Expected the enhancer to be a function. Instead, received: '"+Rm(t)+"'");return t(DT)(s,e)}if(typeof s!="function")throw new Error("Expected the root reducer to be a function. Instead, received: '"+Rm(s)+"'");var a=s,o=e,l=[],u=l,d=!1;function C(){u===l&&(u=l.slice())}function A(){if(d)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return o}function p(w){if(typeof w!="function")throw new Error("Expected the listener to be a function. Instead, received: '"+Rm(w)+"'");if(d)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");var R=!0;return C(),u.push(w),function(){if(R){if(d)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");R=!1,C();var x=u.indexOf(w);u.splice(x,1),l=null}}}function m(w){if(!g5(w))throw new Error("Actions must be plain objects. Instead, the actual type was: '"+Rm(w)+"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.");if(typeof w.type>"u")throw new Error('Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(d)throw new Error("Reducers may not dispatch actions.");try{d=!0,o=a(o,w)}finally{d=!1}for(var R=l=u,Z=0;Z<R.length;Z++){var x=R[Z];x()}return w}function y(w){if(typeof w!="function")throw new Error("Expected the nextReducer to be a function. Instead, received: '"+Rm(w));a=w,m({type:QX.REPLACE})}function G(){var w,R=p;return w={subscribe:function(x){if(typeof x!="object"||x===null)throw new Error("Expected the observer to be an object. Instead, received: '"+Rm(x)+"'");function W(){x.next&&x.next(A())}W();var N=R(W);return{unsubscribe:N}}},w[PX]=function(){return this},w}return m({type:QX.INIT}),n={dispatch:m,subscribe:p,getState:A,replaceReducer:y},n[PX]=G,n}function Jn(s,e,...t){if(h5()&&e===void 0)throw new Error("invariant requires an error message argument");if(!s){let n;if(e===void 0)n=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let a=0;n=new Error(e.replace(/%s/g,function(){return t[a++]})),n.name="Invariant Violation"}throw n.framesToPop=1,n}}function h5(){return typeof process<"u"&&!1}function A5(s,e,t){return e.split(".").reduce((n,a)=>n&&n[a]?n[a]:t||null,s)}function f5(s,e){return s.filter(t=>t!==e)}function kT(s){return typeof s=="object"}function p5(s,e){const t=new Map,n=o=>{t.set(o,t.has(o)?t.get(o)+1:1)};s.forEach(n),e.forEach(n);const a=[];return t.forEach((o,l)=>{o===1&&a.push(l)}),a}function m5(s,e){return s.filter(t=>e.indexOf(t)>-1)}const _N="dnd-core/INIT_COORDS",dw="dnd-core/BEGIN_DRAG",DN="dnd-core/PUBLISH_DRAG_SOURCE",Cw="dnd-core/HOVER",hw="dnd-core/DROP",Aw="dnd-core/END_DRAG";function jX(s,e){return{type:_N,payload:{sourceClientOffset:e||null,clientOffset:s||null}}}const b5={type:_N,payload:{clientOffset:null,sourceClientOffset:null}};function v5(s){return function(t=[],n={publishSource:!0}){const{publishSource:a=!0,clientOffset:o,getSourceClientOffset:l}=n,u=s.getMonitor(),d=s.getRegistry();s.dispatch(jX(o)),y5(t,u,d);const C=Z5(t,u);if(C==null){s.dispatch(b5);return}let A=null;if(o){if(!l)throw new Error("getSourceClientOffset must be defined");G5(l),A=l(C)}s.dispatch(jX(o,A));const m=d.getSource(C).beginDrag(u,C);if(m==null)return;B5(m),d.pinSource(C);const y=d.getSourceType(C);return{type:dw,payload:{itemType:y,item:m,sourceId:C,clientOffset:o||null,sourceClientOffset:A||null,isSourcePublic:!!a}}}}function y5(s,e,t){Jn(!e.isDragging(),"Cannot call beginDrag while dragging."),s.forEach(function(n){Jn(t.getSource(n),"Expected sourceIds to be registered.")})}function G5(s){Jn(typeof s=="function","When clientOffset is provided, getSourceClientOffset must be a function.")}function B5(s){Jn(kT(s),"Item must be an object.")}function Z5(s,e){let t=null;for(let n=s.length-1;n>=0;n--)if(e.canDragSource(s[n])){t=s[n];break}return t}function S5(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function R5(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),n.forEach(function(a){S5(s,a,t[a])})}return s}function w5(s){return function(t={}){const n=s.getMonitor(),a=s.getRegistry();x5(n),M5(n).forEach((l,u)=>{const d=W5(l,u,a,n),C={type:hw,payload:{dropResult:R5({},t,d)}};s.dispatch(C)})}}function x5(s){Jn(s.isDragging(),"Cannot call drop while not dragging."),Jn(!s.didDrop(),"Cannot call drop twice during one drag operation.")}function W5(s,e,t,n){const a=t.getTarget(s);let o=a?a.drop(n,s):void 0;return V5(o),typeof o>"u"&&(o=e===0?{}:n.getDropResult()),o}function V5(s){Jn(typeof s>"u"||kT(s),"Drop result must either be an object or undefined.")}function M5(s){const e=s.getTargetIds().filter(s.canDropOnTarget,s);return e.reverse(),e}function N5(s){return function(){const t=s.getMonitor(),n=s.getRegistry();H5(t);const a=t.getSourceId();return a!=null&&(n.getSource(a,!0).endDrag(t,a),n.unpinSource()),{type:Aw}}}function H5(s){Jn(s.isDragging(),"Cannot call endDrag while not dragging.")}function gN(s,e){return e===null?s===null:Array.isArray(s)?s.some(t=>t===e):s===e}function X5(s){return function(t,{clientOffset:n}={}){F5(t);const a=t.slice(0),o=s.getMonitor(),l=s.getRegistry(),u=o.getItemType();return T5(a,l,u),Y5(a,o,l),E5(a,o,l),{type:Cw,payload:{targetIds:a,clientOffset:n||null}}}}function F5(s){Jn(Array.isArray(s),"Expected targetIds to be an array.")}function Y5(s,e,t){Jn(e.isDragging(),"Cannot call hover while not dragging."),Jn(!e.didDrop(),"Cannot call hover after drop.");for(let n=0;n<s.length;n++){const a=s[n];Jn(s.lastIndexOf(a)===n,"Expected targetIds to be unique in the passed array.");const o=t.getTarget(a);Jn(o,"Expected targetIds to be registered.")}}function T5(s,e,t){for(let n=s.length-1;n>=0;n--){const a=s[n],o=e.getTargetType(a);gN(o,t)||s.splice(n,1)}}function E5(s,e,t){s.forEach(function(n){t.getTarget(n).hover(e,n)})}function K5(s){return function(){if(s.getMonitor().isDragging())return{type:DN}}}function L5(s){return{beginDrag:v5(s),publishDragSource:K5(s),hover:X5(s),drop:w5(s),endDrag:N5(s)}}class z5{receiveBackend(e){this.backend=e}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){const e=this,{dispatch:t}=this.store;function n(o){return(...l)=>{const u=o.apply(e,l);typeof u<"u"&&t(u)}}const a=L5(this);return Object.keys(a).reduce((o,l)=>{const u=a[l];return o[l]=n(u),o},{})}dispatch(e){this.store.dispatch(e)}constructor(e,t){this.isSetUp=!1,this.handleRefCountChange=()=>{const n=this.store.getState().refCount>0;this.backend&&(n&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!n&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=e,this.monitor=t,e.subscribe(this.handleRefCountChange)}}function _5(s,e){return{x:s.x+e.x,y:s.y+e.y}}function UT(s,e){return{x:s.x-e.x,y:s.y-e.y}}function D5(s){const{clientOffset:e,initialClientOffset:t,initialSourceClientOffset:n}=s;return!e||!t||!n?null:UT(_5(e,n),t)}function k5(s){const{clientOffset:e,initialClientOffset:t}=s;return!e||!t?null:UT(e,t)}const tG=[],kN=[];tG.__IS_NONE__=!0;kN.__IS_ALL__=!0;function U5(s,e){return s===tG?!1:s===kN||typeof e>"u"?!0:m5(e,s).length>0}class J5{subscribeToStateChange(e,t={}){const{handlerIds:n}=t;Jn(typeof e=="function","listener must be a function."),Jn(typeof n>"u"||Array.isArray(n),"handlerIds, when specified, must be an array of strings.");let a=this.store.getState().stateId;const o=()=>{const l=this.store.getState(),u=l.stateId;try{u===a||u===a+1&&!U5(l.dirtyHandlerIds,n)||e()}finally{a=u}};return this.store.subscribe(o)}subscribeToOffsetChange(e){Jn(typeof e=="function","listener must be a function.");let t=this.store.getState().dragOffset;const n=()=>{const a=this.store.getState().dragOffset;a!==t&&(t=a,e())};return this.store.subscribe(n)}canDragSource(e){if(!e)return!1;const t=this.registry.getSource(e);return Jn(t,`Expected to find a valid source. sourceId=${e}`),this.isDragging()?!1:t.canDrag(this,e)}canDropOnTarget(e){if(!e)return!1;const t=this.registry.getTarget(e);if(Jn(t,`Expected to find a valid target. targetId=${e}`),!this.isDragging()||this.didDrop())return!1;const n=this.registry.getTargetType(e),a=this.getItemType();return gN(n,a)&&t.canDrop(this,e)}isDragging(){return!!this.getItemType()}isDraggingSource(e){if(!e)return!1;const t=this.registry.getSource(e,!0);if(Jn(t,`Expected to find a valid source. sourceId=${e}`),!this.isDragging()||!this.isSourcePublic())return!1;const n=this.registry.getSourceType(e),a=this.getItemType();return n!==a?!1:t.isDragging(this,e)}isOverTarget(e,t={shallow:!1}){if(!e)return!1;const{shallow:n}=t;if(!this.isDragging())return!1;const a=this.registry.getTargetType(e),o=this.getItemType();if(o&&!gN(a,o))return!1;const l=this.getTargetIds();if(!l.length)return!1;const u=l.indexOf(e);return n?u===l.length-1:u>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return!!this.store.getState().dragOperation.isSourcePublic}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return D5(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return k5(this.store.getState().dragOffset)}constructor(e,t){this.store=e,this.registry=t}}const qX=typeof global<"u"?global:self,JT=qX.MutationObserver||qX.WebKitMutationObserver;function OT(s){return function(){const t=setTimeout(a,0),n=setInterval(a,50);function a(){clearTimeout(t),clearInterval(n),s()}}}function O5(s){let e=1;const t=new JT(s),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){e=-e,n.data=e}}const P5=typeof JT=="function"?O5:OT;class Q5{enqueueTask(e){const{queue:t,requestFlush:n}=this;t.length||(n(),this.flushing=!0),t[t.length]=e}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{const{queue:e}=this;for(;this.index<e.length;){const t=this.index;if(this.index++,e[t].call(),this.index>this.capacity){for(let n=0,a=e.length-this.index;n<a;n++)e[n]=e[n+this.index];e.length-=this.index,this.index=0}}e.length=0,this.index=0,this.flushing=!1},this.registerPendingError=e=>{this.pendingErrors.push(e),this.requestErrorThrow()},this.requestFlush=P5(this.flush),this.requestErrorThrow=OT(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}}class j5{call(){try{this.task&&this.task()}catch(e){this.onError(e)}finally{this.task=null,this.release(this)}}constructor(e,t){this.onError=e,this.release=t,this.task=null}}class q5{create(e){const t=this.freeTasks,n=t.length?t.pop():new j5(this.onError,a=>t[t.length]=a);return n.task=e,n}constructor(e){this.onError=e,this.freeTasks=[]}}const PT=new Q5,$5=new q5(PT.registerPendingError);function e_(s){PT.enqueueTask($5.create(s))}const UN="dnd-core/ADD_SOURCE",JN="dnd-core/ADD_TARGET",ON="dnd-core/REMOVE_SOURCE",fw="dnd-core/REMOVE_TARGET";function t_(s){return{type:UN,payload:{sourceId:s}}}function n_(s){return{type:JN,payload:{targetId:s}}}function i_(s){return{type:ON,payload:{sourceId:s}}}function a_(s){return{type:fw,payload:{targetId:s}}}function r_(s){Jn(typeof s.canDrag=="function","Expected canDrag to be a function."),Jn(typeof s.beginDrag=="function","Expected beginDrag to be a function."),Jn(typeof s.endDrag=="function","Expected endDrag to be a function.")}function o_(s){Jn(typeof s.canDrop=="function","Expected canDrop to be a function."),Jn(typeof s.hover=="function","Expected hover to be a function."),Jn(typeof s.drop=="function","Expected beginDrag to be a function.")}function uN(s,e){if(e&&Array.isArray(s)){s.forEach(t=>uN(t,!1));return}Jn(typeof s=="string"||typeof s=="symbol",e?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}var El;(function(s){s.SOURCE="SOURCE",s.TARGET="TARGET"})(El||(El={}));let s_=0;function l_(){return s_++}function c_(s){const e=l_().toString();switch(s){case El.SOURCE:return`S${e}`;case El.TARGET:return`T${e}`;default:throw new Error(`Unknown Handler Role: ${s}`)}}function $X(s){switch(s[0]){case"S":return El.SOURCE;case"T":return El.TARGET;default:throw new Error(`Cannot parse handler ID: ${s}`)}}function eF(s,e){const t=s.entries();let n=!1;do{const{done:a,value:[,o]}=t.next();if(o===e)return!0;n=!!a}while(!n);return!1}class g_{addSource(e,t){uN(e),r_(t);const n=this.addHandler(El.SOURCE,e,t);return this.store.dispatch(t_(n)),n}addTarget(e,t){uN(e,!0),o_(t);const n=this.addHandler(El.TARGET,e,t);return this.store.dispatch(n_(n)),n}containsHandler(e){return eF(this.dragSources,e)||eF(this.dropTargets,e)}getSource(e,t=!1){return Jn(this.isSourceId(e),"Expected a valid source ID."),t&&e===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(e)}getTarget(e){return Jn(this.isTargetId(e),"Expected a valid target ID."),this.dropTargets.get(e)}getSourceType(e){return Jn(this.isSourceId(e),"Expected a valid source ID."),this.types.get(e)}getTargetType(e){return Jn(this.isTargetId(e),"Expected a valid target ID."),this.types.get(e)}isSourceId(e){return $X(e)===El.SOURCE}isTargetId(e){return $X(e)===El.TARGET}removeSource(e){Jn(this.getSource(e),"Expected an existing source."),this.store.dispatch(i_(e)),e_(()=>{this.dragSources.delete(e),this.types.delete(e)})}removeTarget(e){Jn(this.getTarget(e),"Expected an existing target."),this.store.dispatch(a_(e)),this.dropTargets.delete(e),this.types.delete(e)}pinSource(e){const t=this.getSource(e);Jn(t,"Expected an existing source."),this.pinnedSourceId=e,this.pinnedSource=t}unpinSource(){Jn(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(e,t,n){const a=c_(e);return this.types.set(a,t),e===El.SOURCE?this.dragSources.set(a,n):e===El.TARGET&&this.dropTargets.set(a,n),a}constructor(e){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=e}}const u_=(s,e)=>s===e;function I_(s,e){return!s&&!e?!0:!s||!e?!1:s.x===e.x&&s.y===e.y}function d_(s,e,t=u_){if(s.length!==e.length)return!1;for(let n=0;n<s.length;++n)if(!t(s[n],e[n]))return!1;return!0}function C_(s=tG,e){switch(e.type){case Cw:break;case UN:case JN:case fw:case ON:return tG;case dw:case DN:case Aw:case hw:default:return kN}const{targetIds:t=[],prevTargetIds:n=[]}=e.payload,a=p5(t,n);if(!(a.length>0||!d_(t,n)))return tG;const l=n[n.length-1],u=t[t.length-1];return l!==u&&(l&&a.push(l),u&&a.push(u)),a}function h_(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function A_(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),n.forEach(function(a){h_(s,a,t[a])})}return s}const tF={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function f_(s=tF,e){const{payload:t}=e;switch(e.type){case _N:case dw:return{initialSourceClientOffset:t.sourceClientOffset,initialClientOffset:t.clientOffset,clientOffset:t.clientOffset};case Cw:return I_(s.clientOffset,t.clientOffset)?s:A_({},s,{clientOffset:t.clientOffset});case Aw:case hw:return tF;default:return s}}function p_(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function wm(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),n.forEach(function(a){p_(s,a,t[a])})}return s}const m_={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function b_(s=m_,e){const{payload:t}=e;switch(e.type){case dw:return wm({},s,{itemType:t.itemType,item:t.item,sourceId:t.sourceId,isSourcePublic:t.isSourcePublic,dropResult:null,didDrop:!1});case DN:return wm({},s,{isSourcePublic:!0});case Cw:return wm({},s,{targetIds:t.targetIds});case fw:return s.targetIds.indexOf(t.targetId)===-1?s:wm({},s,{targetIds:f5(s.targetIds,t.targetId)});case hw:return wm({},s,{dropResult:t.dropResult,didDrop:!0,targetIds:[]});case Aw:return wm({},s,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return s}}function v_(s=0,e){switch(e.type){case UN:case JN:return s+1;case ON:case fw:return s-1;default:return s}}function y_(s=0){return s+1}function G_(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function B_(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),n.forEach(function(a){G_(s,a,t[a])})}return s}function Z_(s={},e){return{dirtyHandlerIds:C_(s.dirtyHandlerIds,{type:e.type,payload:B_({},e.payload,{prevTargetIds:A5(s,"dragOperation.targetIds",[])})}),dragOffset:f_(s.dragOffset,e),refCount:v_(s.refCount,e),dragOperation:b_(s.dragOperation,e),stateId:y_(s.stateId)}}function S_(s,e=void 0,t={},n=!1){const a=R_(n),o=new J5(a,new g_(a)),l=new z5(a,o),u=s(l,e,t);return l.receiveBackend(u),l}function R_(s){const e=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__;return DT(Z_,s&&e&&e({name:"dnd-core",instanceId:"dnd-core"}))}function w_(s,e){if(s==null)return{};var t=x_(s,e),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);for(a=0;a<o.length;a++)n=o[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(s,n)&&(t[n]=s[n])}return t}function x_(s,e){if(s==null)return{};var t={},n=Object.keys(s),a,o;for(o=0;o<n.length;o++)a=n[o],!(e.indexOf(a)>=0)&&(t[a]=s[a]);return t}let nF=0;const mR=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var W_=Fe.memo(function(e){var{children:t}=e,n=w_(e,["children"]);const[a,o]=V_(n);return Fe.useEffect(()=>{if(o){const l=QT();return++nF,()=>{--nF===0&&(l[mR]=null)}}},[]),Il.jsx(zT.Provider,{value:a,children:t})});function V_(s){if("manager"in s)return[{dragDropManager:s.manager},!1];const e=M_(s.backend,s.context,s.options,s.debugMode),t=!s.context;return[e,t]}function M_(s,e=QT(),t,n){const a=e;return a[mR]||(a[mR]={dragDropManager:S_(s,e,t,n)}),a[mR]}function QT(){return typeof global<"u"?global:window}var N_=function s(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,a,o;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(a=n;a--!==0;)if(!s(e[a],t[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[a]))return!1;for(a=n;a--!==0;){var l=o[a];if(!s(e[l],t[l]))return!1}return!0}return e!==e&&t!==t};const H_=KN(N_),zA=typeof window<"u"?Fe.useLayoutEffect:Fe.useEffect;function X_(s,e,t){const[n,a]=Fe.useState(()=>e(s)),o=Fe.useCallback(()=>{const l=e(s);H_(n,l)||(a(l),t&&t())},[n,s,t]);return zA(o),[n,o]}function F_(s,e,t){const[n,a]=X_(s,e,t);return zA(function(){const l=s.getHandlerId();if(l!=null)return s.subscribeToStateChange(a,{handlerIds:[l]})},[s,a]),n}function jT(s,e,t){return F_(e,s||(()=>({})),()=>t.reconnect())}function qT(s,e){const t=[...e||[]];return e==null&&typeof s!="function"&&t.push(s),Fe.useMemo(()=>typeof s=="function"?s():s,t)}function Y_(s){return Fe.useMemo(()=>s.hooks.dragSource(),[s])}function T_(s){return Fe.useMemo(()=>s.hooks.dragPreview(),[s])}let QV=!1,jV=!1;class E_{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){Jn(!QV,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return QV=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{QV=!1}}isDragging(){if(!this.sourceId)return!1;Jn(!jV,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return jV=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{jV=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}let qV=!1;class K_{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;Jn(!qV,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return qV=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{qV=!1}}isOver(e){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,e):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}function L_(s,e,t){const n=t.getRegistry(),a=n.addTarget(s,e);return[a,()=>n.removeTarget(a)]}function z_(s,e,t){const n=t.getRegistry(),a=n.addSource(s,e);return[a,()=>n.removeSource(a)]}function IN(s,e,t,n){let a;if(a!==void 0)return!!a;if(s===e)return!0;if(typeof s!="object"||!s||typeof e!="object"||!e)return!1;const o=Object.keys(s),l=Object.keys(e);if(o.length!==l.length)return!1;const u=Object.prototype.hasOwnProperty.bind(e);for(let d=0;d<o.length;d++){const C=o[d];if(!u(C))return!1;const A=s[C],p=e[C];if(a=void 0,a===!1||a===void 0&&A!==p)return!1}return!0}function dN(s){return s!==null&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,"current")}function __(s){if(typeof s.type=="string")return;const e=s.type.displayName||s.type.name||"the component";throw new Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${e} into a <div>, or turn it into a drag source or a drop target itself.`)}function D_(s){return(e=null,t=null)=>{if(!Fe.isValidElement(e)){const o=e;return s(o,t),o}const n=e;return __(n),k_(n,t?o=>s(o,t):s)}}function $T(s){const e={};return Object.keys(s).forEach(t=>{const n=s[t];if(t.endsWith("Ref"))e[t]=s[t];else{const a=D_(n);e[t]=()=>a}}),e}function iF(s,e){typeof s=="function"?s(e):s.current=e}function k_(s,e){const t=s.ref;return Jn(typeof t!="string","Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),t?Fe.cloneElement(s,{ref:n=>{iF(t,n),iF(e,n)}}):Fe.cloneElement(s,{ref:e})}class U_{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(e=!1){const t=this.dragPreview,n=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(n&&this.disconnectDragPreview(),!!this.handlerId){if(!t){this.lastConnectedDragPreview=t;return}n&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!IN(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!IN(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=$T({dragSource:(t,n)=>{this.clearDragSource(),this.dragSourceOptions=n||null,dN(t)?this.dragSourceRef=t:this.dragSourceNode=t,this.reconnectDragSource()},dragPreview:(t,n)=>{this.clearDragPreview(),this.dragPreviewOptions=n||null,dN(t)?this.dragPreviewRef=t:this.dragPreviewNode=t,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}class J_{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;if(this.handlerId){if(!t){this.lastConnectedDropTarget=t;return}e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions))}}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!IN(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=$T({dropTarget:(t,n)=>{this.clearDropTarget(),this.dropTargetOptions=n,dN(t)?this.dropTargetRef=t:this.dropTargetNode=t,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function db(){const{dragDropManager:s}=Fe.useContext(zT);return Jn(s!=null,"Expected drag drop context"),s}function O_(s,e){const t=db(),n=Fe.useMemo(()=>new U_(t.getBackend()),[t]);return zA(()=>(n.dragSourceOptions=s||null,n.reconnect(),()=>n.disconnectDragSource()),[n,s]),zA(()=>(n.dragPreviewOptions=e||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,e]),n}function P_(){const s=db();return Fe.useMemo(()=>new E_(s),[s])}class Q_{beginDrag(){const e=this.spec,t=this.monitor;let n=null;return typeof e.item=="object"?n=e.item:typeof e.item=="function"?n=e.item(t):n={},n??null}canDrag(){const e=this.spec,t=this.monitor;return typeof e.canDrag=="boolean"?e.canDrag:typeof e.canDrag=="function"?e.canDrag(t):!0}isDragging(e,t){const n=this.spec,a=this.monitor,{isDragging:o}=n;return o?o(a):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,n=this.connector,{end:a}=e;a&&a(t.getItem(),t),n.reconnect()}constructor(e,t,n){this.spec=e,this.monitor=t,this.connector=n}}function j_(s,e,t){const n=Fe.useMemo(()=>new Q_(s,e,t),[e,t]);return Fe.useEffect(()=>{n.spec=s},[s]),n}function q_(s){return Fe.useMemo(()=>{const e=s.type;return Jn(e!=null,"spec.type must be defined"),e},[s])}function $_(s,e,t){const n=db(),a=j_(s,e,t),o=q_(s);zA(function(){if(o!=null){const[u,d]=z_(o,a,n);return e.receiveHandlerId(u),t.receiveHandlerId(u),d}},[n,e,t,a,o])}function PN(s,e){const t=qT(s,e);Jn(!t.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const n=P_(),a=O_(t.options,t.previewOptions);return $_(t,n,a),[jT(t.collect,n,a),Y_(a),T_(a)]}function e3(s){return Fe.useMemo(()=>s.hooks.dropTarget(),[s])}function t3(s){const e=db(),t=Fe.useMemo(()=>new J_(e.getBackend()),[e]);return zA(()=>(t.dropTargetOptions=s||null,t.reconnect(),()=>t.disconnectDropTarget()),[s]),t}function n3(){const s=db();return Fe.useMemo(()=>new K_(s),[s])}function i3(s){const{accept:e}=s;return Fe.useMemo(()=>(Jn(s.accept!=null,"accept must be defined"),Array.isArray(e)?e:[e]),[e])}class a3{canDrop(){const e=this.spec,t=this.monitor;return e.canDrop?e.canDrop(t.getItem(),t):!0}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function r3(s,e){const t=Fe.useMemo(()=>new a3(s,e),[e]);return Fe.useEffect(()=>{t.spec=s},[s]),t}function o3(s,e,t){const n=db(),a=r3(s,e),o=i3(s);zA(function(){const[u,d]=L_(o,a,n);return e.receiveHandlerId(u),t.receiveHandlerId(u),d},[n,e,a,t,o.map(l=>l.toString()).join("|")])}function pw(s,e){const t=qT(s,e),n=n3(),a=t3(t.options);return o3(t,n,a),[jT(t.collect,n,a),e3(a)]}function eE(s){let e=null;return()=>(e==null&&(e=s()),e)}function s3(s,e){return s.filter(t=>t!==e)}function l3(s,e){const t=new Set,n=o=>t.add(o);s.forEach(n),e.forEach(n);const a=[];return t.forEach(o=>a.push(o)),a}class c3{enter(e){const t=this.entered.length,n=a=>this.isNodeInDocument(a)&&(!a.contains||a.contains(e));return this.entered=l3(this.entered.filter(n),[e]),t===0&&this.entered.length>0}leave(e){const t=this.entered.length;return this.entered=s3(this.entered.filter(this.isNodeInDocument),e),t>0&&this.entered.length===0}reset(){this.entered=[]}constructor(e){this.entered=[],this.isNodeInDocument=e}}class g3{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(e=>{Object.defineProperty(this.item,e,{configurable:!0,enumerable:!0,get(){return console.warn(`Browser doesn't allow reading "${e}" until the drop event.`),null}})})}loadDataTransfer(e){if(e){const t={};Object.keys(this.config.exposeProperties).forEach(n=>{const a=this.config.exposeProperties[n];a!=null&&(t[n]={value:a(e,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,t)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(e,t){return t===e.getSourceId()}endDrag(){}constructor(e){this.config=e,this.item={},this.initializeExposedProperties()}}const tE="__NATIVE_FILE__",nE="__NATIVE_URL__",iE="__NATIVE_TEXT__",aE="__NATIVE_HTML__",aF=Object.freeze(Object.defineProperty({__proto__:null,FILE:tE,HTML:aE,TEXT:iE,URL:nE},Symbol.toStringTag,{value:"Module"}));function $V(s,e,t){const n=e.reduce((a,o)=>a||s.getData(o),"");return n??t}const CN={[tE]:{exposeProperties:{files:s=>Array.prototype.slice.call(s.files),items:s=>s.items,dataTransfer:s=>s},matchesTypes:["Files"]},[aE]:{exposeProperties:{html:(s,e)=>$V(s,e,""),dataTransfer:s=>s},matchesTypes:["Html","text/html"]},[nE]:{exposeProperties:{urls:(s,e)=>$V(s,e,"").split(`
`),dataTransfer:s=>s},matchesTypes:["Url","text/uri-list"]},[iE]:{exposeProperties:{text:(s,e)=>$V(s,e,""),dataTransfer:s=>s},matchesTypes:["Text","text/plain"]}};function u3(s,e){const t=CN[s];if(!t)throw new Error(`native type ${s} has no configuration`);const n=new g3(t);return n.loadDataTransfer(e),n}function eM(s){if(!s)return null;const e=Array.prototype.slice.call(s.types||[]);return Object.keys(CN).filter(t=>{const n=CN[t];return n!=null&&n.matchesTypes?n.matchesTypes.some(a=>e.indexOf(a)>-1):!1})[0]||null}const I3=eE(()=>/firefox/i.test(navigator.userAgent)),rE=eE(()=>!!window.safari);class rF{interpolate(e){const{xs:t,ys:n,c1s:a,c2s:o,c3s:l}=this;let u=t.length-1;if(e===t[u])return n[u];let d=0,C=l.length-1,A;for(;d<=C;){A=Math.floor(.5*(d+C));const y=t[A];if(y<e)d=A+1;else if(y>e)C=A-1;else return n[A]}u=Math.max(0,C);const p=e-t[u],m=p*p;return n[u]+a[u]*p+o[u]*m+l[u]*p*m}constructor(e,t){const{length:n}=e,a=[];for(let y=0;y<n;y++)a.push(y);a.sort((y,G)=>e[y]<e[G]?-1:1);const o=[],l=[];let u,d;for(let y=0;y<n-1;y++)u=e[y+1]-e[y],d=t[y+1]-t[y],o.push(u),l.push(d/u);const C=[l[0]];for(let y=0;y<o.length-1;y++){const G=l[y],w=l[y+1];if(G*w<=0)C.push(0);else{u=o[y];const R=o[y+1],Z=u+R;C.push(3*Z/((Z+R)/G+(Z+u)/w))}}C.push(l[l.length-1]);const A=[],p=[];let m;for(let y=0;y<C.length-1;y++){m=l[y];const G=C[y],w=1/o[y],R=G+C[y+1]-m-m;A.push((m-G-R)*w),p.push(R*w*w)}this.xs=e,this.ys=t,this.c1s=C,this.c2s=A,this.c3s=p}}const d3=1;function oE(s){const e=s.nodeType===d3?s:s.parentElement;if(!e)return null;const{top:t,left:n}=e.getBoundingClientRect();return{x:n,y:t}}function AS(s){return{x:s.clientX,y:s.clientY}}function C3(s){var e;return s.nodeName==="IMG"&&(I3()||!(!((e=document.documentElement)===null||e===void 0)&&e.contains(s)))}function h3(s,e,t,n){let a=s?e.width:t,o=s?e.height:n;return rE()&&s&&(o/=window.devicePixelRatio,a/=window.devicePixelRatio),{dragPreviewWidth:a,dragPreviewHeight:o}}function A3(s,e,t,n,a){const o=C3(e),u=oE(o?s:e),d={x:t.x-u.x,y:t.y-u.y},{offsetWidth:C,offsetHeight:A}=s,{anchorX:p,anchorY:m}=n,{dragPreviewWidth:y,dragPreviewHeight:G}=h3(o,e,C,A),w=()=>{let T=new rF([0,.5,1],[d.y,d.y/A*G,d.y+G-A]).interpolate(m);return rE()&&o&&(T+=(window.devicePixelRatio-1)*G),T},R=()=>new rF([0,.5,1],[d.x,d.x/C*y,d.x+y-C]).interpolate(p),{offsetX:Z,offsetY:x}=a,W=Z===0||Z,N=x===0||x;return{x:W?Z:R(),y:N?x:w()}}class f3{get window(){if(this.globalContext)return this.globalContext;if(typeof window<"u")return window}get document(){var e;return!((e=this.globalContext)===null||e===void 0)&&e.document?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var e;return((e=this.optionsArgs)===null||e===void 0?void 0:e.rootElement)||this.window}constructor(e,t){this.ownerDocument=null,this.globalContext=e,this.optionsArgs=t}}function p3(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function oF(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),n.forEach(function(a){p3(s,a,t[a])})}return s}class m3{profile(){var e,t;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:((e=this.dragStartSourceIds)===null||e===void 0?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:((t=this.dragOverTargetIds)===null||t===void 0?void 0:t.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){const e=this.rootElement;if(e!==void 0){if(e.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}teardown(){const e=this.rootElement;if(e!==void 0&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId)){var t;(t=this.window)===null||t===void 0||t.cancelAnimationFrame(this.asyncEndDragFrameId)}}connectDragPreview(e,t,n){return this.sourcePreviewNodeOptions.set(e,n),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDragSource(e,t,n){this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,n);const a=l=>this.handleDragStart(l,e),o=l=>this.handleSelectStart(l);return t.setAttribute("draggable","true"),t.addEventListener("dragstart",a),t.addEventListener("selectstart",o),()=>{this.sourceNodes.delete(e),this.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",a),t.removeEventListener("selectstart",o),t.setAttribute("draggable","false")}}connectDropTarget(e,t){const n=l=>this.handleDragEnter(l,e),a=l=>this.handleDragOver(l,e),o=l=>this.handleDrop(l,e);return t.addEventListener("dragenter",n),t.addEventListener("dragover",a),t.addEventListener("drop",o),()=>{t.removeEventListener("dragenter",n),t.removeEventListener("dragover",a),t.removeEventListener("drop",o)}}addEventListeners(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return oF({dropEffect:this.altKeyPressed?"copy":"move"},t||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourcePreviewNodeOptions.get(e);return oF({anchorX:.5,anchorY:.5,captureDraggingState:!1},t||{})}isDraggingNativeItem(){const e=this.monitor.getItemType();return Object.keys(aF).some(t=>aF[t]===e)}beginDragNativeItem(e,t){this.clearCurrentDragSourceNode(),this.currentNativeSource=u3(e,t),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(e){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;const t=1e3;this.mouseMoveTimeoutTimer=setTimeout(()=>{var n;return(n=this.rootElement)===null||n===void 0?void 0:n.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},t)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){if(this.currentDragSourceNode=null,this.rootElement){var e;(e=this.window)===null||e===void 0||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)}return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(e,t){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t))}handleDragEnter(e,t){this.dragEnterTargetIds.unshift(t)}handleDragOver(e,t){this.dragOverTargetIds===null&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)}handleDrop(e,t){this.dropTargetIds.unshift(t)}constructor(e,t,n){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=a=>{const o=this.sourceNodes.get(a);return o&&oE(o)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=a=>!!(a&&this.document&&this.document.body&&this.document.body.contains(a)),this.endDragIfSourceWasRemovedFromDOM=()=>{const a=this.currentDragSourceNode;a==null||this.isNodeInDocument(a)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=a=>{this.hoverRafId===null&&typeof requestAnimationFrame<"u"&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(a||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{this.hoverRafId!==null&&typeof cancelAnimationFrame<"u"&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=a=>{if(a.defaultPrevented)return;const{dragStartSourceIds:o}=this;this.dragStartSourceIds=null;const l=AS(a);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(o||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:l});const{dataTransfer:u}=a,d=eM(u);if(this.monitor.isDragging()){if(u&&typeof u.setDragImage=="function"){const A=this.monitor.getSourceId(),p=this.sourceNodes.get(A),m=this.sourcePreviewNodes.get(A)||p;if(m){const{anchorX:y,anchorY:G,offsetX:w,offsetY:R}=this.getCurrentSourcePreviewNodeOptions(),W=A3(p,m,l,{anchorX:y,anchorY:G},{offsetX:w,offsetY:R});u.setDragImage(m,W.x,W.y)}}try{u==null||u.setData("application/json",{})}catch{}this.setCurrentDragSourceNode(a.target);const{captureDraggingState:C}=this.getCurrentSourcePreviewNodeOptions();C?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(d)this.beginDragNativeItem(d);else{if(u&&!u.types&&(a.target&&!a.target.hasAttribute||!a.target.hasAttribute("draggable")))return;a.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=a=>{if(this.dragEnterTargetIds=[],this.isDraggingNativeItem()){var o;(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(a.dataTransfer)}if(!this.enterLeaveCounter.enter(a.target)||this.monitor.isDragging())return;const{dataTransfer:u}=a,d=eM(u);d&&this.beginDragNativeItem(d,u)},this.handleTopDragEnter=a=>{const{dragEnterTargetIds:o}=this;if(this.dragEnterTargetIds=[],!this.monitor.isDragging())return;this.altKeyPressed=a.altKey,o.length>0&&this.actions.hover(o,{clientOffset:AS(a)}),o.some(u=>this.monitor.canDropOnTarget(u))&&(a.preventDefault(),a.dataTransfer&&(a.dataTransfer.dropEffect=this.getCurrentDropEffect()))},this.handleTopDragOverCapture=a=>{if(this.dragOverTargetIds=[],this.isDraggingNativeItem()){var o;(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(a.dataTransfer)}},this.handleTopDragOver=a=>{const{dragOverTargetIds:o}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging()){a.preventDefault(),a.dataTransfer&&(a.dataTransfer.dropEffect="none");return}this.altKeyPressed=a.altKey,this.lastClientOffset=AS(a),this.scheduleHover(o),(o||[]).some(u=>this.monitor.canDropOnTarget(u))?(a.preventDefault(),a.dataTransfer&&(a.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?a.preventDefault():(a.preventDefault(),a.dataTransfer&&(a.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=a=>{this.isDraggingNativeItem()&&a.preventDefault(),this.enterLeaveCounter.leave(a.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=a=>{if(this.dropTargetIds=[],this.isDraggingNativeItem()){var o;a.preventDefault(),(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(a.dataTransfer)}else eM(a.dataTransfer)&&a.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=a=>{const{dropTargetIds:o}=this;this.dropTargetIds=[],this.actions.hover(o,{clientOffset:AS(a)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=a=>{const o=a.target;typeof o.dragDrop=="function"&&(o.tagName==="INPUT"||o.tagName==="SELECT"||o.tagName==="TEXTAREA"||o.isContentEditable||(a.preventDefault(),o.dragDrop()))},this.options=new f3(t,n),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.enterLeaveCounter=new c3(this.isNodeInDocument)}}const b3=function(e,t,n){return new m3(e,t,n)};/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const yG="170",vA={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},yA={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},sE=0,hN=1,lE=2,v3=3,cE=0,mw=1,nG=2,Yc=3,iu=0,ss=1,Kl=2,RI=0,FA=1,AN=2,fN=3,pN=4,gE=5,rC=100,uE=101,IE=102,dE=103,CE=104,hE=200,AE=201,fE=202,pE=203,ZR=204,SR=205,mE=206,bE=207,vE=208,yE=209,GE=210,BE=211,ZE=212,SE=213,RE=214,RR=0,wR=1,xR=2,_A=3,WR=4,VR=5,MR=6,NR=7,GG=0,wE=1,xE=2,eu=0,WE=1,VE=2,ME=3,QN=4,NE=5,HE=6,XE=7,mN="attached",FE="detached",bw=300,WI=301,sC=302,uG=303,IG=304,Cb=306,lC=1e3,dl=1001,rb=1002,_r=1003,vw=1004,y3=1004,xA=1005,G3=1005,er=1006,tb=1007,B3=1007,Ll=1008,Z3=1008,Lc=1009,jN=1010,qN=1011,ob=1012,yw=1013,VI=1014,Ns=1015,hb=1016,Gw=1017,Bw=1018,DA=1020,$N=35902,eH=1021,tH=1022,To=1023,nH=1024,iH=1025,YA=1026,kA=1027,Zw=1028,BG=1029,aH=1030,Sw=1031,S3=1032,Rw=1033,iG=33776,aG=33777,rG=33778,oG=33779,HR=35840,XR=35841,FR=35842,YR=35843,TR=36196,ER=37492,KR=37496,LR=37808,zR=37809,_R=37810,DR=37811,kR=37812,UR=37813,JR=37814,OR=37815,PR=37816,QR=37817,jR=37818,qR=37819,$R=37820,ew=37821,sG=36492,tw=36494,nw=36495,rH=36283,iw=36284,aw=36285,rw=36286,YE=2200,TE=2201,EE=2202,sb=2300,lb=2301,bR=2302,WA=2400,VA=2401,dG=2402,ww=2500,oH=2501,KE=0,sH=1,ow=2,LE=3200,zE=3201,R3=3202,w3=3203,gC=0,_E=1,vI="",Vs="srgb",jA="srgb-linear",ZG="linear",ki="srgb",x3=0,GA=7680,W3=7681,V3=7682,M3=7683,N3=34055,H3=34056,X3=5386,F3=512,Y3=513,T3=514,E3=515,K3=516,L3=517,z3=518,bN=519,DE=512,kE=513,UE=514,lH=515,JE=516,OE=517,PE=518,QE=519,CG=35044,jE=35048,_3=35040,D3=35045,k3=35049,U3=35041,J3=35046,O3=35050,P3=35042,Q3="100",vN="300 es",$g=2e3,hG=2001;let au=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const a=this._listeners[e];if(a!==void 0){const o=a.indexOf(t);o!==-1&&a.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const a=n.slice(0);for(let o=0,l=a.length;o<l;o++)a[o].call(this,e);e.target=null}}};const No=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let sF=1234567;const TA=Math.PI/180,cb=180/Math.PI;function hl(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(No[s&255]+No[s>>8&255]+No[s>>16&255]+No[s>>24&255]+"-"+No[e&255]+No[e>>8&255]+"-"+No[e>>16&15|64]+No[e>>24&255]+"-"+No[t&63|128]+No[t>>8&255]+"-"+No[t>>16&255]+No[t>>24&255]+No[n&255]+No[n>>8&255]+No[n>>16&255]+No[n>>24&255]).toLowerCase()}function La(s,e,t){return Math.max(e,Math.min(t,s))}function cH(s,e){return(s%e+e)%e}function j3(s,e,t,n,a){return n+(s-e)*(a-n)/(t-e)}function q3(s,e,t){return s!==e?(t-s)/(e-s):0}function lG(s,e,t){return(1-t)*s+t*e}function $3(s,e,t,n){return lG(s,e,1-Math.exp(-t*n))}function eD(s,e=1){return e-Math.abs(cH(s,e*2)-e)}function tD(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function nD(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function iD(s,e){return s+Math.floor(Math.random()*(e-s+1))}function aD(s,e){return s+Math.random()*(e-s)}function rD(s){return s*(.5-Math.random())}function oD(s){s!==void 0&&(sF=s);let e=sF+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function sD(s){return s*TA}function lD(s){return s*cb}function cD(s){return(s&s-1)===0&&s!==0}function gD(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function uD(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function ID(s,e,t,n,a){const o=Math.cos,l=Math.sin,u=o(t/2),d=l(t/2),C=o((e+n)/2),A=l((e+n)/2),p=o((e-n)/2),m=l((e-n)/2),y=o((n-e)/2),G=l((n-e)/2);switch(a){case"XYX":s.set(u*A,d*p,d*m,u*C);break;case"YZY":s.set(d*m,u*A,d*p,u*C);break;case"ZXZ":s.set(d*p,d*m,u*A,u*C);break;case"XZX":s.set(u*A,d*G,d*y,u*C);break;case"YXY":s.set(d*y,u*A,d*G,u*C);break;case"ZYZ":s.set(d*G,d*y,u*A,u*C);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}}function os(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function Un(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const gH={DEG2RAD:TA,RAD2DEG:cb,generateUUID:hl,clamp:La,euclideanModulo:cH,mapLinear:j3,inverseLerp:q3,lerp:lG,damp:$3,pingpong:eD,smoothstep:tD,smootherstep:nD,randInt:iD,randFloat:aD,randFloatSpread:rD,seededRandom:oD,degToRad:sD,radToDeg:lD,isPowerOfTwo:cD,ceilPowerOfTwo:gD,floorPowerOfTwo:uD,setQuaternionFromProperEuler:ID,normalize:Un,denormalize:os};class ut{constructor(e=0,t=0){ut.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6],this.y=a[1]*t+a[4]*n+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(La(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),a=Math.sin(t),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*a+e.x,this.y=o*a+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class kn{constructor(e,t,n,a,o,l,u,d,C){kn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,a,o,l,u,d,C)}set(e,t,n,a,o,l,u,d,C){const A=this.elements;return A[0]=e,A[1]=a,A[2]=u,A[3]=t,A[4]=o,A[5]=d,A[6]=n,A[7]=l,A[8]=C,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,a=t.elements,o=this.elements,l=n[0],u=n[3],d=n[6],C=n[1],A=n[4],p=n[7],m=n[2],y=n[5],G=n[8],w=a[0],R=a[3],Z=a[6],x=a[1],W=a[4],N=a[7],K=a[2],T=a[5],L=a[8];return o[0]=l*w+u*x+d*K,o[3]=l*R+u*W+d*T,o[6]=l*Z+u*N+d*L,o[1]=C*w+A*x+p*K,o[4]=C*R+A*W+p*T,o[7]=C*Z+A*N+p*L,o[2]=m*w+y*x+G*K,o[5]=m*R+y*W+G*T,o[8]=m*Z+y*N+G*L,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],l=e[4],u=e[5],d=e[6],C=e[7],A=e[8];return t*l*A-t*u*C-n*o*A+n*u*d+a*o*C-a*l*d}invert(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],l=e[4],u=e[5],d=e[6],C=e[7],A=e[8],p=A*l-u*C,m=u*d-A*o,y=C*o-l*d,G=t*p+n*m+a*y;if(G===0)return this.set(0,0,0,0,0,0,0,0,0);const w=1/G;return e[0]=p*w,e[1]=(a*C-A*n)*w,e[2]=(u*n-a*l)*w,e[3]=m*w,e[4]=(A*t-a*d)*w,e[5]=(a*o-u*t)*w,e[6]=y*w,e[7]=(n*d-C*t)*w,e[8]=(l*t-n*o)*w,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,a,o,l,u){const d=Math.cos(o),C=Math.sin(o);return this.set(n*d,n*C,-n*(d*l+C*u)+l+e,-a*C,a*d,-a*(-C*l+d*u)+u+t,0,0,1),this}scale(e,t){return this.premultiply(tM.makeScale(e,t)),this}rotate(e){return this.premultiply(tM.makeRotation(-e)),this}translate(e,t){return this.premultiply(tM.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let a=0;a<9;a++)if(t[a]!==n[a])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const tM=new kn;function qE(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}const dD={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function jm(s,e){return new dD[s](e)}function AG(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function $E(){const s=AG("canvas");return s.style.display="block",s}const lF={};function q0(s){s in lF||(lF[s]=!0,console.warn(s))}function CD(s,e,t){return new Promise(function(n,a){function o(){switch(s.clientWaitSync(e,s.SYNC_FLUSH_COMMANDS_BIT,0)){case s.WAIT_FAILED:a();break;case s.TIMEOUT_EXPIRED:setTimeout(o,t);break;default:n()}}setTimeout(o,t)})}function hD(s){const e=s.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function AD(s){const e=s.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const mi={enabled:!0,workingColorSpace:jA,spaces:{},convert:function(s,e,t){return this.enabled===!1||e===t||!e||!t||(this.spaces[e].transfer===ki&&(s.r=wI(s.r),s.g=wI(s.g),s.b=wI(s.b)),this.spaces[e].primaries!==this.spaces[t].primaries&&(s.applyMatrix3(this.spaces[e].toXYZ),s.applyMatrix3(this.spaces[t].fromXYZ)),this.spaces[t].transfer===ki&&(s.r=nb(s.r),s.g=nb(s.g),s.b=nb(s.b))),s},fromWorkingColorSpace:function(s,e){return this.convert(s,this.workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===vI?ZG:this.spaces[s].transfer},getLuminanceCoefficients:function(s,e=this.workingColorSpace){return s.fromArray(this.spaces[e].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,e,t){return s.copy(this.spaces[e].toXYZ).multiply(this.spaces[t].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace}};function wI(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function nb(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}const cF=[.64,.33,.3,.6,.15,.06],gF=[.2126,.7152,.0722],uF=[.3127,.329],IF=new kn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),dF=new kn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);mi.define({[jA]:{primaries:cF,whitePoint:uF,transfer:ZG,toXYZ:IF,fromXYZ:dF,luminanceCoefficients:gF,workingColorSpaceConfig:{unpackColorSpace:Vs},outputColorSpaceConfig:{drawingBufferColorSpace:Vs}},[Vs]:{primaries:cF,whitePoint:uF,transfer:ki,toXYZ:IF,fromXYZ:dF,luminanceCoefficients:gF,outputColorSpaceConfig:{drawingBufferColorSpace:Vs}}});let xm;class eK{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{xm===void 0&&(xm=AG("canvas")),xm.width=e.width,xm.height=e.height;const n=xm.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=xm}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=AG("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const a=n.getImageData(0,0,e.width,e.height),o=a.data;for(let l=0;l<o.length;l++)o[l]=wI(o[l]/255)*255;return n.putImageData(a,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(wI(t[n]/255)*255):t[n]=wI(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let fD=0;class MA{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:fD++}),this.uuid=hl(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},a=this.data;if(a!==null){let o;if(Array.isArray(a)){o=[];for(let l=0,u=a.length;l<u;l++)a[l].isDataTexture?o.push(nM(a[l].image)):o.push(nM(a[l]))}else o=nM(a);n.url=o}return t||(e.images[this.uuid]=n),n}}function nM(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?eK.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let pD=0;class fa extends au{constructor(e=fa.DEFAULT_IMAGE,t=fa.DEFAULT_MAPPING,n=dl,a=dl,o=er,l=Ll,u=To,d=Lc,C=fa.DEFAULT_ANISOTROPY,A=vI){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:pD++}),this.uuid=hl(),this.name="",this.source=new MA(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=a,this.magFilter=o,this.minFilter=l,this.anisotropy=C,this.format=u,this.internalFormat=null,this.type=d,this.offset=new ut(0,0),this.repeat=new ut(1,1),this.center=new ut(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=A,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==bw)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case lC:e.x=e.x-Math.floor(e.x);break;case dl:e.x=e.x<0?0:1;break;case rb:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case lC:e.y=e.y-Math.floor(e.y);break;case dl:e.y=e.y<0?0:1;break;case rb:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}fa.DEFAULT_IMAGE=null;fa.DEFAULT_MAPPING=bw;fa.DEFAULT_ANISOTROPY=1;class Si{constructor(e=0,t=0,n=0,a=1){Si.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=a}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,a=this.z,o=this.w,l=e.elements;return this.x=l[0]*t+l[4]*n+l[8]*a+l[12]*o,this.y=l[1]*t+l[5]*n+l[9]*a+l[13]*o,this.z=l[2]*t+l[6]*n+l[10]*a+l[14]*o,this.w=l[3]*t+l[7]*n+l[11]*a+l[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,a,o;const d=e.elements,C=d[0],A=d[4],p=d[8],m=d[1],y=d[5],G=d[9],w=d[2],R=d[6],Z=d[10];if(Math.abs(A-m)<.01&&Math.abs(p-w)<.01&&Math.abs(G-R)<.01){if(Math.abs(A+m)<.1&&Math.abs(p+w)<.1&&Math.abs(G+R)<.1&&Math.abs(C+y+Z-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const W=(C+1)/2,N=(y+1)/2,K=(Z+1)/2,T=(A+m)/4,L=(p+w)/4,k=(G+R)/4;return W>N&&W>K?W<.01?(n=0,a=.707106781,o=.707106781):(n=Math.sqrt(W),a=T/n,o=L/n):N>K?N<.01?(n=.707106781,a=0,o=.707106781):(a=Math.sqrt(N),n=T/a,o=k/a):K<.01?(n=.707106781,a=.707106781,o=0):(o=Math.sqrt(K),n=L/o,a=k/o),this.set(n,a,o,t),this}let x=Math.sqrt((R-G)*(R-G)+(p-w)*(p-w)+(m-A)*(m-A));return Math.abs(x)<.001&&(x=1),this.x=(R-G)/x,this.y=(p-w)/x,this.z=(m-A)/x,this.w=Math.acos((C+y+Z-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class tK extends au{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Si(0,0,e,t),this.scissorTest=!1,this.viewport=new Si(0,0,e,t);const a={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:er,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const o=new fa(a,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);o.flipY=!1,o.generateMipmaps=n.generateMipmaps,o.internalFormat=n.internalFormat,this.textures=[];const l=n.count;for(let u=0;u<l;u++)this.textures[u]=o.clone(),this.textures[u].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let a=0,o=this.textures.length;a<o;a++)this.textures[a].image.width=e,this.textures[a].image.height=t,this.textures[a].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,a=e.textures.length;n<a;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new MA(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class zc extends tK{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class xw extends fa{constructor(e=null,t=1,n=1,a=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:a},this.magFilter=_r,this.minFilter=_r,this.wrapR=dl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class mD extends zc{constructor(e=1,t=1,n=1,a={}){super(e,t,a),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new xw(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class uH extends fa{constructor(e=null,t=1,n=1,a=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:a},this.magFilter=_r,this.minFilter=_r,this.wrapR=dl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bD extends zc{constructor(e=1,t=1,n=1,a={}){super(e,t,a),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new uH(null,e,t,n),this.texture.isRenderTargetTexture=!0}}let Ir=class{constructor(e=0,t=0,n=0,a=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=a}static slerpFlat(e,t,n,a,o,l,u){let d=n[a+0],C=n[a+1],A=n[a+2],p=n[a+3];const m=o[l+0],y=o[l+1],G=o[l+2],w=o[l+3];if(u===0){e[t+0]=d,e[t+1]=C,e[t+2]=A,e[t+3]=p;return}if(u===1){e[t+0]=m,e[t+1]=y,e[t+2]=G,e[t+3]=w;return}if(p!==w||d!==m||C!==y||A!==G){let R=1-u;const Z=d*m+C*y+A*G+p*w,x=Z>=0?1:-1,W=1-Z*Z;if(W>Number.EPSILON){const K=Math.sqrt(W),T=Math.atan2(K,Z*x);R=Math.sin(R*T)/K,u=Math.sin(u*T)/K}const N=u*x;if(d=d*R+m*N,C=C*R+y*N,A=A*R+G*N,p=p*R+w*N,R===1-u){const K=1/Math.sqrt(d*d+C*C+A*A+p*p);d*=K,C*=K,A*=K,p*=K}}e[t]=d,e[t+1]=C,e[t+2]=A,e[t+3]=p}static multiplyQuaternionsFlat(e,t,n,a,o,l){const u=n[a],d=n[a+1],C=n[a+2],A=n[a+3],p=o[l],m=o[l+1],y=o[l+2],G=o[l+3];return e[t]=u*G+A*p+d*y-C*m,e[t+1]=d*G+A*m+C*p-u*y,e[t+2]=C*G+A*y+u*m-d*p,e[t+3]=A*G-u*p-d*m-C*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,a){return this._x=e,this._y=t,this._z=n,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,a=e._y,o=e._z,l=e._order,u=Math.cos,d=Math.sin,C=u(n/2),A=u(a/2),p=u(o/2),m=d(n/2),y=d(a/2),G=d(o/2);switch(l){case"XYZ":this._x=m*A*p+C*y*G,this._y=C*y*p-m*A*G,this._z=C*A*G+m*y*p,this._w=C*A*p-m*y*G;break;case"YXZ":this._x=m*A*p+C*y*G,this._y=C*y*p-m*A*G,this._z=C*A*G-m*y*p,this._w=C*A*p+m*y*G;break;case"ZXY":this._x=m*A*p-C*y*G,this._y=C*y*p+m*A*G,this._z=C*A*G+m*y*p,this._w=C*A*p-m*y*G;break;case"ZYX":this._x=m*A*p-C*y*G,this._y=C*y*p+m*A*G,this._z=C*A*G-m*y*p,this._w=C*A*p+m*y*G;break;case"YZX":this._x=m*A*p+C*y*G,this._y=C*y*p+m*A*G,this._z=C*A*G-m*y*p,this._w=C*A*p-m*y*G;break;case"XZY":this._x=m*A*p-C*y*G,this._y=C*y*p-m*A*G,this._z=C*A*G+m*y*p,this._w=C*A*p+m*y*G;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,a=Math.sin(n);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],a=t[4],o=t[8],l=t[1],u=t[5],d=t[9],C=t[2],A=t[6],p=t[10],m=n+u+p;if(m>0){const y=.5/Math.sqrt(m+1);this._w=.25/y,this._x=(A-d)*y,this._y=(o-C)*y,this._z=(l-a)*y}else if(n>u&&n>p){const y=2*Math.sqrt(1+n-u-p);this._w=(A-d)/y,this._x=.25*y,this._y=(a+l)/y,this._z=(o+C)/y}else if(u>p){const y=2*Math.sqrt(1+u-n-p);this._w=(o-C)/y,this._x=(a+l)/y,this._y=.25*y,this._z=(d+A)/y}else{const y=2*Math.sqrt(1+p-n-u);this._w=(l-a)/y,this._x=(o+C)/y,this._y=(d+A)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(La(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const a=Math.min(1,t/n);return this.slerp(e,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,a=e._y,o=e._z,l=e._w,u=t._x,d=t._y,C=t._z,A=t._w;return this._x=n*A+l*u+a*C-o*d,this._y=a*A+l*d+o*u-n*C,this._z=o*A+l*C+n*d-a*u,this._w=l*A-n*u-a*d-o*C,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,a=this._y,o=this._z,l=this._w;let u=l*e._w+n*e._x+a*e._y+o*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=l,this._x=n,this._y=a,this._z=o,this;const d=1-u*u;if(d<=Number.EPSILON){const y=1-t;return this._w=y*l+t*this._w,this._x=y*n+t*this._x,this._y=y*a+t*this._y,this._z=y*o+t*this._z,this.normalize(),this}const C=Math.sqrt(d),A=Math.atan2(C,u),p=Math.sin((1-t)*A)/C,m=Math.sin(t*A)/C;return this._w=l*p+this._w*m,this._x=n*p+this._x*m,this._y=a*p+this._y*m,this._z=o*p+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),a=Math.sqrt(1-n),o=Math.sqrt(n);return this.set(a*Math.sin(e),a*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class q{constructor(e=0,t=0,n=0){q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(CF.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(CF.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*a,this.y=o[1]*t+o[4]*n+o[7]*a,this.z=o[2]*t+o[5]*n+o[8]*a,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,a=this.z,o=e.elements,l=1/(o[3]*t+o[7]*n+o[11]*a+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*a+o[12])*l,this.y=(o[1]*t+o[5]*n+o[9]*a+o[13])*l,this.z=(o[2]*t+o[6]*n+o[10]*a+o[14])*l,this}applyQuaternion(e){const t=this.x,n=this.y,a=this.z,o=e.x,l=e.y,u=e.z,d=e.w,C=2*(l*a-u*n),A=2*(u*t-o*a),p=2*(o*n-l*t);return this.x=t+d*C+l*p-u*A,this.y=n+d*A+u*C-o*p,this.z=a+d*p+o*A-l*C,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*a,this.y=o[1]*t+o[5]*n+o[9]*a,this.z=o[2]*t+o[6]*n+o[10]*a,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,a=e.y,o=e.z,l=t.x,u=t.y,d=t.z;return this.x=a*d-o*u,this.y=o*l-n*d,this.z=n*u-a*l,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return iM.copy(this).projectOnVector(e),this.sub(iM)}reflect(e){return this.sub(iM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(La(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const a=Math.sin(t)*e;return this.x=a*Math.sin(n),this.y=Math.cos(t)*e,this.z=a*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const iM=new q,CF=new Ir;class ho{constructor(e=new q(1/0,1/0,1/0),t=new q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Mc.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Mc.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Mc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const o=n.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let l=0,u=o.count;l<u;l++)e.isMesh===!0?e.getVertexPosition(l,Mc):Mc.fromBufferAttribute(o,l),Mc.applyMatrix4(e.matrixWorld),this.expandByPoint(Mc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),fS.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),fS.copy(n.boundingBox)),fS.applyMatrix4(e.matrixWorld),this.union(fS)}const a=e.children;for(let o=0,l=a.length;o<l;o++)this.expandByObject(a[o],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Mc),Mc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(N0),pS.subVectors(this.max,N0),Wm.subVectors(e.a,N0),Vm.subVectors(e.b,N0),Mm.subVectors(e.c,N0),jd.subVectors(Vm,Wm),qd.subVectors(Mm,Vm),sA.subVectors(Wm,Mm);let t=[0,-jd.z,jd.y,0,-qd.z,qd.y,0,-sA.z,sA.y,jd.z,0,-jd.x,qd.z,0,-qd.x,sA.z,0,-sA.x,-jd.y,jd.x,0,-qd.y,qd.x,0,-sA.y,sA.x,0];return!aM(t,Wm,Vm,Mm,pS)||(t=[1,0,0,0,1,0,0,0,1],!aM(t,Wm,Vm,Mm,pS))?!1:(mS.crossVectors(jd,qd),t=[mS.x,mS.y,mS.z],aM(t,Wm,Vm,Mm,pS))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Mc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Mc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(dI[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),dI[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),dI[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),dI[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),dI[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),dI[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),dI[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),dI[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(dI),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const dI=[new q,new q,new q,new q,new q,new q,new q,new q],Mc=new q,fS=new ho,Wm=new q,Vm=new q,Mm=new q,jd=new q,qd=new q,sA=new q,N0=new q,pS=new q,mS=new q,lA=new q;function aM(s,e,t,n,a){for(let o=0,l=s.length-3;o<=l;o+=3){lA.fromArray(s,o);const u=a.x*Math.abs(lA.x)+a.y*Math.abs(lA.y)+a.z*Math.abs(lA.z),d=e.dot(lA),C=t.dot(lA),A=n.dot(lA);if(Math.max(-Math.max(d,C,A),Math.min(d,C,A))>u)return!1}return!0}const vD=new ho,H0=new q,rM=new q;class Ao{constructor(e=new q,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):vD.setFromPoints(e).getCenter(n);let a=0;for(let o=0,l=e.length;o<l;o++)a=Math.max(a,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(a),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;H0.subVectors(e,this.center);const t=H0.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),a=(n-this.radius)*.5;this.center.addScaledVector(H0,a/n),this.radius+=a}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(rM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(H0.copy(e.center).add(rM)),this.expandByPoint(H0.copy(e.center).sub(rM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const CI=new q,oM=new q,bS=new q,$d=new q,sM=new q,vS=new q,lM=new q;let qA=class{constructor(e=new q,t=new q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,CI)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=CI.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(CI.copy(this.origin).addScaledVector(this.direction,t),CI.distanceToSquared(e))}distanceSqToSegment(e,t,n,a){oM.copy(e).add(t).multiplyScalar(.5),bS.copy(t).sub(e).normalize(),$d.copy(this.origin).sub(oM);const o=e.distanceTo(t)*.5,l=-this.direction.dot(bS),u=$d.dot(this.direction),d=-$d.dot(bS),C=$d.lengthSq(),A=Math.abs(1-l*l);let p,m,y,G;if(A>0)if(p=l*d-u,m=l*u-d,G=o*A,p>=0)if(m>=-G)if(m<=G){const w=1/A;p*=w,m*=w,y=p*(p+l*m+2*u)+m*(l*p+m+2*d)+C}else m=o,p=Math.max(0,-(l*m+u)),y=-p*p+m*(m+2*d)+C;else m=-o,p=Math.max(0,-(l*m+u)),y=-p*p+m*(m+2*d)+C;else m<=-G?(p=Math.max(0,-(-l*o+u)),m=p>0?-o:Math.min(Math.max(-o,-d),o),y=-p*p+m*(m+2*d)+C):m<=G?(p=0,m=Math.min(Math.max(-o,-d),o),y=m*(m+2*d)+C):(p=Math.max(0,-(l*o+u)),m=p>0?o:Math.min(Math.max(-o,-d),o),y=-p*p+m*(m+2*d)+C);else m=l>0?-o:o,p=Math.max(0,-(l*m+u)),y=-p*p+m*(m+2*d)+C;return n&&n.copy(this.origin).addScaledVector(this.direction,p),a&&a.copy(oM).addScaledVector(bS,m),y}intersectSphere(e,t){CI.subVectors(e.center,this.origin);const n=CI.dot(this.direction),a=CI.dot(CI)-n*n,o=e.radius*e.radius;if(a>o)return null;const l=Math.sqrt(o-a),u=n-l,d=n+l;return d<0?null:u<0?this.at(d,t):this.at(u,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,a,o,l,u,d;const C=1/this.direction.x,A=1/this.direction.y,p=1/this.direction.z,m=this.origin;return C>=0?(n=(e.min.x-m.x)*C,a=(e.max.x-m.x)*C):(n=(e.max.x-m.x)*C,a=(e.min.x-m.x)*C),A>=0?(o=(e.min.y-m.y)*A,l=(e.max.y-m.y)*A):(o=(e.max.y-m.y)*A,l=(e.min.y-m.y)*A),n>l||o>a||((o>n||isNaN(n))&&(n=o),(l<a||isNaN(a))&&(a=l),p>=0?(u=(e.min.z-m.z)*p,d=(e.max.z-m.z)*p):(u=(e.max.z-m.z)*p,d=(e.min.z-m.z)*p),n>d||u>a)||((u>n||n!==n)&&(n=u),(d<a||a!==a)&&(a=d),a<0)?null:this.at(n>=0?n:a,t)}intersectsBox(e){return this.intersectBox(e,CI)!==null}intersectTriangle(e,t,n,a,o){sM.subVectors(t,e),vS.subVectors(n,e),lM.crossVectors(sM,vS);let l=this.direction.dot(lM),u;if(l>0){if(a)return null;u=1}else if(l<0)u=-1,l=-l;else return null;$d.subVectors(this.origin,e);const d=u*this.direction.dot(vS.crossVectors($d,vS));if(d<0)return null;const C=u*this.direction.dot(sM.cross($d));if(C<0||d+C>l)return null;const A=-u*$d.dot(lM);return A<0?null:this.at(A/l,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Sn{constructor(e,t,n,a,o,l,u,d,C,A,p,m,y,G,w,R){Sn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,a,o,l,u,d,C,A,p,m,y,G,w,R)}set(e,t,n,a,o,l,u,d,C,A,p,m,y,G,w,R){const Z=this.elements;return Z[0]=e,Z[4]=t,Z[8]=n,Z[12]=a,Z[1]=o,Z[5]=l,Z[9]=u,Z[13]=d,Z[2]=C,Z[6]=A,Z[10]=p,Z[14]=m,Z[3]=y,Z[7]=G,Z[11]=w,Z[15]=R,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Sn().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,a=1/Nm.setFromMatrixColumn(e,0).length(),o=1/Nm.setFromMatrixColumn(e,1).length(),l=1/Nm.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*l,t[9]=n[9]*l,t[10]=n[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,a=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),d=Math.cos(a),C=Math.sin(a),A=Math.cos(o),p=Math.sin(o);if(e.order==="XYZ"){const m=l*A,y=l*p,G=u*A,w=u*p;t[0]=d*A,t[4]=-d*p,t[8]=C,t[1]=y+G*C,t[5]=m-w*C,t[9]=-u*d,t[2]=w-m*C,t[6]=G+y*C,t[10]=l*d}else if(e.order==="YXZ"){const m=d*A,y=d*p,G=C*A,w=C*p;t[0]=m+w*u,t[4]=G*u-y,t[8]=l*C,t[1]=l*p,t[5]=l*A,t[9]=-u,t[2]=y*u-G,t[6]=w+m*u,t[10]=l*d}else if(e.order==="ZXY"){const m=d*A,y=d*p,G=C*A,w=C*p;t[0]=m-w*u,t[4]=-l*p,t[8]=G+y*u,t[1]=y+G*u,t[5]=l*A,t[9]=w-m*u,t[2]=-l*C,t[6]=u,t[10]=l*d}else if(e.order==="ZYX"){const m=l*A,y=l*p,G=u*A,w=u*p;t[0]=d*A,t[4]=G*C-y,t[8]=m*C+w,t[1]=d*p,t[5]=w*C+m,t[9]=y*C-G,t[2]=-C,t[6]=u*d,t[10]=l*d}else if(e.order==="YZX"){const m=l*d,y=l*C,G=u*d,w=u*C;t[0]=d*A,t[4]=w-m*p,t[8]=G*p+y,t[1]=p,t[5]=l*A,t[9]=-u*A,t[2]=-C*A,t[6]=y*p+G,t[10]=m-w*p}else if(e.order==="XZY"){const m=l*d,y=l*C,G=u*d,w=u*C;t[0]=d*A,t[4]=-p,t[8]=C*A,t[1]=m*p+w,t[5]=l*A,t[9]=y*p-G,t[2]=G*p-y,t[6]=u*A,t[10]=w*p+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(yD,e,GD)}lookAt(e,t,n){const a=this.elements;return cl.subVectors(e,t),cl.lengthSq()===0&&(cl.z=1),cl.normalize(),eC.crossVectors(n,cl),eC.lengthSq()===0&&(Math.abs(n.z)===1?cl.x+=1e-4:cl.z+=1e-4,cl.normalize(),eC.crossVectors(n,cl)),eC.normalize(),yS.crossVectors(cl,eC),a[0]=eC.x,a[4]=yS.x,a[8]=cl.x,a[1]=eC.y,a[5]=yS.y,a[9]=cl.y,a[2]=eC.z,a[6]=yS.z,a[10]=cl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,a=t.elements,o=this.elements,l=n[0],u=n[4],d=n[8],C=n[12],A=n[1],p=n[5],m=n[9],y=n[13],G=n[2],w=n[6],R=n[10],Z=n[14],x=n[3],W=n[7],N=n[11],K=n[15],T=a[0],L=a[4],k=a[8],E=a[12],F=a[1],U=a[5],le=a[9],ie=a[13],Ce=a[2],Ge=a[6],ye=a[10],pe=a[14],de=a[3],Oe=a[7],We=a[11],ke=a[15];return o[0]=l*T+u*F+d*Ce+C*de,o[4]=l*L+u*U+d*Ge+C*Oe,o[8]=l*k+u*le+d*ye+C*We,o[12]=l*E+u*ie+d*pe+C*ke,o[1]=A*T+p*F+m*Ce+y*de,o[5]=A*L+p*U+m*Ge+y*Oe,o[9]=A*k+p*le+m*ye+y*We,o[13]=A*E+p*ie+m*pe+y*ke,o[2]=G*T+w*F+R*Ce+Z*de,o[6]=G*L+w*U+R*Ge+Z*Oe,o[10]=G*k+w*le+R*ye+Z*We,o[14]=G*E+w*ie+R*pe+Z*ke,o[3]=x*T+W*F+N*Ce+K*de,o[7]=x*L+W*U+N*Ge+K*Oe,o[11]=x*k+W*le+N*ye+K*We,o[15]=x*E+W*ie+N*pe+K*ke,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],a=e[8],o=e[12],l=e[1],u=e[5],d=e[9],C=e[13],A=e[2],p=e[6],m=e[10],y=e[14],G=e[3],w=e[7],R=e[11],Z=e[15];return G*(+o*d*p-a*C*p-o*u*m+n*C*m+a*u*y-n*d*y)+w*(+t*d*y-t*C*m+o*l*m-a*l*y+a*C*A-o*d*A)+R*(+t*C*p-t*u*y-o*l*p+n*l*y+o*u*A-n*C*A)+Z*(-a*u*A-t*d*p+t*u*m+a*l*p-n*l*m+n*d*A)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=t,a[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],l=e[4],u=e[5],d=e[6],C=e[7],A=e[8],p=e[9],m=e[10],y=e[11],G=e[12],w=e[13],R=e[14],Z=e[15],x=p*R*C-w*m*C+w*d*y-u*R*y-p*d*Z+u*m*Z,W=G*m*C-A*R*C-G*d*y+l*R*y+A*d*Z-l*m*Z,N=A*w*C-G*p*C+G*u*y-l*w*y-A*u*Z+l*p*Z,K=G*p*d-A*w*d-G*u*m+l*w*m+A*u*R-l*p*R,T=t*x+n*W+a*N+o*K;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const L=1/T;return e[0]=x*L,e[1]=(w*m*o-p*R*o-w*a*y+n*R*y+p*a*Z-n*m*Z)*L,e[2]=(u*R*o-w*d*o+w*a*C-n*R*C-u*a*Z+n*d*Z)*L,e[3]=(p*d*o-u*m*o-p*a*C+n*m*C+u*a*y-n*d*y)*L,e[4]=W*L,e[5]=(A*R*o-G*m*o+G*a*y-t*R*y-A*a*Z+t*m*Z)*L,e[6]=(G*d*o-l*R*o-G*a*C+t*R*C+l*a*Z-t*d*Z)*L,e[7]=(l*m*o-A*d*o+A*a*C-t*m*C-l*a*y+t*d*y)*L,e[8]=N*L,e[9]=(G*p*o-A*w*o-G*n*y+t*w*y+A*n*Z-t*p*Z)*L,e[10]=(l*w*o-G*u*o+G*n*C-t*w*C-l*n*Z+t*u*Z)*L,e[11]=(A*u*o-l*p*o-A*n*C+t*p*C+l*n*y-t*u*y)*L,e[12]=K*L,e[13]=(A*w*a-G*p*a+G*n*m-t*w*m-A*n*R+t*p*R)*L,e[14]=(G*u*a-l*w*a-G*n*d+t*w*d+l*n*R-t*u*R)*L,e[15]=(l*p*a-A*u*a+A*n*d-t*p*d-l*n*m+t*u*m)*L,this}scale(e){const t=this.elements,n=e.x,a=e.y,o=e.z;return t[0]*=n,t[4]*=a,t[8]*=o,t[1]*=n,t[5]*=a,t[9]*=o,t[2]*=n,t[6]*=a,t[10]*=o,t[3]*=n,t[7]*=a,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,a))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),a=Math.sin(t),o=1-n,l=e.x,u=e.y,d=e.z,C=o*l,A=o*u;return this.set(C*l+n,C*u-a*d,C*d+a*u,0,C*u+a*d,A*u+n,A*d-a*l,0,C*d-a*u,A*d+a*l,o*d*d+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,a,o,l){return this.set(1,n,o,0,e,1,l,0,t,a,1,0,0,0,0,1),this}compose(e,t,n){const a=this.elements,o=t._x,l=t._y,u=t._z,d=t._w,C=o+o,A=l+l,p=u+u,m=o*C,y=o*A,G=o*p,w=l*A,R=l*p,Z=u*p,x=d*C,W=d*A,N=d*p,K=n.x,T=n.y,L=n.z;return a[0]=(1-(w+Z))*K,a[1]=(y+N)*K,a[2]=(G-W)*K,a[3]=0,a[4]=(y-N)*T,a[5]=(1-(m+Z))*T,a[6]=(R+x)*T,a[7]=0,a[8]=(G+W)*L,a[9]=(R-x)*L,a[10]=(1-(m+w))*L,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}decompose(e,t,n){const a=this.elements;let o=Nm.set(a[0],a[1],a[2]).length();const l=Nm.set(a[4],a[5],a[6]).length(),u=Nm.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),e.x=a[12],e.y=a[13],e.z=a[14],Nc.copy(this);const C=1/o,A=1/l,p=1/u;return Nc.elements[0]*=C,Nc.elements[1]*=C,Nc.elements[2]*=C,Nc.elements[4]*=A,Nc.elements[5]*=A,Nc.elements[6]*=A,Nc.elements[8]*=p,Nc.elements[9]*=p,Nc.elements[10]*=p,t.setFromRotationMatrix(Nc),n.x=o,n.y=l,n.z=u,this}makePerspective(e,t,n,a,o,l,u=$g){const d=this.elements,C=2*o/(t-e),A=2*o/(n-a),p=(t+e)/(t-e),m=(n+a)/(n-a);let y,G;if(u===$g)y=-(l+o)/(l-o),G=-2*l*o/(l-o);else if(u===hG)y=-l/(l-o),G=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return d[0]=C,d[4]=0,d[8]=p,d[12]=0,d[1]=0,d[5]=A,d[9]=m,d[13]=0,d[2]=0,d[6]=0,d[10]=y,d[14]=G,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(e,t,n,a,o,l,u=$g){const d=this.elements,C=1/(t-e),A=1/(n-a),p=1/(l-o),m=(t+e)*C,y=(n+a)*A;let G,w;if(u===$g)G=(l+o)*p,w=-2*p;else if(u===hG)G=o*p,w=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return d[0]=2*C,d[4]=0,d[8]=0,d[12]=-m,d[1]=0,d[5]=2*A,d[9]=0,d[13]=-y,d[2]=0,d[6]=0,d[10]=w,d[14]=-G,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let a=0;a<16;a++)if(t[a]!==n[a])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Nm=new q,Nc=new Sn,yD=new q(0,0,0),GD=new q(1,1,1),eC=new q,yS=new q,cl=new q,hF=new Sn,AF=new Ir;class Hs{constructor(e=0,t=0,n=0,a=Hs.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=a}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,a=this._order){return this._x=e,this._y=t,this._z=n,this._order=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const a=e.elements,o=a[0],l=a[4],u=a[8],d=a[1],C=a[5],A=a[9],p=a[2],m=a[6],y=a[10];switch(t){case"XYZ":this._y=Math.asin(La(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-A,y),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(m,C),this._z=0);break;case"YXZ":this._x=Math.asin(-La(A,-1,1)),Math.abs(A)<.9999999?(this._y=Math.atan2(u,y),this._z=Math.atan2(d,C)):(this._y=Math.atan2(-p,o),this._z=0);break;case"ZXY":this._x=Math.asin(La(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-l,C)):(this._y=0,this._z=Math.atan2(d,o));break;case"ZYX":this._y=Math.asin(-La(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(m,y),this._z=Math.atan2(d,o)):(this._x=0,this._z=Math.atan2(-l,C));break;case"YZX":this._z=Math.asin(La(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-A,C),this._y=Math.atan2(-p,o)):(this._x=0,this._y=Math.atan2(u,y));break;case"XZY":this._z=Math.asin(-La(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(m,C),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-A,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return hF.makeRotationFromQuaternion(e),this.setFromRotationMatrix(hF,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return AF.setFromEuler(this),this.setFromQuaternion(AF,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Hs.DEFAULT_ORDER="XYZ";class EA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let BD=0;const fF=new q,Hm=new Ir,hI=new Sn,GS=new q,X0=new q,ZD=new q,SD=new Ir,pF=new q(1,0,0),mF=new q(0,1,0),bF=new q(0,0,1),vF={type:"added"},RD={type:"removed"},Xm={type:"childadded",child:null},cM={type:"childremoved",child:null};class gi extends au{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:BD++}),this.uuid=hl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gi.DEFAULT_UP.clone();const e=new q,t=new Hs,n=new Ir,a=new q(1,1,1);function o(){n.setFromEuler(t,!1)}function l(){t.setFromQuaternion(n,void 0,!1)}t._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new Sn},normalMatrix:{value:new kn}}),this.matrix=new Sn,this.matrixWorld=new Sn,this.matrixAutoUpdate=gi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new EA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Hm.setFromAxisAngle(e,t),this.quaternion.multiply(Hm),this}rotateOnWorldAxis(e,t){return Hm.setFromAxisAngle(e,t),this.quaternion.premultiply(Hm),this}rotateX(e){return this.rotateOnAxis(pF,e)}rotateY(e){return this.rotateOnAxis(mF,e)}rotateZ(e){return this.rotateOnAxis(bF,e)}translateOnAxis(e,t){return fF.copy(e).applyQuaternion(this.quaternion),this.position.add(fF.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(pF,e)}translateY(e){return this.translateOnAxis(mF,e)}translateZ(e){return this.translateOnAxis(bF,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(hI.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?GS.copy(e):GS.set(e,t,n);const a=this.parent;this.updateWorldMatrix(!0,!1),X0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hI.lookAt(X0,GS,this.up):hI.lookAt(GS,X0,this.up),this.quaternion.setFromRotationMatrix(hI),a&&(hI.extractRotation(a.matrixWorld),Hm.setFromRotationMatrix(hI),this.quaternion.premultiply(Hm.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(vF),Xm.child=e,this.dispatchEvent(Xm),Xm.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(RD),cM.child=e,this.dispatchEvent(cM),cM.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),hI.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),hI.multiply(e.parent.matrixWorld)),e.applyMatrix4(hI),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(vF),Xm.child=e,this.dispatchEvent(Xm),Xm.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,a=this.children.length;n<a;n++){const l=this.children[n].getObjectByProperty(e,t);if(l!==void 0)return l}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const a=this.children;for(let o=0,l=a.length;o<l;o++)a[o].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(X0,e,ZD),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(X0,SD,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,a=t.length;n<a;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,a=t.length;n<a;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,a=t.length;n<a;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const a=this.children;for(let o=0,l=a.length;o<l;o++)a[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const a={};a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),this.castShadow===!0&&(a.castShadow=!0),this.receiveShadow===!0&&(a.receiveShadow=!0),this.visible===!1&&(a.visible=!1),this.frustumCulled===!1&&(a.frustumCulled=!1),this.renderOrder!==0&&(a.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),a.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(a.matrixAutoUpdate=!1),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(a.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(a.type="BatchedMesh",a.perObjectFrustumCulled=this.perObjectFrustumCulled,a.sortObjects=this.sortObjects,a.drawRanges=this._drawRanges,a.reservedRanges=this._reservedRanges,a.visibility=this._visibility,a.active=this._active,a.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),a.maxInstanceCount=this._maxInstanceCount,a.maxVertexCount=this._maxVertexCount,a.maxIndexCount=this._maxIndexCount,a.geometryInitialized=this._geometryInitialized,a.geometryCount=this._geometryCount,a.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(a.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(a.boundingSphere={center:a.boundingSphere.center.toArray(),radius:a.boundingSphere.radius}),this.boundingBox!==null&&(a.boundingBox={min:a.boundingBox.min.toArray(),max:a.boundingBox.max.toArray()}));function o(u,d){return u[d.uuid]===void 0&&(u[d.uuid]=d.toJSON(e)),d.uuid}if(this.isScene)this.background&&(this.background.isColor?a.background=this.background.toJSON():this.background.isTexture&&(a.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(a.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){a.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const d=u.shapes;if(Array.isArray(d))for(let C=0,A=d.length;C<A;C++){const p=d[C];o(e.shapes,p)}else o(e.shapes,d)}}if(this.isSkinnedMesh&&(a.bindMode=this.bindMode,a.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),a.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let d=0,C=this.material.length;d<C;d++)u.push(o(e.materials,this.material[d]));a.material=u}else a.material=o(e.materials,this.material);if(this.children.length>0){a.children=[];for(let u=0;u<this.children.length;u++)a.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){a.animations=[];for(let u=0;u<this.animations.length;u++){const d=this.animations[u];a.animations.push(o(e.animations,d))}}if(t){const u=l(e.geometries),d=l(e.materials),C=l(e.textures),A=l(e.images),p=l(e.shapes),m=l(e.skeletons),y=l(e.animations),G=l(e.nodes);u.length>0&&(n.geometries=u),d.length>0&&(n.materials=d),C.length>0&&(n.textures=C),A.length>0&&(n.images=A),p.length>0&&(n.shapes=p),m.length>0&&(n.skeletons=m),y.length>0&&(n.animations=y),G.length>0&&(n.nodes=G)}return n.object=a,n;function l(u){const d=[];for(const C in u){const A=u[C];delete A.metadata,d.push(A)}return d}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const a=e.children[n];this.add(a.clone())}return this}}gi.DEFAULT_UP=new q(0,1,0);gi.DEFAULT_MATRIX_AUTO_UPDATE=!0;gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Hc=new q,AI=new q,gM=new q,fI=new q,Fm=new q,Ym=new q,yF=new q,uM=new q,IM=new q,dM=new q,CM=new Si,hM=new Si,AM=new Si;class Ms{constructor(e=new q,t=new q,n=new q){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,a){a.subVectors(n,t),Hc.subVectors(e,t),a.cross(Hc);const o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}static getBarycoord(e,t,n,a,o){Hc.subVectors(a,t),AI.subVectors(n,t),gM.subVectors(e,t);const l=Hc.dot(Hc),u=Hc.dot(AI),d=Hc.dot(gM),C=AI.dot(AI),A=AI.dot(gM),p=l*C-u*u;if(p===0)return o.set(0,0,0),null;const m=1/p,y=(C*d-u*A)*m,G=(l*A-u*d)*m;return o.set(1-y-G,G,y)}static containsPoint(e,t,n,a){return this.getBarycoord(e,t,n,a,fI)===null?!1:fI.x>=0&&fI.y>=0&&fI.x+fI.y<=1}static getInterpolation(e,t,n,a,o,l,u,d){return this.getBarycoord(e,t,n,a,fI)===null?(d.x=0,d.y=0,"z"in d&&(d.z=0),"w"in d&&(d.w=0),null):(d.setScalar(0),d.addScaledVector(o,fI.x),d.addScaledVector(l,fI.y),d.addScaledVector(u,fI.z),d)}static getInterpolatedAttribute(e,t,n,a,o,l){return CM.setScalar(0),hM.setScalar(0),AM.setScalar(0),CM.fromBufferAttribute(e,t),hM.fromBufferAttribute(e,n),AM.fromBufferAttribute(e,a),l.setScalar(0),l.addScaledVector(CM,o.x),l.addScaledVector(hM,o.y),l.addScaledVector(AM,o.z),l}static isFrontFacing(e,t,n,a){return Hc.subVectors(n,t),AI.subVectors(e,t),Hc.cross(AI).dot(a)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,a){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[a]),this}setFromAttributeAndIndices(e,t,n,a){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,a),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Hc.subVectors(this.c,this.b),AI.subVectors(this.a,this.b),Hc.cross(AI).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ms.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ms.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,a,o){return Ms.getInterpolation(e,this.a,this.b,this.c,t,n,a,o)}containsPoint(e){return Ms.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ms.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,a=this.b,o=this.c;let l,u;Fm.subVectors(a,n),Ym.subVectors(o,n),uM.subVectors(e,n);const d=Fm.dot(uM),C=Ym.dot(uM);if(d<=0&&C<=0)return t.copy(n);IM.subVectors(e,a);const A=Fm.dot(IM),p=Ym.dot(IM);if(A>=0&&p<=A)return t.copy(a);const m=d*p-A*C;if(m<=0&&d>=0&&A<=0)return l=d/(d-A),t.copy(n).addScaledVector(Fm,l);dM.subVectors(e,o);const y=Fm.dot(dM),G=Ym.dot(dM);if(G>=0&&y<=G)return t.copy(o);const w=y*C-d*G;if(w<=0&&C>=0&&G<=0)return u=C/(C-G),t.copy(n).addScaledVector(Ym,u);const R=A*G-y*p;if(R<=0&&p-A>=0&&y-G>=0)return yF.subVectors(o,a),u=(p-A)/(p-A+(y-G)),t.copy(a).addScaledVector(yF,u);const Z=1/(R+w+m);return l=w*Z,u=m*Z,t.copy(n).addScaledVector(Fm,l).addScaledVector(Ym,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const nK={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},tC={h:0,s:0,l:0},BS={h:0,s:0,l:0};function fM(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}class $t{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const a=e;a&&a.isColor?this.copy(a):typeof a=="number"?this.setHex(a):typeof a=="string"&&this.setStyle(a)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Vs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,mi.toWorkingColorSpace(this,t),this}setRGB(e,t,n,a=mi.workingColorSpace){return this.r=e,this.g=t,this.b=n,mi.toWorkingColorSpace(this,a),this}setHSL(e,t,n,a=mi.workingColorSpace){if(e=cH(e,1),t=La(t,0,1),n=La(n,0,1),t===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+t):n+t-n*t,l=2*n-o;this.r=fM(l,o,e+1/3),this.g=fM(l,o,e),this.b=fM(l,o,e-1/3)}return mi.toWorkingColorSpace(this,a),this}setStyle(e,t=Vs){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const l=a[1],u=a[2];switch(l){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=a[1],l=o.length;if(l===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(l===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Vs){const n=nK[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=wI(e.r),this.g=wI(e.g),this.b=wI(e.b),this}copyLinearToSRGB(e){return this.r=nb(e.r),this.g=nb(e.g),this.b=nb(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Vs){return mi.fromWorkingColorSpace(Ho.copy(this),e),Math.round(La(Ho.r*255,0,255))*65536+Math.round(La(Ho.g*255,0,255))*256+Math.round(La(Ho.b*255,0,255))}getHexString(e=Vs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=mi.workingColorSpace){mi.fromWorkingColorSpace(Ho.copy(this),t);const n=Ho.r,a=Ho.g,o=Ho.b,l=Math.max(n,a,o),u=Math.min(n,a,o);let d,C;const A=(u+l)/2;if(u===l)d=0,C=0;else{const p=l-u;switch(C=A<=.5?p/(l+u):p/(2-l-u),l){case n:d=(a-o)/p+(a<o?6:0);break;case a:d=(o-n)/p+2;break;case o:d=(n-a)/p+4;break}d/=6}return e.h=d,e.s=C,e.l=A,e}getRGB(e,t=mi.workingColorSpace){return mi.fromWorkingColorSpace(Ho.copy(this),t),e.r=Ho.r,e.g=Ho.g,e.b=Ho.b,e}getStyle(e=Vs){mi.fromWorkingColorSpace(Ho.copy(this),e);const t=Ho.r,n=Ho.g,a=Ho.b;return e!==Vs?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${a.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(a*255)})`}offsetHSL(e,t,n){return this.getHSL(tC),this.setHSL(tC.h+e,tC.s+t,tC.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(tC),e.getHSL(BS);const n=lG(tC.h,BS.h,t),a=lG(tC.s,BS.s,t),o=lG(tC.l,BS.l,t);return this.setHSL(n,a,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,a=this.b,o=e.elements;return this.r=o[0]*t+o[3]*n+o[6]*a,this.g=o[1]*t+o[4]*n+o[7]*a,this.b=o[2]*t+o[5]*n+o[8]*a,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ho=new $t;$t.NAMES=nK;let wD=0;class Zr extends au{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:wD++}),this.uuid=hl(),this.name="",this.blending=FA,this.side=iu,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ZR,this.blendDst=SR,this.blendEquation=rC,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new $t(0,0,0),this.blendAlpha=0,this.depthFunc=_A,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=bN,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=GA,this.stencilZFail=GA,this.stencilZPass=GA,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const a=this[t];if(a===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}a&&a.isColor?a.set(n):a&&a.isVector3&&n&&n.isVector3?a.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==FA&&(n.blending=this.blending),this.side!==iu&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==ZR&&(n.blendSrc=this.blendSrc),this.blendDst!==SR&&(n.blendDst=this.blendDst),this.blendEquation!==rC&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==_A&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==bN&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==GA&&(n.stencilFail=this.stencilFail),this.stencilZFail!==GA&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==GA&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function a(o){const l=[];for(const u in o){const d=o[u];delete d.metadata,l.push(d)}return l}if(t){const o=a(e.textures),l=a(e.images);o.length>0&&(n.textures=o),l.length>0&&(n.images=l)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const a=t.length;n=new Array(a);for(let o=0;o!==a;++o)n[o]=t[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Cl extends Zr{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new $t(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hs,this.combine=GG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yI=xD();function xD(){const s=new ArrayBuffer(4),e=new Float32Array(s),t=new Uint32Array(s),n=new Uint32Array(512),a=new Uint32Array(512);for(let d=0;d<256;++d){const C=d-127;C<-27?(n[d]=0,n[d|256]=32768,a[d]=24,a[d|256]=24):C<-14?(n[d]=1024>>-C-14,n[d|256]=1024>>-C-14|32768,a[d]=-C-1,a[d|256]=-C-1):C<=15?(n[d]=C+15<<10,n[d|256]=C+15<<10|32768,a[d]=13,a[d|256]=13):C<128?(n[d]=31744,n[d|256]=64512,a[d]=24,a[d|256]=24):(n[d]=31744,n[d|256]=64512,a[d]=13,a[d|256]=13)}const o=new Uint32Array(2048),l=new Uint32Array(64),u=new Uint32Array(64);for(let d=1;d<1024;++d){let C=d<<13,A=0;for(;!(C&8388608);)C<<=1,A-=8388608;C&=-8388609,A+=947912704,o[d]=C|A}for(let d=1024;d<2048;++d)o[d]=939524096+(d-1024<<13);for(let d=1;d<31;++d)l[d]=d<<23;l[31]=1199570944,l[32]=2147483648;for(let d=33;d<63;++d)l[d]=2147483648+(d-32<<23);l[63]=3347054592;for(let d=1;d<64;++d)d!==32&&(u[d]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:a,mantissaTable:o,exponentTable:l,offsetTable:u}}function ws(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=La(s,-65504,65504),yI.floatView[0]=s;const e=yI.uint32View[0],t=e>>23&511;return yI.baseTable[t]+((e&8388607)>>yI.shiftTable[t])}function $0(s){const e=s>>10;return yI.uint32View[0]=yI.mantissaTable[yI.offsetTable[e]+(s&1023)]+yI.exponentTable[e],yI.floatView[0]}const WD={toHalfFloat:ws,fromHalfFloat:$0},ur=new q,ZS=new ut;class Ri{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=CG,this.updateRanges=[],this.gpuType=Ns,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let a=0,o=this.itemSize;a<o;a++)this.array[e+a]=t.array[n+a];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)ZS.fromBufferAttribute(this,t),ZS.applyMatrix3(e),this.setXY(t,ZS.x,ZS.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)ur.fromBufferAttribute(this,t),ur.applyMatrix3(e),this.setXYZ(t,ur.x,ur.y,ur.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ur.fromBufferAttribute(this,t),ur.applyMatrix4(e),this.setXYZ(t,ur.x,ur.y,ur.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ur.fromBufferAttribute(this,t),ur.applyNormalMatrix(e),this.setXYZ(t,ur.x,ur.y,ur.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ur.fromBufferAttribute(this,t),ur.transformDirection(e),this.setXYZ(t,ur.x,ur.y,ur.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=os(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Un(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=os(t,this.array)),t}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=os(t,this.array)),t}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=os(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=os(t,this.array)),t}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,a){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=a,this}setXYZW(e,t,n,a,o){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array),o=Un(o,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=a,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==CG&&(e.usage=this.usage),e}}class VD extends Ri{constructor(e,t,n){super(new Int8Array(e),t,n)}}class MD extends Ri{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class ND extends Ri{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class HD extends Ri{constructor(e,t,n){super(new Int16Array(e),t,n)}}class IH extends Ri{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class XD extends Ri{constructor(e,t,n){super(new Int32Array(e),t,n)}}class dH extends Ri{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class FD extends Ri{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=$0(this.array[e*this.itemSize]);return this.normalized&&(t=os(t,this.array)),t}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize]=ws(t),this}getY(e){let t=$0(this.array[e*this.itemSize+1]);return this.normalized&&(t=os(t,this.array)),t}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+1]=ws(t),this}getZ(e){let t=$0(this.array[e*this.itemSize+2]);return this.normalized&&(t=os(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+2]=ws(t),this}getW(e){let t=$0(this.array[e*this.itemSize+3]);return this.normalized&&(t=os(t,this.array)),t}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+3]=ws(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.array[e+0]=ws(t),this.array[e+1]=ws(n),this}setXYZ(e,t,n,a){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array)),this.array[e+0]=ws(t),this.array[e+1]=ws(n),this.array[e+2]=ws(a),this}setXYZW(e,t,n,a,o){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array),o=Un(o,this.array)),this.array[e+0]=ws(t),this.array[e+1]=ws(n),this.array[e+2]=ws(a),this.array[e+3]=ws(o),this}}class hn extends Ri{constructor(e,t,n){super(new Float32Array(e),t,n)}}let YD=0;const Yl=new Sn,pM=new gi,Tm=new q,gl=new ho,F0=new ho,zr=new q;class Ln extends au{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:YD++}),this.uuid=hl(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(qE(e)?dH:IH)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new kn().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const a=this.attributes.tangent;return a!==void 0&&(a.transformDirection(e),a.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Yl.makeRotationFromQuaternion(e),this.applyMatrix4(Yl),this}rotateX(e){return Yl.makeRotationX(e),this.applyMatrix4(Yl),this}rotateY(e){return Yl.makeRotationY(e),this.applyMatrix4(Yl),this}rotateZ(e){return Yl.makeRotationZ(e),this.applyMatrix4(Yl),this}translate(e,t,n){return Yl.makeTranslation(e,t,n),this.applyMatrix4(Yl),this}scale(e,t,n){return Yl.makeScale(e,t,n),this.applyMatrix4(Yl),this}lookAt(e){return pM.lookAt(e),pM.updateMatrix(),this.applyMatrix4(pM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Tm).negate(),this.translate(Tm.x,Tm.y,Tm.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let a=0,o=e.length;a<o;a++){const l=e[a];n.push(l.x,l.y,l.z||0)}this.setAttribute("position",new hn(n,3))}else{for(let n=0,a=t.count;n<a;n++){const o=e[n];t.setXYZ(n,o.x,o.y,o.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ho);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new q(-1/0,-1/0,-1/0),new q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,a=t.length;n<a;n++){const o=t[n];gl.setFromBufferAttribute(o),this.morphTargetsRelative?(zr.addVectors(this.boundingBox.min,gl.min),this.boundingBox.expandByPoint(zr),zr.addVectors(this.boundingBox.max,gl.max),this.boundingBox.expandByPoint(zr)):(this.boundingBox.expandByPoint(gl.min),this.boundingBox.expandByPoint(gl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ao);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new q,1/0);return}if(e){const n=this.boundingSphere.center;if(gl.setFromBufferAttribute(e),t)for(let o=0,l=t.length;o<l;o++){const u=t[o];F0.setFromBufferAttribute(u),this.morphTargetsRelative?(zr.addVectors(gl.min,F0.min),gl.expandByPoint(zr),zr.addVectors(gl.max,F0.max),gl.expandByPoint(zr)):(gl.expandByPoint(F0.min),gl.expandByPoint(F0.max))}gl.getCenter(n);let a=0;for(let o=0,l=e.count;o<l;o++)zr.fromBufferAttribute(e,o),a=Math.max(a,n.distanceToSquared(zr));if(t)for(let o=0,l=t.length;o<l;o++){const u=t[o],d=this.morphTargetsRelative;for(let C=0,A=u.count;C<A;C++)zr.fromBufferAttribute(u,C),d&&(Tm.fromBufferAttribute(e,C),zr.add(Tm)),a=Math.max(a,n.distanceToSquared(zr))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,a=t.normal,o=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ri(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],d=[];for(let k=0;k<n.count;k++)u[k]=new q,d[k]=new q;const C=new q,A=new q,p=new q,m=new ut,y=new ut,G=new ut,w=new q,R=new q;function Z(k,E,F){C.fromBufferAttribute(n,k),A.fromBufferAttribute(n,E),p.fromBufferAttribute(n,F),m.fromBufferAttribute(o,k),y.fromBufferAttribute(o,E),G.fromBufferAttribute(o,F),A.sub(C),p.sub(C),y.sub(m),G.sub(m);const U=1/(y.x*G.y-G.x*y.y);isFinite(U)&&(w.copy(A).multiplyScalar(G.y).addScaledVector(p,-y.y).multiplyScalar(U),R.copy(p).multiplyScalar(y.x).addScaledVector(A,-G.x).multiplyScalar(U),u[k].add(w),u[E].add(w),u[F].add(w),d[k].add(R),d[E].add(R),d[F].add(R))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let k=0,E=x.length;k<E;++k){const F=x[k],U=F.start,le=F.count;for(let ie=U,Ce=U+le;ie<Ce;ie+=3)Z(e.getX(ie+0),e.getX(ie+1),e.getX(ie+2))}const W=new q,N=new q,K=new q,T=new q;function L(k){K.fromBufferAttribute(a,k),T.copy(K);const E=u[k];W.copy(E),W.sub(K.multiplyScalar(K.dot(E))).normalize(),N.crossVectors(T,E);const U=N.dot(d[k])<0?-1:1;l.setXYZW(k,W.x,W.y,W.z,U)}for(let k=0,E=x.length;k<E;++k){const F=x[k],U=F.start,le=F.count;for(let ie=U,Ce=U+le;ie<Ce;ie+=3)L(e.getX(ie+0)),L(e.getX(ie+1)),L(e.getX(ie+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Ri(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let m=0,y=n.count;m<y;m++)n.setXYZ(m,0,0,0);const a=new q,o=new q,l=new q,u=new q,d=new q,C=new q,A=new q,p=new q;if(e)for(let m=0,y=e.count;m<y;m+=3){const G=e.getX(m+0),w=e.getX(m+1),R=e.getX(m+2);a.fromBufferAttribute(t,G),o.fromBufferAttribute(t,w),l.fromBufferAttribute(t,R),A.subVectors(l,o),p.subVectors(a,o),A.cross(p),u.fromBufferAttribute(n,G),d.fromBufferAttribute(n,w),C.fromBufferAttribute(n,R),u.add(A),d.add(A),C.add(A),n.setXYZ(G,u.x,u.y,u.z),n.setXYZ(w,d.x,d.y,d.z),n.setXYZ(R,C.x,C.y,C.z)}else for(let m=0,y=t.count;m<y;m+=3)a.fromBufferAttribute(t,m+0),o.fromBufferAttribute(t,m+1),l.fromBufferAttribute(t,m+2),A.subVectors(l,o),p.subVectors(a,o),A.cross(p),n.setXYZ(m+0,A.x,A.y,A.z),n.setXYZ(m+1,A.x,A.y,A.z),n.setXYZ(m+2,A.x,A.y,A.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)zr.fromBufferAttribute(e,t),zr.normalize(),e.setXYZ(t,zr.x,zr.y,zr.z)}toNonIndexed(){function e(u,d){const C=u.array,A=u.itemSize,p=u.normalized,m=new C.constructor(d.length*A);let y=0,G=0;for(let w=0,R=d.length;w<R;w++){u.isInterleavedBufferAttribute?y=d[w]*u.data.stride+u.offset:y=d[w]*A;for(let Z=0;Z<A;Z++)m[G++]=C[y++]}return new Ri(m,A,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ln,n=this.index.array,a=this.attributes;for(const u in a){const d=a[u],C=e(d,n);t.setAttribute(u,C)}const o=this.morphAttributes;for(const u in o){const d=[],C=o[u];for(let A=0,p=C.length;A<p;A++){const m=C[A],y=e(m,n);d.push(y)}t.morphAttributes[u]=d}t.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,d=l.length;u<d;u++){const C=l[u];t.addGroup(C.start,C.count,C.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const d=this.parameters;for(const C in d)d[C]!==void 0&&(e[C]=d[C]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const d in n){const C=n[d];e.data.attributes[d]=C.toJSON(e.data)}const a={};let o=!1;for(const d in this.morphAttributes){const C=this.morphAttributes[d],A=[];for(let p=0,m=C.length;p<m;p++){const y=C[p];A.push(y.toJSON(e.data))}A.length>0&&(a[d]=A,o=!0)}o&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const a=e.attributes;for(const C in a){const A=a[C];this.setAttribute(C,A.clone(t))}const o=e.morphAttributes;for(const C in o){const A=[],p=o[C];for(let m=0,y=p.length;m<y;m++)A.push(p[m].clone(t));this.morphAttributes[C]=A}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let C=0,A=l.length;C<A;C++){const p=l[C];this.addGroup(p.start,p.count,p.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const d=e.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const GF=new Sn,cA=new qA,SS=new Ao,BF=new q,RS=new q,wS=new q,xS=new q,mM=new q,WS=new q,ZF=new q,VS=new q;class tr extends gi{constructor(e=new Ln,t=new Cl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const a=t[n[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=a.length;o<l;o++){const u=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=o}}}}getVertexPosition(e,t){const n=this.geometry,a=n.attributes.position,o=n.morphAttributes.position,l=n.morphTargetsRelative;t.fromBufferAttribute(a,e);const u=this.morphTargetInfluences;if(o&&u){WS.set(0,0,0);for(let d=0,C=o.length;d<C;d++){const A=u[d],p=o[d];A!==0&&(mM.fromBufferAttribute(p,e),l?WS.addScaledVector(mM,A):WS.addScaledVector(mM.sub(t),A))}t.add(WS)}return t}raycast(e,t){const n=this.geometry,a=this.material,o=this.matrixWorld;a!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),SS.copy(n.boundingSphere),SS.applyMatrix4(o),cA.copy(e.ray).recast(e.near),!(SS.containsPoint(cA.origin)===!1&&(cA.intersectSphere(SS,BF)===null||cA.origin.distanceToSquared(BF)>(e.far-e.near)**2))&&(GF.copy(o).invert(),cA.copy(e.ray).applyMatrix4(GF),!(n.boundingBox!==null&&cA.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,cA)))}_computeIntersections(e,t,n){let a;const o=this.geometry,l=this.material,u=o.index,d=o.attributes.position,C=o.attributes.uv,A=o.attributes.uv1,p=o.attributes.normal,m=o.groups,y=o.drawRange;if(u!==null)if(Array.isArray(l))for(let G=0,w=m.length;G<w;G++){const R=m[G],Z=l[R.materialIndex],x=Math.max(R.start,y.start),W=Math.min(u.count,Math.min(R.start+R.count,y.start+y.count));for(let N=x,K=W;N<K;N+=3){const T=u.getX(N),L=u.getX(N+1),k=u.getX(N+2);a=MS(this,Z,e,n,C,A,p,T,L,k),a&&(a.faceIndex=Math.floor(N/3),a.face.materialIndex=R.materialIndex,t.push(a))}}else{const G=Math.max(0,y.start),w=Math.min(u.count,y.start+y.count);for(let R=G,Z=w;R<Z;R+=3){const x=u.getX(R),W=u.getX(R+1),N=u.getX(R+2);a=MS(this,l,e,n,C,A,p,x,W,N),a&&(a.faceIndex=Math.floor(R/3),t.push(a))}}else if(d!==void 0)if(Array.isArray(l))for(let G=0,w=m.length;G<w;G++){const R=m[G],Z=l[R.materialIndex],x=Math.max(R.start,y.start),W=Math.min(d.count,Math.min(R.start+R.count,y.start+y.count));for(let N=x,K=W;N<K;N+=3){const T=N,L=N+1,k=N+2;a=MS(this,Z,e,n,C,A,p,T,L,k),a&&(a.faceIndex=Math.floor(N/3),a.face.materialIndex=R.materialIndex,t.push(a))}}else{const G=Math.max(0,y.start),w=Math.min(d.count,y.start+y.count);for(let R=G,Z=w;R<Z;R+=3){const x=R,W=R+1,N=R+2;a=MS(this,l,e,n,C,A,p,x,W,N),a&&(a.faceIndex=Math.floor(R/3),t.push(a))}}}}function TD(s,e,t,n,a,o,l,u){let d;if(e.side===ss?d=n.intersectTriangle(l,o,a,!0,u):d=n.intersectTriangle(a,o,l,e.side===iu,u),d===null)return null;VS.copy(u),VS.applyMatrix4(s.matrixWorld);const C=t.ray.origin.distanceTo(VS);return C<t.near||C>t.far?null:{distance:C,point:VS.clone(),object:s}}function MS(s,e,t,n,a,o,l,u,d,C){s.getVertexPosition(u,RS),s.getVertexPosition(d,wS),s.getVertexPosition(C,xS);const A=TD(s,e,t,n,RS,wS,xS,ZF);if(A){const p=new q;Ms.getBarycoord(ZF,RS,wS,xS,p),a&&(A.uv=Ms.getInterpolatedAttribute(a,u,d,C,p,new ut)),o&&(A.uv1=Ms.getInterpolatedAttribute(o,u,d,C,p,new ut)),l&&(A.normal=Ms.getInterpolatedAttribute(l,u,d,C,p,new q),A.normal.dot(n.direction)>0&&A.normal.multiplyScalar(-1));const m={a:u,b:d,c:C,normal:new q,materialIndex:0};Ms.getNormal(RS,wS,xS,m.normal),A.face=m,A.barycoord=p}return A}class $A extends Ln{constructor(e=1,t=1,n=1,a=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:a,heightSegments:o,depthSegments:l};const u=this;a=Math.floor(a),o=Math.floor(o),l=Math.floor(l);const d=[],C=[],A=[],p=[];let m=0,y=0;G("z","y","x",-1,-1,n,t,e,l,o,0),G("z","y","x",1,-1,n,t,-e,l,o,1),G("x","z","y",1,1,e,n,t,a,l,2),G("x","z","y",1,-1,e,n,-t,a,l,3),G("x","y","z",1,-1,e,t,n,a,o,4),G("x","y","z",-1,-1,e,t,-n,a,o,5),this.setIndex(d),this.setAttribute("position",new hn(C,3)),this.setAttribute("normal",new hn(A,3)),this.setAttribute("uv",new hn(p,2));function G(w,R,Z,x,W,N,K,T,L,k,E){const F=N/L,U=K/k,le=N/2,ie=K/2,Ce=T/2,Ge=L+1,ye=k+1;let pe=0,de=0;const Oe=new q;for(let We=0;We<ye;We++){const ke=We*U-ie;for(let $e=0;$e<Ge;$e++){const ot=$e*F-le;Oe[w]=ot*x,Oe[R]=ke*W,Oe[Z]=Ce,C.push(Oe.x,Oe.y,Oe.z),Oe[w]=0,Oe[R]=0,Oe[Z]=T>0?1:-1,A.push(Oe.x,Oe.y,Oe.z),p.push($e/L),p.push(1-We/k),pe+=1}}for(let We=0;We<k;We++)for(let ke=0;ke<L;ke++){const $e=m+ke+Ge*We,ot=m+ke+Ge*(We+1),Ne=m+(ke+1)+Ge*(We+1),tt=m+(ke+1)+Ge*We;d.push($e,ot,tt),d.push(ot,Ne,tt),de+=6}u.addGroup(y,de,E),y+=de,m+=pe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $A(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function gb(s){const e={};for(const t in s){e[t]={};for(const n in s[t]){const a=s[t][n];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=a.clone():Array.isArray(a)?e[t][n]=a.slice():e[t][n]=a}}return e}function is(s){const e={};for(let t=0;t<s.length;t++){const n=gb(s[t]);for(const a in n)e[a]=n[a]}return e}function ED(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}function iK(s){const e=s.getRenderTarget();return e===null?s.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:mi.workingColorSpace}const aK={clone:gb,merge:is};var KD=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,LD=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class _c extends Zr{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=KD,this.fragmentShader=LD,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=gb(e.uniforms),this.uniformsGroups=ED(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const a in this.uniforms){const l=this.uniforms[a].value;l&&l.isTexture?t.uniforms[a]={type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?t.uniforms[a]={type:"c",value:l.getHex()}:l&&l.isVector2?t.uniforms[a]={type:"v2",value:l.toArray()}:l&&l.isVector3?t.uniforms[a]={type:"v3",value:l.toArray()}:l&&l.isVector4?t.uniforms[a]={type:"v4",value:l.toArray()}:l&&l.isMatrix3?t.uniforms[a]={type:"m3",value:l.toArray()}:l&&l.isMatrix4?t.uniforms[a]={type:"m4",value:l.toArray()}:t.uniforms[a]={value:l}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const a in this.extensions)this.extensions[a]===!0&&(n[a]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class SG extends gi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Sn,this.projectionMatrix=new Sn,this.projectionMatrixInverse=new Sn,this.coordinateSystem=$g}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const nC=new q,SF=new ut,RF=new ut;class Aa extends SG{constructor(e=50,t=1,n=.1,a=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=a,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=cb*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(TA*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return cb*2*Math.atan(Math.tan(TA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){nC.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(nC.x,nC.y).multiplyScalar(-e/nC.z),nC.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(nC.x,nC.y).multiplyScalar(-e/nC.z)}getViewSize(e,t){return this.getViewBounds(e,SF,RF),t.subVectors(RF,SF)}setViewOffset(e,t,n,a,o,l){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=a,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(TA*.5*this.fov)/this.zoom,n=2*t,a=this.aspect*n,o=-.5*a;const l=this.view;if(this.view!==null&&this.view.enabled){const d=l.fullWidth,C=l.fullHeight;o+=l.offsetX*a/d,t-=l.offsetY*n/C,a*=l.width/d,n*=l.height/C}const u=this.filmOffset;u!==0&&(o+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+a,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Em=-90,Km=1;class rK extends gi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const a=new Aa(Em,Km,e,t);a.layers=this.layers,this.add(a);const o=new Aa(Em,Km,e,t);o.layers=this.layers,this.add(o);const l=new Aa(Em,Km,e,t);l.layers=this.layers,this.add(l);const u=new Aa(Em,Km,e,t);u.layers=this.layers,this.add(u);const d=new Aa(Em,Km,e,t);d.layers=this.layers,this.add(d);const C=new Aa(Em,Km,e,t);C.layers=this.layers,this.add(C)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,a,o,l,u,d]=t;for(const C of t)this.remove(C);if(e===$g)n.up.set(0,1,0),n.lookAt(1,0,0),a.up.set(0,1,0),a.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),l.up.set(0,0,1),l.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),d.up.set(0,1,0),d.lookAt(0,0,-1);else if(e===hG)n.up.set(0,-1,0),n.lookAt(-1,0,0),a.up.set(0,-1,0),a.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),l.up.set(0,0,-1),l.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),d.up.set(0,-1,0),d.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const C of t)this.add(C),C.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:a}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,l,u,d,C,A]=this.children,p=e.getRenderTarget(),m=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),G=e.xr.enabled;e.xr.enabled=!1;const w=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,a),e.render(t,o),e.setRenderTarget(n,1,a),e.render(t,l),e.setRenderTarget(n,2,a),e.render(t,u),e.setRenderTarget(n,3,a),e.render(t,d),e.setRenderTarget(n,4,a),e.render(t,C),n.texture.generateMipmaps=w,e.setRenderTarget(n,5,a),e.render(t,A),e.setRenderTarget(p,m,y),e.xr.enabled=G,n.texture.needsPMREMUpdate=!0}}class RG extends fa{constructor(e,t,n,a,o,l,u,d,C,A){e=e!==void 0?e:[],t=t!==void 0?t:WI,super(e,t,n,a,o,l,u,d,C,A),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class oK extends zc{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},a=[n,n,n,n,n,n];this.texture=new RG(a,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:er}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},a=new $A(5,5,5),o=new _c({name:"CubemapFromEquirect",uniforms:gb(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:ss,blending:RI});o.uniforms.tEquirect.value=t;const l=new tr(a,o),u=t.minFilter;return t.minFilter===Ll&&(t.minFilter=er),new rK(1,10,this).update(e,l),t.minFilter=u,l.geometry.dispose(),l.material.dispose(),this}clear(e,t,n,a){const o=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(t,n,a);e.setRenderTarget(o)}}const bM=new q,zD=new q,_D=new kn;class bI{constructor(e=new q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const a=bM.subVectors(n,t).cross(zD.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(a,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(bM),a=this.normal.dot(n);if(a===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/a;return o<0||o>1?null:t.copy(e.start).addScaledVector(n,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||_D.getNormalMatrix(e),a=this.coplanarPoint(bM).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-a.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const gA=new Ao,NS=new q;class wG{constructor(e=new bI,t=new bI,n=new bI,a=new bI,o=new bI,l=new bI){this.planes=[e,t,n,a,o,l]}set(e,t,n,a,o,l){const u=this.planes;return u[0].copy(e),u[1].copy(t),u[2].copy(n),u[3].copy(a),u[4].copy(o),u[5].copy(l),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=$g){const n=this.planes,a=e.elements,o=a[0],l=a[1],u=a[2],d=a[3],C=a[4],A=a[5],p=a[6],m=a[7],y=a[8],G=a[9],w=a[10],R=a[11],Z=a[12],x=a[13],W=a[14],N=a[15];if(n[0].setComponents(d-o,m-C,R-y,N-Z).normalize(),n[1].setComponents(d+o,m+C,R+y,N+Z).normalize(),n[2].setComponents(d+l,m+A,R+G,N+x).normalize(),n[3].setComponents(d-l,m-A,R-G,N-x).normalize(),n[4].setComponents(d-u,m-p,R-w,N-W).normalize(),t===$g)n[5].setComponents(d+u,m+p,R+w,N+W).normalize();else if(t===hG)n[5].setComponents(u,p,w,W).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),gA.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),gA.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(gA)}intersectsSprite(e){return gA.center.set(0,0,0),gA.radius=.7071067811865476,gA.applyMatrix4(e.matrixWorld),this.intersectsSphere(gA)}intersectsSphere(e){const t=this.planes,n=e.center,a=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(n)<a)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const a=t[n];if(NS.x=a.normal.x>0?e.max.x:e.min.x,NS.y=a.normal.y>0?e.max.y:e.min.y,NS.z=a.normal.z>0?e.max.z:e.min.z,a.distanceToPoint(NS)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function sK(){let s=null,e=!1,t=null,n=null;function a(o,l){t(o,l),n=s.requestAnimationFrame(a)}return{start:function(){e!==!0&&t!==null&&(n=s.requestAnimationFrame(a),e=!0)},stop:function(){s.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){s=o}}}function DD(s){const e=new WeakMap;function t(u,d){const C=u.array,A=u.usage,p=C.byteLength,m=s.createBuffer();s.bindBuffer(d,m),s.bufferData(d,C,A),u.onUploadCallback();let y;if(C instanceof Float32Array)y=s.FLOAT;else if(C instanceof Uint16Array)u.isFloat16BufferAttribute?y=s.HALF_FLOAT:y=s.UNSIGNED_SHORT;else if(C instanceof Int16Array)y=s.SHORT;else if(C instanceof Uint32Array)y=s.UNSIGNED_INT;else if(C instanceof Int32Array)y=s.INT;else if(C instanceof Int8Array)y=s.BYTE;else if(C instanceof Uint8Array)y=s.UNSIGNED_BYTE;else if(C instanceof Uint8ClampedArray)y=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+C);return{buffer:m,type:y,bytesPerElement:C.BYTES_PER_ELEMENT,version:u.version,size:p}}function n(u,d,C){const A=d.array,p=d.updateRanges;if(s.bindBuffer(C,u),p.length===0)s.bufferSubData(C,0,A);else{p.sort((y,G)=>y.start-G.start);let m=0;for(let y=1;y<p.length;y++){const G=p[m],w=p[y];w.start<=G.start+G.count+1?G.count=Math.max(G.count,w.start+w.count-G.start):(++m,p[m]=w)}p.length=m+1;for(let y=0,G=p.length;y<G;y++){const w=p[y];s.bufferSubData(C,w.start*A.BYTES_PER_ELEMENT,A,w.start,w.count)}d.clearUpdateRanges()}d.onUploadCallback()}function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);const d=e.get(u);d&&(s.deleteBuffer(d.buffer),e.delete(u))}function l(u,d){if(u.isInterleavedBufferAttribute&&(u=u.data),u.isGLBufferAttribute){const A=e.get(u);(!A||A.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}const C=e.get(u);if(C===void 0)e.set(u,t(u,d));else if(C.version<u.version){if(C.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(C.buffer,u,d),C.version=u.version}}return{get:a,remove:o,update:l}}class Ab extends Ln{constructor(e=1,t=1,n=1,a=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:a};const o=e/2,l=t/2,u=Math.floor(n),d=Math.floor(a),C=u+1,A=d+1,p=e/u,m=t/d,y=[],G=[],w=[],R=[];for(let Z=0;Z<A;Z++){const x=Z*m-l;for(let W=0;W<C;W++){const N=W*p-o;G.push(N,-x,0),w.push(0,0,1),R.push(W/u),R.push(1-Z/d)}}for(let Z=0;Z<d;Z++)for(let x=0;x<u;x++){const W=x+C*Z,N=x+C*(Z+1),K=x+1+C*(Z+1),T=x+1+C*Z;y.push(W,N,T),y.push(N,K,T)}this.setIndex(y),this.setAttribute("position",new hn(G,3)),this.setAttribute("normal",new hn(w,3)),this.setAttribute("uv",new hn(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ab(e.width,e.height,e.widthSegments,e.heightSegments)}}var kD=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,UD=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,JD=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,OD=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,PD=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,QD=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,jD=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,qD=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$D=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,ek=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,tk=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,nk=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ik=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,ak=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,rk=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,ok=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,sk=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,lk=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,ck=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,gk=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,uk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Ik=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,dk=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Ck=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,hk=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Ak=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,fk=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,pk=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,mk=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,bk=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,vk="gl_FragColor = linearToOutputTexel( gl_FragColor );",yk=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Gk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Bk=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Zk=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Sk=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Rk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,wk=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,xk=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Wk=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Vk=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Mk=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Nk=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Hk=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Xk=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Fk=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Yk=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Tk=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Ek=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Kk=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Lk=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,zk=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,_k=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Dk=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,kk=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Uk=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Jk=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Ok=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Pk=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Qk=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,jk=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,qk=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,$k=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,eU=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,tU=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,nU=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,iU=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,aU=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,rU=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,oU=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,sU=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,lU=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,cU=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,gU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,uU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,IU=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,dU=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,CU=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,hU=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,AU=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,fU=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,pU=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,mU=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,bU=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,vU=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,yU=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,GU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,BU=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,ZU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,SU=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,RU=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,wU=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,xU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,WU=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,VU=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,MU=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,NU=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,HU=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,XU=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,FU=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,YU=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,TU=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,EU=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,KU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,LU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,zU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,_U=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const DU=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,kU=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,UU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,JU=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,OU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,PU=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,QU=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,jU=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,qU=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,$U=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,eJ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,tJ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,nJ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,iJ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,aJ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,rJ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oJ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sJ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lJ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,cJ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gJ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,uJ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,IJ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dJ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CJ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,hJ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AJ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fJ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pJ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,mJ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bJ=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vJ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,yJ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,GJ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,qn={alphahash_fragment:kD,alphahash_pars_fragment:UD,alphamap_fragment:JD,alphamap_pars_fragment:OD,alphatest_fragment:PD,alphatest_pars_fragment:QD,aomap_fragment:jD,aomap_pars_fragment:qD,batching_pars_vertex:$D,batching_vertex:ek,begin_vertex:tk,beginnormal_vertex:nk,bsdfs:ik,iridescence_fragment:ak,bumpmap_pars_fragment:rk,clipping_planes_fragment:ok,clipping_planes_pars_fragment:sk,clipping_planes_pars_vertex:lk,clipping_planes_vertex:ck,color_fragment:gk,color_pars_fragment:uk,color_pars_vertex:Ik,color_vertex:dk,common:Ck,cube_uv_reflection_fragment:hk,defaultnormal_vertex:Ak,displacementmap_pars_vertex:fk,displacementmap_vertex:pk,emissivemap_fragment:mk,emissivemap_pars_fragment:bk,colorspace_fragment:vk,colorspace_pars_fragment:yk,envmap_fragment:Gk,envmap_common_pars_fragment:Bk,envmap_pars_fragment:Zk,envmap_pars_vertex:Sk,envmap_physical_pars_fragment:Yk,envmap_vertex:Rk,fog_vertex:wk,fog_pars_vertex:xk,fog_fragment:Wk,fog_pars_fragment:Vk,gradientmap_pars_fragment:Mk,lightmap_pars_fragment:Nk,lights_lambert_fragment:Hk,lights_lambert_pars_fragment:Xk,lights_pars_begin:Fk,lights_toon_fragment:Tk,lights_toon_pars_fragment:Ek,lights_phong_fragment:Kk,lights_phong_pars_fragment:Lk,lights_physical_fragment:zk,lights_physical_pars_fragment:_k,lights_fragment_begin:Dk,lights_fragment_maps:kk,lights_fragment_end:Uk,logdepthbuf_fragment:Jk,logdepthbuf_pars_fragment:Ok,logdepthbuf_pars_vertex:Pk,logdepthbuf_vertex:Qk,map_fragment:jk,map_pars_fragment:qk,map_particle_fragment:$k,map_particle_pars_fragment:eU,metalnessmap_fragment:tU,metalnessmap_pars_fragment:nU,morphinstance_vertex:iU,morphcolor_vertex:aU,morphnormal_vertex:rU,morphtarget_pars_vertex:oU,morphtarget_vertex:sU,normal_fragment_begin:lU,normal_fragment_maps:cU,normal_pars_fragment:gU,normal_pars_vertex:uU,normal_vertex:IU,normalmap_pars_fragment:dU,clearcoat_normal_fragment_begin:CU,clearcoat_normal_fragment_maps:hU,clearcoat_pars_fragment:AU,iridescence_pars_fragment:fU,opaque_fragment:pU,packing:mU,premultiplied_alpha_fragment:bU,project_vertex:vU,dithering_fragment:yU,dithering_pars_fragment:GU,roughnessmap_fragment:BU,roughnessmap_pars_fragment:ZU,shadowmap_pars_fragment:SU,shadowmap_pars_vertex:RU,shadowmap_vertex:wU,shadowmask_pars_fragment:xU,skinbase_vertex:WU,skinning_pars_vertex:VU,skinning_vertex:MU,skinnormal_vertex:NU,specularmap_fragment:HU,specularmap_pars_fragment:XU,tonemapping_fragment:FU,tonemapping_pars_fragment:YU,transmission_fragment:TU,transmission_pars_fragment:EU,uv_pars_fragment:KU,uv_pars_vertex:LU,uv_vertex:zU,worldpos_vertex:_U,background_vert:DU,background_frag:kU,backgroundCube_vert:UU,backgroundCube_frag:JU,cube_vert:OU,cube_frag:PU,depth_vert:QU,depth_frag:jU,distanceRGBA_vert:qU,distanceRGBA_frag:$U,equirect_vert:eJ,equirect_frag:tJ,linedashed_vert:nJ,linedashed_frag:iJ,meshbasic_vert:aJ,meshbasic_frag:rJ,meshlambert_vert:oJ,meshlambert_frag:sJ,meshmatcap_vert:lJ,meshmatcap_frag:cJ,meshnormal_vert:gJ,meshnormal_frag:uJ,meshphong_vert:IJ,meshphong_frag:dJ,meshphysical_vert:CJ,meshphysical_frag:hJ,meshtoon_vert:AJ,meshtoon_frag:fJ,points_vert:pJ,points_frag:mJ,shadow_vert:bJ,shadow_frag:vJ,sprite_vert:yJ,sprite_frag:GJ},qt={common:{diffuse:{value:new $t(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new kn},alphaMap:{value:null},alphaMapTransform:{value:new kn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new kn}},envmap:{envMap:{value:null},envMapRotation:{value:new kn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new kn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new kn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new kn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new kn},normalScale:{value:new ut(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new kn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new kn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new kn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new kn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $t(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $t(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new kn},alphaTest:{value:0},uvTransform:{value:new kn}},sprite:{diffuse:{value:new $t(16777215)},opacity:{value:1},center:{value:new ut(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new kn},alphaMap:{value:null},alphaMapTransform:{value:new kn},alphaTest:{value:0}}},Ec={basic:{uniforms:is([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.fog]),vertexShader:qn.meshbasic_vert,fragmentShader:qn.meshbasic_frag},lambert:{uniforms:is([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,qt.lights,{emissive:{value:new $t(0)}}]),vertexShader:qn.meshlambert_vert,fragmentShader:qn.meshlambert_frag},phong:{uniforms:is([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,qt.lights,{emissive:{value:new $t(0)},specular:{value:new $t(1118481)},shininess:{value:30}}]),vertexShader:qn.meshphong_vert,fragmentShader:qn.meshphong_frag},standard:{uniforms:is([qt.common,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.roughnessmap,qt.metalnessmap,qt.fog,qt.lights,{emissive:{value:new $t(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qn.meshphysical_vert,fragmentShader:qn.meshphysical_frag},toon:{uniforms:is([qt.common,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.gradientmap,qt.fog,qt.lights,{emissive:{value:new $t(0)}}]),vertexShader:qn.meshtoon_vert,fragmentShader:qn.meshtoon_frag},matcap:{uniforms:is([qt.common,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,{matcap:{value:null}}]),vertexShader:qn.meshmatcap_vert,fragmentShader:qn.meshmatcap_frag},points:{uniforms:is([qt.points,qt.fog]),vertexShader:qn.points_vert,fragmentShader:qn.points_frag},dashed:{uniforms:is([qt.common,qt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qn.linedashed_vert,fragmentShader:qn.linedashed_frag},depth:{uniforms:is([qt.common,qt.displacementmap]),vertexShader:qn.depth_vert,fragmentShader:qn.depth_frag},normal:{uniforms:is([qt.common,qt.bumpmap,qt.normalmap,qt.displacementmap,{opacity:{value:1}}]),vertexShader:qn.meshnormal_vert,fragmentShader:qn.meshnormal_frag},sprite:{uniforms:is([qt.sprite,qt.fog]),vertexShader:qn.sprite_vert,fragmentShader:qn.sprite_frag},background:{uniforms:{uvTransform:{value:new kn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:qn.background_vert,fragmentShader:qn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new kn}},vertexShader:qn.backgroundCube_vert,fragmentShader:qn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qn.cube_vert,fragmentShader:qn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qn.equirect_vert,fragmentShader:qn.equirect_frag},distanceRGBA:{uniforms:is([qt.common,qt.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qn.distanceRGBA_vert,fragmentShader:qn.distanceRGBA_frag},shadow:{uniforms:is([qt.lights,qt.fog,{color:{value:new $t(0)},opacity:{value:1}}]),vertexShader:qn.shadow_vert,fragmentShader:qn.shadow_frag}};Ec.physical={uniforms:is([Ec.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new kn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new kn},clearcoatNormalScale:{value:new ut(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new kn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new kn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new kn},sheen:{value:0},sheenColor:{value:new $t(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new kn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new kn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new kn},transmissionSamplerSize:{value:new ut},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new kn},attenuationDistance:{value:0},attenuationColor:{value:new $t(0)},specularColor:{value:new $t(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new kn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new kn},anisotropyVector:{value:new ut},anisotropyMap:{value:null},anisotropyMapTransform:{value:new kn}}]),vertexShader:qn.meshphysical_vert,fragmentShader:qn.meshphysical_frag};const HS={r:0,b:0,g:0},uA=new Hs,BJ=new Sn;function ZJ(s,e,t,n,a,o,l){const u=new $t(0);let d=o===!0?0:1,C,A,p=null,m=0,y=null;function G(x){let W=x.isScene===!0?x.background:null;return W&&W.isTexture&&(W=(x.backgroundBlurriness>0?t:e).get(W)),W}function w(x){let W=!1;const N=G(x);N===null?Z(u,d):N&&N.isColor&&(Z(N,1),W=!0);const K=s.xr.getEnvironmentBlendMode();K==="additive"?n.buffers.color.setClear(0,0,0,1,l):K==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,l),(s.autoClear||W)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil))}function R(x,W){const N=G(W);N&&(N.isCubeTexture||N.mapping===Cb)?(A===void 0&&(A=new tr(new $A(1,1,1),new _c({name:"BackgroundCubeMaterial",uniforms:gb(Ec.backgroundCube.uniforms),vertexShader:Ec.backgroundCube.vertexShader,fragmentShader:Ec.backgroundCube.fragmentShader,side:ss,depthTest:!1,depthWrite:!1,fog:!1})),A.geometry.deleteAttribute("normal"),A.geometry.deleteAttribute("uv"),A.onBeforeRender=function(K,T,L){this.matrixWorld.copyPosition(L.matrixWorld)},Object.defineProperty(A.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(A)),uA.copy(W.backgroundRotation),uA.x*=-1,uA.y*=-1,uA.z*=-1,N.isCubeTexture&&N.isRenderTargetTexture===!1&&(uA.y*=-1,uA.z*=-1),A.material.uniforms.envMap.value=N,A.material.uniforms.flipEnvMap.value=N.isCubeTexture&&N.isRenderTargetTexture===!1?-1:1,A.material.uniforms.backgroundBlurriness.value=W.backgroundBlurriness,A.material.uniforms.backgroundIntensity.value=W.backgroundIntensity,A.material.uniforms.backgroundRotation.value.setFromMatrix4(BJ.makeRotationFromEuler(uA)),A.material.toneMapped=mi.getTransfer(N.colorSpace)!==ki,(p!==N||m!==N.version||y!==s.toneMapping)&&(A.material.needsUpdate=!0,p=N,m=N.version,y=s.toneMapping),A.layers.enableAll(),x.unshift(A,A.geometry,A.material,0,0,null)):N&&N.isTexture&&(C===void 0&&(C=new tr(new Ab(2,2),new _c({name:"BackgroundMaterial",uniforms:gb(Ec.background.uniforms),vertexShader:Ec.background.vertexShader,fragmentShader:Ec.background.fragmentShader,side:iu,depthTest:!1,depthWrite:!1,fog:!1})),C.geometry.deleteAttribute("normal"),Object.defineProperty(C.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(C)),C.material.uniforms.t2D.value=N,C.material.uniforms.backgroundIntensity.value=W.backgroundIntensity,C.material.toneMapped=mi.getTransfer(N.colorSpace)!==ki,N.matrixAutoUpdate===!0&&N.updateMatrix(),C.material.uniforms.uvTransform.value.copy(N.matrix),(p!==N||m!==N.version||y!==s.toneMapping)&&(C.material.needsUpdate=!0,p=N,m=N.version,y=s.toneMapping),C.layers.enableAll(),x.unshift(C,C.geometry,C.material,0,0,null))}function Z(x,W){x.getRGB(HS,iK(s)),n.buffers.color.setClear(HS.r,HS.g,HS.b,W,l)}return{getClearColor:function(){return u},setClearColor:function(x,W=1){u.set(x),d=W,Z(u,d)},getClearAlpha:function(){return d},setClearAlpha:function(x){d=x,Z(u,d)},render:w,addToRenderList:R}}function SJ(s,e){const t=s.getParameter(s.MAX_VERTEX_ATTRIBS),n={},a=m(null);let o=a,l=!1;function u(F,U,le,ie,Ce){let Ge=!1;const ye=p(ie,le,U);o!==ye&&(o=ye,C(o.object)),Ge=y(F,ie,le,Ce),Ge&&G(F,ie,le,Ce),Ce!==null&&e.update(Ce,s.ELEMENT_ARRAY_BUFFER),(Ge||l)&&(l=!1,N(F,U,le,ie),Ce!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.get(Ce).buffer))}function d(){return s.createVertexArray()}function C(F){return s.bindVertexArray(F)}function A(F){return s.deleteVertexArray(F)}function p(F,U,le){const ie=le.wireframe===!0;let Ce=n[F.id];Ce===void 0&&(Ce={},n[F.id]=Ce);let Ge=Ce[U.id];Ge===void 0&&(Ge={},Ce[U.id]=Ge);let ye=Ge[ie];return ye===void 0&&(ye=m(d()),Ge[ie]=ye),ye}function m(F){const U=[],le=[],ie=[];for(let Ce=0;Ce<t;Ce++)U[Ce]=0,le[Ce]=0,ie[Ce]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:le,attributeDivisors:ie,object:F,attributes:{},index:null}}function y(F,U,le,ie){const Ce=o.attributes,Ge=U.attributes;let ye=0;const pe=le.getAttributes();for(const de in pe)if(pe[de].location>=0){const We=Ce[de];let ke=Ge[de];if(ke===void 0&&(de==="instanceMatrix"&&F.instanceMatrix&&(ke=F.instanceMatrix),de==="instanceColor"&&F.instanceColor&&(ke=F.instanceColor)),We===void 0||We.attribute!==ke||ke&&We.data!==ke.data)return!0;ye++}return o.attributesNum!==ye||o.index!==ie}function G(F,U,le,ie){const Ce={},Ge=U.attributes;let ye=0;const pe=le.getAttributes();for(const de in pe)if(pe[de].location>=0){let We=Ge[de];We===void 0&&(de==="instanceMatrix"&&F.instanceMatrix&&(We=F.instanceMatrix),de==="instanceColor"&&F.instanceColor&&(We=F.instanceColor));const ke={};ke.attribute=We,We&&We.data&&(ke.data=We.data),Ce[de]=ke,ye++}o.attributes=Ce,o.attributesNum=ye,o.index=ie}function w(){const F=o.newAttributes;for(let U=0,le=F.length;U<le;U++)F[U]=0}function R(F){Z(F,0)}function Z(F,U){const le=o.newAttributes,ie=o.enabledAttributes,Ce=o.attributeDivisors;le[F]=1,ie[F]===0&&(s.enableVertexAttribArray(F),ie[F]=1),Ce[F]!==U&&(s.vertexAttribDivisor(F,U),Ce[F]=U)}function x(){const F=o.newAttributes,U=o.enabledAttributes;for(let le=0,ie=U.length;le<ie;le++)U[le]!==F[le]&&(s.disableVertexAttribArray(le),U[le]=0)}function W(F,U,le,ie,Ce,Ge,ye){ye===!0?s.vertexAttribIPointer(F,U,le,Ce,Ge):s.vertexAttribPointer(F,U,le,ie,Ce,Ge)}function N(F,U,le,ie){w();const Ce=ie.attributes,Ge=le.getAttributes(),ye=U.defaultAttributeValues;for(const pe in Ge){const de=Ge[pe];if(de.location>=0){let Oe=Ce[pe];if(Oe===void 0&&(pe==="instanceMatrix"&&F.instanceMatrix&&(Oe=F.instanceMatrix),pe==="instanceColor"&&F.instanceColor&&(Oe=F.instanceColor)),Oe!==void 0){const We=Oe.normalized,ke=Oe.itemSize,$e=e.get(Oe);if($e===void 0)continue;const ot=$e.buffer,Ne=$e.type,tt=$e.bytesPerElement,bt=Ne===s.INT||Ne===s.UNSIGNED_INT||Oe.gpuType===yw;if(Oe.isInterleavedBufferAttribute){const dt=Oe.data,yt=dt.stride,zt=Oe.offset;if(dt.isInstancedInterleavedBuffer){for(let Nt=0;Nt<de.locationSize;Nt++)Z(de.location+Nt,dt.meshPerAttribute);F.isInstancedMesh!==!0&&ie._maxInstanceCount===void 0&&(ie._maxInstanceCount=dt.meshPerAttribute*dt.count)}else for(let Nt=0;Nt<de.locationSize;Nt++)R(de.location+Nt);s.bindBuffer(s.ARRAY_BUFFER,ot);for(let Nt=0;Nt<de.locationSize;Nt++)W(de.location+Nt,ke/de.locationSize,Ne,We,yt*tt,(zt+ke/de.locationSize*Nt)*tt,bt)}else{if(Oe.isInstancedBufferAttribute){for(let dt=0;dt<de.locationSize;dt++)Z(de.location+dt,Oe.meshPerAttribute);F.isInstancedMesh!==!0&&ie._maxInstanceCount===void 0&&(ie._maxInstanceCount=Oe.meshPerAttribute*Oe.count)}else for(let dt=0;dt<de.locationSize;dt++)R(de.location+dt);s.bindBuffer(s.ARRAY_BUFFER,ot);for(let dt=0;dt<de.locationSize;dt++)W(de.location+dt,ke/de.locationSize,Ne,We,ke*tt,ke/de.locationSize*dt*tt,bt)}}else if(ye!==void 0){const We=ye[pe];if(We!==void 0)switch(We.length){case 2:s.vertexAttrib2fv(de.location,We);break;case 3:s.vertexAttrib3fv(de.location,We);break;case 4:s.vertexAttrib4fv(de.location,We);break;default:s.vertexAttrib1fv(de.location,We)}}}}x()}function K(){k();for(const F in n){const U=n[F];for(const le in U){const ie=U[le];for(const Ce in ie)A(ie[Ce].object),delete ie[Ce];delete U[le]}delete n[F]}}function T(F){if(n[F.id]===void 0)return;const U=n[F.id];for(const le in U){const ie=U[le];for(const Ce in ie)A(ie[Ce].object),delete ie[Ce];delete U[le]}delete n[F.id]}function L(F){for(const U in n){const le=n[U];if(le[F.id]===void 0)continue;const ie=le[F.id];for(const Ce in ie)A(ie[Ce].object),delete ie[Ce];delete le[F.id]}}function k(){E(),l=!0,o!==a&&(o=a,C(o.object))}function E(){a.geometry=null,a.program=null,a.wireframe=!1}return{setup:u,reset:k,resetDefaultState:E,dispose:K,releaseStatesOfGeometry:T,releaseStatesOfProgram:L,initAttributes:w,enableAttribute:R,disableUnusedAttributes:x}}function RJ(s,e,t){let n;function a(C){n=C}function o(C,A){s.drawArrays(n,C,A),t.update(A,n,1)}function l(C,A,p){p!==0&&(s.drawArraysInstanced(n,C,A,p),t.update(A,n,p))}function u(C,A,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,C,0,A,0,p);let y=0;for(let G=0;G<p;G++)y+=A[G];t.update(y,n,1)}function d(C,A,p,m){if(p===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let G=0;G<C.length;G++)l(C[G],A[G],m[G]);else{y.multiDrawArraysInstancedWEBGL(n,C,0,A,0,m,0,p);let G=0;for(let w=0;w<p;w++)G+=A[w]*m[w];t.update(G,n,1)}}this.setMode=a,this.render=o,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=d}function wJ(s,e,t,n){let a;function o(){if(a!==void 0)return a;if(e.has("EXT_texture_filter_anisotropic")===!0){const L=e.get("EXT_texture_filter_anisotropic");a=s.getParameter(L.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else a=0;return a}function l(L){return!(L!==To&&n.convert(L)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT))}function u(L){const k=L===hb&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(L!==Lc&&n.convert(L)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE)&&L!==Ns&&!k)}function d(L){if(L==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";L="mediump"}return L==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let C=t.precision!==void 0?t.precision:"highp";const A=d(C);A!==C&&(console.warn("THREE.WebGLRenderer:",C,"not supported, using",A,"instead."),C=A);const p=t.logarithmicDepthBuffer===!0,m=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),y=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),G=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),w=s.getParameter(s.MAX_TEXTURE_SIZE),R=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),Z=s.getParameter(s.MAX_VERTEX_ATTRIBS),x=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),W=s.getParameter(s.MAX_VARYING_VECTORS),N=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),K=G>0,T=s.getParameter(s.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:d,textureFormatReadable:l,textureTypeReadable:u,precision:C,logarithmicDepthBuffer:p,reverseDepthBuffer:m,maxTextures:y,maxVertexTextures:G,maxTextureSize:w,maxCubemapSize:R,maxAttributes:Z,maxVertexUniforms:x,maxVaryings:W,maxFragmentUniforms:N,vertexTextures:K,maxSamples:T}}function xJ(s){const e=this;let t=null,n=0,a=!1,o=!1;const l=new bI,u=new kn,d={value:null,needsUpdate:!1};this.uniform=d,this.numPlanes=0,this.numIntersection=0,this.init=function(p,m){const y=p.length!==0||m||n!==0||a;return a=m,n=p.length,y},this.beginShadows=function(){o=!0,A(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(p,m){t=A(p,m,0)},this.setState=function(p,m,y){const G=p.clippingPlanes,w=p.clipIntersection,R=p.clipShadows,Z=s.get(p);if(!a||G===null||G.length===0||o&&!R)o?A(null):C();else{const x=o?0:n,W=x*4;let N=Z.clippingState||null;d.value=N,N=A(G,m,W,y);for(let K=0;K!==W;++K)N[K]=t[K];Z.clippingState=N,this.numIntersection=w?this.numPlanes:0,this.numPlanes+=x}};function C(){d.value!==t&&(d.value=t,d.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function A(p,m,y,G){const w=p!==null?p.length:0;let R=null;if(w!==0){if(R=d.value,G!==!0||R===null){const Z=y+w*4,x=m.matrixWorldInverse;u.getNormalMatrix(x),(R===null||R.length<Z)&&(R=new Float32Array(Z));for(let W=0,N=y;W!==w;++W,N+=4)l.copy(p[W]).applyMatrix4(x,u),l.normal.toArray(R,N),R[N+3]=l.constant}d.value=R,d.needsUpdate=!0}return e.numPlanes=w,e.numIntersection=0,R}}function WJ(s){let e=new WeakMap;function t(l,u){return u===uG?l.mapping=WI:u===IG&&(l.mapping=sC),l}function n(l){if(l&&l.isTexture){const u=l.mapping;if(u===uG||u===IG)if(e.has(l)){const d=e.get(l).texture;return t(d,l.mapping)}else{const d=l.image;if(d&&d.height>0){const C=new oK(d.height);return C.fromEquirectangularTexture(s,l),e.set(l,C),l.addEventListener("dispose",a),t(C.texture,l.mapping)}else return null}}return l}function a(l){const u=l.target;u.removeEventListener("dispose",a);const d=e.get(u);d!==void 0&&(e.delete(u),d.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}class Kc extends SG{constructor(e=-1,t=1,n=1,a=-1,o=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=a,this.near=o,this.far=l,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,a,o,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=a,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,a=(this.top+this.bottom)/2;let o=n-e,l=n+e,u=a+t,d=a-t;if(this.view!==null&&this.view.enabled){const C=(this.right-this.left)/this.view.fullWidth/this.zoom,A=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=C*this.view.offsetX,l=o+C*this.view.width,u-=A*this.view.offsetY,d=u-A*this.view.height}this.projectionMatrix.makeOrthographic(o,l,u,d,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const qm=4,wF=[.125,.215,.35,.446,.526,.582],SA=20,vM=new Kc,xF=new $t;let yM=null,GM=0,BM=0,ZM=!1;const BA=(1+Math.sqrt(5))/2,Lm=1/BA,WF=[new q(-BA,Lm,0),new q(BA,Lm,0),new q(-Lm,0,BA),new q(Lm,0,BA),new q(0,BA,-Lm),new q(0,BA,Lm),new q(-1,1,-1),new q(1,1,-1),new q(-1,1,1),new q(1,1,1)];class yN{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,a=100){yM=this._renderer.getRenderTarget(),GM=this._renderer.getActiveCubeFace(),BM=this._renderer.getActiveMipmapLevel(),ZM=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,a,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=NF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=MF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(yM,GM,BM),this._renderer.xr.enabled=ZM,e.scissorTest=!1,XS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===WI||e.mapping===sC?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),yM=this._renderer.getRenderTarget(),GM=this._renderer.getActiveCubeFace(),BM=this._renderer.getActiveMipmapLevel(),ZM=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:er,minFilter:er,generateMipmaps:!1,type:hb,format:To,colorSpace:jA,depthBuffer:!1},a=VF(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=VF(e,t,n);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=VJ(o)),this._blurMaterial=MJ(o,e,t)}return a}_compileMaterial(e){const t=new tr(this._lodPlanes[0],e);this._renderer.compile(t,vM)}_sceneToCubeUV(e,t,n,a){const u=new Aa(90,1,t,n),d=[1,-1,1,1,1,1],C=[1,1,1,-1,-1,-1],A=this._renderer,p=A.autoClear,m=A.toneMapping;A.getClearColor(xF),A.toneMapping=eu,A.autoClear=!1;const y=new Cl({name:"PMREM.Background",side:ss,depthWrite:!1,depthTest:!1}),G=new tr(new $A,y);let w=!1;const R=e.background;R?R.isColor&&(y.color.copy(R),e.background=null,w=!0):(y.color.copy(xF),w=!0);for(let Z=0;Z<6;Z++){const x=Z%3;x===0?(u.up.set(0,d[Z],0),u.lookAt(C[Z],0,0)):x===1?(u.up.set(0,0,d[Z]),u.lookAt(0,C[Z],0)):(u.up.set(0,d[Z],0),u.lookAt(0,0,C[Z]));const W=this._cubeSize;XS(a,x*W,Z>2?W:0,W,W),A.setRenderTarget(a),w&&A.render(G,u),A.render(e,u)}G.geometry.dispose(),G.material.dispose(),A.toneMapping=m,A.autoClear=p,e.background=R}_textureToCubeUV(e,t){const n=this._renderer,a=e.mapping===WI||e.mapping===sC;a?(this._cubemapMaterial===null&&(this._cubemapMaterial=NF()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=MF());const o=a?this._cubemapMaterial:this._equirectMaterial,l=new tr(this._lodPlanes[0],o),u=o.uniforms;u.envMap.value=e;const d=this._cubeSize;XS(t,0,0,3*d,2*d),n.setRenderTarget(t),n.render(l,vM)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const a=this._lodPlanes.length;for(let o=1;o<a;o++){const l=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),u=WF[(a-o-1)%WF.length];this._blur(e,o-1,o,l,u)}t.autoClear=n}_blur(e,t,n,a,o){const l=this._pingPongRenderTarget;this._halfBlur(e,l,t,n,a,"latitudinal",o),this._halfBlur(l,e,n,n,a,"longitudinal",o)}_halfBlur(e,t,n,a,o,l,u){const d=this._renderer,C=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const A=3,p=new tr(this._lodPlanes[a],C),m=C.uniforms,y=this._sizeLods[n]-1,G=isFinite(o)?Math.PI/(2*y):2*Math.PI/(2*SA-1),w=o/G,R=isFinite(o)?1+Math.floor(A*w):SA;R>SA&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${R} samples when the maximum is set to ${SA}`);const Z=[];let x=0;for(let L=0;L<SA;++L){const k=L/w,E=Math.exp(-k*k/2);Z.push(E),L===0?x+=E:L<R&&(x+=2*E)}for(let L=0;L<Z.length;L++)Z[L]=Z[L]/x;m.envMap.value=e.texture,m.samples.value=R,m.weights.value=Z,m.latitudinal.value=l==="latitudinal",u&&(m.poleAxis.value=u);const{_lodMax:W}=this;m.dTheta.value=G,m.mipInt.value=W-n;const N=this._sizeLods[a],K=3*N*(a>W-qm?a-W+qm:0),T=4*(this._cubeSize-N);XS(t,K,T,3*N,2*N),d.setRenderTarget(t),d.render(p,vM)}}function VJ(s){const e=[],t=[],n=[];let a=s;const o=s-qm+1+wF.length;for(let l=0;l<o;l++){const u=Math.pow(2,a);t.push(u);let d=1/u;l>s-qm?d=wF[l-s+qm-1]:l===0&&(d=0),n.push(d);const C=1/(u-2),A=-C,p=1+C,m=[A,A,p,A,p,p,A,A,p,p,A,p],y=6,G=6,w=3,R=2,Z=1,x=new Float32Array(w*G*y),W=new Float32Array(R*G*y),N=new Float32Array(Z*G*y);for(let T=0;T<y;T++){const L=T%3*2/3-1,k=T>2?0:-1,E=[L,k,0,L+2/3,k,0,L+2/3,k+1,0,L,k,0,L+2/3,k+1,0,L,k+1,0];x.set(E,w*G*T),W.set(m,R*G*T);const F=[T,T,T,T,T,T];N.set(F,Z*G*T)}const K=new Ln;K.setAttribute("position",new Ri(x,w)),K.setAttribute("uv",new Ri(W,R)),K.setAttribute("faceIndex",new Ri(N,Z)),e.push(K),a>qm&&a--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function VF(s,e,t){const n=new zc(s,e,t);return n.texture.mapping=Cb,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function XS(s,e,t,n,a){s.viewport.set(e,t,n,a),s.scissor.set(e,t,n,a)}function MJ(s,e,t){const n=new Float32Array(SA),a=new q(0,1,0);return new _c({name:"SphericalGaussianBlur",defines:{n:SA,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:CH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:RI,depthTest:!1,depthWrite:!1})}function MF(){return new _c({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:CH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:RI,depthTest:!1,depthWrite:!1})}function NF(){return new _c({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:CH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:RI,depthTest:!1,depthWrite:!1})}function CH(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function NJ(s){let e=new WeakMap,t=null;function n(u){if(u&&u.isTexture){const d=u.mapping,C=d===uG||d===IG,A=d===WI||d===sC;if(C||A){let p=e.get(u);const m=p!==void 0?p.texture.pmremVersion:0;if(u.isRenderTargetTexture&&u.pmremVersion!==m)return t===null&&(t=new yN(s)),p=C?t.fromEquirectangular(u,p):t.fromCubemap(u,p),p.texture.pmremVersion=u.pmremVersion,e.set(u,p),p.texture;if(p!==void 0)return p.texture;{const y=u.image;return C&&y&&y.height>0||A&&y&&a(y)?(t===null&&(t=new yN(s)),p=C?t.fromEquirectangular(u):t.fromCubemap(u),p.texture.pmremVersion=u.pmremVersion,e.set(u,p),u.addEventListener("dispose",o),p.texture):null}}}return u}function a(u){let d=0;const C=6;for(let A=0;A<C;A++)u[A]!==void 0&&d++;return d===C}function o(u){const d=u.target;d.removeEventListener("dispose",o);const C=e.get(d);C!==void 0&&(e.delete(d),C.dispose())}function l(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:l}}function HJ(s){const e={};function t(n){if(e[n]!==void 0)return e[n];let a;switch(n){case"WEBGL_depth_texture":a=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=s.getExtension(n)}return e[n]=a,a}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const a=t(n);return a===null&&q0("THREE.WebGLRenderer: "+n+" extension not supported."),a}}}function XJ(s,e,t,n){const a={},o=new WeakMap;function l(p){const m=p.target;m.index!==null&&e.remove(m.index);for(const G in m.attributes)e.remove(m.attributes[G]);for(const G in m.morphAttributes){const w=m.morphAttributes[G];for(let R=0,Z=w.length;R<Z;R++)e.remove(w[R])}m.removeEventListener("dispose",l),delete a[m.id];const y=o.get(m);y&&(e.remove(y),o.delete(m)),n.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,t.memory.geometries--}function u(p,m){return a[m.id]===!0||(m.addEventListener("dispose",l),a[m.id]=!0,t.memory.geometries++),m}function d(p){const m=p.attributes;for(const G in m)e.update(m[G],s.ARRAY_BUFFER);const y=p.morphAttributes;for(const G in y){const w=y[G];for(let R=0,Z=w.length;R<Z;R++)e.update(w[R],s.ARRAY_BUFFER)}}function C(p){const m=[],y=p.index,G=p.attributes.position;let w=0;if(y!==null){const x=y.array;w=y.version;for(let W=0,N=x.length;W<N;W+=3){const K=x[W+0],T=x[W+1],L=x[W+2];m.push(K,T,T,L,L,K)}}else if(G!==void 0){const x=G.array;w=G.version;for(let W=0,N=x.length/3-1;W<N;W+=3){const K=W+0,T=W+1,L=W+2;m.push(K,T,T,L,L,K)}}else return;const R=new(qE(m)?dH:IH)(m,1);R.version=w;const Z=o.get(p);Z&&e.remove(Z),o.set(p,R)}function A(p){const m=o.get(p);if(m){const y=p.index;y!==null&&m.version<y.version&&C(p)}else C(p);return o.get(p)}return{get:u,update:d,getWireframeAttribute:A}}function FJ(s,e,t){let n;function a(m){n=m}let o,l;function u(m){o=m.type,l=m.bytesPerElement}function d(m,y){s.drawElements(n,y,o,m*l),t.update(y,n,1)}function C(m,y,G){G!==0&&(s.drawElementsInstanced(n,y,o,m*l,G),t.update(y,n,G))}function A(m,y,G){if(G===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,y,0,o,m,0,G);let R=0;for(let Z=0;Z<G;Z++)R+=y[Z];t.update(R,n,1)}function p(m,y,G,w){if(G===0)return;const R=e.get("WEBGL_multi_draw");if(R===null)for(let Z=0;Z<m.length;Z++)C(m[Z]/l,y[Z],w[Z]);else{R.multiDrawElementsInstancedWEBGL(n,y,0,o,m,0,w,0,G);let Z=0;for(let x=0;x<G;x++)Z+=y[x]*w[x];t.update(Z,n,1)}}this.setMode=a,this.setIndex=u,this.render=d,this.renderInstances=C,this.renderMultiDraw=A,this.renderMultiDrawInstances=p}function YJ(s){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,l,u){switch(t.calls++,l){case s.TRIANGLES:t.triangles+=u*(o/3);break;case s.LINES:t.lines+=u*(o/2);break;case s.LINE_STRIP:t.lines+=u*(o-1);break;case s.LINE_LOOP:t.lines+=u*o;break;case s.POINTS:t.points+=u*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function a(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:a,update:n}}function TJ(s,e,t){const n=new WeakMap,a=new Si;function o(l,u,d){const C=l.morphTargetInfluences,A=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=A!==void 0?A.length:0;let m=n.get(u);if(m===void 0||m.count!==p){let F=function(){k.dispose(),n.delete(u),u.removeEventListener("dispose",F)};var y=F;m!==void 0&&m.texture.dispose();const G=u.morphAttributes.position!==void 0,w=u.morphAttributes.normal!==void 0,R=u.morphAttributes.color!==void 0,Z=u.morphAttributes.position||[],x=u.morphAttributes.normal||[],W=u.morphAttributes.color||[];let N=0;G===!0&&(N=1),w===!0&&(N=2),R===!0&&(N=3);let K=u.attributes.position.count*N,T=1;K>e.maxTextureSize&&(T=Math.ceil(K/e.maxTextureSize),K=e.maxTextureSize);const L=new Float32Array(K*T*4*p),k=new xw(L,K,T,p);k.type=Ns,k.needsUpdate=!0;const E=N*4;for(let U=0;U<p;U++){const le=Z[U],ie=x[U],Ce=W[U],Ge=K*T*4*U;for(let ye=0;ye<le.count;ye++){const pe=ye*E;G===!0&&(a.fromBufferAttribute(le,ye),L[Ge+pe+0]=a.x,L[Ge+pe+1]=a.y,L[Ge+pe+2]=a.z,L[Ge+pe+3]=0),w===!0&&(a.fromBufferAttribute(ie,ye),L[Ge+pe+4]=a.x,L[Ge+pe+5]=a.y,L[Ge+pe+6]=a.z,L[Ge+pe+7]=0),R===!0&&(a.fromBufferAttribute(Ce,ye),L[Ge+pe+8]=a.x,L[Ge+pe+9]=a.y,L[Ge+pe+10]=a.z,L[Ge+pe+11]=Ce.itemSize===4?a.w:1)}}m={count:p,texture:k,size:new ut(K,T)},n.set(u,m),u.addEventListener("dispose",F)}if(l.isInstancedMesh===!0&&l.morphTexture!==null)d.getUniforms().setValue(s,"morphTexture",l.morphTexture,t);else{let G=0;for(let R=0;R<C.length;R++)G+=C[R];const w=u.morphTargetsRelative?1:1-G;d.getUniforms().setValue(s,"morphTargetBaseInfluence",w),d.getUniforms().setValue(s,"morphTargetInfluences",C)}d.getUniforms().setValue(s,"morphTargetsTexture",m.texture,t),d.getUniforms().setValue(s,"morphTargetsTextureSize",m.size)}return{update:o}}function EJ(s,e,t,n){let a=new WeakMap;function o(d){const C=n.render.frame,A=d.geometry,p=e.get(d,A);if(a.get(p)!==C&&(e.update(p),a.set(p,C)),d.isInstancedMesh&&(d.hasEventListener("dispose",u)===!1&&d.addEventListener("dispose",u),a.get(d)!==C&&(t.update(d.instanceMatrix,s.ARRAY_BUFFER),d.instanceColor!==null&&t.update(d.instanceColor,s.ARRAY_BUFFER),a.set(d,C))),d.isSkinnedMesh){const m=d.skeleton;a.get(m)!==C&&(m.update(),a.set(m,C))}return p}function l(){a=new WeakMap}function u(d){const C=d.target;C.removeEventListener("dispose",u),t.remove(C.instanceMatrix),C.instanceColor!==null&&t.remove(C.instanceColor)}return{update:o,dispose:l}}class hH extends fa{constructor(e,t,n,a,o,l,u,d,C,A=YA){if(A!==YA&&A!==kA)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&A===YA&&(n=VI),n===void 0&&A===kA&&(n=DA),super(null,a,o,l,u,d,A,n,C),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=u!==void 0?u:_r,this.minFilter=d!==void 0?d:_r,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const lK=new fa,HF=new hH(1,1),cK=new xw,gK=new uH,uK=new RG,XF=[],FF=[],YF=new Float32Array(16),TF=new Float32Array(9),EF=new Float32Array(4);function fb(s,e,t){const n=s[0];if(n<=0||n>0)return s;const a=e*t;let o=XF[a];if(o===void 0&&(o=new Float32Array(a),XF[a]=o),e!==0){n.toArray(o,0);for(let l=1,u=0;l!==e;++l)u+=t,s[l].toArray(o,u)}return o}function Sr(s,e){if(s.length!==e.length)return!1;for(let t=0,n=s.length;t<n;t++)if(s[t]!==e[t])return!1;return!0}function Rr(s,e){for(let t=0,n=e.length;t<n;t++)s[t]=e[t]}function Ww(s,e){let t=FF[e];t===void 0&&(t=new Int32Array(e),FF[e]=t);for(let n=0;n!==e;++n)t[n]=s.allocateTextureUnit();return t}function KJ(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function LJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;s.uniform2fv(this.addr,e),Rr(t,e)}}function zJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Sr(t,e))return;s.uniform3fv(this.addr,e),Rr(t,e)}}function _J(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;s.uniform4fv(this.addr,e),Rr(t,e)}}function DJ(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Sr(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),Rr(t,e)}else{if(Sr(t,n))return;EF.set(n),s.uniformMatrix2fv(this.addr,!1,EF),Rr(t,n)}}function kJ(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Sr(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),Rr(t,e)}else{if(Sr(t,n))return;TF.set(n),s.uniformMatrix3fv(this.addr,!1,TF),Rr(t,n)}}function UJ(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Sr(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),Rr(t,e)}else{if(Sr(t,n))return;YF.set(n),s.uniformMatrix4fv(this.addr,!1,YF),Rr(t,n)}}function JJ(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function OJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;s.uniform2iv(this.addr,e),Rr(t,e)}}function PJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Sr(t,e))return;s.uniform3iv(this.addr,e),Rr(t,e)}}function QJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;s.uniform4iv(this.addr,e),Rr(t,e)}}function jJ(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function qJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;s.uniform2uiv(this.addr,e),Rr(t,e)}}function $J(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Sr(t,e))return;s.uniform3uiv(this.addr,e),Rr(t,e)}}function eO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;s.uniform4uiv(this.addr,e),Rr(t,e)}}function tO(s,e,t){const n=this.cache,a=t.allocateTextureUnit();n[0]!==a&&(s.uniform1i(this.addr,a),n[0]=a);let o;this.type===s.SAMPLER_2D_SHADOW?(HF.compareFunction=lH,o=HF):o=lK,t.setTexture2D(e||o,a)}function nO(s,e,t){const n=this.cache,a=t.allocateTextureUnit();n[0]!==a&&(s.uniform1i(this.addr,a),n[0]=a),t.setTexture3D(e||gK,a)}function iO(s,e,t){const n=this.cache,a=t.allocateTextureUnit();n[0]!==a&&(s.uniform1i(this.addr,a),n[0]=a),t.setTextureCube(e||uK,a)}function aO(s,e,t){const n=this.cache,a=t.allocateTextureUnit();n[0]!==a&&(s.uniform1i(this.addr,a),n[0]=a),t.setTexture2DArray(e||cK,a)}function rO(s){switch(s){case 5126:return KJ;case 35664:return LJ;case 35665:return zJ;case 35666:return _J;case 35674:return DJ;case 35675:return kJ;case 35676:return UJ;case 5124:case 35670:return JJ;case 35667:case 35671:return OJ;case 35668:case 35672:return PJ;case 35669:case 35673:return QJ;case 5125:return jJ;case 36294:return qJ;case 36295:return $J;case 36296:return eO;case 35678:case 36198:case 36298:case 36306:case 35682:return tO;case 35679:case 36299:case 36307:return nO;case 35680:case 36300:case 36308:case 36293:return iO;case 36289:case 36303:case 36311:case 36292:return aO}}function oO(s,e){s.uniform1fv(this.addr,e)}function sO(s,e){const t=fb(e,this.size,2);s.uniform2fv(this.addr,t)}function lO(s,e){const t=fb(e,this.size,3);s.uniform3fv(this.addr,t)}function cO(s,e){const t=fb(e,this.size,4);s.uniform4fv(this.addr,t)}function gO(s,e){const t=fb(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function uO(s,e){const t=fb(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function IO(s,e){const t=fb(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function dO(s,e){s.uniform1iv(this.addr,e)}function CO(s,e){s.uniform2iv(this.addr,e)}function hO(s,e){s.uniform3iv(this.addr,e)}function AO(s,e){s.uniform4iv(this.addr,e)}function fO(s,e){s.uniform1uiv(this.addr,e)}function pO(s,e){s.uniform2uiv(this.addr,e)}function mO(s,e){s.uniform3uiv(this.addr,e)}function bO(s,e){s.uniform4uiv(this.addr,e)}function vO(s,e,t){const n=this.cache,a=e.length,o=Ww(t,a);Sr(n,o)||(s.uniform1iv(this.addr,o),Rr(n,o));for(let l=0;l!==a;++l)t.setTexture2D(e[l]||lK,o[l])}function yO(s,e,t){const n=this.cache,a=e.length,o=Ww(t,a);Sr(n,o)||(s.uniform1iv(this.addr,o),Rr(n,o));for(let l=0;l!==a;++l)t.setTexture3D(e[l]||gK,o[l])}function GO(s,e,t){const n=this.cache,a=e.length,o=Ww(t,a);Sr(n,o)||(s.uniform1iv(this.addr,o),Rr(n,o));for(let l=0;l!==a;++l)t.setTextureCube(e[l]||uK,o[l])}function BO(s,e,t){const n=this.cache,a=e.length,o=Ww(t,a);Sr(n,o)||(s.uniform1iv(this.addr,o),Rr(n,o));for(let l=0;l!==a;++l)t.setTexture2DArray(e[l]||cK,o[l])}function ZO(s){switch(s){case 5126:return oO;case 35664:return sO;case 35665:return lO;case 35666:return cO;case 35674:return gO;case 35675:return uO;case 35676:return IO;case 5124:case 35670:return dO;case 35667:case 35671:return CO;case 35668:case 35672:return hO;case 35669:case 35673:return AO;case 5125:return fO;case 36294:return pO;case 36295:return mO;case 36296:return bO;case 35678:case 36198:case 36298:case 36306:case 35682:return vO;case 35679:case 36299:case 36307:return yO;case 35680:case 36300:case 36308:case 36293:return GO;case 36289:case 36303:case 36311:case 36292:return BO}}class SO{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=rO(t.type)}}class RO{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=ZO(t.type)}}class wO{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const a=this.seq;for(let o=0,l=a.length;o!==l;++o){const u=a[o];u.setValue(e,t[u.id],n)}}}const SM=/(\w+)(\])?(\[|\.)?/g;function KF(s,e){s.seq.push(e),s.map[e.id]=e}function xO(s,e,t){const n=s.name,a=n.length;for(SM.lastIndex=0;;){const o=SM.exec(n),l=SM.lastIndex;let u=o[1];const d=o[2]==="]",C=o[3];if(d&&(u=u|0),C===void 0||C==="["&&l+2===a){KF(t,C===void 0?new SO(u,s,e):new RO(u,s,e));break}else{let p=t.map[u];p===void 0&&(p=new wO(u),KF(t,p)),t=p}}}class vR{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<n;++a){const o=e.getActiveUniform(t,a),l=e.getUniformLocation(t,o.name);xO(o,l,this)}}setValue(e,t,n,a){const o=this.map[t];o!==void 0&&o.setValue(e,n,a)}setOptional(e,t,n){const a=t[n];a!==void 0&&this.setValue(e,n,a)}static upload(e,t,n,a){for(let o=0,l=t.length;o!==l;++o){const u=t[o],d=n[u.id];d.needsUpdate!==!1&&u.setValue(e,d.value,a)}}static seqWithValue(e,t){const n=[];for(let a=0,o=e.length;a!==o;++a){const l=e[a];l.id in t&&n.push(l)}return n}}function LF(s,e,t){const n=s.createShader(e);return s.shaderSource(n,t),s.compileShader(n),n}const WO=37297;let VO=0;function MO(s,e){const t=s.split(`
`),n=[],a=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let l=a;l<o;l++){const u=l+1;n.push(`${u===e?">":" "} ${u}: ${t[l]}`)}return n.join(`
`)}const zF=new kn;function NO(s){mi._getMatrix(zF,mi.workingColorSpace,s);const e=`mat3( ${zF.elements.map(t=>t.toFixed(4))} )`;switch(mi.getTransfer(s)){case ZG:return[e,"LinearTransferOETF"];case ki:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",s),[e,"LinearTransferOETF"]}}function _F(s,e,t){const n=s.getShaderParameter(e,s.COMPILE_STATUS),a=s.getShaderInfoLog(e).trim();if(n&&a==="")return"";const o=/ERROR: 0:(\d+)/.exec(a);if(o){const l=parseInt(o[1]);return t.toUpperCase()+`

`+a+`

`+MO(s.getShaderSource(e),l)}else return a}function HO(s,e){const t=NO(e);return[`vec4 ${s}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function XO(s,e){let t;switch(e){case WE:t="Linear";break;case VE:t="Reinhard";break;case ME:t="Cineon";break;case QN:t="ACESFilmic";break;case HE:t="AgX";break;case XE:t="Neutral";break;case NE:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const FS=new q;function FO(){mi.getLuminanceCoefficients(FS);const s=FS.x.toFixed(4),e=FS.y.toFixed(4),t=FS.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${s}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function YO(s){return[s.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",s.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(eG).join(`
`)}function TO(s){const e=[];for(const t in s){const n=s[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function EO(s,e){const t={},n=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let a=0;a<n;a++){const o=s.getActiveAttrib(e,a),l=o.name;let u=1;o.type===s.FLOAT_MAT2&&(u=2),o.type===s.FLOAT_MAT3&&(u=3),o.type===s.FLOAT_MAT4&&(u=4),t[l]={type:o.type,location:s.getAttribLocation(e,l),locationSize:u}}return t}function eG(s){return s!==""}function DF(s,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function kF(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const KO=/^[ \t]*#include +<([\w\d./]+)>/gm;function GN(s){return s.replace(KO,zO)}const LO=new Map;function zO(s,e){let t=qn[e];if(t===void 0){const n=LO.get(e);if(n!==void 0)t=qn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return GN(t)}const _O=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function UF(s){return s.replace(_O,DO)}function DO(s,e,t,n){let a="";for(let o=parseInt(e);o<parseInt(t);o++)a+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return a}function JF(s){let e=`precision ${s.precision} float;
	precision ${s.precision} int;
	precision ${s.precision} sampler2D;
	precision ${s.precision} samplerCube;
	precision ${s.precision} sampler3D;
	precision ${s.precision} sampler2DArray;
	precision ${s.precision} sampler2DShadow;
	precision ${s.precision} samplerCubeShadow;
	precision ${s.precision} sampler2DArrayShadow;
	precision ${s.precision} isampler2D;
	precision ${s.precision} isampler3D;
	precision ${s.precision} isamplerCube;
	precision ${s.precision} isampler2DArray;
	precision ${s.precision} usampler2D;
	precision ${s.precision} usampler3D;
	precision ${s.precision} usamplerCube;
	precision ${s.precision} usampler2DArray;
	`;return s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function kO(s){let e="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===mw?e="SHADOWMAP_TYPE_PCF":s.shadowMapType===nG?e="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===Yc&&(e="SHADOWMAP_TYPE_VSM"),e}function UO(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case WI:case sC:e="ENVMAP_TYPE_CUBE";break;case Cb:e="ENVMAP_TYPE_CUBE_UV";break}return e}function JO(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case sC:e="ENVMAP_MODE_REFRACTION";break}return e}function OO(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case GG:e="ENVMAP_BLENDING_MULTIPLY";break;case wE:e="ENVMAP_BLENDING_MIX";break;case xE:e="ENVMAP_BLENDING_ADD";break}return e}function PO(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function QO(s,e,t,n){const a=s.getContext(),o=t.defines;let l=t.vertexShader,u=t.fragmentShader;const d=kO(t),C=UO(t),A=JO(t),p=OO(t),m=PO(t),y=YO(t),G=TO(o),w=a.createProgram();let R,Z,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(R=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,G].filter(eG).join(`
`),R.length>0&&(R+=`
`),Z=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,G].filter(eG).join(`
`),Z.length>0&&(Z+=`
`)):(R=[JF(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,G,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+A:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(eG).join(`
`),Z=[JF(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,G,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+C:"",t.envMap?"#define "+A:"",t.envMap?"#define "+p:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==eu?"#define TONE_MAPPING":"",t.toneMapping!==eu?qn.tonemapping_pars_fragment:"",t.toneMapping!==eu?XO("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",qn.colorspace_pars_fragment,HO("linearToOutputTexel",t.outputColorSpace),FO(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(eG).join(`
`)),l=GN(l),l=DF(l,t),l=kF(l,t),u=GN(u),u=DF(u,t),u=kF(u,t),l=UF(l),u=UF(u),t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,R=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+R,Z=["#define varying in",t.glslVersion===vN?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===vN?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Z);const W=x+R+l,N=x+Z+u,K=LF(a,a.VERTEX_SHADER,W),T=LF(a,a.FRAGMENT_SHADER,N);a.attachShader(w,K),a.attachShader(w,T),t.index0AttributeName!==void 0?a.bindAttribLocation(w,0,t.index0AttributeName):t.morphTargets===!0&&a.bindAttribLocation(w,0,"position"),a.linkProgram(w);function L(U){if(s.debug.checkShaderErrors){const le=a.getProgramInfoLog(w).trim(),ie=a.getShaderInfoLog(K).trim(),Ce=a.getShaderInfoLog(T).trim();let Ge=!0,ye=!0;if(a.getProgramParameter(w,a.LINK_STATUS)===!1)if(Ge=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(a,w,K,T);else{const pe=_F(a,K,"vertex"),de=_F(a,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(w,a.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+le+`
`+pe+`
`+de)}else le!==""?console.warn("THREE.WebGLProgram: Program Info Log:",le):(ie===""||Ce==="")&&(ye=!1);ye&&(U.diagnostics={runnable:Ge,programLog:le,vertexShader:{log:ie,prefix:R},fragmentShader:{log:Ce,prefix:Z}})}a.deleteShader(K),a.deleteShader(T),k=new vR(a,w),E=EO(a,w)}let k;this.getUniforms=function(){return k===void 0&&L(this),k};let E;this.getAttributes=function(){return E===void 0&&L(this),E};let F=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return F===!1&&(F=a.getProgramParameter(w,WO)),F},this.destroy=function(){n.releaseStatesOfProgram(this),a.deleteProgram(w),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=VO++,this.cacheKey=e,this.usedTimes=1,this.program=w,this.vertexShader=K,this.fragmentShader=T,this}let jO=0;class qO{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,a=this._getShaderStage(t),o=this._getShaderStage(n),l=this._getShaderCacheForMaterial(e);return l.has(a)===!1&&(l.add(a),a.usedTimes++),l.has(o)===!1&&(l.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new $O(e),t.set(e,n)),n}}class $O{constructor(e){this.id=jO++,this.code=e,this.usedTimes=0}}function eP(s,e,t,n,a,o,l){const u=new EA,d=new qO,C=new Set,A=[],p=a.logarithmicDepthBuffer,m=a.vertexTextures;let y=a.precision;const G={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function w(E){return C.add(E),E===0?"uv":`uv${E}`}function R(E,F,U,le,ie){const Ce=le.fog,Ge=ie.geometry,ye=E.isMeshStandardMaterial?le.environment:null,pe=(E.isMeshStandardMaterial?t:e).get(E.envMap||ye),de=pe&&pe.mapping===Cb?pe.image.height:null,Oe=G[E.type];E.precision!==null&&(y=a.getMaxPrecision(E.precision),y!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",y,"instead."));const We=Ge.morphAttributes.position||Ge.morphAttributes.normal||Ge.morphAttributes.color,ke=We!==void 0?We.length:0;let $e=0;Ge.morphAttributes.position!==void 0&&($e=1),Ge.morphAttributes.normal!==void 0&&($e=2),Ge.morphAttributes.color!==void 0&&($e=3);let ot,Ne,tt,bt;if(Oe){const bn=Ec[Oe];ot=bn.vertexShader,Ne=bn.fragmentShader}else ot=E.vertexShader,Ne=E.fragmentShader,d.update(E),tt=d.getVertexShaderID(E),bt=d.getFragmentShaderID(E);const dt=s.getRenderTarget(),yt=s.state.buffers.depth.getReversed(),zt=ie.isInstancedMesh===!0,Nt=ie.isBatchedMesh===!0,Lt=!!E.map,Ue=!!E.matcap,Pe=!!pe,te=!!E.aoMap,Gt=!!E.lightMap,Qe=!!E.bumpMap,ht=!!E.normalMap,Ct=!!E.displacementMap,Tt=!!E.emissiveMap,Rt=!!E.metalnessMap,$=!!E.roughnessMap,J=E.anisotropy>0,fe=E.clearcoat>0,ze=E.dispersion>0,et=E.iridescence>0,_e=E.sheen>0,At=E.transmission>0,Zt=J&&!!E.anisotropyMap,Xt=fe&&!!E.clearcoatMap,An=fe&&!!E.clearcoatNormalMap,j=fe&&!!E.clearcoatRoughnessMap,ue=et&&!!E.iridescenceMap,Ve=et&&!!E.iridescenceThicknessMap,qe=_e&&!!E.sheenColorMap,Me=_e&&!!E.sheenRoughnessMap,se=!!E.specularMap,Re=!!E.specularColorMap,De=!!E.specularIntensityMap,Q=At&&!!E.transmissionMap,st=At&&!!E.thicknessMap,be=!!E.gradientMap,Be=!!E.alphaMap,Ft=E.alphaTest>0,wt=!!E.alphaHash,ln=!!E.extensions;let Yn=eu;E.toneMapped&&(dt===null||dt.isXRRenderTarget===!0)&&(Yn=s.toneMapping);const un={shaderID:Oe,shaderType:E.type,shaderName:E.name,vertexShader:ot,fragmentShader:Ne,defines:E.defines,customVertexShaderID:tt,customFragmentShaderID:bt,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:y,batching:Nt,batchingColor:Nt&&ie._colorsTexture!==null,instancing:zt,instancingColor:zt&&ie.instanceColor!==null,instancingMorph:zt&&ie.morphTexture!==null,supportsVertexTextures:m,outputColorSpace:dt===null?s.outputColorSpace:dt.isXRRenderTarget===!0?dt.texture.colorSpace:jA,alphaToCoverage:!!E.alphaToCoverage,map:Lt,matcap:Ue,envMap:Pe,envMapMode:Pe&&pe.mapping,envMapCubeUVHeight:de,aoMap:te,lightMap:Gt,bumpMap:Qe,normalMap:ht,displacementMap:m&&Ct,emissiveMap:Tt,normalMapObjectSpace:ht&&E.normalMapType===_E,normalMapTangentSpace:ht&&E.normalMapType===gC,metalnessMap:Rt,roughnessMap:$,anisotropy:J,anisotropyMap:Zt,clearcoat:fe,clearcoatMap:Xt,clearcoatNormalMap:An,clearcoatRoughnessMap:j,dispersion:ze,iridescence:et,iridescenceMap:ue,iridescenceThicknessMap:Ve,sheen:_e,sheenColorMap:qe,sheenRoughnessMap:Me,specularMap:se,specularColorMap:Re,specularIntensityMap:De,transmission:At,transmissionMap:Q,thicknessMap:st,gradientMap:be,opaque:E.transparent===!1&&E.blending===FA&&E.alphaToCoverage===!1,alphaMap:Be,alphaTest:Ft,alphaHash:wt,combine:E.combine,mapUv:Lt&&w(E.map.channel),aoMapUv:te&&w(E.aoMap.channel),lightMapUv:Gt&&w(E.lightMap.channel),bumpMapUv:Qe&&w(E.bumpMap.channel),normalMapUv:ht&&w(E.normalMap.channel),displacementMapUv:Ct&&w(E.displacementMap.channel),emissiveMapUv:Tt&&w(E.emissiveMap.channel),metalnessMapUv:Rt&&w(E.metalnessMap.channel),roughnessMapUv:$&&w(E.roughnessMap.channel),anisotropyMapUv:Zt&&w(E.anisotropyMap.channel),clearcoatMapUv:Xt&&w(E.clearcoatMap.channel),clearcoatNormalMapUv:An&&w(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:j&&w(E.clearcoatRoughnessMap.channel),iridescenceMapUv:ue&&w(E.iridescenceMap.channel),iridescenceThicknessMapUv:Ve&&w(E.iridescenceThicknessMap.channel),sheenColorMapUv:qe&&w(E.sheenColorMap.channel),sheenRoughnessMapUv:Me&&w(E.sheenRoughnessMap.channel),specularMapUv:se&&w(E.specularMap.channel),specularColorMapUv:Re&&w(E.specularColorMap.channel),specularIntensityMapUv:De&&w(E.specularIntensityMap.channel),transmissionMapUv:Q&&w(E.transmissionMap.channel),thicknessMapUv:st&&w(E.thicknessMap.channel),alphaMapUv:Be&&w(E.alphaMap.channel),vertexTangents:!!Ge.attributes.tangent&&(ht||J),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!Ge.attributes.color&&Ge.attributes.color.itemSize===4,pointsUvs:ie.isPoints===!0&&!!Ge.attributes.uv&&(Lt||Be),fog:!!Ce,useFog:E.fog===!0,fogExp2:!!Ce&&Ce.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:p,reverseDepthBuffer:yt,skinning:ie.isSkinnedMesh===!0,morphTargets:Ge.morphAttributes.position!==void 0,morphNormals:Ge.morphAttributes.normal!==void 0,morphColors:Ge.morphAttributes.color!==void 0,morphTargetsCount:ke,morphTextureStride:$e,numDirLights:F.directional.length,numPointLights:F.point.length,numSpotLights:F.spot.length,numSpotLightMaps:F.spotLightMap.length,numRectAreaLights:F.rectArea.length,numHemiLights:F.hemi.length,numDirLightShadows:F.directionalShadowMap.length,numPointLightShadows:F.pointShadowMap.length,numSpotLightShadows:F.spotShadowMap.length,numSpotLightShadowsWithMaps:F.numSpotLightShadowsWithMaps,numLightProbes:F.numLightProbes,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:E.dithering,shadowMapEnabled:s.shadowMap.enabled&&U.length>0,shadowMapType:s.shadowMap.type,toneMapping:Yn,decodeVideoTexture:Lt&&E.map.isVideoTexture===!0&&mi.getTransfer(E.map.colorSpace)===ki,decodeVideoTextureEmissive:Tt&&E.emissiveMap.isVideoTexture===!0&&mi.getTransfer(E.emissiveMap.colorSpace)===ki,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===Kl,flipSided:E.side===ss,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionClipCullDistance:ln&&E.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ln&&E.extensions.multiDraw===!0||Nt)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()};return un.vertexUv1s=C.has(1),un.vertexUv2s=C.has(2),un.vertexUv3s=C.has(3),C.clear(),un}function Z(E){const F=[];if(E.shaderID?F.push(E.shaderID):(F.push(E.customVertexShaderID),F.push(E.customFragmentShaderID)),E.defines!==void 0)for(const U in E.defines)F.push(U),F.push(E.defines[U]);return E.isRawShaderMaterial===!1&&(x(F,E),W(F,E),F.push(s.outputColorSpace)),F.push(E.customProgramCacheKey),F.join()}function x(E,F){E.push(F.precision),E.push(F.outputColorSpace),E.push(F.envMapMode),E.push(F.envMapCubeUVHeight),E.push(F.mapUv),E.push(F.alphaMapUv),E.push(F.lightMapUv),E.push(F.aoMapUv),E.push(F.bumpMapUv),E.push(F.normalMapUv),E.push(F.displacementMapUv),E.push(F.emissiveMapUv),E.push(F.metalnessMapUv),E.push(F.roughnessMapUv),E.push(F.anisotropyMapUv),E.push(F.clearcoatMapUv),E.push(F.clearcoatNormalMapUv),E.push(F.clearcoatRoughnessMapUv),E.push(F.iridescenceMapUv),E.push(F.iridescenceThicknessMapUv),E.push(F.sheenColorMapUv),E.push(F.sheenRoughnessMapUv),E.push(F.specularMapUv),E.push(F.specularColorMapUv),E.push(F.specularIntensityMapUv),E.push(F.transmissionMapUv),E.push(F.thicknessMapUv),E.push(F.combine),E.push(F.fogExp2),E.push(F.sizeAttenuation),E.push(F.morphTargetsCount),E.push(F.morphAttributeCount),E.push(F.numDirLights),E.push(F.numPointLights),E.push(F.numSpotLights),E.push(F.numSpotLightMaps),E.push(F.numHemiLights),E.push(F.numRectAreaLights),E.push(F.numDirLightShadows),E.push(F.numPointLightShadows),E.push(F.numSpotLightShadows),E.push(F.numSpotLightShadowsWithMaps),E.push(F.numLightProbes),E.push(F.shadowMapType),E.push(F.toneMapping),E.push(F.numClippingPlanes),E.push(F.numClipIntersection),E.push(F.depthPacking)}function W(E,F){u.disableAll(),F.supportsVertexTextures&&u.enable(0),F.instancing&&u.enable(1),F.instancingColor&&u.enable(2),F.instancingMorph&&u.enable(3),F.matcap&&u.enable(4),F.envMap&&u.enable(5),F.normalMapObjectSpace&&u.enable(6),F.normalMapTangentSpace&&u.enable(7),F.clearcoat&&u.enable(8),F.iridescence&&u.enable(9),F.alphaTest&&u.enable(10),F.vertexColors&&u.enable(11),F.vertexAlphas&&u.enable(12),F.vertexUv1s&&u.enable(13),F.vertexUv2s&&u.enable(14),F.vertexUv3s&&u.enable(15),F.vertexTangents&&u.enable(16),F.anisotropy&&u.enable(17),F.alphaHash&&u.enable(18),F.batching&&u.enable(19),F.dispersion&&u.enable(20),F.batchingColor&&u.enable(21),E.push(u.mask),u.disableAll(),F.fog&&u.enable(0),F.useFog&&u.enable(1),F.flatShading&&u.enable(2),F.logarithmicDepthBuffer&&u.enable(3),F.reverseDepthBuffer&&u.enable(4),F.skinning&&u.enable(5),F.morphTargets&&u.enable(6),F.morphNormals&&u.enable(7),F.morphColors&&u.enable(8),F.premultipliedAlpha&&u.enable(9),F.shadowMapEnabled&&u.enable(10),F.doubleSided&&u.enable(11),F.flipSided&&u.enable(12),F.useDepthPacking&&u.enable(13),F.dithering&&u.enable(14),F.transmission&&u.enable(15),F.sheen&&u.enable(16),F.opaque&&u.enable(17),F.pointsUvs&&u.enable(18),F.decodeVideoTexture&&u.enable(19),F.decodeVideoTextureEmissive&&u.enable(20),F.alphaToCoverage&&u.enable(21),E.push(u.mask)}function N(E){const F=G[E.type];let U;if(F){const le=Ec[F];U=aK.clone(le.uniforms)}else U=E.uniforms;return U}function K(E,F){let U;for(let le=0,ie=A.length;le<ie;le++){const Ce=A[le];if(Ce.cacheKey===F){U=Ce,++U.usedTimes;break}}return U===void 0&&(U=new QO(s,F,E,o),A.push(U)),U}function T(E){if(--E.usedTimes===0){const F=A.indexOf(E);A[F]=A[A.length-1],A.pop(),E.destroy()}}function L(E){d.remove(E)}function k(){d.dispose()}return{getParameters:R,getProgramCacheKey:Z,getUniforms:N,acquireProgram:K,releaseProgram:T,releaseShaderCache:L,programs:A,dispose:k}}function tP(){let s=new WeakMap;function e(l){return s.has(l)}function t(l){let u=s.get(l);return u===void 0&&(u={},s.set(l,u)),u}function n(l){s.delete(l)}function a(l,u,d){s.get(l)[u]=d}function o(){s=new WeakMap}return{has:e,get:t,remove:n,update:a,dispose:o}}function nP(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function OF(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function PF(){const s=[];let e=0;const t=[],n=[],a=[];function o(){e=0,t.length=0,n.length=0,a.length=0}function l(p,m,y,G,w,R){let Z=s[e];return Z===void 0?(Z={id:p.id,object:p,geometry:m,material:y,groupOrder:G,renderOrder:p.renderOrder,z:w,group:R},s[e]=Z):(Z.id=p.id,Z.object=p,Z.geometry=m,Z.material=y,Z.groupOrder=G,Z.renderOrder=p.renderOrder,Z.z=w,Z.group=R),e++,Z}function u(p,m,y,G,w,R){const Z=l(p,m,y,G,w,R);y.transmission>0?n.push(Z):y.transparent===!0?a.push(Z):t.push(Z)}function d(p,m,y,G,w,R){const Z=l(p,m,y,G,w,R);y.transmission>0?n.unshift(Z):y.transparent===!0?a.unshift(Z):t.unshift(Z)}function C(p,m){t.length>1&&t.sort(p||nP),n.length>1&&n.sort(m||OF),a.length>1&&a.sort(m||OF)}function A(){for(let p=e,m=s.length;p<m;p++){const y=s[p];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:a,init:o,push:u,unshift:d,finish:A,sort:C}}function iP(){let s=new WeakMap;function e(n,a){const o=s.get(n);let l;return o===void 0?(l=new PF,s.set(n,[l])):a>=o.length?(l=new PF,o.push(l)):l=o[a],l}function t(){s=new WeakMap}return{get:e,dispose:t}}function aP(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new q,color:new $t};break;case"SpotLight":t={position:new q,direction:new q,color:new $t,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new q,color:new $t,distance:0,decay:0};break;case"HemisphereLight":t={direction:new q,skyColor:new $t,groundColor:new $t};break;case"RectAreaLight":t={color:new $t,position:new q,halfWidth:new q,halfHeight:new q};break}return s[e.id]=t,t}}}function rP(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ut};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ut};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ut,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=t,t}}}let oP=0;function sP(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function lP(s){const e=new aP,t=rP(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let C=0;C<9;C++)n.probe.push(new q);const a=new q,o=new Sn,l=new Sn;function u(C){let A=0,p=0,m=0;for(let E=0;E<9;E++)n.probe[E].set(0,0,0);let y=0,G=0,w=0,R=0,Z=0,x=0,W=0,N=0,K=0,T=0,L=0;C.sort(sP);for(let E=0,F=C.length;E<F;E++){const U=C[E],le=U.color,ie=U.intensity,Ce=U.distance,Ge=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)A+=le.r*ie,p+=le.g*ie,m+=le.b*ie;else if(U.isLightProbe){for(let ye=0;ye<9;ye++)n.probe[ye].addScaledVector(U.sh.coefficients[ye],ie);L++}else if(U.isDirectionalLight){const ye=e.get(U);if(ye.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const pe=U.shadow,de=t.get(U);de.shadowIntensity=pe.intensity,de.shadowBias=pe.bias,de.shadowNormalBias=pe.normalBias,de.shadowRadius=pe.radius,de.shadowMapSize=pe.mapSize,n.directionalShadow[y]=de,n.directionalShadowMap[y]=Ge,n.directionalShadowMatrix[y]=U.shadow.matrix,x++}n.directional[y]=ye,y++}else if(U.isSpotLight){const ye=e.get(U);ye.position.setFromMatrixPosition(U.matrixWorld),ye.color.copy(le).multiplyScalar(ie),ye.distance=Ce,ye.coneCos=Math.cos(U.angle),ye.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),ye.decay=U.decay,n.spot[w]=ye;const pe=U.shadow;if(U.map&&(n.spotLightMap[K]=U.map,K++,pe.updateMatrices(U),U.castShadow&&T++),n.spotLightMatrix[w]=pe.matrix,U.castShadow){const de=t.get(U);de.shadowIntensity=pe.intensity,de.shadowBias=pe.bias,de.shadowNormalBias=pe.normalBias,de.shadowRadius=pe.radius,de.shadowMapSize=pe.mapSize,n.spotShadow[w]=de,n.spotShadowMap[w]=Ge,N++}w++}else if(U.isRectAreaLight){const ye=e.get(U);ye.color.copy(le).multiplyScalar(ie),ye.halfWidth.set(U.width*.5,0,0),ye.halfHeight.set(0,U.height*.5,0),n.rectArea[R]=ye,R++}else if(U.isPointLight){const ye=e.get(U);if(ye.color.copy(U.color).multiplyScalar(U.intensity),ye.distance=U.distance,ye.decay=U.decay,U.castShadow){const pe=U.shadow,de=t.get(U);de.shadowIntensity=pe.intensity,de.shadowBias=pe.bias,de.shadowNormalBias=pe.normalBias,de.shadowRadius=pe.radius,de.shadowMapSize=pe.mapSize,de.shadowCameraNear=pe.camera.near,de.shadowCameraFar=pe.camera.far,n.pointShadow[G]=de,n.pointShadowMap[G]=Ge,n.pointShadowMatrix[G]=U.shadow.matrix,W++}n.point[G]=ye,G++}else if(U.isHemisphereLight){const ye=e.get(U);ye.skyColor.copy(U.color).multiplyScalar(ie),ye.groundColor.copy(U.groundColor).multiplyScalar(ie),n.hemi[Z]=ye,Z++}}R>0&&(s.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=qt.LTC_FLOAT_1,n.rectAreaLTC2=qt.LTC_FLOAT_2):(n.rectAreaLTC1=qt.LTC_HALF_1,n.rectAreaLTC2=qt.LTC_HALF_2)),n.ambient[0]=A,n.ambient[1]=p,n.ambient[2]=m;const k=n.hash;(k.directionalLength!==y||k.pointLength!==G||k.spotLength!==w||k.rectAreaLength!==R||k.hemiLength!==Z||k.numDirectionalShadows!==x||k.numPointShadows!==W||k.numSpotShadows!==N||k.numSpotMaps!==K||k.numLightProbes!==L)&&(n.directional.length=y,n.spot.length=w,n.rectArea.length=R,n.point.length=G,n.hemi.length=Z,n.directionalShadow.length=x,n.directionalShadowMap.length=x,n.pointShadow.length=W,n.pointShadowMap.length=W,n.spotShadow.length=N,n.spotShadowMap.length=N,n.directionalShadowMatrix.length=x,n.pointShadowMatrix.length=W,n.spotLightMatrix.length=N+K-T,n.spotLightMap.length=K,n.numSpotLightShadowsWithMaps=T,n.numLightProbes=L,k.directionalLength=y,k.pointLength=G,k.spotLength=w,k.rectAreaLength=R,k.hemiLength=Z,k.numDirectionalShadows=x,k.numPointShadows=W,k.numSpotShadows=N,k.numSpotMaps=K,k.numLightProbes=L,n.version=oP++)}function d(C,A){let p=0,m=0,y=0,G=0,w=0;const R=A.matrixWorldInverse;for(let Z=0,x=C.length;Z<x;Z++){const W=C[Z];if(W.isDirectionalLight){const N=n.directional[p];N.direction.setFromMatrixPosition(W.matrixWorld),a.setFromMatrixPosition(W.target.matrixWorld),N.direction.sub(a),N.direction.transformDirection(R),p++}else if(W.isSpotLight){const N=n.spot[y];N.position.setFromMatrixPosition(W.matrixWorld),N.position.applyMatrix4(R),N.direction.setFromMatrixPosition(W.matrixWorld),a.setFromMatrixPosition(W.target.matrixWorld),N.direction.sub(a),N.direction.transformDirection(R),y++}else if(W.isRectAreaLight){const N=n.rectArea[G];N.position.setFromMatrixPosition(W.matrixWorld),N.position.applyMatrix4(R),l.identity(),o.copy(W.matrixWorld),o.premultiply(R),l.extractRotation(o),N.halfWidth.set(W.width*.5,0,0),N.halfHeight.set(0,W.height*.5,0),N.halfWidth.applyMatrix4(l),N.halfHeight.applyMatrix4(l),G++}else if(W.isPointLight){const N=n.point[m];N.position.setFromMatrixPosition(W.matrixWorld),N.position.applyMatrix4(R),m++}else if(W.isHemisphereLight){const N=n.hemi[w];N.direction.setFromMatrixPosition(W.matrixWorld),N.direction.transformDirection(R),w++}}}return{setup:u,setupView:d,state:n}}function QF(s){const e=new lP(s),t=[],n=[];function a(A){C.camera=A,t.length=0,n.length=0}function o(A){t.push(A)}function l(A){n.push(A)}function u(){e.setup(t)}function d(A){e.setupView(t,A)}const C={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:a,state:C,setupLights:u,setupLightsView:d,pushLight:o,pushShadow:l}}function cP(s){let e=new WeakMap;function t(a,o=0){const l=e.get(a);let u;return l===void 0?(u=new QF(s),e.set(a,[u])):o>=l.length?(u=new QF(s),l.push(u)):u=l[o],u}function n(){e=new WeakMap}return{get:t,dispose:n}}class AH extends Zr{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=LE,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class fH extends Zr{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const gP=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,uP=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function IP(s,e,t){let n=new wG;const a=new ut,o=new ut,l=new Si,u=new AH({depthPacking:zE}),d=new fH,C={},A=t.maxTextureSize,p={[iu]:ss,[ss]:iu,[Kl]:Kl},m=new _c({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ut},radius:{value:4}},vertexShader:gP,fragmentShader:uP}),y=m.clone();y.defines.HORIZONTAL_PASS=1;const G=new Ln;G.setAttribute("position",new Ri(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new tr(G,m),R=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=mw;let Z=this.type;this.render=function(T,L,k){if(R.enabled===!1||R.autoUpdate===!1&&R.needsUpdate===!1||T.length===0)return;const E=s.getRenderTarget(),F=s.getActiveCubeFace(),U=s.getActiveMipmapLevel(),le=s.state;le.setBlending(RI),le.buffers.color.setClear(1,1,1,1),le.buffers.depth.setTest(!0),le.setScissorTest(!1);const ie=Z!==Yc&&this.type===Yc,Ce=Z===Yc&&this.type!==Yc;for(let Ge=0,ye=T.length;Ge<ye;Ge++){const pe=T[Ge],de=pe.shadow;if(de===void 0){console.warn("THREE.WebGLShadowMap:",pe,"has no shadow.");continue}if(de.autoUpdate===!1&&de.needsUpdate===!1)continue;a.copy(de.mapSize);const Oe=de.getFrameExtents();if(a.multiply(Oe),o.copy(de.mapSize),(a.x>A||a.y>A)&&(a.x>A&&(o.x=Math.floor(A/Oe.x),a.x=o.x*Oe.x,de.mapSize.x=o.x),a.y>A&&(o.y=Math.floor(A/Oe.y),a.y=o.y*Oe.y,de.mapSize.y=o.y)),de.map===null||ie===!0||Ce===!0){const ke=this.type!==Yc?{minFilter:_r,magFilter:_r}:{};de.map!==null&&de.map.dispose(),de.map=new zc(a.x,a.y,ke),de.map.texture.name=pe.name+".shadowMap",de.camera.updateProjectionMatrix()}s.setRenderTarget(de.map),s.clear();const We=de.getViewportCount();for(let ke=0;ke<We;ke++){const $e=de.getViewport(ke);l.set(o.x*$e.x,o.y*$e.y,o.x*$e.z,o.y*$e.w),le.viewport(l),de.updateMatrices(pe,ke),n=de.getFrustum(),N(L,k,de.camera,pe,this.type)}de.isPointLightShadow!==!0&&this.type===Yc&&x(de,k),de.needsUpdate=!1}Z=this.type,R.needsUpdate=!1,s.setRenderTarget(E,F,U)};function x(T,L){const k=e.update(w);m.defines.VSM_SAMPLES!==T.blurSamples&&(m.defines.VSM_SAMPLES=T.blurSamples,y.defines.VSM_SAMPLES=T.blurSamples,m.needsUpdate=!0,y.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new zc(a.x,a.y)),m.uniforms.shadow_pass.value=T.map.texture,m.uniforms.resolution.value=T.mapSize,m.uniforms.radius.value=T.radius,s.setRenderTarget(T.mapPass),s.clear(),s.renderBufferDirect(L,null,k,m,w,null),y.uniforms.shadow_pass.value=T.mapPass.texture,y.uniforms.resolution.value=T.mapSize,y.uniforms.radius.value=T.radius,s.setRenderTarget(T.map),s.clear(),s.renderBufferDirect(L,null,k,y,w,null)}function W(T,L,k,E){let F=null;const U=k.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(U!==void 0)F=U;else if(F=k.isPointLight===!0?d:u,s.localClippingEnabled&&L.clipShadows===!0&&Array.isArray(L.clippingPlanes)&&L.clippingPlanes.length!==0||L.displacementMap&&L.displacementScale!==0||L.alphaMap&&L.alphaTest>0||L.map&&L.alphaTest>0){const le=F.uuid,ie=L.uuid;let Ce=C[le];Ce===void 0&&(Ce={},C[le]=Ce);let Ge=Ce[ie];Ge===void 0&&(Ge=F.clone(),Ce[ie]=Ge,L.addEventListener("dispose",K)),F=Ge}if(F.visible=L.visible,F.wireframe=L.wireframe,E===Yc?F.side=L.shadowSide!==null?L.shadowSide:L.side:F.side=L.shadowSide!==null?L.shadowSide:p[L.side],F.alphaMap=L.alphaMap,F.alphaTest=L.alphaTest,F.map=L.map,F.clipShadows=L.clipShadows,F.clippingPlanes=L.clippingPlanes,F.clipIntersection=L.clipIntersection,F.displacementMap=L.displacementMap,F.displacementScale=L.displacementScale,F.displacementBias=L.displacementBias,F.wireframeLinewidth=L.wireframeLinewidth,F.linewidth=L.linewidth,k.isPointLight===!0&&F.isMeshDistanceMaterial===!0){const le=s.properties.get(F);le.light=k}return F}function N(T,L,k,E,F){if(T.visible===!1)return;if(T.layers.test(L.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&F===Yc)&&(!T.frustumCulled||n.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,T.matrixWorld);const ie=e.update(T),Ce=T.material;if(Array.isArray(Ce)){const Ge=ie.groups;for(let ye=0,pe=Ge.length;ye<pe;ye++){const de=Ge[ye],Oe=Ce[de.materialIndex];if(Oe&&Oe.visible){const We=W(T,Oe,E,F);T.onBeforeShadow(s,T,L,k,ie,We,de),s.renderBufferDirect(k,null,ie,We,T,de),T.onAfterShadow(s,T,L,k,ie,We,de)}}}else if(Ce.visible){const Ge=W(T,Ce,E,F);T.onBeforeShadow(s,T,L,k,ie,Ge,null),s.renderBufferDirect(k,null,ie,Ge,T,null),T.onAfterShadow(s,T,L,k,ie,Ge,null)}}const le=T.children;for(let ie=0,Ce=le.length;ie<Ce;ie++)N(le[ie],L,k,E,F)}function K(T){T.target.removeEventListener("dispose",K);for(const k in C){const E=C[k],F=T.target.uuid;F in E&&(E[F].dispose(),delete E[F])}}}const dP={[RR]:wR,[xR]:MR,[WR]:NR,[_A]:VR,[wR]:RR,[MR]:xR,[NR]:WR,[VR]:_A};function CP(s,e){function t(){let Q=!1;const st=new Si;let be=null;const Be=new Si(0,0,0,0);return{setMask:function(Ft){be!==Ft&&!Q&&(s.colorMask(Ft,Ft,Ft,Ft),be=Ft)},setLocked:function(Ft){Q=Ft},setClear:function(Ft,wt,ln,Yn,un){un===!0&&(Ft*=Yn,wt*=Yn,ln*=Yn),st.set(Ft,wt,ln,Yn),Be.equals(st)===!1&&(s.clearColor(Ft,wt,ln,Yn),Be.copy(st))},reset:function(){Q=!1,be=null,Be.set(-1,0,0,0)}}}function n(){let Q=!1,st=!1,be=null,Be=null,Ft=null;return{setReversed:function(wt){if(st!==wt){const ln=e.get("EXT_clip_control");st?ln.clipControlEXT(ln.LOWER_LEFT_EXT,ln.ZERO_TO_ONE_EXT):ln.clipControlEXT(ln.LOWER_LEFT_EXT,ln.NEGATIVE_ONE_TO_ONE_EXT);const Yn=Ft;Ft=null,this.setClear(Yn)}st=wt},getReversed:function(){return st},setTest:function(wt){wt?dt(s.DEPTH_TEST):yt(s.DEPTH_TEST)},setMask:function(wt){be!==wt&&!Q&&(s.depthMask(wt),be=wt)},setFunc:function(wt){if(st&&(wt=dP[wt]),Be!==wt){switch(wt){case RR:s.depthFunc(s.NEVER);break;case wR:s.depthFunc(s.ALWAYS);break;case xR:s.depthFunc(s.LESS);break;case _A:s.depthFunc(s.LEQUAL);break;case WR:s.depthFunc(s.EQUAL);break;case VR:s.depthFunc(s.GEQUAL);break;case MR:s.depthFunc(s.GREATER);break;case NR:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}Be=wt}},setLocked:function(wt){Q=wt},setClear:function(wt){Ft!==wt&&(st&&(wt=1-wt),s.clearDepth(wt),Ft=wt)},reset:function(){Q=!1,be=null,Be=null,Ft=null,st=!1}}}function a(){let Q=!1,st=null,be=null,Be=null,Ft=null,wt=null,ln=null,Yn=null,un=null;return{setTest:function(bn){Q||(bn?dt(s.STENCIL_TEST):yt(s.STENCIL_TEST))},setMask:function(bn){st!==bn&&!Q&&(s.stencilMask(bn),st=bn)},setFunc:function(bn,ui,bi){(be!==bn||Be!==ui||Ft!==bi)&&(s.stencilFunc(bn,ui,bi),be=bn,Be=ui,Ft=bi)},setOp:function(bn,ui,bi){(wt!==bn||ln!==ui||Yn!==bi)&&(s.stencilOp(bn,ui,bi),wt=bn,ln=ui,Yn=bi)},setLocked:function(bn){Q=bn},setClear:function(bn){un!==bn&&(s.clearStencil(bn),un=bn)},reset:function(){Q=!1,st=null,be=null,Be=null,Ft=null,wt=null,ln=null,Yn=null,un=null}}}const o=new t,l=new n,u=new a,d=new WeakMap,C=new WeakMap;let A={},p={},m=new WeakMap,y=[],G=null,w=!1,R=null,Z=null,x=null,W=null,N=null,K=null,T=null,L=new $t(0,0,0),k=0,E=!1,F=null,U=null,le=null,ie=null,Ce=null;const Ge=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ye=!1,pe=0;const de=s.getParameter(s.VERSION);de.indexOf("WebGL")!==-1?(pe=parseFloat(/^WebGL (\d)/.exec(de)[1]),ye=pe>=1):de.indexOf("OpenGL ES")!==-1&&(pe=parseFloat(/^OpenGL ES (\d)/.exec(de)[1]),ye=pe>=2);let Oe=null,We={};const ke=s.getParameter(s.SCISSOR_BOX),$e=s.getParameter(s.VIEWPORT),ot=new Si().fromArray(ke),Ne=new Si().fromArray($e);function tt(Q,st,be,Be){const Ft=new Uint8Array(4),wt=s.createTexture();s.bindTexture(Q,wt),s.texParameteri(Q,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(Q,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let ln=0;ln<be;ln++)Q===s.TEXTURE_3D||Q===s.TEXTURE_2D_ARRAY?s.texImage3D(st,0,s.RGBA,1,1,Be,0,s.RGBA,s.UNSIGNED_BYTE,Ft):s.texImage2D(st+ln,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,Ft);return wt}const bt={};bt[s.TEXTURE_2D]=tt(s.TEXTURE_2D,s.TEXTURE_2D,1),bt[s.TEXTURE_CUBE_MAP]=tt(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),bt[s.TEXTURE_2D_ARRAY]=tt(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),bt[s.TEXTURE_3D]=tt(s.TEXTURE_3D,s.TEXTURE_3D,1,1),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),dt(s.DEPTH_TEST),l.setFunc(_A),Qe(!1),ht(hN),dt(s.CULL_FACE),te(RI);function dt(Q){A[Q]!==!0&&(s.enable(Q),A[Q]=!0)}function yt(Q){A[Q]!==!1&&(s.disable(Q),A[Q]=!1)}function zt(Q,st){return p[Q]!==st?(s.bindFramebuffer(Q,st),p[Q]=st,Q===s.DRAW_FRAMEBUFFER&&(p[s.FRAMEBUFFER]=st),Q===s.FRAMEBUFFER&&(p[s.DRAW_FRAMEBUFFER]=st),!0):!1}function Nt(Q,st){let be=y,Be=!1;if(Q){be=m.get(st),be===void 0&&(be=[],m.set(st,be));const Ft=Q.textures;if(be.length!==Ft.length||be[0]!==s.COLOR_ATTACHMENT0){for(let wt=0,ln=Ft.length;wt<ln;wt++)be[wt]=s.COLOR_ATTACHMENT0+wt;be.length=Ft.length,Be=!0}}else be[0]!==s.BACK&&(be[0]=s.BACK,Be=!0);Be&&s.drawBuffers(be)}function Lt(Q){return G!==Q?(s.useProgram(Q),G=Q,!0):!1}const Ue={[rC]:s.FUNC_ADD,[uE]:s.FUNC_SUBTRACT,[IE]:s.FUNC_REVERSE_SUBTRACT};Ue[dE]=s.MIN,Ue[CE]=s.MAX;const Pe={[hE]:s.ZERO,[AE]:s.ONE,[fE]:s.SRC_COLOR,[ZR]:s.SRC_ALPHA,[GE]:s.SRC_ALPHA_SATURATE,[vE]:s.DST_COLOR,[mE]:s.DST_ALPHA,[pE]:s.ONE_MINUS_SRC_COLOR,[SR]:s.ONE_MINUS_SRC_ALPHA,[yE]:s.ONE_MINUS_DST_COLOR,[bE]:s.ONE_MINUS_DST_ALPHA,[BE]:s.CONSTANT_COLOR,[ZE]:s.ONE_MINUS_CONSTANT_COLOR,[SE]:s.CONSTANT_ALPHA,[RE]:s.ONE_MINUS_CONSTANT_ALPHA};function te(Q,st,be,Be,Ft,wt,ln,Yn,un,bn){if(Q===RI){w===!0&&(yt(s.BLEND),w=!1);return}if(w===!1&&(dt(s.BLEND),w=!0),Q!==gE){if(Q!==R||bn!==E){if((Z!==rC||N!==rC)&&(s.blendEquation(s.FUNC_ADD),Z=rC,N=rC),bn)switch(Q){case FA:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case AN:s.blendFunc(s.ONE,s.ONE);break;case fN:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case pN:s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q);break}else switch(Q){case FA:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case AN:s.blendFunc(s.SRC_ALPHA,s.ONE);break;case fN:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case pN:s.blendFunc(s.ZERO,s.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q);break}x=null,W=null,K=null,T=null,L.set(0,0,0),k=0,R=Q,E=bn}return}Ft=Ft||st,wt=wt||be,ln=ln||Be,(st!==Z||Ft!==N)&&(s.blendEquationSeparate(Ue[st],Ue[Ft]),Z=st,N=Ft),(be!==x||Be!==W||wt!==K||ln!==T)&&(s.blendFuncSeparate(Pe[be],Pe[Be],Pe[wt],Pe[ln]),x=be,W=Be,K=wt,T=ln),(Yn.equals(L)===!1||un!==k)&&(s.blendColor(Yn.r,Yn.g,Yn.b,un),L.copy(Yn),k=un),R=Q,E=!1}function Gt(Q,st){Q.side===Kl?yt(s.CULL_FACE):dt(s.CULL_FACE);let be=Q.side===ss;st&&(be=!be),Qe(be),Q.blending===FA&&Q.transparent===!1?te(RI):te(Q.blending,Q.blendEquation,Q.blendSrc,Q.blendDst,Q.blendEquationAlpha,Q.blendSrcAlpha,Q.blendDstAlpha,Q.blendColor,Q.blendAlpha,Q.premultipliedAlpha),l.setFunc(Q.depthFunc),l.setTest(Q.depthTest),l.setMask(Q.depthWrite),o.setMask(Q.colorWrite);const Be=Q.stencilWrite;u.setTest(Be),Be&&(u.setMask(Q.stencilWriteMask),u.setFunc(Q.stencilFunc,Q.stencilRef,Q.stencilFuncMask),u.setOp(Q.stencilFail,Q.stencilZFail,Q.stencilZPass)),Tt(Q.polygonOffset,Q.polygonOffsetFactor,Q.polygonOffsetUnits),Q.alphaToCoverage===!0?dt(s.SAMPLE_ALPHA_TO_COVERAGE):yt(s.SAMPLE_ALPHA_TO_COVERAGE)}function Qe(Q){F!==Q&&(Q?s.frontFace(s.CW):s.frontFace(s.CCW),F=Q)}function ht(Q){Q!==sE?(dt(s.CULL_FACE),Q!==U&&(Q===hN?s.cullFace(s.BACK):Q===lE?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):yt(s.CULL_FACE),U=Q}function Ct(Q){Q!==le&&(ye&&s.lineWidth(Q),le=Q)}function Tt(Q,st,be){Q?(dt(s.POLYGON_OFFSET_FILL),(ie!==st||Ce!==be)&&(s.polygonOffset(st,be),ie=st,Ce=be)):yt(s.POLYGON_OFFSET_FILL)}function Rt(Q){Q?dt(s.SCISSOR_TEST):yt(s.SCISSOR_TEST)}function $(Q){Q===void 0&&(Q=s.TEXTURE0+Ge-1),Oe!==Q&&(s.activeTexture(Q),Oe=Q)}function J(Q,st,be){be===void 0&&(Oe===null?be=s.TEXTURE0+Ge-1:be=Oe);let Be=We[be];Be===void 0&&(Be={type:void 0,texture:void 0},We[be]=Be),(Be.type!==Q||Be.texture!==st)&&(Oe!==be&&(s.activeTexture(be),Oe=be),s.bindTexture(Q,st||bt[Q]),Be.type=Q,Be.texture=st)}function fe(){const Q=We[Oe];Q!==void 0&&Q.type!==void 0&&(s.bindTexture(Q.type,null),Q.type=void 0,Q.texture=void 0)}function ze(){try{s.compressedTexImage2D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function et(){try{s.compressedTexImage3D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function _e(){try{s.texSubImage2D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function At(){try{s.texSubImage3D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Zt(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Xt(){try{s.compressedTexSubImage3D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function An(){try{s.texStorage2D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function j(){try{s.texStorage3D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function ue(){try{s.texImage2D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Ve(){try{s.texImage3D.apply(s,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function qe(Q){ot.equals(Q)===!1&&(s.scissor(Q.x,Q.y,Q.z,Q.w),ot.copy(Q))}function Me(Q){Ne.equals(Q)===!1&&(s.viewport(Q.x,Q.y,Q.z,Q.w),Ne.copy(Q))}function se(Q,st){let be=C.get(st);be===void 0&&(be=new WeakMap,C.set(st,be));let Be=be.get(Q);Be===void 0&&(Be=s.getUniformBlockIndex(st,Q.name),be.set(Q,Be))}function Re(Q,st){const Be=C.get(st).get(Q);d.get(st)!==Be&&(s.uniformBlockBinding(st,Be,Q.__bindingPointIndex),d.set(st,Be))}function De(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.blendColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),l.setReversed(!1),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),A={},Oe=null,We={},p={},m=new WeakMap,y=[],G=null,w=!1,R=null,Z=null,x=null,W=null,N=null,K=null,T=null,L=new $t(0,0,0),k=0,E=!1,F=null,U=null,le=null,ie=null,Ce=null,ot.set(0,0,s.canvas.width,s.canvas.height),Ne.set(0,0,s.canvas.width,s.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:dt,disable:yt,bindFramebuffer:zt,drawBuffers:Nt,useProgram:Lt,setBlending:te,setMaterial:Gt,setFlipSided:Qe,setCullFace:ht,setLineWidth:Ct,setPolygonOffset:Tt,setScissorTest:Rt,activeTexture:$,bindTexture:J,unbindTexture:fe,compressedTexImage2D:ze,compressedTexImage3D:et,texImage2D:ue,texImage3D:Ve,updateUBOMapping:se,uniformBlockBinding:Re,texStorage2D:An,texStorage3D:j,texSubImage2D:_e,texSubImage3D:At,compressedTexSubImage2D:Zt,compressedTexSubImage3D:Xt,scissor:qe,viewport:Me,reset:De}}function hP(s,e){const t=s.image&&s.image.width?s.image.width/s.image.height:1;return t>e?(s.repeat.x=1,s.repeat.y=t/e,s.offset.x=0,s.offset.y=(1-s.repeat.y)/2):(s.repeat.x=e/t,s.repeat.y=1,s.offset.x=(1-s.repeat.x)/2,s.offset.y=0),s}function AP(s,e){const t=s.image&&s.image.width?s.image.width/s.image.height:1;return t>e?(s.repeat.x=e/t,s.repeat.y=1,s.offset.x=(1-s.repeat.x)/2,s.offset.y=0):(s.repeat.x=1,s.repeat.y=t/e,s.offset.x=0,s.offset.y=(1-s.repeat.y)/2),s}function fP(s){return s.repeat.x=1,s.repeat.y=1,s.offset.x=0,s.offset.y=0,s}function BN(s,e,t,n){const a=pP(n);switch(t){case eH:return s*e;case nH:return s*e;case iH:return s*e*2;case Zw:return s*e/a.components*a.byteLength;case BG:return s*e/a.components*a.byteLength;case aH:return s*e*2/a.components*a.byteLength;case Sw:return s*e*2/a.components*a.byteLength;case tH:return s*e*3/a.components*a.byteLength;case To:return s*e*4/a.components*a.byteLength;case Rw:return s*e*4/a.components*a.byteLength;case iG:case aG:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case rG:case oG:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case XR:case YR:return Math.max(s,16)*Math.max(e,8)/4;case HR:case FR:return Math.max(s,8)*Math.max(e,8)/2;case TR:case ER:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case KR:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case LR:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case zR:return Math.floor((s+4)/5)*Math.floor((e+3)/4)*16;case _R:return Math.floor((s+4)/5)*Math.floor((e+4)/5)*16;case DR:return Math.floor((s+5)/6)*Math.floor((e+4)/5)*16;case kR:return Math.floor((s+5)/6)*Math.floor((e+5)/6)*16;case UR:return Math.floor((s+7)/8)*Math.floor((e+4)/5)*16;case JR:return Math.floor((s+7)/8)*Math.floor((e+5)/6)*16;case OR:return Math.floor((s+7)/8)*Math.floor((e+7)/8)*16;case PR:return Math.floor((s+9)/10)*Math.floor((e+4)/5)*16;case QR:return Math.floor((s+9)/10)*Math.floor((e+5)/6)*16;case jR:return Math.floor((s+9)/10)*Math.floor((e+7)/8)*16;case qR:return Math.floor((s+9)/10)*Math.floor((e+9)/10)*16;case $R:return Math.floor((s+11)/12)*Math.floor((e+9)/10)*16;case ew:return Math.floor((s+11)/12)*Math.floor((e+11)/12)*16;case sG:case tw:case nw:return Math.ceil(s/4)*Math.ceil(e/4)*16;case rH:case iw:return Math.ceil(s/4)*Math.ceil(e/4)*8;case aw:case rw:return Math.ceil(s/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function pP(s){switch(s){case Lc:case jN:return{byteLength:1,components:1};case ob:case qN:case hb:return{byteLength:2,components:1};case Gw:case Bw:return{byteLength:2,components:4};case VI:case yw:case Ns:return{byteLength:4,components:1};case $N:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${s}.`)}const mP={contain:hP,cover:AP,fill:fP,getByteLength:BN};function bP(s,e,t,n,a,o,l){const u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,d=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),C=new ut,A=new WeakMap;let p;const m=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function G($,J){return y?new OffscreenCanvas($,J):AG("canvas")}function w($,J,fe){let ze=1;const et=Rt($);if((et.width>fe||et.height>fe)&&(ze=fe/Math.max(et.width,et.height)),ze<1)if(typeof HTMLImageElement<"u"&&$ instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&$ instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&$ instanceof ImageBitmap||typeof VideoFrame<"u"&&$ instanceof VideoFrame){const _e=Math.floor(ze*et.width),At=Math.floor(ze*et.height);p===void 0&&(p=G(_e,At));const Zt=J?G(_e,At):p;return Zt.width=_e,Zt.height=At,Zt.getContext("2d").drawImage($,0,0,_e,At),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+et.width+"x"+et.height+") to ("+_e+"x"+At+")."),Zt}else return"data"in $&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+et.width+"x"+et.height+")."),$;return $}function R($){return $.generateMipmaps}function Z($){s.generateMipmap($)}function x($){return $.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:$.isWebGL3DRenderTarget?s.TEXTURE_3D:$.isWebGLArrayRenderTarget||$.isCompressedArrayTexture?s.TEXTURE_2D_ARRAY:s.TEXTURE_2D}function W($,J,fe,ze,et=!1){if($!==null){if(s[$]!==void 0)return s[$];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+$+"'")}let _e=J;if(J===s.RED&&(fe===s.FLOAT&&(_e=s.R32F),fe===s.HALF_FLOAT&&(_e=s.R16F),fe===s.UNSIGNED_BYTE&&(_e=s.R8)),J===s.RED_INTEGER&&(fe===s.UNSIGNED_BYTE&&(_e=s.R8UI),fe===s.UNSIGNED_SHORT&&(_e=s.R16UI),fe===s.UNSIGNED_INT&&(_e=s.R32UI),fe===s.BYTE&&(_e=s.R8I),fe===s.SHORT&&(_e=s.R16I),fe===s.INT&&(_e=s.R32I)),J===s.RG&&(fe===s.FLOAT&&(_e=s.RG32F),fe===s.HALF_FLOAT&&(_e=s.RG16F),fe===s.UNSIGNED_BYTE&&(_e=s.RG8)),J===s.RG_INTEGER&&(fe===s.UNSIGNED_BYTE&&(_e=s.RG8UI),fe===s.UNSIGNED_SHORT&&(_e=s.RG16UI),fe===s.UNSIGNED_INT&&(_e=s.RG32UI),fe===s.BYTE&&(_e=s.RG8I),fe===s.SHORT&&(_e=s.RG16I),fe===s.INT&&(_e=s.RG32I)),J===s.RGB_INTEGER&&(fe===s.UNSIGNED_BYTE&&(_e=s.RGB8UI),fe===s.UNSIGNED_SHORT&&(_e=s.RGB16UI),fe===s.UNSIGNED_INT&&(_e=s.RGB32UI),fe===s.BYTE&&(_e=s.RGB8I),fe===s.SHORT&&(_e=s.RGB16I),fe===s.INT&&(_e=s.RGB32I)),J===s.RGBA_INTEGER&&(fe===s.UNSIGNED_BYTE&&(_e=s.RGBA8UI),fe===s.UNSIGNED_SHORT&&(_e=s.RGBA16UI),fe===s.UNSIGNED_INT&&(_e=s.RGBA32UI),fe===s.BYTE&&(_e=s.RGBA8I),fe===s.SHORT&&(_e=s.RGBA16I),fe===s.INT&&(_e=s.RGBA32I)),J===s.RGB&&fe===s.UNSIGNED_INT_5_9_9_9_REV&&(_e=s.RGB9_E5),J===s.RGBA){const At=et?ZG:mi.getTransfer(ze);fe===s.FLOAT&&(_e=s.RGBA32F),fe===s.HALF_FLOAT&&(_e=s.RGBA16F),fe===s.UNSIGNED_BYTE&&(_e=At===ki?s.SRGB8_ALPHA8:s.RGBA8),fe===s.UNSIGNED_SHORT_4_4_4_4&&(_e=s.RGBA4),fe===s.UNSIGNED_SHORT_5_5_5_1&&(_e=s.RGB5_A1)}return(_e===s.R16F||_e===s.R32F||_e===s.RG16F||_e===s.RG32F||_e===s.RGBA16F||_e===s.RGBA32F)&&e.get("EXT_color_buffer_float"),_e}function N($,J){let fe;return $?J===null||J===VI||J===DA?fe=s.DEPTH24_STENCIL8:J===Ns?fe=s.DEPTH32F_STENCIL8:J===ob&&(fe=s.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):J===null||J===VI||J===DA?fe=s.DEPTH_COMPONENT24:J===Ns?fe=s.DEPTH_COMPONENT32F:J===ob&&(fe=s.DEPTH_COMPONENT16),fe}function K($,J){return R($)===!0||$.isFramebufferTexture&&$.minFilter!==_r&&$.minFilter!==er?Math.log2(Math.max(J.width,J.height))+1:$.mipmaps!==void 0&&$.mipmaps.length>0?$.mipmaps.length:$.isCompressedTexture&&Array.isArray($.image)?J.mipmaps.length:1}function T($){const J=$.target;J.removeEventListener("dispose",T),k(J),J.isVideoTexture&&A.delete(J)}function L($){const J=$.target;J.removeEventListener("dispose",L),F(J)}function k($){const J=n.get($);if(J.__webglInit===void 0)return;const fe=$.source,ze=m.get(fe);if(ze){const et=ze[J.__cacheKey];et.usedTimes--,et.usedTimes===0&&E($),Object.keys(ze).length===0&&m.delete(fe)}n.remove($)}function E($){const J=n.get($);s.deleteTexture(J.__webglTexture);const fe=$.source,ze=m.get(fe);delete ze[J.__cacheKey],l.memory.textures--}function F($){const J=n.get($);if($.depthTexture&&($.depthTexture.dispose(),n.remove($.depthTexture)),$.isWebGLCubeRenderTarget)for(let ze=0;ze<6;ze++){if(Array.isArray(J.__webglFramebuffer[ze]))for(let et=0;et<J.__webglFramebuffer[ze].length;et++)s.deleteFramebuffer(J.__webglFramebuffer[ze][et]);else s.deleteFramebuffer(J.__webglFramebuffer[ze]);J.__webglDepthbuffer&&s.deleteRenderbuffer(J.__webglDepthbuffer[ze])}else{if(Array.isArray(J.__webglFramebuffer))for(let ze=0;ze<J.__webglFramebuffer.length;ze++)s.deleteFramebuffer(J.__webglFramebuffer[ze]);else s.deleteFramebuffer(J.__webglFramebuffer);if(J.__webglDepthbuffer&&s.deleteRenderbuffer(J.__webglDepthbuffer),J.__webglMultisampledFramebuffer&&s.deleteFramebuffer(J.__webglMultisampledFramebuffer),J.__webglColorRenderbuffer)for(let ze=0;ze<J.__webglColorRenderbuffer.length;ze++)J.__webglColorRenderbuffer[ze]&&s.deleteRenderbuffer(J.__webglColorRenderbuffer[ze]);J.__webglDepthRenderbuffer&&s.deleteRenderbuffer(J.__webglDepthRenderbuffer)}const fe=$.textures;for(let ze=0,et=fe.length;ze<et;ze++){const _e=n.get(fe[ze]);_e.__webglTexture&&(s.deleteTexture(_e.__webglTexture),l.memory.textures--),n.remove(fe[ze])}n.remove($)}let U=0;function le(){U=0}function ie(){const $=U;return $>=a.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+$+" texture units while this GPU supports only "+a.maxTextures),U+=1,$}function Ce($){const J=[];return J.push($.wrapS),J.push($.wrapT),J.push($.wrapR||0),J.push($.magFilter),J.push($.minFilter),J.push($.anisotropy),J.push($.internalFormat),J.push($.format),J.push($.type),J.push($.generateMipmaps),J.push($.premultiplyAlpha),J.push($.flipY),J.push($.unpackAlignment),J.push($.colorSpace),J.join()}function Ge($,J){const fe=n.get($);if($.isVideoTexture&&Ct($),$.isRenderTargetTexture===!1&&$.version>0&&fe.__version!==$.version){const ze=$.image;if(ze===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ze.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ne(fe,$,J);return}}t.bindTexture(s.TEXTURE_2D,fe.__webglTexture,s.TEXTURE0+J)}function ye($,J){const fe=n.get($);if($.version>0&&fe.__version!==$.version){Ne(fe,$,J);return}t.bindTexture(s.TEXTURE_2D_ARRAY,fe.__webglTexture,s.TEXTURE0+J)}function pe($,J){const fe=n.get($);if($.version>0&&fe.__version!==$.version){Ne(fe,$,J);return}t.bindTexture(s.TEXTURE_3D,fe.__webglTexture,s.TEXTURE0+J)}function de($,J){const fe=n.get($);if($.version>0&&fe.__version!==$.version){tt(fe,$,J);return}t.bindTexture(s.TEXTURE_CUBE_MAP,fe.__webglTexture,s.TEXTURE0+J)}const Oe={[lC]:s.REPEAT,[dl]:s.CLAMP_TO_EDGE,[rb]:s.MIRRORED_REPEAT},We={[_r]:s.NEAREST,[vw]:s.NEAREST_MIPMAP_NEAREST,[xA]:s.NEAREST_MIPMAP_LINEAR,[er]:s.LINEAR,[tb]:s.LINEAR_MIPMAP_NEAREST,[Ll]:s.LINEAR_MIPMAP_LINEAR},ke={[DE]:s.NEVER,[QE]:s.ALWAYS,[kE]:s.LESS,[lH]:s.LEQUAL,[UE]:s.EQUAL,[PE]:s.GEQUAL,[JE]:s.GREATER,[OE]:s.NOTEQUAL};function $e($,J){if(J.type===Ns&&e.has("OES_texture_float_linear")===!1&&(J.magFilter===er||J.magFilter===tb||J.magFilter===xA||J.magFilter===Ll||J.minFilter===er||J.minFilter===tb||J.minFilter===xA||J.minFilter===Ll)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),s.texParameteri($,s.TEXTURE_WRAP_S,Oe[J.wrapS]),s.texParameteri($,s.TEXTURE_WRAP_T,Oe[J.wrapT]),($===s.TEXTURE_3D||$===s.TEXTURE_2D_ARRAY)&&s.texParameteri($,s.TEXTURE_WRAP_R,Oe[J.wrapR]),s.texParameteri($,s.TEXTURE_MAG_FILTER,We[J.magFilter]),s.texParameteri($,s.TEXTURE_MIN_FILTER,We[J.minFilter]),J.compareFunction&&(s.texParameteri($,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri($,s.TEXTURE_COMPARE_FUNC,ke[J.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(J.magFilter===_r||J.minFilter!==xA&&J.minFilter!==Ll||J.type===Ns&&e.has("OES_texture_float_linear")===!1)return;if(J.anisotropy>1||n.get(J).__currentAnisotropy){const fe=e.get("EXT_texture_filter_anisotropic");s.texParameterf($,fe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(J.anisotropy,a.getMaxAnisotropy())),n.get(J).__currentAnisotropy=J.anisotropy}}}function ot($,J){let fe=!1;$.__webglInit===void 0&&($.__webglInit=!0,J.addEventListener("dispose",T));const ze=J.source;let et=m.get(ze);et===void 0&&(et={},m.set(ze,et));const _e=Ce(J);if(_e!==$.__cacheKey){et[_e]===void 0&&(et[_e]={texture:s.createTexture(),usedTimes:0},l.memory.textures++,fe=!0),et[_e].usedTimes++;const At=et[$.__cacheKey];At!==void 0&&(et[$.__cacheKey].usedTimes--,At.usedTimes===0&&E(J)),$.__cacheKey=_e,$.__webglTexture=et[_e].texture}return fe}function Ne($,J,fe){let ze=s.TEXTURE_2D;(J.isDataArrayTexture||J.isCompressedArrayTexture)&&(ze=s.TEXTURE_2D_ARRAY),J.isData3DTexture&&(ze=s.TEXTURE_3D);const et=ot($,J),_e=J.source;t.bindTexture(ze,$.__webglTexture,s.TEXTURE0+fe);const At=n.get(_e);if(_e.version!==At.__version||et===!0){t.activeTexture(s.TEXTURE0+fe);const Zt=mi.getPrimaries(mi.workingColorSpace),Xt=J.colorSpace===vI?null:mi.getPrimaries(J.colorSpace),An=J.colorSpace===vI||Zt===Xt?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,J.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,J.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,J.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,An);let j=w(J.image,!1,a.maxTextureSize);j=Tt(J,j);const ue=o.convert(J.format,J.colorSpace),Ve=o.convert(J.type);let qe=W(J.internalFormat,ue,Ve,J.colorSpace,J.isVideoTexture);$e(ze,J);let Me;const se=J.mipmaps,Re=J.isVideoTexture!==!0,De=At.__version===void 0||et===!0,Q=_e.dataReady,st=K(J,j);if(J.isDepthTexture)qe=N(J.format===kA,J.type),De&&(Re?t.texStorage2D(s.TEXTURE_2D,1,qe,j.width,j.height):t.texImage2D(s.TEXTURE_2D,0,qe,j.width,j.height,0,ue,Ve,null));else if(J.isDataTexture)if(se.length>0){Re&&De&&t.texStorage2D(s.TEXTURE_2D,st,qe,se[0].width,se[0].height);for(let be=0,Be=se.length;be<Be;be++)Me=se[be],Re?Q&&t.texSubImage2D(s.TEXTURE_2D,be,0,0,Me.width,Me.height,ue,Ve,Me.data):t.texImage2D(s.TEXTURE_2D,be,qe,Me.width,Me.height,0,ue,Ve,Me.data);J.generateMipmaps=!1}else Re?(De&&t.texStorage2D(s.TEXTURE_2D,st,qe,j.width,j.height),Q&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,j.width,j.height,ue,Ve,j.data)):t.texImage2D(s.TEXTURE_2D,0,qe,j.width,j.height,0,ue,Ve,j.data);else if(J.isCompressedTexture)if(J.isCompressedArrayTexture){Re&&De&&t.texStorage3D(s.TEXTURE_2D_ARRAY,st,qe,se[0].width,se[0].height,j.depth);for(let be=0,Be=se.length;be<Be;be++)if(Me=se[be],J.format!==To)if(ue!==null)if(Re){if(Q)if(J.layerUpdates.size>0){const Ft=BN(Me.width,Me.height,J.format,J.type);for(const wt of J.layerUpdates){const ln=Me.data.subarray(wt*Ft/Me.data.BYTES_PER_ELEMENT,(wt+1)*Ft/Me.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,be,0,0,wt,Me.width,Me.height,1,ue,ln)}J.clearLayerUpdates()}else t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,be,0,0,0,Me.width,Me.height,j.depth,ue,Me.data)}else t.compressedTexImage3D(s.TEXTURE_2D_ARRAY,be,qe,Me.width,Me.height,j.depth,0,Me.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Re?Q&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,be,0,0,0,Me.width,Me.height,j.depth,ue,Ve,Me.data):t.texImage3D(s.TEXTURE_2D_ARRAY,be,qe,Me.width,Me.height,j.depth,0,ue,Ve,Me.data)}else{Re&&De&&t.texStorage2D(s.TEXTURE_2D,st,qe,se[0].width,se[0].height);for(let be=0,Be=se.length;be<Be;be++)Me=se[be],J.format!==To?ue!==null?Re?Q&&t.compressedTexSubImage2D(s.TEXTURE_2D,be,0,0,Me.width,Me.height,ue,Me.data):t.compressedTexImage2D(s.TEXTURE_2D,be,qe,Me.width,Me.height,0,Me.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Re?Q&&t.texSubImage2D(s.TEXTURE_2D,be,0,0,Me.width,Me.height,ue,Ve,Me.data):t.texImage2D(s.TEXTURE_2D,be,qe,Me.width,Me.height,0,ue,Ve,Me.data)}else if(J.isDataArrayTexture)if(Re){if(De&&t.texStorage3D(s.TEXTURE_2D_ARRAY,st,qe,j.width,j.height,j.depth),Q)if(J.layerUpdates.size>0){const be=BN(j.width,j.height,J.format,J.type);for(const Be of J.layerUpdates){const Ft=j.data.subarray(Be*be/j.data.BYTES_PER_ELEMENT,(Be+1)*be/j.data.BYTES_PER_ELEMENT);t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,Be,j.width,j.height,1,ue,Ve,Ft)}J.clearLayerUpdates()}else t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,j.width,j.height,j.depth,ue,Ve,j.data)}else t.texImage3D(s.TEXTURE_2D_ARRAY,0,qe,j.width,j.height,j.depth,0,ue,Ve,j.data);else if(J.isData3DTexture)Re?(De&&t.texStorage3D(s.TEXTURE_3D,st,qe,j.width,j.height,j.depth),Q&&t.texSubImage3D(s.TEXTURE_3D,0,0,0,0,j.width,j.height,j.depth,ue,Ve,j.data)):t.texImage3D(s.TEXTURE_3D,0,qe,j.width,j.height,j.depth,0,ue,Ve,j.data);else if(J.isFramebufferTexture){if(De)if(Re)t.texStorage2D(s.TEXTURE_2D,st,qe,j.width,j.height);else{let be=j.width,Be=j.height;for(let Ft=0;Ft<st;Ft++)t.texImage2D(s.TEXTURE_2D,Ft,qe,be,Be,0,ue,Ve,null),be>>=1,Be>>=1}}else if(se.length>0){if(Re&&De){const be=Rt(se[0]);t.texStorage2D(s.TEXTURE_2D,st,qe,be.width,be.height)}for(let be=0,Be=se.length;be<Be;be++)Me=se[be],Re?Q&&t.texSubImage2D(s.TEXTURE_2D,be,0,0,ue,Ve,Me):t.texImage2D(s.TEXTURE_2D,be,qe,ue,Ve,Me);J.generateMipmaps=!1}else if(Re){if(De){const be=Rt(j);t.texStorage2D(s.TEXTURE_2D,st,qe,be.width,be.height)}Q&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,ue,Ve,j)}else t.texImage2D(s.TEXTURE_2D,0,qe,ue,Ve,j);R(J)&&Z(ze),At.__version=_e.version,J.onUpdate&&J.onUpdate(J)}$.__version=J.version}function tt($,J,fe){if(J.image.length!==6)return;const ze=ot($,J),et=J.source;t.bindTexture(s.TEXTURE_CUBE_MAP,$.__webglTexture,s.TEXTURE0+fe);const _e=n.get(et);if(et.version!==_e.__version||ze===!0){t.activeTexture(s.TEXTURE0+fe);const At=mi.getPrimaries(mi.workingColorSpace),Zt=J.colorSpace===vI?null:mi.getPrimaries(J.colorSpace),Xt=J.colorSpace===vI||At===Zt?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,J.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,J.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,J.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Xt);const An=J.isCompressedTexture||J.image[0].isCompressedTexture,j=J.image[0]&&J.image[0].isDataTexture,ue=[];for(let Be=0;Be<6;Be++)!An&&!j?ue[Be]=w(J.image[Be],!0,a.maxCubemapSize):ue[Be]=j?J.image[Be].image:J.image[Be],ue[Be]=Tt(J,ue[Be]);const Ve=ue[0],qe=o.convert(J.format,J.colorSpace),Me=o.convert(J.type),se=W(J.internalFormat,qe,Me,J.colorSpace),Re=J.isVideoTexture!==!0,De=_e.__version===void 0||ze===!0,Q=et.dataReady;let st=K(J,Ve);$e(s.TEXTURE_CUBE_MAP,J);let be;if(An){Re&&De&&t.texStorage2D(s.TEXTURE_CUBE_MAP,st,se,Ve.width,Ve.height);for(let Be=0;Be<6;Be++){be=ue[Be].mipmaps;for(let Ft=0;Ft<be.length;Ft++){const wt=be[Ft];J.format!==To?qe!==null?Re?Q&&t.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft,0,0,wt.width,wt.height,qe,wt.data):t.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft,se,wt.width,wt.height,0,wt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Re?Q&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft,0,0,wt.width,wt.height,qe,Me,wt.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft,se,wt.width,wt.height,0,qe,Me,wt.data)}}}else{if(be=J.mipmaps,Re&&De){be.length>0&&st++;const Be=Rt(ue[0]);t.texStorage2D(s.TEXTURE_CUBE_MAP,st,se,Be.width,Be.height)}for(let Be=0;Be<6;Be++)if(j){Re?Q&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,0,0,ue[Be].width,ue[Be].height,qe,Me,ue[Be].data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,se,ue[Be].width,ue[Be].height,0,qe,Me,ue[Be].data);for(let Ft=0;Ft<be.length;Ft++){const ln=be[Ft].image[Be].image;Re?Q&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft+1,0,0,ln.width,ln.height,qe,Me,ln.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft+1,se,ln.width,ln.height,0,qe,Me,ln.data)}}else{Re?Q&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,0,0,qe,Me,ue[Be]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,se,qe,Me,ue[Be]);for(let Ft=0;Ft<be.length;Ft++){const wt=be[Ft];Re?Q&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft+1,0,0,qe,Me,wt.image[Be]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft+1,se,qe,Me,wt.image[Be])}}}R(J)&&Z(s.TEXTURE_CUBE_MAP),_e.__version=et.version,J.onUpdate&&J.onUpdate(J)}$.__version=J.version}function bt($,J,fe,ze,et,_e){const At=o.convert(fe.format,fe.colorSpace),Zt=o.convert(fe.type),Xt=W(fe.internalFormat,At,Zt,fe.colorSpace),An=n.get(J),j=n.get(fe);if(j.__renderTarget=J,!An.__hasExternalTextures){const ue=Math.max(1,J.width>>_e),Ve=Math.max(1,J.height>>_e);et===s.TEXTURE_3D||et===s.TEXTURE_2D_ARRAY?t.texImage3D(et,_e,Xt,ue,Ve,J.depth,0,At,Zt,null):t.texImage2D(et,_e,Xt,ue,Ve,0,At,Zt,null)}t.bindFramebuffer(s.FRAMEBUFFER,$),ht(J)?u.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,ze,et,j.__webglTexture,0,Qe(J)):(et===s.TEXTURE_2D||et>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&et<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,ze,et,j.__webglTexture,_e),t.bindFramebuffer(s.FRAMEBUFFER,null)}function dt($,J,fe){if(s.bindRenderbuffer(s.RENDERBUFFER,$),J.depthBuffer){const ze=J.depthTexture,et=ze&&ze.isDepthTexture?ze.type:null,_e=N(J.stencilBuffer,et),At=J.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Zt=Qe(J);ht(J)?u.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Zt,_e,J.width,J.height):fe?s.renderbufferStorageMultisample(s.RENDERBUFFER,Zt,_e,J.width,J.height):s.renderbufferStorage(s.RENDERBUFFER,_e,J.width,J.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,At,s.RENDERBUFFER,$)}else{const ze=J.textures;for(let et=0;et<ze.length;et++){const _e=ze[et],At=o.convert(_e.format,_e.colorSpace),Zt=o.convert(_e.type),Xt=W(_e.internalFormat,At,Zt,_e.colorSpace),An=Qe(J);fe&&ht(J)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,An,Xt,J.width,J.height):ht(J)?u.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,An,Xt,J.width,J.height):s.renderbufferStorage(s.RENDERBUFFER,Xt,J.width,J.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function yt($,J){if(J&&J.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(s.FRAMEBUFFER,$),!(J.depthTexture&&J.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ze=n.get(J.depthTexture);ze.__renderTarget=J,(!ze.__webglTexture||J.depthTexture.image.width!==J.width||J.depthTexture.image.height!==J.height)&&(J.depthTexture.image.width=J.width,J.depthTexture.image.height=J.height,J.depthTexture.needsUpdate=!0),Ge(J.depthTexture,0);const et=ze.__webglTexture,_e=Qe(J);if(J.depthTexture.format===YA)ht(J)?u.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,et,0,_e):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,et,0);else if(J.depthTexture.format===kA)ht(J)?u.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,et,0,_e):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,et,0);else throw new Error("Unknown depthTexture format")}function zt($){const J=n.get($),fe=$.isWebGLCubeRenderTarget===!0;if(J.__boundDepthTexture!==$.depthTexture){const ze=$.depthTexture;if(J.__depthDisposeCallback&&J.__depthDisposeCallback(),ze){const et=()=>{delete J.__boundDepthTexture,delete J.__depthDisposeCallback,ze.removeEventListener("dispose",et)};ze.addEventListener("dispose",et),J.__depthDisposeCallback=et}J.__boundDepthTexture=ze}if($.depthTexture&&!J.__autoAllocateDepthBuffer){if(fe)throw new Error("target.depthTexture not supported in Cube render targets");yt(J.__webglFramebuffer,$)}else if(fe){J.__webglDepthbuffer=[];for(let ze=0;ze<6;ze++)if(t.bindFramebuffer(s.FRAMEBUFFER,J.__webglFramebuffer[ze]),J.__webglDepthbuffer[ze]===void 0)J.__webglDepthbuffer[ze]=s.createRenderbuffer(),dt(J.__webglDepthbuffer[ze],$,!1);else{const et=$.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,_e=J.__webglDepthbuffer[ze];s.bindRenderbuffer(s.RENDERBUFFER,_e),s.framebufferRenderbuffer(s.FRAMEBUFFER,et,s.RENDERBUFFER,_e)}}else if(t.bindFramebuffer(s.FRAMEBUFFER,J.__webglFramebuffer),J.__webglDepthbuffer===void 0)J.__webglDepthbuffer=s.createRenderbuffer(),dt(J.__webglDepthbuffer,$,!1);else{const ze=$.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,et=J.__webglDepthbuffer;s.bindRenderbuffer(s.RENDERBUFFER,et),s.framebufferRenderbuffer(s.FRAMEBUFFER,ze,s.RENDERBUFFER,et)}t.bindFramebuffer(s.FRAMEBUFFER,null)}function Nt($,J,fe){const ze=n.get($);J!==void 0&&bt(ze.__webglFramebuffer,$,$.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,0),fe!==void 0&&zt($)}function Lt($){const J=$.texture,fe=n.get($),ze=n.get(J);$.addEventListener("dispose",L);const et=$.textures,_e=$.isWebGLCubeRenderTarget===!0,At=et.length>1;if(At||(ze.__webglTexture===void 0&&(ze.__webglTexture=s.createTexture()),ze.__version=J.version,l.memory.textures++),_e){fe.__webglFramebuffer=[];for(let Zt=0;Zt<6;Zt++)if(J.mipmaps&&J.mipmaps.length>0){fe.__webglFramebuffer[Zt]=[];for(let Xt=0;Xt<J.mipmaps.length;Xt++)fe.__webglFramebuffer[Zt][Xt]=s.createFramebuffer()}else fe.__webglFramebuffer[Zt]=s.createFramebuffer()}else{if(J.mipmaps&&J.mipmaps.length>0){fe.__webglFramebuffer=[];for(let Zt=0;Zt<J.mipmaps.length;Zt++)fe.__webglFramebuffer[Zt]=s.createFramebuffer()}else fe.__webglFramebuffer=s.createFramebuffer();if(At)for(let Zt=0,Xt=et.length;Zt<Xt;Zt++){const An=n.get(et[Zt]);An.__webglTexture===void 0&&(An.__webglTexture=s.createTexture(),l.memory.textures++)}if($.samples>0&&ht($)===!1){fe.__webglMultisampledFramebuffer=s.createFramebuffer(),fe.__webglColorRenderbuffer=[],t.bindFramebuffer(s.FRAMEBUFFER,fe.__webglMultisampledFramebuffer);for(let Zt=0;Zt<et.length;Zt++){const Xt=et[Zt];fe.__webglColorRenderbuffer[Zt]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,fe.__webglColorRenderbuffer[Zt]);const An=o.convert(Xt.format,Xt.colorSpace),j=o.convert(Xt.type),ue=W(Xt.internalFormat,An,j,Xt.colorSpace,$.isXRRenderTarget===!0),Ve=Qe($);s.renderbufferStorageMultisample(s.RENDERBUFFER,Ve,ue,$.width,$.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Zt,s.RENDERBUFFER,fe.__webglColorRenderbuffer[Zt])}s.bindRenderbuffer(s.RENDERBUFFER,null),$.depthBuffer&&(fe.__webglDepthRenderbuffer=s.createRenderbuffer(),dt(fe.__webglDepthRenderbuffer,$,!0)),t.bindFramebuffer(s.FRAMEBUFFER,null)}}if(_e){t.bindTexture(s.TEXTURE_CUBE_MAP,ze.__webglTexture),$e(s.TEXTURE_CUBE_MAP,J);for(let Zt=0;Zt<6;Zt++)if(J.mipmaps&&J.mipmaps.length>0)for(let Xt=0;Xt<J.mipmaps.length;Xt++)bt(fe.__webglFramebuffer[Zt][Xt],$,J,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+Zt,Xt);else bt(fe.__webglFramebuffer[Zt],$,J,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+Zt,0);R(J)&&Z(s.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(At){for(let Zt=0,Xt=et.length;Zt<Xt;Zt++){const An=et[Zt],j=n.get(An);t.bindTexture(s.TEXTURE_2D,j.__webglTexture),$e(s.TEXTURE_2D,An),bt(fe.__webglFramebuffer,$,An,s.COLOR_ATTACHMENT0+Zt,s.TEXTURE_2D,0),R(An)&&Z(s.TEXTURE_2D)}t.unbindTexture()}else{let Zt=s.TEXTURE_2D;if(($.isWebGL3DRenderTarget||$.isWebGLArrayRenderTarget)&&(Zt=$.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY),t.bindTexture(Zt,ze.__webglTexture),$e(Zt,J),J.mipmaps&&J.mipmaps.length>0)for(let Xt=0;Xt<J.mipmaps.length;Xt++)bt(fe.__webglFramebuffer[Xt],$,J,s.COLOR_ATTACHMENT0,Zt,Xt);else bt(fe.__webglFramebuffer,$,J,s.COLOR_ATTACHMENT0,Zt,0);R(J)&&Z(Zt),t.unbindTexture()}$.depthBuffer&&zt($)}function Ue($){const J=$.textures;for(let fe=0,ze=J.length;fe<ze;fe++){const et=J[fe];if(R(et)){const _e=x($),At=n.get(et).__webglTexture;t.bindTexture(_e,At),Z(_e),t.unbindTexture()}}}const Pe=[],te=[];function Gt($){if($.samples>0){if(ht($)===!1){const J=$.textures,fe=$.width,ze=$.height;let et=s.COLOR_BUFFER_BIT;const _e=$.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,At=n.get($),Zt=J.length>1;if(Zt)for(let Xt=0;Xt<J.length;Xt++)t.bindFramebuffer(s.FRAMEBUFFER,At.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Xt,s.RENDERBUFFER,null),t.bindFramebuffer(s.FRAMEBUFFER,At.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Xt,s.TEXTURE_2D,null,0);t.bindFramebuffer(s.READ_FRAMEBUFFER,At.__webglMultisampledFramebuffer),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,At.__webglFramebuffer);for(let Xt=0;Xt<J.length;Xt++){if($.resolveDepthBuffer&&($.depthBuffer&&(et|=s.DEPTH_BUFFER_BIT),$.stencilBuffer&&$.resolveStencilBuffer&&(et|=s.STENCIL_BUFFER_BIT)),Zt){s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,At.__webglColorRenderbuffer[Xt]);const An=n.get(J[Xt]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,An,0)}s.blitFramebuffer(0,0,fe,ze,0,0,fe,ze,et,s.NEAREST),d===!0&&(Pe.length=0,te.length=0,Pe.push(s.COLOR_ATTACHMENT0+Xt),$.depthBuffer&&$.resolveDepthBuffer===!1&&(Pe.push(_e),te.push(_e),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,te)),s.invalidateFramebuffer(s.READ_FRAMEBUFFER,Pe))}if(t.bindFramebuffer(s.READ_FRAMEBUFFER,null),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),Zt)for(let Xt=0;Xt<J.length;Xt++){t.bindFramebuffer(s.FRAMEBUFFER,At.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Xt,s.RENDERBUFFER,At.__webglColorRenderbuffer[Xt]);const An=n.get(J[Xt]).__webglTexture;t.bindFramebuffer(s.FRAMEBUFFER,At.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Xt,s.TEXTURE_2D,An,0)}t.bindFramebuffer(s.DRAW_FRAMEBUFFER,At.__webglMultisampledFramebuffer)}else if($.depthBuffer&&$.resolveDepthBuffer===!1&&d){const J=$.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[J])}}}function Qe($){return Math.min(a.maxSamples,$.samples)}function ht($){const J=n.get($);return $.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&J.__useRenderToTexture!==!1}function Ct($){const J=l.render.frame;A.get($)!==J&&(A.set($,J),$.update())}function Tt($,J){const fe=$.colorSpace,ze=$.format,et=$.type;return $.isCompressedTexture===!0||$.isVideoTexture===!0||fe!==jA&&fe!==vI&&(mi.getTransfer(fe)===ki?(ze!==To||et!==Lc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",fe)),J}function Rt($){return typeof HTMLImageElement<"u"&&$ instanceof HTMLImageElement?(C.width=$.naturalWidth||$.width,C.height=$.naturalHeight||$.height):typeof VideoFrame<"u"&&$ instanceof VideoFrame?(C.width=$.displayWidth,C.height=$.displayHeight):(C.width=$.width,C.height=$.height),C}this.allocateTextureUnit=ie,this.resetTextureUnits=le,this.setTexture2D=Ge,this.setTexture2DArray=ye,this.setTexture3D=pe,this.setTextureCube=de,this.rebindTextures=Nt,this.setupRenderTarget=Lt,this.updateRenderTargetMipmap=Ue,this.updateMultisampleRenderTarget=Gt,this.setupDepthRenderbuffer=zt,this.setupFrameBufferTexture=bt,this.useMultisampledRTT=ht}function IK(s,e){function t(n,a=vI){let o;const l=mi.getTransfer(a);if(n===Lc)return s.UNSIGNED_BYTE;if(n===Gw)return s.UNSIGNED_SHORT_4_4_4_4;if(n===Bw)return s.UNSIGNED_SHORT_5_5_5_1;if(n===$N)return s.UNSIGNED_INT_5_9_9_9_REV;if(n===jN)return s.BYTE;if(n===qN)return s.SHORT;if(n===ob)return s.UNSIGNED_SHORT;if(n===yw)return s.INT;if(n===VI)return s.UNSIGNED_INT;if(n===Ns)return s.FLOAT;if(n===hb)return s.HALF_FLOAT;if(n===eH)return s.ALPHA;if(n===tH)return s.RGB;if(n===To)return s.RGBA;if(n===nH)return s.LUMINANCE;if(n===iH)return s.LUMINANCE_ALPHA;if(n===YA)return s.DEPTH_COMPONENT;if(n===kA)return s.DEPTH_STENCIL;if(n===Zw)return s.RED;if(n===BG)return s.RED_INTEGER;if(n===aH)return s.RG;if(n===Sw)return s.RG_INTEGER;if(n===Rw)return s.RGBA_INTEGER;if(n===iG||n===aG||n===rG||n===oG)if(l===ki)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(n===iG)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===aG)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===rG)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===oG)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(n===iG)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===aG)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===rG)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===oG)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===HR||n===XR||n===FR||n===YR)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(n===HR)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===XR)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===FR)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===YR)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===TR||n===ER||n===KR)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(n===TR||n===ER)return l===ki?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(n===KR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===LR||n===zR||n===_R||n===DR||n===kR||n===UR||n===JR||n===OR||n===PR||n===QR||n===jR||n===qR||n===$R||n===ew)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(n===LR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===zR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===_R)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===DR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===kR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===UR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===JR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===OR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===PR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===QR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===jR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===qR)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===$R)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===ew)return l===ki?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===sG||n===tw||n===nw)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(n===sG)return l===ki?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===tw)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===nw)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===rH||n===iw||n===aw||n===rw)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(n===sG)return o.COMPRESSED_RED_RGTC1_EXT;if(n===iw)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===aw)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===rw)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===DA?s.UNSIGNED_INT_24_8:s[n]!==void 0?s[n]:null}return{convert:t}}class dK extends Aa{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class GI extends gi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const vP={type:"move"};class RM{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new GI,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new GI,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new GI,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let a=null,o=null,l=null;const u=this._targetRay,d=this._grip,C=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(C&&e.hand){l=!0;for(const w of e.hand.values()){const R=t.getJointPose(w,n),Z=this._getHandJoint(C,w);R!==null&&(Z.matrix.fromArray(R.transform.matrix),Z.matrix.decompose(Z.position,Z.rotation,Z.scale),Z.matrixWorldNeedsUpdate=!0,Z.jointRadius=R.radius),Z.visible=R!==null}const A=C.joints["index-finger-tip"],p=C.joints["thumb-tip"],m=A.position.distanceTo(p.position),y=.02,G=.005;C.inputState.pinching&&m>y+G?(C.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!C.inputState.pinching&&m<=y-G&&(C.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else d!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),o!==null&&(d.matrix.fromArray(o.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,o.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(o.linearVelocity)):d.hasLinearVelocity=!1,o.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(o.angularVelocity)):d.hasAngularVelocity=!1));u!==null&&(a=t.getPose(e.targetRaySpace,n),a===null&&o!==null&&(a=o),a!==null&&(u.matrix.fromArray(a.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,a.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(a.linearVelocity)):u.hasLinearVelocity=!1,a.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(a.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(vP)))}return u!==null&&(u.visible=a!==null),d!==null&&(d.visible=o!==null),C!==null&&(C.visible=l!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new GI;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}const yP=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,GP=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class BP{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const a=new fa,o=e.properties.get(a);o.__webglTexture=t.texture,(t.depthNear!=n.depthNear||t.depthFar!=n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=a}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new _c({vertexShader:yP,fragmentShader:GP,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new tr(new Ab(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class ZP extends au{constructor(e,t){super();const n=this;let a=null,o=1,l=null,u="local-floor",d=1,C=null,A=null,p=null,m=null,y=null,G=null;const w=new BP,R=t.getContextAttributes();let Z=null,x=null;const W=[],N=[],K=new ut;let T=null;const L=new Aa;L.viewport=new Si;const k=new Aa;k.viewport=new Si;const E=[L,k],F=new dK;let U=null,le=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ne){let tt=W[Ne];return tt===void 0&&(tt=new RM,W[Ne]=tt),tt.getTargetRaySpace()},this.getControllerGrip=function(Ne){let tt=W[Ne];return tt===void 0&&(tt=new RM,W[Ne]=tt),tt.getGripSpace()},this.getHand=function(Ne){let tt=W[Ne];return tt===void 0&&(tt=new RM,W[Ne]=tt),tt.getHandSpace()};function ie(Ne){const tt=N.indexOf(Ne.inputSource);if(tt===-1)return;const bt=W[tt];bt!==void 0&&(bt.update(Ne.inputSource,Ne.frame,C||l),bt.dispatchEvent({type:Ne.type,data:Ne.inputSource}))}function Ce(){a.removeEventListener("select",ie),a.removeEventListener("selectstart",ie),a.removeEventListener("selectend",ie),a.removeEventListener("squeeze",ie),a.removeEventListener("squeezestart",ie),a.removeEventListener("squeezeend",ie),a.removeEventListener("end",Ce),a.removeEventListener("inputsourceschange",Ge);for(let Ne=0;Ne<W.length;Ne++){const tt=N[Ne];tt!==null&&(N[Ne]=null,W[Ne].disconnect(tt))}U=null,le=null,w.reset(),e.setRenderTarget(Z),y=null,m=null,p=null,a=null,x=null,ot.stop(),n.isPresenting=!1,e.setPixelRatio(T),e.setSize(K.width,K.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ne){o=Ne,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ne){u=Ne,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return C||l},this.setReferenceSpace=function(Ne){C=Ne},this.getBaseLayer=function(){return m!==null?m:y},this.getBinding=function(){return p},this.getFrame=function(){return G},this.getSession=function(){return a},this.setSession=async function(Ne){if(a=Ne,a!==null){if(Z=e.getRenderTarget(),a.addEventListener("select",ie),a.addEventListener("selectstart",ie),a.addEventListener("selectend",ie),a.addEventListener("squeeze",ie),a.addEventListener("squeezestart",ie),a.addEventListener("squeezeend",ie),a.addEventListener("end",Ce),a.addEventListener("inputsourceschange",Ge),R.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(K),a.renderState.layers===void 0){const tt={antialias:R.antialias,alpha:!0,depth:R.depth,stencil:R.stencil,framebufferScaleFactor:o};y=new XRWebGLLayer(a,t,tt),a.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),x=new zc(y.framebufferWidth,y.framebufferHeight,{format:To,type:Lc,colorSpace:e.outputColorSpace,stencilBuffer:R.stencil})}else{let tt=null,bt=null,dt=null;R.depth&&(dt=R.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,tt=R.stencil?kA:YA,bt=R.stencil?DA:VI);const yt={colorFormat:t.RGBA8,depthFormat:dt,scaleFactor:o};p=new XRWebGLBinding(a,t),m=p.createProjectionLayer(yt),a.updateRenderState({layers:[m]}),e.setPixelRatio(1),e.setSize(m.textureWidth,m.textureHeight,!1),x=new zc(m.textureWidth,m.textureHeight,{format:To,type:Lc,depthTexture:new hH(m.textureWidth,m.textureHeight,bt,void 0,void 0,void 0,void 0,void 0,void 0,tt),stencilBuffer:R.stencil,colorSpace:e.outputColorSpace,samples:R.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1})}x.isXRRenderTarget=!0,this.setFoveation(d),C=null,l=await a.requestReferenceSpace(u),ot.setContext(a),ot.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(a!==null)return a.environmentBlendMode},this.getDepthTexture=function(){return w.getDepthTexture()};function Ge(Ne){for(let tt=0;tt<Ne.removed.length;tt++){const bt=Ne.removed[tt],dt=N.indexOf(bt);dt>=0&&(N[dt]=null,W[dt].disconnect(bt))}for(let tt=0;tt<Ne.added.length;tt++){const bt=Ne.added[tt];let dt=N.indexOf(bt);if(dt===-1){for(let zt=0;zt<W.length;zt++)if(zt>=N.length){N.push(bt),dt=zt;break}else if(N[zt]===null){N[zt]=bt,dt=zt;break}if(dt===-1)break}const yt=W[dt];yt&&yt.connect(bt)}}const ye=new q,pe=new q;function de(Ne,tt,bt){ye.setFromMatrixPosition(tt.matrixWorld),pe.setFromMatrixPosition(bt.matrixWorld);const dt=ye.distanceTo(pe),yt=tt.projectionMatrix.elements,zt=bt.projectionMatrix.elements,Nt=yt[14]/(yt[10]-1),Lt=yt[14]/(yt[10]+1),Ue=(yt[9]+1)/yt[5],Pe=(yt[9]-1)/yt[5],te=(yt[8]-1)/yt[0],Gt=(zt[8]+1)/zt[0],Qe=Nt*te,ht=Nt*Gt,Ct=dt/(-te+Gt),Tt=Ct*-te;if(tt.matrixWorld.decompose(Ne.position,Ne.quaternion,Ne.scale),Ne.translateX(Tt),Ne.translateZ(Ct),Ne.matrixWorld.compose(Ne.position,Ne.quaternion,Ne.scale),Ne.matrixWorldInverse.copy(Ne.matrixWorld).invert(),yt[10]===-1)Ne.projectionMatrix.copy(tt.projectionMatrix),Ne.projectionMatrixInverse.copy(tt.projectionMatrixInverse);else{const Rt=Nt+Ct,$=Lt+Ct,J=Qe-Tt,fe=ht+(dt-Tt),ze=Ue*Lt/$*Rt,et=Pe*Lt/$*Rt;Ne.projectionMatrix.makePerspective(J,fe,ze,et,Rt,$),Ne.projectionMatrixInverse.copy(Ne.projectionMatrix).invert()}}function Oe(Ne,tt){tt===null?Ne.matrixWorld.copy(Ne.matrix):Ne.matrixWorld.multiplyMatrices(tt.matrixWorld,Ne.matrix),Ne.matrixWorldInverse.copy(Ne.matrixWorld).invert()}this.updateCamera=function(Ne){if(a===null)return;let tt=Ne.near,bt=Ne.far;w.texture!==null&&(w.depthNear>0&&(tt=w.depthNear),w.depthFar>0&&(bt=w.depthFar)),F.near=k.near=L.near=tt,F.far=k.far=L.far=bt,(U!==F.near||le!==F.far)&&(a.updateRenderState({depthNear:F.near,depthFar:F.far}),U=F.near,le=F.far),L.layers.mask=Ne.layers.mask|2,k.layers.mask=Ne.layers.mask|4,F.layers.mask=L.layers.mask|k.layers.mask;const dt=Ne.parent,yt=F.cameras;Oe(F,dt);for(let zt=0;zt<yt.length;zt++)Oe(yt[zt],dt);yt.length===2?de(F,L,k):F.projectionMatrix.copy(L.projectionMatrix),We(Ne,F,dt)};function We(Ne,tt,bt){bt===null?Ne.matrix.copy(tt.matrixWorld):(Ne.matrix.copy(bt.matrixWorld),Ne.matrix.invert(),Ne.matrix.multiply(tt.matrixWorld)),Ne.matrix.decompose(Ne.position,Ne.quaternion,Ne.scale),Ne.updateMatrixWorld(!0),Ne.projectionMatrix.copy(tt.projectionMatrix),Ne.projectionMatrixInverse.copy(tt.projectionMatrixInverse),Ne.isPerspectiveCamera&&(Ne.fov=cb*2*Math.atan(1/Ne.projectionMatrix.elements[5]),Ne.zoom=1)}this.getCamera=function(){return F},this.getFoveation=function(){if(!(m===null&&y===null))return d},this.setFoveation=function(Ne){d=Ne,m!==null&&(m.fixedFoveation=Ne),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=Ne)},this.hasDepthSensing=function(){return w.texture!==null},this.getDepthSensingMesh=function(){return w.getMesh(F)};let ke=null;function $e(Ne,tt){if(A=tt.getViewerPose(C||l),G=tt,A!==null){const bt=A.views;y!==null&&(e.setRenderTargetFramebuffer(x,y.framebuffer),e.setRenderTarget(x));let dt=!1;bt.length!==F.cameras.length&&(F.cameras.length=0,dt=!0);for(let zt=0;zt<bt.length;zt++){const Nt=bt[zt];let Lt=null;if(y!==null)Lt=y.getViewport(Nt);else{const Pe=p.getViewSubImage(m,Nt);Lt=Pe.viewport,zt===0&&(e.setRenderTargetTextures(x,Pe.colorTexture,m.ignoreDepthValues?void 0:Pe.depthStencilTexture),e.setRenderTarget(x))}let Ue=E[zt];Ue===void 0&&(Ue=new Aa,Ue.layers.enable(zt),Ue.viewport=new Si,E[zt]=Ue),Ue.matrix.fromArray(Nt.transform.matrix),Ue.matrix.decompose(Ue.position,Ue.quaternion,Ue.scale),Ue.projectionMatrix.fromArray(Nt.projectionMatrix),Ue.projectionMatrixInverse.copy(Ue.projectionMatrix).invert(),Ue.viewport.set(Lt.x,Lt.y,Lt.width,Lt.height),zt===0&&(F.matrix.copy(Ue.matrix),F.matrix.decompose(F.position,F.quaternion,F.scale)),dt===!0&&F.cameras.push(Ue)}const yt=a.enabledFeatures;if(yt&&yt.includes("depth-sensing")){const zt=p.getDepthInformation(bt[0]);zt&&zt.isValid&&zt.texture&&w.init(e,zt,a.renderState)}}for(let bt=0;bt<W.length;bt++){const dt=N[bt],yt=W[bt];dt!==null&&yt!==void 0&&yt.update(dt,tt,C||l)}ke&&ke(Ne,tt),tt.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:tt}),G=null}const ot=new sK;ot.setAnimationLoop($e),this.setAnimationLoop=function(Ne){ke=Ne},this.dispose=function(){}}}const IA=new Hs,SP=new Sn;function RP(s,e){function t(R,Z){R.matrixAutoUpdate===!0&&R.updateMatrix(),Z.value.copy(R.matrix)}function n(R,Z){Z.color.getRGB(R.fogColor.value,iK(s)),Z.isFog?(R.fogNear.value=Z.near,R.fogFar.value=Z.far):Z.isFogExp2&&(R.fogDensity.value=Z.density)}function a(R,Z,x,W,N){Z.isMeshBasicMaterial||Z.isMeshLambertMaterial?o(R,Z):Z.isMeshToonMaterial?(o(R,Z),p(R,Z)):Z.isMeshPhongMaterial?(o(R,Z),A(R,Z)):Z.isMeshStandardMaterial?(o(R,Z),m(R,Z),Z.isMeshPhysicalMaterial&&y(R,Z,N)):Z.isMeshMatcapMaterial?(o(R,Z),G(R,Z)):Z.isMeshDepthMaterial?o(R,Z):Z.isMeshDistanceMaterial?(o(R,Z),w(R,Z)):Z.isMeshNormalMaterial?o(R,Z):Z.isLineBasicMaterial?(l(R,Z),Z.isLineDashedMaterial&&u(R,Z)):Z.isPointsMaterial?d(R,Z,x,W):Z.isSpriteMaterial?C(R,Z):Z.isShadowMaterial?(R.color.value.copy(Z.color),R.opacity.value=Z.opacity):Z.isShaderMaterial&&(Z.uniformsNeedUpdate=!1)}function o(R,Z){R.opacity.value=Z.opacity,Z.color&&R.diffuse.value.copy(Z.color),Z.emissive&&R.emissive.value.copy(Z.emissive).multiplyScalar(Z.emissiveIntensity),Z.map&&(R.map.value=Z.map,t(Z.map,R.mapTransform)),Z.alphaMap&&(R.alphaMap.value=Z.alphaMap,t(Z.alphaMap,R.alphaMapTransform)),Z.bumpMap&&(R.bumpMap.value=Z.bumpMap,t(Z.bumpMap,R.bumpMapTransform),R.bumpScale.value=Z.bumpScale,Z.side===ss&&(R.bumpScale.value*=-1)),Z.normalMap&&(R.normalMap.value=Z.normalMap,t(Z.normalMap,R.normalMapTransform),R.normalScale.value.copy(Z.normalScale),Z.side===ss&&R.normalScale.value.negate()),Z.displacementMap&&(R.displacementMap.value=Z.displacementMap,t(Z.displacementMap,R.displacementMapTransform),R.displacementScale.value=Z.displacementScale,R.displacementBias.value=Z.displacementBias),Z.emissiveMap&&(R.emissiveMap.value=Z.emissiveMap,t(Z.emissiveMap,R.emissiveMapTransform)),Z.specularMap&&(R.specularMap.value=Z.specularMap,t(Z.specularMap,R.specularMapTransform)),Z.alphaTest>0&&(R.alphaTest.value=Z.alphaTest);const x=e.get(Z),W=x.envMap,N=x.envMapRotation;W&&(R.envMap.value=W,IA.copy(N),IA.x*=-1,IA.y*=-1,IA.z*=-1,W.isCubeTexture&&W.isRenderTargetTexture===!1&&(IA.y*=-1,IA.z*=-1),R.envMapRotation.value.setFromMatrix4(SP.makeRotationFromEuler(IA)),R.flipEnvMap.value=W.isCubeTexture&&W.isRenderTargetTexture===!1?-1:1,R.reflectivity.value=Z.reflectivity,R.ior.value=Z.ior,R.refractionRatio.value=Z.refractionRatio),Z.lightMap&&(R.lightMap.value=Z.lightMap,R.lightMapIntensity.value=Z.lightMapIntensity,t(Z.lightMap,R.lightMapTransform)),Z.aoMap&&(R.aoMap.value=Z.aoMap,R.aoMapIntensity.value=Z.aoMapIntensity,t(Z.aoMap,R.aoMapTransform))}function l(R,Z){R.diffuse.value.copy(Z.color),R.opacity.value=Z.opacity,Z.map&&(R.map.value=Z.map,t(Z.map,R.mapTransform))}function u(R,Z){R.dashSize.value=Z.dashSize,R.totalSize.value=Z.dashSize+Z.gapSize,R.scale.value=Z.scale}function d(R,Z,x,W){R.diffuse.value.copy(Z.color),R.opacity.value=Z.opacity,R.size.value=Z.size*x,R.scale.value=W*.5,Z.map&&(R.map.value=Z.map,t(Z.map,R.uvTransform)),Z.alphaMap&&(R.alphaMap.value=Z.alphaMap,t(Z.alphaMap,R.alphaMapTransform)),Z.alphaTest>0&&(R.alphaTest.value=Z.alphaTest)}function C(R,Z){R.diffuse.value.copy(Z.color),R.opacity.value=Z.opacity,R.rotation.value=Z.rotation,Z.map&&(R.map.value=Z.map,t(Z.map,R.mapTransform)),Z.alphaMap&&(R.alphaMap.value=Z.alphaMap,t(Z.alphaMap,R.alphaMapTransform)),Z.alphaTest>0&&(R.alphaTest.value=Z.alphaTest)}function A(R,Z){R.specular.value.copy(Z.specular),R.shininess.value=Math.max(Z.shininess,1e-4)}function p(R,Z){Z.gradientMap&&(R.gradientMap.value=Z.gradientMap)}function m(R,Z){R.metalness.value=Z.metalness,Z.metalnessMap&&(R.metalnessMap.value=Z.metalnessMap,t(Z.metalnessMap,R.metalnessMapTransform)),R.roughness.value=Z.roughness,Z.roughnessMap&&(R.roughnessMap.value=Z.roughnessMap,t(Z.roughnessMap,R.roughnessMapTransform)),Z.envMap&&(R.envMapIntensity.value=Z.envMapIntensity)}function y(R,Z,x){R.ior.value=Z.ior,Z.sheen>0&&(R.sheenColor.value.copy(Z.sheenColor).multiplyScalar(Z.sheen),R.sheenRoughness.value=Z.sheenRoughness,Z.sheenColorMap&&(R.sheenColorMap.value=Z.sheenColorMap,t(Z.sheenColorMap,R.sheenColorMapTransform)),Z.sheenRoughnessMap&&(R.sheenRoughnessMap.value=Z.sheenRoughnessMap,t(Z.sheenRoughnessMap,R.sheenRoughnessMapTransform))),Z.clearcoat>0&&(R.clearcoat.value=Z.clearcoat,R.clearcoatRoughness.value=Z.clearcoatRoughness,Z.clearcoatMap&&(R.clearcoatMap.value=Z.clearcoatMap,t(Z.clearcoatMap,R.clearcoatMapTransform)),Z.clearcoatRoughnessMap&&(R.clearcoatRoughnessMap.value=Z.clearcoatRoughnessMap,t(Z.clearcoatRoughnessMap,R.clearcoatRoughnessMapTransform)),Z.clearcoatNormalMap&&(R.clearcoatNormalMap.value=Z.clearcoatNormalMap,t(Z.clearcoatNormalMap,R.clearcoatNormalMapTransform),R.clearcoatNormalScale.value.copy(Z.clearcoatNormalScale),Z.side===ss&&R.clearcoatNormalScale.value.negate())),Z.dispersion>0&&(R.dispersion.value=Z.dispersion),Z.iridescence>0&&(R.iridescence.value=Z.iridescence,R.iridescenceIOR.value=Z.iridescenceIOR,R.iridescenceThicknessMinimum.value=Z.iridescenceThicknessRange[0],R.iridescenceThicknessMaximum.value=Z.iridescenceThicknessRange[1],Z.iridescenceMap&&(R.iridescenceMap.value=Z.iridescenceMap,t(Z.iridescenceMap,R.iridescenceMapTransform)),Z.iridescenceThicknessMap&&(R.iridescenceThicknessMap.value=Z.iridescenceThicknessMap,t(Z.iridescenceThicknessMap,R.iridescenceThicknessMapTransform))),Z.transmission>0&&(R.transmission.value=Z.transmission,R.transmissionSamplerMap.value=x.texture,R.transmissionSamplerSize.value.set(x.width,x.height),Z.transmissionMap&&(R.transmissionMap.value=Z.transmissionMap,t(Z.transmissionMap,R.transmissionMapTransform)),R.thickness.value=Z.thickness,Z.thicknessMap&&(R.thicknessMap.value=Z.thicknessMap,t(Z.thicknessMap,R.thicknessMapTransform)),R.attenuationDistance.value=Z.attenuationDistance,R.attenuationColor.value.copy(Z.attenuationColor)),Z.anisotropy>0&&(R.anisotropyVector.value.set(Z.anisotropy*Math.cos(Z.anisotropyRotation),Z.anisotropy*Math.sin(Z.anisotropyRotation)),Z.anisotropyMap&&(R.anisotropyMap.value=Z.anisotropyMap,t(Z.anisotropyMap,R.anisotropyMapTransform))),R.specularIntensity.value=Z.specularIntensity,R.specularColor.value.copy(Z.specularColor),Z.specularColorMap&&(R.specularColorMap.value=Z.specularColorMap,t(Z.specularColorMap,R.specularColorMapTransform)),Z.specularIntensityMap&&(R.specularIntensityMap.value=Z.specularIntensityMap,t(Z.specularIntensityMap,R.specularIntensityMapTransform))}function G(R,Z){Z.matcap&&(R.matcap.value=Z.matcap)}function w(R,Z){const x=e.get(Z).light;R.referencePosition.value.setFromMatrixPosition(x.matrixWorld),R.nearDistance.value=x.shadow.camera.near,R.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:a}}function wP(s,e,t,n){let a={},o={},l=[];const u=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS);function d(x,W){const N=W.program;n.uniformBlockBinding(x,N)}function C(x,W){let N=a[x.id];N===void 0&&(G(x),N=A(x),a[x.id]=N,x.addEventListener("dispose",R));const K=W.program;n.updateUBOMapping(x,K);const T=e.render.frame;o[x.id]!==T&&(m(x),o[x.id]=T)}function A(x){const W=p();x.__bindingPointIndex=W;const N=s.createBuffer(),K=x.__size,T=x.usage;return s.bindBuffer(s.UNIFORM_BUFFER,N),s.bufferData(s.UNIFORM_BUFFER,K,T),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,W,N),N}function p(){for(let x=0;x<u;x++)if(l.indexOf(x)===-1)return l.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(x){const W=a[x.id],N=x.uniforms,K=x.__cache;s.bindBuffer(s.UNIFORM_BUFFER,W);for(let T=0,L=N.length;T<L;T++){const k=Array.isArray(N[T])?N[T]:[N[T]];for(let E=0,F=k.length;E<F;E++){const U=k[E];if(y(U,T,E,K)===!0){const le=U.__offset,ie=Array.isArray(U.value)?U.value:[U.value];let Ce=0;for(let Ge=0;Ge<ie.length;Ge++){const ye=ie[Ge],pe=w(ye);typeof ye=="number"||typeof ye=="boolean"?(U.__data[0]=ye,s.bufferSubData(s.UNIFORM_BUFFER,le+Ce,U.__data)):ye.isMatrix3?(U.__data[0]=ye.elements[0],U.__data[1]=ye.elements[1],U.__data[2]=ye.elements[2],U.__data[3]=0,U.__data[4]=ye.elements[3],U.__data[5]=ye.elements[4],U.__data[6]=ye.elements[5],U.__data[7]=0,U.__data[8]=ye.elements[6],U.__data[9]=ye.elements[7],U.__data[10]=ye.elements[8],U.__data[11]=0):(ye.toArray(U.__data,Ce),Ce+=pe.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,le,U.__data)}}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function y(x,W,N,K){const T=x.value,L=W+"_"+N;if(K[L]===void 0)return typeof T=="number"||typeof T=="boolean"?K[L]=T:K[L]=T.clone(),!0;{const k=K[L];if(typeof T=="number"||typeof T=="boolean"){if(k!==T)return K[L]=T,!0}else if(k.equals(T)===!1)return k.copy(T),!0}return!1}function G(x){const W=x.uniforms;let N=0;const K=16;for(let L=0,k=W.length;L<k;L++){const E=Array.isArray(W[L])?W[L]:[W[L]];for(let F=0,U=E.length;F<U;F++){const le=E[F],ie=Array.isArray(le.value)?le.value:[le.value];for(let Ce=0,Ge=ie.length;Ce<Ge;Ce++){const ye=ie[Ce],pe=w(ye),de=N%K,Oe=de%pe.boundary,We=de+Oe;N+=Oe,We!==0&&K-We<pe.storage&&(N+=K-We),le.__data=new Float32Array(pe.storage/Float32Array.BYTES_PER_ELEMENT),le.__offset=N,N+=pe.storage}}}const T=N%K;return T>0&&(N+=K-T),x.__size=N,x.__cache={},this}function w(x){const W={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(W.boundary=4,W.storage=4):x.isVector2?(W.boundary=8,W.storage=8):x.isVector3||x.isColor?(W.boundary=16,W.storage=12):x.isVector4?(W.boundary=16,W.storage=16):x.isMatrix3?(W.boundary=48,W.storage=48):x.isMatrix4?(W.boundary=64,W.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),W}function R(x){const W=x.target;W.removeEventListener("dispose",R);const N=l.indexOf(W.__bindingPointIndex);l.splice(N,1),s.deleteBuffer(a[W.id]),delete a[W.id],delete o[W.id]}function Z(){for(const x in a)s.deleteBuffer(a[x]);l=[],a={},o={}}return{bind:d,update:C,dispose:Z}}class CK{constructor(e={}){const{canvas:t=$E(),context:n=null,depth:a=!0,stencil:o=!1,alpha:l=!1,antialias:u=!1,premultipliedAlpha:d=!0,preserveDrawingBuffer:C=!1,powerPreference:A="default",failIfMajorPerformanceCaveat:p=!1,reverseDepthBuffer:m=!1}=e;this.isWebGLRenderer=!0;let y;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=n.getContextAttributes().alpha}else y=l;const G=new Uint32Array(4),w=new Int32Array(4);let R=null,Z=null;const x=[],W=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Vs,this.toneMapping=eu,this.toneMappingExposure=1;const N=this;let K=!1,T=0,L=0,k=null,E=-1,F=null;const U=new Si,le=new Si;let ie=null;const Ce=new $t(0);let Ge=0,ye=t.width,pe=t.height,de=1,Oe=null,We=null;const ke=new Si(0,0,ye,pe),$e=new Si(0,0,ye,pe);let ot=!1;const Ne=new wG;let tt=!1,bt=!1;const dt=new Sn,yt=new Sn,zt=new q,Nt=new Si,Lt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ue=!1;function Pe(){return k===null?de:1}let te=n;function Gt(D,he){return t.getContext(D,he)}try{const D={alpha:!0,depth:a,stencil:o,antialias:u,premultipliedAlpha:d,preserveDrawingBuffer:C,powerPreference:A,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${yG}`),t.addEventListener("webglcontextlost",Be,!1),t.addEventListener("webglcontextrestored",Ft,!1),t.addEventListener("webglcontextcreationerror",wt,!1),te===null){const he="webgl2";if(te=Gt(he,D),te===null)throw Gt(he)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(D){throw console.error("THREE.WebGLRenderer: "+D.message),D}let Qe,ht,Ct,Tt,Rt,$,J,fe,ze,et,_e,At,Zt,Xt,An,j,ue,Ve,qe,Me,se,Re,De,Q;function st(){Qe=new HJ(te),Qe.init(),Re=new IK(te,Qe),ht=new wJ(te,Qe,e,Re),Ct=new CP(te,Qe),ht.reverseDepthBuffer&&m&&Ct.buffers.depth.setReversed(!0),Tt=new YJ(te),Rt=new tP,$=new bP(te,Qe,Ct,Rt,ht,Re,Tt),J=new WJ(N),fe=new NJ(N),ze=new DD(te),De=new SJ(te,ze),et=new XJ(te,ze,Tt,De),_e=new EJ(te,et,ze,Tt),qe=new TJ(te,ht,$),j=new xJ(Rt),At=new eP(N,J,fe,Qe,ht,De,j),Zt=new RP(N,Rt),Xt=new iP,An=new cP(Qe),Ve=new ZJ(N,J,fe,Ct,_e,y,d),ue=new IP(N,_e,ht),Q=new wP(te,Tt,ht,Ct),Me=new RJ(te,Qe,Tt),se=new FJ(te,Qe,Tt),Tt.programs=At.programs,N.capabilities=ht,N.extensions=Qe,N.properties=Rt,N.renderLists=Xt,N.shadowMap=ue,N.state=Ct,N.info=Tt}st();const be=new ZP(N,te);this.xr=be,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){const D=Qe.get("WEBGL_lose_context");D&&D.loseContext()},this.forceContextRestore=function(){const D=Qe.get("WEBGL_lose_context");D&&D.restoreContext()},this.getPixelRatio=function(){return de},this.setPixelRatio=function(D){D!==void 0&&(de=D,this.setSize(ye,pe,!1))},this.getSize=function(D){return D.set(ye,pe)},this.setSize=function(D,he,Ze=!0){if(be.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ye=D,pe=he,t.width=Math.floor(D*de),t.height=Math.floor(he*de),Ze===!0&&(t.style.width=D+"px",t.style.height=he+"px"),this.setViewport(0,0,D,he)},this.getDrawingBufferSize=function(D){return D.set(ye*de,pe*de).floor()},this.setDrawingBufferSize=function(D,he,Ze){ye=D,pe=he,de=Ze,t.width=Math.floor(D*Ze),t.height=Math.floor(he*Ze),this.setViewport(0,0,D,he)},this.getCurrentViewport=function(D){return D.copy(U)},this.getViewport=function(D){return D.copy(ke)},this.setViewport=function(D,he,Ze,Se){D.isVector4?ke.set(D.x,D.y,D.z,D.w):ke.set(D,he,Ze,Se),Ct.viewport(U.copy(ke).multiplyScalar(de).round())},this.getScissor=function(D){return D.copy($e)},this.setScissor=function(D,he,Ze,Se){D.isVector4?$e.set(D.x,D.y,D.z,D.w):$e.set(D,he,Ze,Se),Ct.scissor(le.copy($e).multiplyScalar(de).round())},this.getScissorTest=function(){return ot},this.setScissorTest=function(D){Ct.setScissorTest(ot=D)},this.setOpaqueSort=function(D){Oe=D},this.setTransparentSort=function(D){We=D},this.getClearColor=function(D){return D.copy(Ve.getClearColor())},this.setClearColor=function(){Ve.setClearColor.apply(Ve,arguments)},this.getClearAlpha=function(){return Ve.getClearAlpha()},this.setClearAlpha=function(){Ve.setClearAlpha.apply(Ve,arguments)},this.clear=function(D=!0,he=!0,Ze=!0){let Se=0;if(D){let Ae=!1;if(k!==null){const mt=k.texture.format;Ae=mt===Rw||mt===Sw||mt===BG}if(Ae){const mt=k.texture.type,Wt=mt===Lc||mt===VI||mt===ob||mt===DA||mt===Gw||mt===Bw,Dt=Ve.getClearColor(),Ot=Ve.getClearAlpha(),Yt=Dt.r,Rn=Dt.g,sn=Dt.b;Wt?(G[0]=Yt,G[1]=Rn,G[2]=sn,G[3]=Ot,te.clearBufferuiv(te.COLOR,0,G)):(w[0]=Yt,w[1]=Rn,w[2]=sn,w[3]=Ot,te.clearBufferiv(te.COLOR,0,w))}else Se|=te.COLOR_BUFFER_BIT}he&&(Se|=te.DEPTH_BUFFER_BIT),Ze&&(Se|=te.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),te.clear(Se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Be,!1),t.removeEventListener("webglcontextrestored",Ft,!1),t.removeEventListener("webglcontextcreationerror",wt,!1),Xt.dispose(),An.dispose(),Rt.dispose(),J.dispose(),fe.dispose(),_e.dispose(),De.dispose(),Q.dispose(),At.dispose(),be.dispose(),be.removeEventListener("sessionstart",aa),be.removeEventListener("sessionend",Ui),pa.stop()};function Be(D){D.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),K=!0}function Ft(){console.log("THREE.WebGLRenderer: Context Restored."),K=!1;const D=Tt.autoReset,he=ue.enabled,Ze=ue.autoUpdate,Se=ue.needsUpdate,Ae=ue.type;st(),Tt.autoReset=D,ue.enabled=he,ue.autoUpdate=Ze,ue.needsUpdate=Se,ue.type=Ae}function wt(D){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",D.statusMessage)}function ln(D){const he=D.target;he.removeEventListener("dispose",ln),Yn(he)}function Yn(D){un(D),Rt.remove(D)}function un(D){const he=Rt.get(D).programs;he!==void 0&&(he.forEach(function(Ze){At.releaseProgram(Ze)}),D.isShaderMaterial&&At.releaseShaderCache(D))}this.renderBufferDirect=function(D,he,Ze,Se,Ae,mt){he===null&&(he=Lt);const Wt=Ae.isMesh&&Ae.matrixWorld.determinant()<0,Dt=kt(D,he,Ze,Se,Ae);Ct.setMaterial(Se,Wt);let Ot=Ze.index,Yt=1;if(Se.wireframe===!0){if(Ot=et.getWireframeAttribute(Ze),Ot===void 0)return;Yt=2}const Rn=Ze.drawRange,sn=Ze.attributes.position;let On=Rn.start*Yt,Ii=(Rn.start+Rn.count)*Yt;mt!==null&&(On=Math.max(On,mt.start*Yt),Ii=Math.min(Ii,(mt.start+mt.count)*Yt)),Ot!==null?(On=Math.max(On,0),Ii=Math.min(Ii,Ot.count)):sn!=null&&(On=Math.max(On,0),Ii=Math.min(Ii,sn.count));const vi=Ii-On;if(vi<0||vi===1/0)return;De.setup(Ae,Se,Dt,Ze,Ot);let Va,ti=Me;if(Ot!==null&&(Va=ze.get(Ot),ti=se,ti.setIndex(Va)),Ae.isMesh)Se.wireframe===!0?(Ct.setLineWidth(Se.wireframeLinewidth*Pe()),ti.setMode(te.LINES)):ti.setMode(te.TRIANGLES);else if(Ae.isLine){let In=Se.linewidth;In===void 0&&(In=1),Ct.setLineWidth(In*Pe()),Ae.isLineSegments?ti.setMode(te.LINES):Ae.isLineLoop?ti.setMode(te.LINE_LOOP):ti.setMode(te.LINE_STRIP)}else Ae.isPoints?ti.setMode(te.POINTS):Ae.isSprite&&ti.setMode(te.TRIANGLES);if(Ae.isBatchedMesh)if(Ae._multiDrawInstances!==null)ti.renderMultiDrawInstances(Ae._multiDrawStarts,Ae._multiDrawCounts,Ae._multiDrawCount,Ae._multiDrawInstances);else if(Qe.get("WEBGL_multi_draw"))ti.renderMultiDraw(Ae._multiDrawStarts,Ae._multiDrawCounts,Ae._multiDrawCount);else{const In=Ae._multiDrawStarts,Fi=Ae._multiDrawCounts,ni=Ae._multiDrawCount,Dr=Ot?ze.get(Ot).bytesPerElement:1,ls=Rt.get(Se).currentProgram.getUniforms();for(let ma=0;ma<ni;ma++)ls.setValue(te,"_gl_DrawID",ma),ti.render(In[ma]/Dr,Fi[ma])}else if(Ae.isInstancedMesh)ti.renderInstances(On,vi,Ae.count);else if(Ze.isInstancedBufferGeometry){const In=Ze._maxInstanceCount!==void 0?Ze._maxInstanceCount:1/0,Fi=Math.min(Ze.instanceCount,In);ti.renderInstances(On,vi,Fi)}else ti.render(On,vi)};function bn(D,he,Ze){D.transparent===!0&&D.side===Kl&&D.forceSinglePass===!1?(D.side=ss,D.needsUpdate=!0,Te(D,he,Ze),D.side=iu,D.needsUpdate=!0,Te(D,he,Ze),D.side=Kl):Te(D,he,Ze)}this.compile=function(D,he,Ze=null){Ze===null&&(Ze=D),Z=An.get(Ze),Z.init(he),W.push(Z),Ze.traverseVisible(function(Ae){Ae.isLight&&Ae.layers.test(he.layers)&&(Z.pushLight(Ae),Ae.castShadow&&Z.pushShadow(Ae))}),D!==Ze&&D.traverseVisible(function(Ae){Ae.isLight&&Ae.layers.test(he.layers)&&(Z.pushLight(Ae),Ae.castShadow&&Z.pushShadow(Ae))}),Z.setupLights();const Se=new Set;return D.traverse(function(Ae){if(!(Ae.isMesh||Ae.isPoints||Ae.isLine||Ae.isSprite))return;const mt=Ae.material;if(mt)if(Array.isArray(mt))for(let Wt=0;Wt<mt.length;Wt++){const Dt=mt[Wt];bn(Dt,Ze,Ae),Se.add(Dt)}else bn(mt,Ze,Ae),Se.add(mt)}),W.pop(),Z=null,Se},this.compileAsync=function(D,he,Ze=null){const Se=this.compile(D,he,Ze);return new Promise(Ae=>{function mt(){if(Se.forEach(function(Wt){Rt.get(Wt).currentProgram.isReady()&&Se.delete(Wt)}),Se.size===0){Ae(D);return}setTimeout(mt,10)}Qe.get("KHR_parallel_shader_compile")!==null?mt():setTimeout(mt,10)})};let ui=null;function bi(D){ui&&ui(D)}function aa(){pa.stop()}function Ui(){pa.start()}const pa=new sK;pa.setAnimationLoop(bi),typeof self<"u"&&pa.setContext(self),this.setAnimationLoop=function(D){ui=D,be.setAnimationLoop(D),D===null?pa.stop():pa.start()},be.addEventListener("sessionstart",aa),be.addEventListener("sessionend",Ui),this.render=function(D,he){if(he!==void 0&&he.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(K===!0)return;if(D.matrixWorldAutoUpdate===!0&&D.updateMatrixWorld(),he.parent===null&&he.matrixWorldAutoUpdate===!0&&he.updateMatrixWorld(),be.enabled===!0&&be.isPresenting===!0&&(be.cameraAutoUpdate===!0&&be.updateCamera(he),he=be.getCamera()),D.isScene===!0&&D.onBeforeRender(N,D,he,k),Z=An.get(D,W.length),Z.init(he),W.push(Z),yt.multiplyMatrices(he.projectionMatrix,he.matrixWorldInverse),Ne.setFromProjectionMatrix(yt),bt=this.localClippingEnabled,tt=j.init(this.clippingPlanes,bt),R=Xt.get(D,x.length),R.init(),x.push(R),be.enabled===!0&&be.isPresenting===!0){const mt=N.xr.getDepthSensingMesh();mt!==null&&ua(mt,he,-1/0,N.sortObjects)}ua(D,he,0,N.sortObjects),R.finish(),N.sortObjects===!0&&R.sort(Oe,We),Ue=be.enabled===!1||be.isPresenting===!1||be.hasDepthSensing()===!1,Ue&&Ve.addToRenderList(R,D),this.info.render.frame++,tt===!0&&j.beginShadows();const Ze=Z.state.shadowsArray;ue.render(Ze,D,he),tt===!0&&j.endShadows(),this.info.autoReset===!0&&this.info.reset();const Se=R.opaque,Ae=R.transmissive;if(Z.setupLights(),he.isArrayCamera){const mt=he.cameras;if(Ae.length>0)for(let Wt=0,Dt=mt.length;Wt<Dt;Wt++){const Ot=mt[Wt];pt(Se,Ae,D,Ot)}Ue&&Ve.render(D);for(let Wt=0,Dt=mt.length;Wt<Dt;Wt++){const Ot=mt[Wt];ce(R,D,Ot,Ot.viewport)}}else Ae.length>0&&pt(Se,Ae,D,he),Ue&&Ve.render(D),ce(R,D,he);k!==null&&($.updateMultisampleRenderTarget(k),$.updateRenderTargetMipmap(k)),D.isScene===!0&&D.onAfterRender(N,D,he),De.resetDefaultState(),E=-1,F=null,W.pop(),W.length>0?(Z=W[W.length-1],tt===!0&&j.setGlobalState(N.clippingPlanes,Z.state.camera)):Z=null,x.pop(),x.length>0?R=x[x.length-1]:R=null};function ua(D,he,Ze,Se){if(D.visible===!1)return;if(D.layers.test(he.layers)){if(D.isGroup)Ze=D.renderOrder;else if(D.isLOD)D.autoUpdate===!0&&D.update(he);else if(D.isLight)Z.pushLight(D),D.castShadow&&Z.pushShadow(D);else if(D.isSprite){if(!D.frustumCulled||Ne.intersectsSprite(D)){Se&&Nt.setFromMatrixPosition(D.matrixWorld).applyMatrix4(yt);const Wt=_e.update(D),Dt=D.material;Dt.visible&&R.push(D,Wt,Dt,Ze,Nt.z,null)}}else if((D.isMesh||D.isLine||D.isPoints)&&(!D.frustumCulled||Ne.intersectsObject(D))){const Wt=_e.update(D),Dt=D.material;if(Se&&(D.boundingSphere!==void 0?(D.boundingSphere===null&&D.computeBoundingSphere(),Nt.copy(D.boundingSphere.center)):(Wt.boundingSphere===null&&Wt.computeBoundingSphere(),Nt.copy(Wt.boundingSphere.center)),Nt.applyMatrix4(D.matrixWorld).applyMatrix4(yt)),Array.isArray(Dt)){const Ot=Wt.groups;for(let Yt=0,Rn=Ot.length;Yt<Rn;Yt++){const sn=Ot[Yt],On=Dt[sn.materialIndex];On&&On.visible&&R.push(D,Wt,On,Ze,Nt.z,sn)}}else Dt.visible&&R.push(D,Wt,Dt,Ze,Nt.z,null)}}const mt=D.children;for(let Wt=0,Dt=mt.length;Wt<Dt;Wt++)ua(mt[Wt],he,Ze,Se)}function ce(D,he,Ze,Se){const Ae=D.opaque,mt=D.transmissive,Wt=D.transparent;Z.setupLightsView(Ze),tt===!0&&j.setGlobalState(N.clippingPlanes,Ze),Se&&Ct.viewport(U.copy(Se)),Ae.length>0&&Kt(Ae,he,Ze),mt.length>0&&Kt(mt,he,Ze),Wt.length>0&&Kt(Wt,he,Ze),Ct.buffers.depth.setTest(!0),Ct.buffers.depth.setMask(!0),Ct.buffers.color.setMask(!0),Ct.setPolygonOffset(!1)}function pt(D,he,Ze,Se){if((Ze.isScene===!0?Ze.overrideMaterial:null)!==null)return;Z.state.transmissionRenderTarget[Se.id]===void 0&&(Z.state.transmissionRenderTarget[Se.id]=new zc(1,1,{generateMipmaps:!0,type:Qe.has("EXT_color_buffer_half_float")||Qe.has("EXT_color_buffer_float")?hb:Lc,minFilter:Ll,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:mi.workingColorSpace}));const mt=Z.state.transmissionRenderTarget[Se.id],Wt=Se.viewport||U;mt.setSize(Wt.z,Wt.w);const Dt=N.getRenderTarget();N.setRenderTarget(mt),N.getClearColor(Ce),Ge=N.getClearAlpha(),Ge<1&&N.setClearColor(16777215,.5),N.clear(),Ue&&Ve.render(Ze);const Ot=N.toneMapping;N.toneMapping=eu;const Yt=Se.viewport;if(Se.viewport!==void 0&&(Se.viewport=void 0),Z.setupLightsView(Se),tt===!0&&j.setGlobalState(N.clippingPlanes,Se),Kt(D,Ze,Se),$.updateMultisampleRenderTarget(mt),$.updateRenderTargetMipmap(mt),Qe.has("WEBGL_multisampled_render_to_texture")===!1){let Rn=!1;for(let sn=0,On=he.length;sn<On;sn++){const Ii=he[sn],vi=Ii.object,Va=Ii.geometry,ti=Ii.material,In=Ii.group;if(ti.side===Kl&&vi.layers.test(Se.layers)){const Fi=ti.side;ti.side=ss,ti.needsUpdate=!0,ne(vi,Ze,Se,Va,ti,In),ti.side=Fi,ti.needsUpdate=!0,Rn=!0}}Rn===!0&&($.updateMultisampleRenderTarget(mt),$.updateRenderTargetMipmap(mt))}N.setRenderTarget(Dt),N.setClearColor(Ce,Ge),Yt!==void 0&&(Se.viewport=Yt),N.toneMapping=Ot}function Kt(D,he,Ze){const Se=he.isScene===!0?he.overrideMaterial:null;for(let Ae=0,mt=D.length;Ae<mt;Ae++){const Wt=D[Ae],Dt=Wt.object,Ot=Wt.geometry,Yt=Se===null?Wt.material:Se,Rn=Wt.group;Dt.layers.test(Ze.layers)&&ne(Dt,he,Ze,Ot,Yt,Rn)}}function ne(D,he,Ze,Se,Ae,mt){D.onBeforeRender(N,he,Ze,Se,Ae,mt),D.modelViewMatrix.multiplyMatrices(Ze.matrixWorldInverse,D.matrixWorld),D.normalMatrix.getNormalMatrix(D.modelViewMatrix),Ae.onBeforeRender(N,he,Ze,Se,D,mt),Ae.transparent===!0&&Ae.side===Kl&&Ae.forceSinglePass===!1?(Ae.side=ss,Ae.needsUpdate=!0,N.renderBufferDirect(Ze,he,Se,Ae,D,mt),Ae.side=iu,Ae.needsUpdate=!0,N.renderBufferDirect(Ze,he,Se,Ae,D,mt),Ae.side=Kl):N.renderBufferDirect(Ze,he,Se,Ae,D,mt),D.onAfterRender(N,he,Ze,Se,Ae,mt)}function Te(D,he,Ze){he.isScene!==!0&&(he=Lt);const Se=Rt.get(D),Ae=Z.state.lights,mt=Z.state.shadowsArray,Wt=Ae.state.version,Dt=At.getParameters(D,Ae.state,mt,he,Ze),Ot=At.getProgramCacheKey(Dt);let Yt=Se.programs;Se.environment=D.isMeshStandardMaterial?he.environment:null,Se.fog=he.fog,Se.envMap=(D.isMeshStandardMaterial?fe:J).get(D.envMap||Se.environment),Se.envMapRotation=Se.environment!==null&&D.envMap===null?he.environmentRotation:D.envMapRotation,Yt===void 0&&(D.addEventListener("dispose",ln),Yt=new Map,Se.programs=Yt);let Rn=Yt.get(Ot);if(Rn!==void 0){if(Se.currentProgram===Rn&&Se.lightsStateVersion===Wt)return Vt(D,Dt),Rn}else Dt.uniforms=At.getUniforms(D),D.onBeforeCompile(Dt,N),Rn=At.acquireProgram(Dt,Ot),Yt.set(Ot,Rn),Se.uniforms=Dt.uniforms;const sn=Se.uniforms;return(!D.isShaderMaterial&&!D.isRawShaderMaterial||D.clipping===!0)&&(sn.clippingPlanes=j.uniform),Vt(D,Dt),Se.needsLights=Ut(D),Se.lightsStateVersion=Wt,Se.needsLights&&(sn.ambientLightColor.value=Ae.state.ambient,sn.lightProbe.value=Ae.state.probe,sn.directionalLights.value=Ae.state.directional,sn.directionalLightShadows.value=Ae.state.directionalShadow,sn.spotLights.value=Ae.state.spot,sn.spotLightShadows.value=Ae.state.spotShadow,sn.rectAreaLights.value=Ae.state.rectArea,sn.ltc_1.value=Ae.state.rectAreaLTC1,sn.ltc_2.value=Ae.state.rectAreaLTC2,sn.pointLights.value=Ae.state.point,sn.pointLightShadows.value=Ae.state.pointShadow,sn.hemisphereLights.value=Ae.state.hemi,sn.directionalShadowMap.value=Ae.state.directionalShadowMap,sn.directionalShadowMatrix.value=Ae.state.directionalShadowMatrix,sn.spotShadowMap.value=Ae.state.spotShadowMap,sn.spotLightMatrix.value=Ae.state.spotLightMatrix,sn.spotLightMap.value=Ae.state.spotLightMap,sn.pointShadowMap.value=Ae.state.pointShadowMap,sn.pointShadowMatrix.value=Ae.state.pointShadowMatrix),Se.currentProgram=Rn,Se.uniformsList=null,Rn}function nt(D){if(D.uniformsList===null){const he=D.currentProgram.getUniforms();D.uniformsList=vR.seqWithValue(he.seq,D.uniforms)}return D.uniformsList}function Vt(D,he){const Ze=Rt.get(D);Ze.outputColorSpace=he.outputColorSpace,Ze.batching=he.batching,Ze.batchingColor=he.batchingColor,Ze.instancing=he.instancing,Ze.instancingColor=he.instancingColor,Ze.instancingMorph=he.instancingMorph,Ze.skinning=he.skinning,Ze.morphTargets=he.morphTargets,Ze.morphNormals=he.morphNormals,Ze.morphColors=he.morphColors,Ze.morphTargetsCount=he.morphTargetsCount,Ze.numClippingPlanes=he.numClippingPlanes,Ze.numIntersection=he.numClipIntersection,Ze.vertexAlphas=he.vertexAlphas,Ze.vertexTangents=he.vertexTangents,Ze.toneMapping=he.toneMapping}function kt(D,he,Ze,Se,Ae){he.isScene!==!0&&(he=Lt),$.resetTextureUnits();const mt=he.fog,Wt=Se.isMeshStandardMaterial?he.environment:null,Dt=k===null?N.outputColorSpace:k.isXRRenderTarget===!0?k.texture.colorSpace:jA,Ot=(Se.isMeshStandardMaterial?fe:J).get(Se.envMap||Wt),Yt=Se.vertexColors===!0&&!!Ze.attributes.color&&Ze.attributes.color.itemSize===4,Rn=!!Ze.attributes.tangent&&(!!Se.normalMap||Se.anisotropy>0),sn=!!Ze.morphAttributes.position,On=!!Ze.morphAttributes.normal,Ii=!!Ze.morphAttributes.color;let vi=eu;Se.toneMapped&&(k===null||k.isXRRenderTarget===!0)&&(vi=N.toneMapping);const Va=Ze.morphAttributes.position||Ze.morphAttributes.normal||Ze.morphAttributes.color,ti=Va!==void 0?Va.length:0,In=Rt.get(Se),Fi=Z.state.lights;if(tt===!0&&(bt===!0||D!==F)){const za=D===F&&Se.id===E;j.setState(Se,D,za)}let ni=!1;Se.version===In.__version?(In.needsLights&&In.lightsStateVersion!==Fi.state.version||In.outputColorSpace!==Dt||Ae.isBatchedMesh&&In.batching===!1||!Ae.isBatchedMesh&&In.batching===!0||Ae.isBatchedMesh&&In.batchingColor===!0&&Ae.colorTexture===null||Ae.isBatchedMesh&&In.batchingColor===!1&&Ae.colorTexture!==null||Ae.isInstancedMesh&&In.instancing===!1||!Ae.isInstancedMesh&&In.instancing===!0||Ae.isSkinnedMesh&&In.skinning===!1||!Ae.isSkinnedMesh&&In.skinning===!0||Ae.isInstancedMesh&&In.instancingColor===!0&&Ae.instanceColor===null||Ae.isInstancedMesh&&In.instancingColor===!1&&Ae.instanceColor!==null||Ae.isInstancedMesh&&In.instancingMorph===!0&&Ae.morphTexture===null||Ae.isInstancedMesh&&In.instancingMorph===!1&&Ae.morphTexture!==null||In.envMap!==Ot||Se.fog===!0&&In.fog!==mt||In.numClippingPlanes!==void 0&&(In.numClippingPlanes!==j.numPlanes||In.numIntersection!==j.numIntersection)||In.vertexAlphas!==Yt||In.vertexTangents!==Rn||In.morphTargets!==sn||In.morphNormals!==On||In.morphColors!==Ii||In.toneMapping!==vi||In.morphTargetsCount!==ti)&&(ni=!0):(ni=!0,In.__version=Se.version);let Dr=In.currentProgram;ni===!0&&(Dr=Te(Se,he,Ae));let ls=!1,ma=!1,nr=!1;const di=Dr.getUniforms(),ba=In.uniforms;if(Ct.useProgram(Dr.program)&&(ls=!0,ma=!0,nr=!0),Se.id!==E&&(E=Se.id,ma=!0),ls||F!==D){Ct.buffers.depth.getReversed()?(dt.copy(D.projectionMatrix),hD(dt),AD(dt),di.setValue(te,"projectionMatrix",dt)):di.setValue(te,"projectionMatrix",D.projectionMatrix),di.setValue(te,"viewMatrix",D.matrixWorldInverse);const kr=di.map.cameraPosition;kr!==void 0&&kr.setValue(te,zt.setFromMatrixPosition(D.matrixWorld)),ht.logarithmicDepthBuffer&&di.setValue(te,"logDepthBufFC",2/(Math.log(D.far+1)/Math.LN2)),(Se.isMeshPhongMaterial||Se.isMeshToonMaterial||Se.isMeshLambertMaterial||Se.isMeshBasicMaterial||Se.isMeshStandardMaterial||Se.isShaderMaterial)&&di.setValue(te,"isOrthographic",D.isOrthographicCamera===!0),F!==D&&(F=D,ma=!0,nr=!0)}if(Ae.isSkinnedMesh){di.setOptional(te,Ae,"bindMatrix"),di.setOptional(te,Ae,"bindMatrixInverse");const za=Ae.skeleton;za&&(za.boneTexture===null&&za.computeBoneTexture(),di.setValue(te,"boneTexture",za.boneTexture,$))}Ae.isBatchedMesh&&(di.setOptional(te,Ae,"batchingTexture"),di.setValue(te,"batchingTexture",Ae._matricesTexture,$),di.setOptional(te,Ae,"batchingIdTexture"),di.setValue(te,"batchingIdTexture",Ae._indirectTexture,$),di.setOptional(te,Ae,"batchingColorTexture"),Ae._colorsTexture!==null&&di.setValue(te,"batchingColorTexture",Ae._colorsTexture,$));const Lo=Ze.morphAttributes;if((Lo.position!==void 0||Lo.normal!==void 0||Lo.color!==void 0)&&qe.update(Ae,Ze,Dr),(ma||In.receiveShadow!==Ae.receiveShadow)&&(In.receiveShadow=Ae.receiveShadow,di.setValue(te,"receiveShadow",Ae.receiveShadow)),Se.isMeshGouraudMaterial&&Se.envMap!==null&&(ba.envMap.value=Ot,ba.flipEnvMap.value=Ot.isCubeTexture&&Ot.isRenderTargetTexture===!1?-1:1),Se.isMeshStandardMaterial&&Se.envMap===null&&he.environment!==null&&(ba.envMapIntensity.value=he.environmentIntensity),ma&&(di.setValue(te,"toneMappingExposure",N.toneMappingExposure),In.needsLights&&dn(ba,nr),mt&&Se.fog===!0&&Zt.refreshFogUniforms(ba,mt),Zt.refreshMaterialUniforms(ba,Se,de,pe,Z.state.transmissionRenderTarget[D.id]),vR.upload(te,nt(In),ba,$)),Se.isShaderMaterial&&Se.uniformsNeedUpdate===!0&&(vR.upload(te,nt(In),ba,$),Se.uniformsNeedUpdate=!1),Se.isSpriteMaterial&&di.setValue(te,"center",Ae.center),di.setValue(te,"modelViewMatrix",Ae.modelViewMatrix),di.setValue(te,"normalMatrix",Ae.normalMatrix),di.setValue(te,"modelMatrix",Ae.matrixWorld),Se.isShaderMaterial||Se.isRawShaderMaterial){const za=Se.uniformsGroups;for(let kr=0,Ur=za.length;kr<Ur;kr++){const ru=za[kr];Q.update(ru,Dr),Q.bind(ru,Dr)}}return Dr}function dn(D,he){D.ambientLightColor.needsUpdate=he,D.lightProbe.needsUpdate=he,D.directionalLights.needsUpdate=he,D.directionalLightShadows.needsUpdate=he,D.pointLights.needsUpdate=he,D.pointLightShadows.needsUpdate=he,D.spotLights.needsUpdate=he,D.spotLightShadows.needsUpdate=he,D.rectAreaLights.needsUpdate=he,D.hemisphereLights.needsUpdate=he}function Ut(D){return D.isMeshLambertMaterial||D.isMeshToonMaterial||D.isMeshPhongMaterial||D.isMeshStandardMaterial||D.isShadowMaterial||D.isShaderMaterial&&D.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return L},this.getRenderTarget=function(){return k},this.setRenderTargetTextures=function(D,he,Ze){Rt.get(D.texture).__webglTexture=he,Rt.get(D.depthTexture).__webglTexture=Ze;const Se=Rt.get(D);Se.__hasExternalTextures=!0,Se.__autoAllocateDepthBuffer=Ze===void 0,Se.__autoAllocateDepthBuffer||Qe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Se.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(D,he){const Ze=Rt.get(D);Ze.__webglFramebuffer=he,Ze.__useDefaultFramebuffer=he===void 0},this.setRenderTarget=function(D,he=0,Ze=0){k=D,T=he,L=Ze;let Se=!0,Ae=null,mt=!1,Wt=!1;if(D){const Ot=Rt.get(D);if(Ot.__useDefaultFramebuffer!==void 0)Ct.bindFramebuffer(te.FRAMEBUFFER,null),Se=!1;else if(Ot.__webglFramebuffer===void 0)$.setupRenderTarget(D);else if(Ot.__hasExternalTextures)$.rebindTextures(D,Rt.get(D.texture).__webglTexture,Rt.get(D.depthTexture).__webglTexture);else if(D.depthBuffer){const sn=D.depthTexture;if(Ot.__boundDepthTexture!==sn){if(sn!==null&&Rt.has(sn)&&(D.width!==sn.image.width||D.height!==sn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");$.setupDepthRenderbuffer(D)}}const Yt=D.texture;(Yt.isData3DTexture||Yt.isDataArrayTexture||Yt.isCompressedArrayTexture)&&(Wt=!0);const Rn=Rt.get(D).__webglFramebuffer;D.isWebGLCubeRenderTarget?(Array.isArray(Rn[he])?Ae=Rn[he][Ze]:Ae=Rn[he],mt=!0):D.samples>0&&$.useMultisampledRTT(D)===!1?Ae=Rt.get(D).__webglMultisampledFramebuffer:Array.isArray(Rn)?Ae=Rn[Ze]:Ae=Rn,U.copy(D.viewport),le.copy(D.scissor),ie=D.scissorTest}else U.copy(ke).multiplyScalar(de).floor(),le.copy($e).multiplyScalar(de).floor(),ie=ot;if(Ct.bindFramebuffer(te.FRAMEBUFFER,Ae)&&Se&&Ct.drawBuffers(D,Ae),Ct.viewport(U),Ct.scissor(le),Ct.setScissorTest(ie),mt){const Ot=Rt.get(D.texture);te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ot.__webglTexture,Ze)}else if(Wt){const Ot=Rt.get(D.texture),Yt=he||0;te.framebufferTextureLayer(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,Ot.__webglTexture,Ze||0,Yt)}E=-1},this.readRenderTargetPixels=function(D,he,Ze,Se,Ae,mt,Wt){if(!(D&&D.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Dt=Rt.get(D).__webglFramebuffer;if(D.isWebGLCubeRenderTarget&&Wt!==void 0&&(Dt=Dt[Wt]),Dt){Ct.bindFramebuffer(te.FRAMEBUFFER,Dt);try{const Ot=D.texture,Yt=Ot.format,Rn=Ot.type;if(!ht.textureFormatReadable(Yt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!ht.textureTypeReadable(Rn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}he>=0&&he<=D.width-Se&&Ze>=0&&Ze<=D.height-Ae&&te.readPixels(he,Ze,Se,Ae,Re.convert(Yt),Re.convert(Rn),mt)}finally{const Ot=k!==null?Rt.get(k).__webglFramebuffer:null;Ct.bindFramebuffer(te.FRAMEBUFFER,Ot)}}},this.readRenderTargetPixelsAsync=async function(D,he,Ze,Se,Ae,mt,Wt){if(!(D&&D.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Dt=Rt.get(D).__webglFramebuffer;if(D.isWebGLCubeRenderTarget&&Wt!==void 0&&(Dt=Dt[Wt]),Dt){const Ot=D.texture,Yt=Ot.format,Rn=Ot.type;if(!ht.textureFormatReadable(Yt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!ht.textureTypeReadable(Rn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(he>=0&&he<=D.width-Se&&Ze>=0&&Ze<=D.height-Ae){Ct.bindFramebuffer(te.FRAMEBUFFER,Dt);const sn=te.createBuffer();te.bindBuffer(te.PIXEL_PACK_BUFFER,sn),te.bufferData(te.PIXEL_PACK_BUFFER,mt.byteLength,te.STREAM_READ),te.readPixels(he,Ze,Se,Ae,Re.convert(Yt),Re.convert(Rn),0);const On=k!==null?Rt.get(k).__webglFramebuffer:null;Ct.bindFramebuffer(te.FRAMEBUFFER,On);const Ii=te.fenceSync(te.SYNC_GPU_COMMANDS_COMPLETE,0);return te.flush(),await CD(te,Ii,4),te.bindBuffer(te.PIXEL_PACK_BUFFER,sn),te.getBufferSubData(te.PIXEL_PACK_BUFFER,0,mt),te.deleteBuffer(sn),te.deleteSync(Ii),mt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(D,he=null,Ze=0){D.isTexture!==!0&&(q0("WebGLRenderer: copyFramebufferToTexture function signature has changed."),he=arguments[0]||null,D=arguments[1]);const Se=Math.pow(2,-Ze),Ae=Math.floor(D.image.width*Se),mt=Math.floor(D.image.height*Se),Wt=he!==null?he.x:0,Dt=he!==null?he.y:0;$.setTexture2D(D,0),te.copyTexSubImage2D(te.TEXTURE_2D,Ze,0,0,Wt,Dt,Ae,mt),Ct.unbindTexture()},this.copyTextureToTexture=function(D,he,Ze=null,Se=null,Ae=0){D.isTexture!==!0&&(q0("WebGLRenderer: copyTextureToTexture function signature has changed."),Se=arguments[0]||null,D=arguments[1],he=arguments[2],Ae=arguments[3]||0,Ze=null);let mt,Wt,Dt,Ot,Yt,Rn,sn,On,Ii;const vi=D.isCompressedTexture?D.mipmaps[Ae]:D.image;Ze!==null?(mt=Ze.max.x-Ze.min.x,Wt=Ze.max.y-Ze.min.y,Dt=Ze.isBox3?Ze.max.z-Ze.min.z:1,Ot=Ze.min.x,Yt=Ze.min.y,Rn=Ze.isBox3?Ze.min.z:0):(mt=vi.width,Wt=vi.height,Dt=vi.depth||1,Ot=0,Yt=0,Rn=0),Se!==null?(sn=Se.x,On=Se.y,Ii=Se.z):(sn=0,On=0,Ii=0);const Va=Re.convert(he.format),ti=Re.convert(he.type);let In;he.isData3DTexture?($.setTexture3D(he,0),In=te.TEXTURE_3D):he.isDataArrayTexture||he.isCompressedArrayTexture?($.setTexture2DArray(he,0),In=te.TEXTURE_2D_ARRAY):($.setTexture2D(he,0),In=te.TEXTURE_2D),te.pixelStorei(te.UNPACK_FLIP_Y_WEBGL,he.flipY),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,he.premultiplyAlpha),te.pixelStorei(te.UNPACK_ALIGNMENT,he.unpackAlignment);const Fi=te.getParameter(te.UNPACK_ROW_LENGTH),ni=te.getParameter(te.UNPACK_IMAGE_HEIGHT),Dr=te.getParameter(te.UNPACK_SKIP_PIXELS),ls=te.getParameter(te.UNPACK_SKIP_ROWS),ma=te.getParameter(te.UNPACK_SKIP_IMAGES);te.pixelStorei(te.UNPACK_ROW_LENGTH,vi.width),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,vi.height),te.pixelStorei(te.UNPACK_SKIP_PIXELS,Ot),te.pixelStorei(te.UNPACK_SKIP_ROWS,Yt),te.pixelStorei(te.UNPACK_SKIP_IMAGES,Rn);const nr=D.isDataArrayTexture||D.isData3DTexture,di=he.isDataArrayTexture||he.isData3DTexture;if(D.isRenderTargetTexture||D.isDepthTexture){const ba=Rt.get(D),Lo=Rt.get(he),za=Rt.get(ba.__renderTarget),kr=Rt.get(Lo.__renderTarget);Ct.bindFramebuffer(te.READ_FRAMEBUFFER,za.__webglFramebuffer),Ct.bindFramebuffer(te.DRAW_FRAMEBUFFER,kr.__webglFramebuffer);for(let Ur=0;Ur<Dt;Ur++)nr&&te.framebufferTextureLayer(te.READ_FRAMEBUFFER,te.COLOR_ATTACHMENT0,Rt.get(D).__webglTexture,Ae,Rn+Ur),D.isDepthTexture?(di&&te.framebufferTextureLayer(te.DRAW_FRAMEBUFFER,te.COLOR_ATTACHMENT0,Rt.get(he).__webglTexture,Ae,Ii+Ur),te.blitFramebuffer(Ot,Yt,mt,Wt,sn,On,mt,Wt,te.DEPTH_BUFFER_BIT,te.NEAREST)):di?te.copyTexSubImage3D(In,Ae,sn,On,Ii+Ur,Ot,Yt,mt,Wt):te.copyTexSubImage2D(In,Ae,sn,On,Ii+Ur,Ot,Yt,mt,Wt);Ct.bindFramebuffer(te.READ_FRAMEBUFFER,null),Ct.bindFramebuffer(te.DRAW_FRAMEBUFFER,null)}else di?D.isDataTexture||D.isData3DTexture?te.texSubImage3D(In,Ae,sn,On,Ii,mt,Wt,Dt,Va,ti,vi.data):he.isCompressedArrayTexture?te.compressedTexSubImage3D(In,Ae,sn,On,Ii,mt,Wt,Dt,Va,vi.data):te.texSubImage3D(In,Ae,sn,On,Ii,mt,Wt,Dt,Va,ti,vi):D.isDataTexture?te.texSubImage2D(te.TEXTURE_2D,Ae,sn,On,mt,Wt,Va,ti,vi.data):D.isCompressedTexture?te.compressedTexSubImage2D(te.TEXTURE_2D,Ae,sn,On,vi.width,vi.height,Va,vi.data):te.texSubImage2D(te.TEXTURE_2D,Ae,sn,On,mt,Wt,Va,ti,vi);te.pixelStorei(te.UNPACK_ROW_LENGTH,Fi),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,ni),te.pixelStorei(te.UNPACK_SKIP_PIXELS,Dr),te.pixelStorei(te.UNPACK_SKIP_ROWS,ls),te.pixelStorei(te.UNPACK_SKIP_IMAGES,ma),Ae===0&&he.generateMipmaps&&te.generateMipmap(In),Ct.unbindTexture()},this.copyTextureToTexture3D=function(D,he,Ze=null,Se=null,Ae=0){return D.isTexture!==!0&&(q0("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Ze=arguments[0]||null,Se=arguments[1]||null,D=arguments[2],he=arguments[3],Ae=arguments[4]||0),q0('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(D,he,Ze,Se,Ae)},this.initRenderTarget=function(D){Rt.get(D).__webglFramebuffer===void 0&&$.setupRenderTarget(D)},this.initTexture=function(D){D.isCubeTexture?$.setTextureCube(D,0):D.isData3DTexture?$.setTexture3D(D,0):D.isDataArrayTexture||D.isCompressedArrayTexture?$.setTexture2DArray(D,0):$.setTexture2D(D,0),Ct.unbindTexture()},this.resetState=function(){T=0,L=0,k=null,Ct.reset(),De.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return $g}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=mi._getDrawingBufferColorSpace(e),t.unpackColorSpace=mi._getUnpackColorSpace()}}class Vw{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new $t(e),this.density=t}clone(){return new Vw(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Mw{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new $t(e),this.near=t,this.far=n}clone(){return new Mw(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class pH extends gi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Hs,this.environmentIntensity=1,this.environmentRotation=new Hs,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class xG{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=CG,this.updateRanges=[],this.version=0,this.uuid=hl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let a=0,o=this.stride;a<o;a++)this.array[e+a]=t.array[n+a];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=hl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=hl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ns=new q;class cC{constructor(e,t,n,a=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=a}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)ns.fromBufferAttribute(this,t),ns.applyMatrix4(e),this.setXYZ(t,ns.x,ns.y,ns.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ns.fromBufferAttribute(this,t),ns.applyNormalMatrix(e),this.setXYZ(t,ns.x,ns.y,ns.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ns.fromBufferAttribute(this,t),ns.transformDirection(e),this.setXYZ(t,ns.x,ns.y,ns.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=os(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Un(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=os(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=os(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=os(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=os(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=a,this}setXYZW(e,t,n,a,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array),o=Un(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=a,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const a=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[a+o])}return new Ri(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new cC(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const a=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[a+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class mH extends Zr{static get type(){return"SpriteMaterial"}constructor(e){super(),this.isSpriteMaterial=!0,this.color=new $t(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let zm;const Y0=new q,_m=new q,Dm=new q,km=new ut,T0=new ut,hK=new Sn,YS=new q,E0=new q,TS=new q,jF=new ut,wM=new ut,qF=new ut;class AK extends gi{constructor(e=new mH){if(super(),this.isSprite=!0,this.type="Sprite",zm===void 0){zm=new Ln;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new xG(t,5);zm.setIndex([0,1,2,0,2,3]),zm.setAttribute("position",new cC(n,3,0,!1)),zm.setAttribute("uv",new cC(n,2,3,!1))}this.geometry=zm,this.material=e,this.center=new ut(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_m.setFromMatrixScale(this.matrixWorld),hK.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Dm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_m.multiplyScalar(-Dm.z);const n=this.material.rotation;let a,o;n!==0&&(o=Math.cos(n),a=Math.sin(n));const l=this.center;ES(YS.set(-.5,-.5,0),Dm,l,_m,a,o),ES(E0.set(.5,-.5,0),Dm,l,_m,a,o),ES(TS.set(.5,.5,0),Dm,l,_m,a,o),jF.set(0,0),wM.set(1,0),qF.set(1,1);let u=e.ray.intersectTriangle(YS,E0,TS,!1,Y0);if(u===null&&(ES(E0.set(-.5,.5,0),Dm,l,_m,a,o),wM.set(0,1),u=e.ray.intersectTriangle(YS,TS,E0,!1,Y0),u===null))return;const d=e.ray.origin.distanceTo(Y0);d<e.near||d>e.far||t.push({distance:d,point:Y0.clone(),uv:Ms.getInterpolation(Y0,YS,E0,TS,jF,wM,qF,new ut),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function ES(s,e,t,n,a,o){km.subVectors(s,t).addScalar(.5).multiply(n),a!==void 0?(T0.x=o*km.x-a*km.y,T0.y=a*km.x+o*km.y):T0.copy(km),s.copy(e),s.x+=T0.x,s.y+=T0.y,s.applyMatrix4(hK)}const KS=new q,$F=new q;class fK extends gi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,a=t.length;n<a;n++){const o=t[n];this.addLevel(o.object.clone(),o.distance,o.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const a=this.levels;let o;for(o=0;o<a.length&&!(t<a[o].distance);o++);return a.splice(o,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const a=t.splice(n,1);return this.remove(a[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,a;for(n=1,a=t.length;n<a;n++){let o=t[n].distance;if(t[n].object.visible&&(o-=o*t[n].hysteresis),e<o)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){KS.setFromMatrixPosition(this.matrixWorld);const a=e.ray.origin.distanceTo(KS);this.getObjectForDistance(a).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){KS.setFromMatrixPosition(e.matrixWorld),$F.setFromMatrixPosition(this.matrixWorld);const n=KS.distanceTo($F)/e.zoom;t[0].object.visible=!0;let a,o;for(a=1,o=t.length;a<o;a++){let l=t[a].distance;if(t[a].object.visible&&(l-=l*t[a].hysteresis),n>=l)t[a-1].object.visible=!1,t[a].object.visible=!0;else break}for(this._currentLevel=a-1;a<o;a++)t[a].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let a=0,o=n.length;a<o;a++){const l=n[a];t.object.levels.push({object:l.object.uuid,distance:l.distance,hysteresis:l.hysteresis})}return t}}const eY=new q,tY=new Si,nY=new Si,xP=new q,iY=new Sn,LS=new q,xM=new Ao,aY=new Sn,WM=new qA;class bH extends tr{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=mN,this.bindMatrix=new Sn,this.bindMatrixInverse=new Sn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ho),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,LS),this.boundingBox.expandByPoint(LS)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ao),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,LS),this.boundingSphere.expandByPoint(LS)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,a=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),xM.copy(this.boundingSphere),xM.applyMatrix4(a),e.ray.intersectsSphere(xM)!==!1&&(aY.copy(a).invert(),WM.copy(e.ray).applyMatrix4(aY),!(this.boundingBox!==null&&WM.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,WM)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Si,t=this.geometry.attributes.skinWeight;for(let n=0,a=t.count;n<a;n++){e.fromBufferAttribute(t,n);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===mN?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===FE?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,a=this.geometry;tY.fromBufferAttribute(a.attributes.skinIndex,e),nY.fromBufferAttribute(a.attributes.skinWeight,e),eY.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const l=nY.getComponent(o);if(l!==0){const u=tY.getComponent(o);iY.multiplyMatrices(n.bones[u].matrixWorld,n.boneInverses[u]),t.addScaledVector(xP.copy(eY).applyMatrix4(iY),l)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Nw extends gi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class tu extends fa{constructor(e=null,t=1,n=1,a,o,l,u,d,C=_r,A=_r,p,m){super(null,l,u,d,C,A,a,o,p,m),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const rY=new Sn,WP=new Sn;class WG{constructor(e=[],t=[]){this.uuid=hl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,a=this.bones.length;n<a;n++)this.boneInverses.push(new Sn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Sn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,a=this.boneTexture;for(let o=0,l=e.length;o<l;o++){const u=e[o]?e[o].matrixWorld:WP;rY.multiplyMatrices(u,t[o]),rY.toArray(n,o*16)}a!==null&&(a.needsUpdate=!0)}clone(){return new WG(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new tu(t,e,e,To,Ns);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const a=this.bones[t];if(a.name===e)return a}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,a=e.bones.length;n<a;n++){const o=e.bones[n];let l=t[o];l===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),l=new Nw),this.bones.push(l),this.boneInverses.push(new Sn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let a=0,o=t.length;a<o;a++){const l=t[a];e.bones.push(l.uuid);const u=n[a];e.boneInverses.push(u.toArray())}return e}}class UA extends Ri{constructor(e,t,n,a=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=a}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Um=new Sn,oY=new Sn,zS=[],sY=new ho,VP=new Sn,K0=new tr,L0=new Ao;class KA extends tr{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new UA(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let a=0;a<n;a++)this.setMatrixAt(a,VP)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new ho),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Um),sY.copy(e.boundingBox).applyMatrix4(Um),this.boundingBox.union(sY)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ao),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Um),L0.copy(e.boundingSphere).applyMatrix4(Um),this.boundingSphere.union(L0)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,a=this.morphTexture.source.data.data,o=n.length+1,l=e*o+1;for(let u=0;u<n.length;u++)n[u]=a[l+u]}raycast(e,t){const n=this.matrixWorld,a=this.count;if(K0.geometry=this.geometry,K0.material=this.material,K0.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),L0.copy(this.boundingSphere),L0.applyMatrix4(n),e.ray.intersectsSphere(L0)!==!1))for(let o=0;o<a;o++){this.getMatrixAt(o,Um),oY.multiplyMatrices(n,Um),K0.matrixWorld=oY,K0.raycast(e,zS);for(let l=0,u=zS.length;l<u;l++){const d=zS[l];d.instanceId=o,d.object=this,t.push(d)}zS.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new UA(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,a=n.length+1;this.morphTexture===null&&(this.morphTexture=new tu(new Float32Array(a*this.count),a,this.count,Zw,Ns));const o=this.morphTexture.source.data.data;let l=0;for(let C=0;C<n.length;C++)l+=n[C];const u=this.geometry.morphTargetsRelative?1:1-l,d=a*e;o[d]=u,o.set(n,d+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function VM(s,e){return s-e}function MP(s,e){return s.z-e.z}function NP(s,e){return e.z-s.z}class HP{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,a){const o=this.pool,l=this.list;this.index>=o.length&&o.push({start:-1,count:-1,z:-1,index:-1});const u=o[this.index];l.push(u),this.index++,u.start=e,u.count=t,u.z=n,u.index=a}reset(){this.list.length=0,this.index=0}}const Zs=new Sn,XP=new $t(1,1,1),MM=new wG,_S=new ho,dA=new Ao,z0=new q,lY=new q,FP=new q,NM=new HP,Xo=new tr,DS=[];function YP(s,e,t=0){const n=e.itemSize;if(s.isInterleavedBufferAttribute||s.array.constructor!==e.array.constructor){const a=s.count;for(let o=0;o<a;o++)for(let l=0;l<n;l++)e.setComponent(o+t,l,s.getComponent(o,l))}else e.array.set(s.array,t*n);e.needsUpdate=!0}function CA(s,e){if(s.constructor!==e.constructor){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++)e[n]=s[n]}else{const t=Math.min(s.length,e.length);e.set(new s.constructor(s.buffer,0,t))}}class pK extends tr{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(e,t,n=t*2,a){super(new Ln,a),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new tu(t,e,e,To,Ns);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new tu(t,e,e,BG,VI);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new tu(t,e,e,To,Ns);n.colorSpace=mi.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,a=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in e.attributes){const l=e.getAttribute(o),{array:u,itemSize:d,normalized:C}=l,A=new u.constructor(n*d),p=new Ri(A,d,C);t.setAttribute(o,p)}if(e.getIndex()!==null){const o=n>65535?new Uint32Array(a):new Uint16Array(a);t.setIndex(new Ri(o,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const a=e.getAttribute(n),o=t.getAttribute(n);if(a.itemSize!==o.itemSize||a.normalized!==o.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ho);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,a=t.length;n<a;n++){if(t[n].active===!1)continue;const o=t[n].geometryIndex;this.getMatrixAt(n,Zs),this.getBoundingBoxAt(o,_S).applyMatrix4(Zs),e.union(_S)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ao);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,a=t.length;n<a;n++){if(t[n].active===!1)continue;const o=t[n].geometryIndex;this.getMatrixAt(n,Zs),this.getBoundingSphereAt(o,dA).applyMatrix4(Zs),e.union(dA)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let a=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(VM),a=this._availableInstanceIds.shift(),this._instanceInfo[a]=n):(a=this._instanceInfo.length,this._instanceInfo.push(n));const o=this._matricesTexture;Zs.identity().toArray(o.image.data,a*16),o.needsUpdate=!0;const l=this._colorsTexture;return l&&(XP.toArray(l.image.data,a*4),l.needsUpdate=!0),this._visibilityChanged=!0,a}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const a={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},o=this._geometryInfo;a.vertexStart=this._nextVertexStart,a.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const l=e.getIndex();if(l!==null&&(a.indexStart=this._nextIndexStart,a.reservedIndexCount=n===-1?l.count:n),a.indexStart!==-1&&a.indexStart+a.reservedIndexCount>this._maxIndexCount||a.vertexStart+a.reservedVertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let d;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(VM),d=this._availableGeometryIds.shift(),o[d]=a):(d=this._geometryCount,this._geometryCount++,o.push(a)),this.setGeometryAt(d,e),this._nextIndexStart=a.indexStart+a.reservedIndexCount,this._nextVertexStart=a.vertexStart+a.reservedVertexCount,d}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,a=n.getIndex()!==null,o=n.getIndex(),l=t.getIndex(),u=this._geometryInfo[e];if(a&&l.count>u.reservedIndexCount||t.attributes.position.count>u.reservedVertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const d=u.vertexStart,C=u.reservedVertexCount;u.vertexCount=t.getAttribute("position").count;for(const A in n.attributes){const p=t.getAttribute(A),m=n.getAttribute(A);YP(p,m,d);const y=p.itemSize;for(let G=p.count,w=C;G<w;G++){const R=d+G;for(let Z=0;Z<y;Z++)m.setComponent(R,Z,0)}m.needsUpdate=!0,m.addUpdateRange(d*y,C*y)}if(a){const A=u.indexStart,p=u.reservedIndexCount;u.indexCount=t.getIndex().count;for(let m=0;m<l.count;m++)o.setX(A+m,d+l.getX(m));for(let m=l.count,y=p;m<y;m++)o.setX(A+m,d);o.needsUpdate=!0,o.addUpdateRange(A,u.reservedIndexCount)}return u.start=a?u.indexStart:u.vertexStart,u.count=a?u.indexCount:u.vertexCount,u.boundingBox=null,t.boundingBox!==null&&(u.boundingBox=t.boundingBox.clone()),u.boundingSphere=null,t.boundingSphere!==null&&(u.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let a=0,o=n.length;a<o;a++)n[a].geometryIndex===e&&this.deleteInstance(a);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){const t=this._instanceInfo;return e>=t.length||t[e].active===!1?this:(t[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this)}optimize(){let e=0,t=0;const n=this._geometryInfo,a=n.map((l,u)=>u).sort((l,u)=>n[l].vertexStart-n[u].vertexStart),o=this.geometry;for(let l=0,u=n.length;l<u;l++){const d=a[l],C=n[d];if(C.active!==!1){if(o.index!==null){if(C.indexStart!==t){const{indexStart:A,vertexStart:p,reservedIndexCount:m}=C,y=o.index,G=y.array,w=e-p;for(let R=A;R<A+m;R++)G[R]=G[R]+w;y.array.copyWithin(t,A,A+m),y.addUpdateRange(t,m),C.indexStart=t}t+=C.reservedIndexCount}if(C.vertexStart!==e){const{vertexStart:A,reservedVertexCount:p}=C,m=o.attributes;for(const y in m){const G=m[y],{array:w,itemSize:R}=G;w.copyWithin(e*R,A*R,(A+p)*R),G.addUpdateRange(e*R,p*R)}C.vertexStart=e}e+=C.reservedVertexCount,C.start=o.index?C.indexStart:C.vertexStart,this._nextIndexStart=o.index?C.indexStart+C.reservedIndexCount:0,this._nextVertexStart=C.vertexStart+C.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,a=this._geometryInfo[e];if(a.boundingBox===null){const o=new ho,l=n.index,u=n.attributes.position;for(let d=a.start,C=a.start+a.count;d<C;d++){let A=d;l&&(A=l.getX(A)),o.expandByPoint(z0.fromBufferAttribute(u,A))}a.boundingBox=o}return t.copy(a.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,a=this._geometryInfo[e];if(a.boundingSphere===null){const o=new Ao;this.getBoundingBoxAt(e,_S),_S.getCenter(o.center);const l=n.index,u=n.attributes.position;let d=0;for(let C=a.start,A=a.start+a.count;C<A;C++){let p=C;l&&(p=l.getX(p)),z0.fromBufferAttribute(u,p),d=Math.max(d,o.center.distanceToSquared(z0))}o.radius=Math.sqrt(d),a.boundingSphere=o}return t.copy(a.boundingSphere),t}setMatrixAt(e,t){const n=this._instanceInfo,a=this._matricesTexture,o=this._matricesTexture.image.data;return e>=n.length||n[e].active===!1?this:(t.toArray(o,e*16),a.needsUpdate=!0,this)}getMatrixAt(e,t){const n=this._instanceInfo,a=this._matricesTexture.image.data;return e>=n.length||n[e].active===!1?null:t.fromArray(a,e*16)}setColorAt(e,t){this._colorsTexture===null&&this._initColorsTexture();const n=this._colorsTexture,a=this._colorsTexture.image.data,o=this._instanceInfo;return e>=o.length||o[e].active===!1?this:(t.toArray(a,e*4),n.needsUpdate=!0,this)}getColorAt(e,t){const n=this._colorsTexture.image.data,a=this._instanceInfo;return e>=a.length||a[e].active===!1?null:t.fromArray(n,e*4)}setVisibleAt(e,t){const n=this._instanceInfo;return e>=n.length||n[e].active===!1||n[e].visible===t?this:(n[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._instanceInfo;return e>=t.length||t[e].active===!1?!1:t[e].visible}setGeometryIdAt(e,t){const n=this._instanceInfo,a=this._geometryInfo;return e>=n.length||n[e].active===!1||t>=a.length||a[t].active===!1?null:(n[e].geometryIndex=t,this)}getGeometryIdAt(e){const t=this._instanceInfo;return e>=t.length||t[e].active===!1?-1:t[e].geometryIndex}getGeometryRangeAt(e,t={}){if(e<0||e>=this._geometryCount)return null;const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(VM);t[t.length-1]===n.length;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const a=new Int32Array(e),o=new Int32Array(e);CA(this._multiDrawCounts,a),CA(this._multiDrawStarts,o),this._multiDrawCounts=a,this._multiDrawStarts=o,this._maxInstanceCount=e;const l=this._indirectTexture,u=this._matricesTexture,d=this._colorsTexture;l.dispose(),this._initIndirectTexture(),CA(l.image.data,this._indirectTexture.image.data),u.dispose(),this._initMatricesTexture(),CA(u.image.data,this._matricesTexture.image.data),d&&(d.dispose(),this._initColorsTexture(),CA(d.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(u=>u.active);if(Math.max(...n.map(u=>u.vertexStart+u.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(d=>d.indexStart+d.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const o=this.geometry;o.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Ln,this._initializeGeometry(o));const l=this.geometry;o.index&&CA(o.index.array,l.index.array);for(const u in o.attributes)CA(o.attributes[u].array,l.attributes[u].array)}raycast(e,t){const n=this._instanceInfo,a=this._geometryInfo,o=this.matrixWorld,l=this.geometry;Xo.material=this.material,Xo.geometry.index=l.index,Xo.geometry.attributes=l.attributes,Xo.geometry.boundingBox===null&&(Xo.geometry.boundingBox=new ho),Xo.geometry.boundingSphere===null&&(Xo.geometry.boundingSphere=new Ao);for(let u=0,d=n.length;u<d;u++){if(!n[u].visible||!n[u].active)continue;const C=n[u].geometryIndex,A=a[C];Xo.geometry.setDrawRange(A.start,A.count),this.getMatrixAt(u,Xo.matrixWorld).premultiply(o),this.getBoundingBoxAt(C,Xo.geometry.boundingBox),this.getBoundingSphereAt(C,Xo.geometry.boundingSphere),Xo.raycast(e,DS);for(let p=0,m=DS.length;p<m;p++){const y=DS[p];y.object=this,y.batchId=u,t.push(y)}DS.length=0}Xo.material=null,Xo.geometry.index=null,Xo.geometry.attributes={},Xo.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,n,a,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const l=a.getIndex(),u=l===null?1:l.array.BYTES_PER_ELEMENT,d=this._instanceInfo,C=this._multiDrawStarts,A=this._multiDrawCounts,p=this._geometryInfo,m=this.perObjectFrustumCulled,y=this._indirectTexture,G=y.image.data;m&&(Zs.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),MM.setFromProjectionMatrix(Zs,e.coordinateSystem));let w=0;if(this.sortObjects){Zs.copy(this.matrixWorld).invert(),z0.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Zs),lY.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Zs);for(let x=0,W=d.length;x<W;x++)if(d[x].visible&&d[x].active){const N=d[x].geometryIndex;this.getMatrixAt(x,Zs),this.getBoundingSphereAt(N,dA).applyMatrix4(Zs);let K=!1;if(m&&(K=!MM.intersectsSphere(dA)),!K){const T=p[N],L=FP.subVectors(dA.center,z0).dot(lY);NM.push(T.start,T.count,L,x)}}const R=NM.list,Z=this.customSort;Z===null?R.sort(o.transparent?NP:MP):Z.call(this,R,n);for(let x=0,W=R.length;x<W;x++){const N=R[x];C[w]=N.start*u,A[w]=N.count,G[w]=N.index,w++}NM.reset()}else for(let R=0,Z=d.length;R<Z;R++)if(d[R].visible&&d[R].active){const x=d[R].geometryIndex;let W=!1;if(m&&(this.getMatrixAt(R,Zs),this.getBoundingSphereAt(x,dA).applyMatrix4(Zs),W=!MM.intersectsSphere(dA)),!W){const N=p[x];C[w]=N.start*u,A[w]=N.count,G[w]=R,w++}}y.needsUpdate=!0,this._multiDrawCount=w,this._visibilityChanged=!1}onBeforeShadow(e,t,n,a,o,l){this.onBeforeRender(e,null,a,o,l)}}class Eo extends Zr{static get type(){return"LineBasicMaterial"}constructor(e){super(),this.isLineBasicMaterial=!0,this.color=new $t(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const sw=new q,lw=new q,cY=new Sn,_0=new qA,kS=new Ao,HM=new q,gY=new q;class MI extends gi{constructor(e=new Ln,t=new Eo){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let a=1,o=t.count;a<o;a++)sw.fromBufferAttribute(t,a-1),lw.fromBufferAttribute(t,a),n[a]=n[a-1],n[a]+=sw.distanceTo(lw);e.setAttribute("lineDistance",new hn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,a=this.matrixWorld,o=e.params.Line.threshold,l=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),kS.copy(n.boundingSphere),kS.applyMatrix4(a),kS.radius+=o,e.ray.intersectsSphere(kS)===!1)return;cY.copy(a).invert(),_0.copy(e.ray).applyMatrix4(cY);const u=o/((this.scale.x+this.scale.y+this.scale.z)/3),d=u*u,C=this.isLineSegments?2:1,A=n.index,m=n.attributes.position;if(A!==null){const y=Math.max(0,l.start),G=Math.min(A.count,l.start+l.count);for(let w=y,R=G-1;w<R;w+=C){const Z=A.getX(w),x=A.getX(w+1),W=US(this,e,_0,d,Z,x);W&&t.push(W)}if(this.isLineLoop){const w=A.getX(G-1),R=A.getX(y),Z=US(this,e,_0,d,w,R);Z&&t.push(Z)}}else{const y=Math.max(0,l.start),G=Math.min(m.count,l.start+l.count);for(let w=y,R=G-1;w<R;w+=C){const Z=US(this,e,_0,d,w,w+1);Z&&t.push(Z)}if(this.isLineLoop){const w=US(this,e,_0,d,G-1,y);w&&t.push(w)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const a=t[n[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=a.length;o<l;o++){const u=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=o}}}}}function US(s,e,t,n,a,o){const l=s.geometry.attributes.position;if(sw.fromBufferAttribute(l,a),lw.fromBufferAttribute(l,o),t.distanceSqToSegment(sw,lw,HM,gY)>n)return;HM.applyMatrix4(s.matrixWorld);const d=e.ray.origin.distanceTo(HM);if(!(d<e.near||d>e.far))return{distance:d,point:gY.clone().applyMatrix4(s.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:s}}const uY=new q,IY=new q;class Dc extends MI{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let a=0,o=t.count;a<o;a+=2)uY.fromBufferAttribute(t,a),IY.fromBufferAttribute(t,a+1),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+uY.distanceTo(IY);e.setAttribute("lineDistance",new hn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class vH extends MI{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Hw extends Zr{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new $t(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const dY=new Sn,ZN=new qA,JS=new Ao,OS=new q;class yH extends gi{constructor(e=new Ln,t=new Hw){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,a=this.matrixWorld,o=e.params.Points.threshold,l=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),JS.copy(n.boundingSphere),JS.applyMatrix4(a),JS.radius+=o,e.ray.intersectsSphere(JS)===!1)return;dY.copy(a).invert(),ZN.copy(e.ray).applyMatrix4(dY);const u=o/((this.scale.x+this.scale.y+this.scale.z)/3),d=u*u,C=n.index,p=n.attributes.position;if(C!==null){const m=Math.max(0,l.start),y=Math.min(C.count,l.start+l.count);for(let G=m,w=y;G<w;G++){const R=C.getX(G);OS.fromBufferAttribute(p,R),CY(OS,R,d,a,e,t,this)}}else{const m=Math.max(0,l.start),y=Math.min(p.count,l.start+l.count);for(let G=m,w=y;G<w;G++)OS.fromBufferAttribute(p,G),CY(OS,G,d,a,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const a=t[n[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=a.length;o<l;o++){const u=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=o}}}}}function CY(s,e,t,n,a,o,l){const u=ZN.distanceSqToPoint(s);if(u<t){const d=new q;ZN.closestPointToPoint(s,d),d.applyMatrix4(n);const C=a.ray.origin.distanceTo(d);if(C<a.near||C>a.far)return;o.push({distance:C,distanceToRay:Math.sqrt(u),point:d,index:e,face:null,faceIndex:null,barycoord:null,object:l})}}class TP extends fa{constructor(e,t,n,a,o,l,u,d,C){super(e,t,n,a,o,l,u,d,C),this.isVideoTexture=!0,this.minFilter=l!==void 0?l:er,this.magFilter=o!==void 0?o:er,this.generateMipmaps=!1;const A=this;function p(){A.needsUpdate=!0,e.requestVideoFrameCallback(p)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(p)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class EP extends fa{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=_r,this.minFilter=_r,this.generateMipmaps=!1,this.needsUpdate=!0}}class Xw extends fa{constructor(e,t,n,a,o,l,u,d,C,A,p,m){super(null,l,u,d,C,A,a,o,p,m),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class KP extends Xw{constructor(e,t,n,a,o,l){super(e,t,n,o,l),this.isCompressedArrayTexture=!0,this.image.depth=a,this.wrapR=dl,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class LP extends Xw{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,WI),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class zP extends fa{constructor(e,t,n,a,o,l,u,d,C){super(e,t,n,a,o,l,u,d,C),this.isCanvasTexture=!0,this.needsUpdate=!0}}class kc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,a=this.getPoint(0),o=0;t.push(0);for(let l=1;l<=e;l++)n=this.getPoint(l/e),o+=n.distanceTo(a),t.push(o),a=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let a=0;const o=n.length;let l;t?l=t:l=e*n[o-1];let u=0,d=o-1,C;for(;u<=d;)if(a=Math.floor(u+(d-u)/2),C=n[a]-l,C<0)u=a+1;else if(C>0)d=a-1;else{d=a;break}if(a=d,n[a]===l)return a/(o-1);const A=n[a],m=n[a+1]-A,y=(l-A)/m;return(a+y)/(o-1)}getTangent(e,t){let a=e-1e-4,o=e+1e-4;a<0&&(a=0),o>1&&(o=1);const l=this.getPoint(a),u=this.getPoint(o),d=t||(l.isVector2?new ut:new q);return d.copy(u).sub(l).normalize(),d}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new q,a=[],o=[],l=[],u=new q,d=new Sn;for(let y=0;y<=e;y++){const G=y/e;a[y]=this.getTangentAt(G,new q)}o[0]=new q,l[0]=new q;let C=Number.MAX_VALUE;const A=Math.abs(a[0].x),p=Math.abs(a[0].y),m=Math.abs(a[0].z);A<=C&&(C=A,n.set(1,0,0)),p<=C&&(C=p,n.set(0,1,0)),m<=C&&n.set(0,0,1),u.crossVectors(a[0],n).normalize(),o[0].crossVectors(a[0],u),l[0].crossVectors(a[0],o[0]);for(let y=1;y<=e;y++){if(o[y]=o[y-1].clone(),l[y]=l[y-1].clone(),u.crossVectors(a[y-1],a[y]),u.length()>Number.EPSILON){u.normalize();const G=Math.acos(La(a[y-1].dot(a[y]),-1,1));o[y].applyMatrix4(d.makeRotationAxis(u,G))}l[y].crossVectors(a[y],o[y])}if(t===!0){let y=Math.acos(La(o[0].dot(o[e]),-1,1));y/=e,a[0].dot(u.crossVectors(o[0],o[e]))>0&&(y=-y);for(let G=1;G<=e;G++)o[G].applyMatrix4(d.makeRotationAxis(a[G],y*G)),l[G].crossVectors(a[G],o[G])}return{tangents:a,normals:o,binormals:l}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Fw extends kc{constructor(e=0,t=0,n=1,a=1,o=0,l=Math.PI*2,u=!1,d=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=a,this.aStartAngle=o,this.aEndAngle=l,this.aClockwise=u,this.aRotation=d}getPoint(e,t=new ut){const n=t,a=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const l=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=a;for(;o>a;)o-=a;o<Number.EPSILON&&(l?o=0:o=a),this.aClockwise===!0&&!l&&(o===a?o=-a:o=o-a);const u=this.aStartAngle+e*o;let d=this.aX+this.xRadius*Math.cos(u),C=this.aY+this.yRadius*Math.sin(u);if(this.aRotation!==0){const A=Math.cos(this.aRotation),p=Math.sin(this.aRotation),m=d-this.aX,y=C-this.aY;d=m*A-y*p+this.aX,C=m*p+y*A+this.aY}return n.set(d,C)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class mK extends Fw{constructor(e,t,n,a,o,l){super(e,t,n,n,a,o,l),this.isArcCurve=!0,this.type="ArcCurve"}}function GH(){let s=0,e=0,t=0,n=0;function a(o,l,u,d){s=o,e=u,t=-3*o+3*l-2*u-d,n=2*o-2*l+u+d}return{initCatmullRom:function(o,l,u,d,C){a(l,u,C*(u-o),C*(d-l))},initNonuniformCatmullRom:function(o,l,u,d,C,A,p){let m=(l-o)/C-(u-o)/(C+A)+(u-l)/A,y=(u-l)/A-(d-l)/(A+p)+(d-u)/p;m*=A,y*=A,a(l,u,m,y)},calc:function(o){const l=o*o,u=l*o;return s+e*o+t*l+n*u}}}const PS=new q,XM=new GH,FM=new GH,YM=new GH;class bK extends kc{constructor(e=[],t=!1,n="centripetal",a=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=a}getPoint(e,t=new q){const n=t,a=this.points,o=a.length,l=(o-(this.closed?0:1))*e;let u=Math.floor(l),d=l-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:d===0&&u===o-1&&(u=o-2,d=1);let C,A;this.closed||u>0?C=a[(u-1)%o]:(PS.subVectors(a[0],a[1]).add(a[0]),C=PS);const p=a[u%o],m=a[(u+1)%o];if(this.closed||u+2<o?A=a[(u+2)%o]:(PS.subVectors(a[o-1],a[o-2]).add(a[o-1]),A=PS),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let G=Math.pow(C.distanceToSquared(p),y),w=Math.pow(p.distanceToSquared(m),y),R=Math.pow(m.distanceToSquared(A),y);w<1e-4&&(w=1),G<1e-4&&(G=w),R<1e-4&&(R=w),XM.initNonuniformCatmullRom(C.x,p.x,m.x,A.x,G,w,R),FM.initNonuniformCatmullRom(C.y,p.y,m.y,A.y,G,w,R),YM.initNonuniformCatmullRom(C.z,p.z,m.z,A.z,G,w,R)}else this.curveType==="catmullrom"&&(XM.initCatmullRom(C.x,p.x,m.x,A.x,this.tension),FM.initCatmullRom(C.y,p.y,m.y,A.y,this.tension),YM.initCatmullRom(C.z,p.z,m.z,A.z,this.tension));return n.set(XM.calc(d),FM.calc(d),YM.calc(d)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const a=e.points[t];this.points.push(a.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const a=this.points[t];e.points.push(a.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const a=e.points[t];this.points.push(new q().fromArray(a))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function hY(s,e,t,n,a){const o=(n-e)*.5,l=(a-t)*.5,u=s*s,d=s*u;return(2*t-2*n+o+l)*d+(-3*t+3*n-2*o-l)*u+o*s+t}function _P(s,e){const t=1-s;return t*t*e}function DP(s,e){return 2*(1-s)*s*e}function kP(s,e){return s*s*e}function cG(s,e,t,n){return _P(s,e)+DP(s,t)+kP(s,n)}function UP(s,e){const t=1-s;return t*t*t*e}function JP(s,e){const t=1-s;return 3*t*t*s*e}function OP(s,e){return 3*(1-s)*s*s*e}function PP(s,e){return s*s*s*e}function gG(s,e,t,n,a){return UP(s,e)+JP(s,t)+OP(s,n)+PP(s,a)}class BH extends kc{constructor(e=new ut,t=new ut,n=new ut,a=new ut){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=a}getPoint(e,t=new ut){const n=t,a=this.v0,o=this.v1,l=this.v2,u=this.v3;return n.set(gG(e,a.x,o.x,l.x,u.x),gG(e,a.y,o.y,l.y,u.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class vK extends kc{constructor(e=new q,t=new q,n=new q,a=new q){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=a}getPoint(e,t=new q){const n=t,a=this.v0,o=this.v1,l=this.v2,u=this.v3;return n.set(gG(e,a.x,o.x,l.x,u.x),gG(e,a.y,o.y,l.y,u.y),gG(e,a.z,o.z,l.z,u.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ZH extends kc{constructor(e=new ut,t=new ut){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ut){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ut){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class yK extends kc{constructor(e=new q,t=new q){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new q){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new q){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class SH extends kc{constructor(e=new ut,t=new ut,n=new ut){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ut){const n=t,a=this.v0,o=this.v1,l=this.v2;return n.set(cG(e,a.x,o.x,l.x),cG(e,a.y,o.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class RH extends kc{constructor(e=new q,t=new q,n=new q){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new q){const n=t,a=this.v0,o=this.v1,l=this.v2;return n.set(cG(e,a.x,o.x,l.x),cG(e,a.y,o.y,l.y),cG(e,a.z,o.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wH extends kc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ut){const n=t,a=this.points,o=(a.length-1)*e,l=Math.floor(o),u=o-l,d=a[l===0?l:l-1],C=a[l],A=a[l>a.length-2?a.length-1:l+1],p=a[l>a.length-3?a.length-1:l+2];return n.set(hY(u,d.x,C.x,A.x,p.x),hY(u,d.y,C.y,A.y,p.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const a=e.points[t];this.points.push(a.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const a=this.points[t];e.points.push(a.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const a=e.points[t];this.points.push(new ut().fromArray(a))}return this}}var cw=Object.freeze({__proto__:null,ArcCurve:mK,CatmullRomCurve3:bK,CubicBezierCurve:BH,CubicBezierCurve3:vK,EllipseCurve:Fw,LineCurve:ZH,LineCurve3:yK,QuadraticBezierCurve:SH,QuadraticBezierCurve3:RH,SplineCurve:wH});class GK extends kc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new cw[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),a=this.getCurveLengths();let o=0;for(;o<a.length;){if(a[o]>=n){const l=a[o]-n,u=this.curves[o],d=u.getLength(),C=d===0?0:1-l/d;return u.getPointAt(C,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,a=this.curves.length;n<a;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let a=0,o=this.curves;a<o.length;a++){const l=o[a],u=l.isEllipseCurve?e*2:l.isLineCurve||l.isLineCurve3?1:l.isSplineCurve?e*l.points.length:e,d=l.getPoints(u);for(let C=0;C<d.length;C++){const A=d[C];n&&n.equals(A)||(t.push(A),n=A)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const a=e.curves[t];this.curves.push(a.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const a=this.curves[t];e.curves.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const a=e.curves[t];this.curves.push(new cw[a.type]().fromJSON(a))}return this}}class fG extends GK{constructor(e){super(),this.type="Path",this.currentPoint=new ut,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new ZH(this.currentPoint.clone(),new ut(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,a){const o=new SH(this.currentPoint.clone(),new ut(e,t),new ut(n,a));return this.curves.push(o),this.currentPoint.set(n,a),this}bezierCurveTo(e,t,n,a,o,l){const u=new BH(this.currentPoint.clone(),new ut(e,t),new ut(n,a),new ut(o,l));return this.curves.push(u),this.currentPoint.set(o,l),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new wH(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,a,o,l){const u=this.currentPoint.x,d=this.currentPoint.y;return this.absarc(e+u,t+d,n,a,o,l),this}absarc(e,t,n,a,o,l){return this.absellipse(e,t,n,n,a,o,l),this}ellipse(e,t,n,a,o,l,u,d){const C=this.currentPoint.x,A=this.currentPoint.y;return this.absellipse(e+C,t+A,n,a,o,l,u,d),this}absellipse(e,t,n,a,o,l,u,d){const C=new Fw(e,t,n,a,o,l,u,d);if(this.curves.length>0){const p=C.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(C);const A=C.getPoint(1);return this.currentPoint.copy(A),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class VG extends Ln{constructor(e=[new ut(0,-.5),new ut(.5,0),new ut(0,.5)],t=12,n=0,a=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:a},t=Math.floor(t),a=La(a,0,Math.PI*2);const o=[],l=[],u=[],d=[],C=[],A=1/t,p=new q,m=new ut,y=new q,G=new q,w=new q;let R=0,Z=0;for(let x=0;x<=e.length-1;x++)switch(x){case 0:R=e[x+1].x-e[x].x,Z=e[x+1].y-e[x].y,y.x=Z*1,y.y=-R,y.z=Z*0,w.copy(y),y.normalize(),d.push(y.x,y.y,y.z);break;case e.length-1:d.push(w.x,w.y,w.z);break;default:R=e[x+1].x-e[x].x,Z=e[x+1].y-e[x].y,y.x=Z*1,y.y=-R,y.z=Z*0,G.copy(y),y.x+=w.x,y.y+=w.y,y.z+=w.z,y.normalize(),d.push(y.x,y.y,y.z),w.copy(G)}for(let x=0;x<=t;x++){const W=n+x*A*a,N=Math.sin(W),K=Math.cos(W);for(let T=0;T<=e.length-1;T++){p.x=e[T].x*N,p.y=e[T].y,p.z=e[T].x*K,l.push(p.x,p.y,p.z),m.x=x/t,m.y=T/(e.length-1),u.push(m.x,m.y);const L=d[3*T+0]*N,k=d[3*T+1],E=d[3*T+0]*K;C.push(L,k,E)}}for(let x=0;x<t;x++)for(let W=0;W<e.length-1;W++){const N=W+x*e.length,K=N,T=N+e.length,L=N+e.length+1,k=N+1;o.push(K,T,k),o.push(L,k,T)}this.setIndex(o),this.setAttribute("position",new hn(l,3)),this.setAttribute("uv",new hn(u,2)),this.setAttribute("normal",new hn(C,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new VG(e.points,e.segments,e.phiStart,e.phiLength)}}class Yw extends VG{constructor(e=1,t=1,n=4,a=8){const o=new fG;o.absarc(0,-t/2,e,Math.PI*1.5,0),o.absarc(0,t/2,e,0,Math.PI*.5),super(o.getPoints(n),a),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:a}}static fromJSON(e){return new Yw(e.radius,e.length,e.capSegments,e.radialSegments)}}class Tw extends Ln{constructor(e=1,t=32,n=0,a=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:a},t=Math.max(3,t);const o=[],l=[],u=[],d=[],C=new q,A=new ut;l.push(0,0,0),u.push(0,0,1),d.push(.5,.5);for(let p=0,m=3;p<=t;p++,m+=3){const y=n+p/t*a;C.x=e*Math.cos(y),C.y=e*Math.sin(y),l.push(C.x,C.y,C.z),u.push(0,0,1),A.x=(l[m]/e+1)/2,A.y=(l[m+1]/e+1)/2,d.push(A.x,A.y)}for(let p=1;p<=t;p++)o.push(p,p+1,0);this.setIndex(o),this.setAttribute("position",new hn(l,3)),this.setAttribute("normal",new hn(u,3)),this.setAttribute("uv",new hn(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tw(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class pb extends Ln{constructor(e=1,t=1,n=1,a=32,o=1,l=!1,u=0,d=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:a,heightSegments:o,openEnded:l,thetaStart:u,thetaLength:d};const C=this;a=Math.floor(a),o=Math.floor(o);const A=[],p=[],m=[],y=[];let G=0;const w=[],R=n/2;let Z=0;x(),l===!1&&(e>0&&W(!0),t>0&&W(!1)),this.setIndex(A),this.setAttribute("position",new hn(p,3)),this.setAttribute("normal",new hn(m,3)),this.setAttribute("uv",new hn(y,2));function x(){const N=new q,K=new q;let T=0;const L=(t-e)/n;for(let k=0;k<=o;k++){const E=[],F=k/o,U=F*(t-e)+e;for(let le=0;le<=a;le++){const ie=le/a,Ce=ie*d+u,Ge=Math.sin(Ce),ye=Math.cos(Ce);K.x=U*Ge,K.y=-F*n+R,K.z=U*ye,p.push(K.x,K.y,K.z),N.set(Ge,L,ye).normalize(),m.push(N.x,N.y,N.z),y.push(ie,1-F),E.push(G++)}w.push(E)}for(let k=0;k<a;k++)for(let E=0;E<o;E++){const F=w[E][k],U=w[E+1][k],le=w[E+1][k+1],ie=w[E][k+1];(e>0||E!==0)&&(A.push(F,U,ie),T+=3),(t>0||E!==o-1)&&(A.push(U,le,ie),T+=3)}C.addGroup(Z,T,0),Z+=T}function W(N){const K=G,T=new ut,L=new q;let k=0;const E=N===!0?e:t,F=N===!0?1:-1;for(let le=1;le<=a;le++)p.push(0,R*F,0),m.push(0,F,0),y.push(.5,.5),G++;const U=G;for(let le=0;le<=a;le++){const Ce=le/a*d+u,Ge=Math.cos(Ce),ye=Math.sin(Ce);L.x=E*ye,L.y=R*F,L.z=E*Ge,p.push(L.x,L.y,L.z),m.push(0,F,0),T.x=Ge*.5+.5,T.y=ye*.5*F+.5,y.push(T.x,T.y),G++}for(let le=0;le<a;le++){const ie=K+le,Ce=U+le;N===!0?A.push(Ce,Ce+1,ie):A.push(Ce+1,Ce,ie),k+=3}C.addGroup(Z,k,N===!0?1:2),Z+=k}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pb(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ew extends pb{constructor(e=1,t=1,n=32,a=1,o=!1,l=0,u=Math.PI*2){super(0,e,t,n,a,o,l,u),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:a,openEnded:o,thetaStart:l,thetaLength:u}}static fromJSON(e){return new Ew(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class uC extends Ln{constructor(e=[],t=[],n=1,a=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:a};const o=[],l=[];u(a),C(n),A(),this.setAttribute("position",new hn(o,3)),this.setAttribute("normal",new hn(o.slice(),3)),this.setAttribute("uv",new hn(l,2)),a===0?this.computeVertexNormals():this.normalizeNormals();function u(x){const W=new q,N=new q,K=new q;for(let T=0;T<t.length;T+=3)y(t[T+0],W),y(t[T+1],N),y(t[T+2],K),d(W,N,K,x)}function d(x,W,N,K){const T=K+1,L=[];for(let k=0;k<=T;k++){L[k]=[];const E=x.clone().lerp(N,k/T),F=W.clone().lerp(N,k/T),U=T-k;for(let le=0;le<=U;le++)le===0&&k===T?L[k][le]=E:L[k][le]=E.clone().lerp(F,le/U)}for(let k=0;k<T;k++)for(let E=0;E<2*(T-k)-1;E++){const F=Math.floor(E/2);E%2===0?(m(L[k][F+1]),m(L[k+1][F]),m(L[k][F])):(m(L[k][F+1]),m(L[k+1][F+1]),m(L[k+1][F]))}}function C(x){const W=new q;for(let N=0;N<o.length;N+=3)W.x=o[N+0],W.y=o[N+1],W.z=o[N+2],W.normalize().multiplyScalar(x),o[N+0]=W.x,o[N+1]=W.y,o[N+2]=W.z}function A(){const x=new q;for(let W=0;W<o.length;W+=3){x.x=o[W+0],x.y=o[W+1],x.z=o[W+2];const N=R(x)/2/Math.PI+.5,K=Z(x)/Math.PI+.5;l.push(N,1-K)}G(),p()}function p(){for(let x=0;x<l.length;x+=6){const W=l[x+0],N=l[x+2],K=l[x+4],T=Math.max(W,N,K),L=Math.min(W,N,K);T>.9&&L<.1&&(W<.2&&(l[x+0]+=1),N<.2&&(l[x+2]+=1),K<.2&&(l[x+4]+=1))}}function m(x){o.push(x.x,x.y,x.z)}function y(x,W){const N=x*3;W.x=e[N+0],W.y=e[N+1],W.z=e[N+2]}function G(){const x=new q,W=new q,N=new q,K=new q,T=new ut,L=new ut,k=new ut;for(let E=0,F=0;E<o.length;E+=9,F+=6){x.set(o[E+0],o[E+1],o[E+2]),W.set(o[E+3],o[E+4],o[E+5]),N.set(o[E+6],o[E+7],o[E+8]),T.set(l[F+0],l[F+1]),L.set(l[F+2],l[F+3]),k.set(l[F+4],l[F+5]),K.copy(x).add(W).add(N).divideScalar(3);const U=R(K);w(T,F+0,x,U),w(L,F+2,W,U),w(k,F+4,N,U)}}function w(x,W,N,K){K<0&&x.x===1&&(l[W]=x.x-1),N.x===0&&N.z===0&&(l[W]=K/2/Math.PI+.5)}function R(x){return Math.atan2(x.z,-x.x)}function Z(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uC(e.vertices,e.indices,e.radius,e.details)}}class Kw extends uC{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,a=1/n,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-n,0,-a,n,0,a,-n,0,a,n,-a,-n,0,-a,n,0,a,-n,0,a,n,0,-n,0,-a,n,0,-a,-n,0,a,n,0,a],l=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,l,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Kw(e.radius,e.detail)}}const QS=new q,jS=new q,TM=new q,qS=new Ms;class BK extends Ln{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const a=Math.pow(10,4),o=Math.cos(TA*t),l=e.getIndex(),u=e.getAttribute("position"),d=l?l.count:u.count,C=[0,0,0],A=["a","b","c"],p=new Array(3),m={},y=[];for(let G=0;G<d;G+=3){l?(C[0]=l.getX(G),C[1]=l.getX(G+1),C[2]=l.getX(G+2)):(C[0]=G,C[1]=G+1,C[2]=G+2);const{a:w,b:R,c:Z}=qS;if(w.fromBufferAttribute(u,C[0]),R.fromBufferAttribute(u,C[1]),Z.fromBufferAttribute(u,C[2]),qS.getNormal(TM),p[0]=`${Math.round(w.x*a)},${Math.round(w.y*a)},${Math.round(w.z*a)}`,p[1]=`${Math.round(R.x*a)},${Math.round(R.y*a)},${Math.round(R.z*a)}`,p[2]=`${Math.round(Z.x*a)},${Math.round(Z.y*a)},${Math.round(Z.z*a)}`,!(p[0]===p[1]||p[1]===p[2]||p[2]===p[0]))for(let x=0;x<3;x++){const W=(x+1)%3,N=p[x],K=p[W],T=qS[A[x]],L=qS[A[W]],k=`${N}_${K}`,E=`${K}_${N}`;E in m&&m[E]?(TM.dot(m[E].normal)<=o&&(y.push(T.x,T.y,T.z),y.push(L.x,L.y,L.z)),m[E]=null):k in m||(m[k]={index0:C[x],index1:C[W],normal:TM.clone()})}}for(const G in m)if(m[G]){const{index0:w,index1:R}=m[G];QS.fromBufferAttribute(u,w),jS.fromBufferAttribute(u,R),y.push(QS.x,QS.y,QS.z),y.push(jS.x,jS.y,jS.z)}this.setAttribute("position",new hn(y,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let LA=class extends fG{constructor(e){super(e),this.uuid=hl(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,a=this.holes.length;n<a;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const a=e.holes[t];this.holes.push(a.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const a=this.holes[t];e.holes.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const a=e.holes[t];this.holes.push(new fG().fromJSON(a))}return this}};const QP={triangulate:function(s,e,t=2){const n=e&&e.length,a=n?e[0]*t:s.length;let o=ZK(s,0,a,t,!0);const l=[];if(!o||o.next===o.prev)return l;let u,d,C,A,p,m,y;if(n&&(o=tQ(s,e,o,t)),s.length>80*t){u=C=s[0],d=A=s[1];for(let G=t;G<a;G+=t)p=s[G],m=s[G+1],p<u&&(u=p),m<d&&(d=m),p>C&&(C=p),m>A&&(A=m);y=Math.max(C-u,A-d),y=y!==0?32767/y:0}return pG(o,l,t,u,d,y,0),l}};function ZK(s,e,t,n,a){let o,l;if(a===IQ(s,e,t,n)>0)for(o=e;o<t;o+=n)l=AY(o,s[o],s[o+1],l);else for(o=t-n;o>=e;o-=n)l=AY(o,s[o],s[o+1],l);return l&&Lw(l,l.next)&&(bG(l),l=l.next),l}function JA(s,e){if(!s)return s;e||(e=s);let t=s,n;do if(n=!1,!t.steiner&&(Lw(t,t.next)||Wa(t.prev,t,t.next)===0)){if(bG(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function pG(s,e,t,n,a,o,l){if(!s)return;!l&&o&&oQ(s,n,a,o);let u=s,d,C;for(;s.prev!==s.next;){if(d=s.prev,C=s.next,o?qP(s,n,a,o):jP(s)){e.push(d.i/t|0),e.push(s.i/t|0),e.push(C.i/t|0),bG(s),s=C.next,u=C.next;continue}if(s=C,s===u){l?l===1?(s=$P(JA(s),e,t),pG(s,e,t,n,a,o,2)):l===2&&eQ(s,e,t,n,a,o):pG(JA(s),e,t,n,a,o,1);break}}}function jP(s){const e=s.prev,t=s,n=s.next;if(Wa(e,t,n)>=0)return!1;const a=e.x,o=t.x,l=n.x,u=e.y,d=t.y,C=n.y,A=a<o?a<l?a:l:o<l?o:l,p=u<d?u<C?u:C:d<C?d:C,m=a>o?a>l?a:l:o>l?o:l,y=u>d?u>C?u:C:d>C?d:C;let G=n.next;for(;G!==e;){if(G.x>=A&&G.x<=m&&G.y>=p&&G.y<=y&&$m(a,u,o,d,l,C,G.x,G.y)&&Wa(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function qP(s,e,t,n){const a=s.prev,o=s,l=s.next;if(Wa(a,o,l)>=0)return!1;const u=a.x,d=o.x,C=l.x,A=a.y,p=o.y,m=l.y,y=u<d?u<C?u:C:d<C?d:C,G=A<p?A<m?A:m:p<m?p:m,w=u>d?u>C?u:C:d>C?d:C,R=A>p?A>m?A:m:p>m?p:m,Z=SN(y,G,e,t,n),x=SN(w,R,e,t,n);let W=s.prevZ,N=s.nextZ;for(;W&&W.z>=Z&&N&&N.z<=x;){if(W.x>=y&&W.x<=w&&W.y>=G&&W.y<=R&&W!==a&&W!==l&&$m(u,A,d,p,C,m,W.x,W.y)&&Wa(W.prev,W,W.next)>=0||(W=W.prevZ,N.x>=y&&N.x<=w&&N.y>=G&&N.y<=R&&N!==a&&N!==l&&$m(u,A,d,p,C,m,N.x,N.y)&&Wa(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;W&&W.z>=Z;){if(W.x>=y&&W.x<=w&&W.y>=G&&W.y<=R&&W!==a&&W!==l&&$m(u,A,d,p,C,m,W.x,W.y)&&Wa(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;N&&N.z<=x;){if(N.x>=y&&N.x<=w&&N.y>=G&&N.y<=R&&N!==a&&N!==l&&$m(u,A,d,p,C,m,N.x,N.y)&&Wa(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function $P(s,e,t){let n=s;do{const a=n.prev,o=n.next.next;!Lw(a,o)&&SK(a,n,n.next,o)&&mG(a,o)&&mG(o,a)&&(e.push(a.i/t|0),e.push(n.i/t|0),e.push(o.i/t|0),bG(n),bG(n.next),n=s=o),n=n.next}while(n!==s);return JA(n)}function eQ(s,e,t,n,a,o){let l=s;do{let u=l.next.next;for(;u!==l.prev;){if(l.i!==u.i&&cQ(l,u)){let d=RK(l,u);l=JA(l,l.next),d=JA(d,d.next),pG(l,e,t,n,a,o,0),pG(d,e,t,n,a,o,0);return}u=u.next}l=l.next}while(l!==s)}function tQ(s,e,t,n){const a=[];let o,l,u,d,C;for(o=0,l=e.length;o<l;o++)u=e[o]*n,d=o<l-1?e[o+1]*n:s.length,C=ZK(s,u,d,n,!1),C===C.next&&(C.steiner=!0),a.push(lQ(C));for(a.sort(nQ),o=0;o<a.length;o++)t=iQ(a[o],t);return t}function nQ(s,e){return s.x-e.x}function iQ(s,e){const t=aQ(s,e);if(!t)return e;const n=RK(t,s);return JA(n,n.next),JA(t,t.next)}function aQ(s,e){let t=e,n=-1/0,a;const o=s.x,l=s.y;do{if(l<=t.y&&l>=t.next.y&&t.next.y!==t.y){const m=t.x+(l-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(m<=o&&m>n&&(n=m,a=t.x<t.next.x?t:t.next,m===o))return a}t=t.next}while(t!==e);if(!a)return null;const u=a,d=a.x,C=a.y;let A=1/0,p;t=a;do o>=t.x&&t.x>=d&&o!==t.x&&$m(l<C?o:n,l,d,C,l<C?n:o,l,t.x,t.y)&&(p=Math.abs(l-t.y)/(o-t.x),mG(t,s)&&(p<A||p===A&&(t.x>a.x||t.x===a.x&&rQ(a,t)))&&(a=t,A=p)),t=t.next;while(t!==u);return a}function rQ(s,e){return Wa(s.prev,s,e.prev)<0&&Wa(e.next,s,s.next)<0}function oQ(s,e,t,n){let a=s;do a.z===0&&(a.z=SN(a.x,a.y,e,t,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==s);a.prevZ.nextZ=null,a.prevZ=null,sQ(a)}function sQ(s){let e,t,n,a,o,l,u,d,C=1;do{for(t=s,s=null,o=null,l=0;t;){for(l++,n=t,u=0,e=0;e<C&&(u++,n=n.nextZ,!!n);e++);for(d=C;u>0||d>0&&n;)u!==0&&(d===0||!n||t.z<=n.z)?(a=t,t=t.nextZ,u--):(a=n,n=n.nextZ,d--),o?o.nextZ=a:s=a,a.prevZ=o,o=a;t=n}o.nextZ=null,C*=2}while(l>1);return s}function SN(s,e,t,n,a){return s=(s-t)*a|0,e=(e-n)*a|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function lQ(s){let e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function $m(s,e,t,n,a,o,l,u){return(a-l)*(e-u)>=(s-l)*(o-u)&&(s-l)*(n-u)>=(t-l)*(e-u)&&(t-l)*(o-u)>=(a-l)*(n-u)}function cQ(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!gQ(s,e)&&(mG(s,e)&&mG(e,s)&&uQ(s,e)&&(Wa(s.prev,s,e.prev)||Wa(s,e.prev,e))||Lw(s,e)&&Wa(s.prev,s,s.next)>0&&Wa(e.prev,e,e.next)>0)}function Wa(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function Lw(s,e){return s.x===e.x&&s.y===e.y}function SK(s,e,t,n){const a=eR(Wa(s,e,t)),o=eR(Wa(s,e,n)),l=eR(Wa(t,n,s)),u=eR(Wa(t,n,e));return!!(a!==o&&l!==u||a===0&&$S(s,t,e)||o===0&&$S(s,n,e)||l===0&&$S(t,s,n)||u===0&&$S(t,e,n))}function $S(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function eR(s){return s>0?1:s<0?-1:0}function gQ(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&SK(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function mG(s,e){return Wa(s.prev,s,s.next)<0?Wa(s,e,s.next)>=0&&Wa(s,s.prev,e)>=0:Wa(s,e,s.prev)<0||Wa(s,s.next,e)<0}function uQ(s,e){let t=s,n=!1;const a=(s.x+e.x)/2,o=(s.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&a<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==s);return n}function RK(s,e){const t=new RN(s.i,s.x,s.y),n=new RN(e.i,e.x,e.y),a=s.next,o=e.prev;return s.next=e,e.prev=s,t.next=a,a.prev=t,n.next=t,t.prev=n,o.next=n,n.prev=o,n}function AY(s,e,t,n){const a=new RN(s,e,t);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function bG(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function RN(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function IQ(s,e,t,n){let a=0;for(let o=e,l=t-n;o<t;o+=n)a+=(s[l]-s[o])*(s[o+1]+s[l+1]),l=o;return a}class nu{static area(e){const t=e.length;let n=0;for(let a=t-1,o=0;o<t;a=o++)n+=e[a].x*e[o].y-e[o].x*e[a].y;return n*.5}static isClockWise(e){return nu.area(e)<0}static triangulateShape(e,t){const n=[],a=[],o=[];fY(e),pY(n,e);let l=e.length;t.forEach(fY);for(let d=0;d<t.length;d++)a.push(l),l+=t[d].length,pY(n,t[d]);const u=QP.triangulate(n,a);for(let d=0;d<u.length;d+=3)o.push(u.slice(d,d+3));return o}}function fY(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function pY(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class zw extends Ln{constructor(e=new LA([new ut(.5,.5),new ut(-.5,.5),new ut(-.5,-.5),new ut(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,a=[],o=[];for(let u=0,d=e.length;u<d;u++){const C=e[u];l(C)}this.setAttribute("position",new hn(a,3)),this.setAttribute("uv",new hn(o,2)),this.computeVertexNormals();function l(u){const d=[],C=t.curveSegments!==void 0?t.curveSegments:12,A=t.steps!==void 0?t.steps:1,p=t.depth!==void 0?t.depth:1;let m=t.bevelEnabled!==void 0?t.bevelEnabled:!0,y=t.bevelThickness!==void 0?t.bevelThickness:.2,G=t.bevelSize!==void 0?t.bevelSize:y-.1,w=t.bevelOffset!==void 0?t.bevelOffset:0,R=t.bevelSegments!==void 0?t.bevelSegments:3;const Z=t.extrudePath,x=t.UVGenerator!==void 0?t.UVGenerator:dQ;let W,N=!1,K,T,L,k;Z&&(W=Z.getSpacedPoints(A),N=!0,m=!1,K=Z.computeFrenetFrames(A,!1),T=new q,L=new q,k=new q),m||(R=0,y=0,G=0,w=0);const E=u.extractPoints(C);let F=E.shape;const U=E.holes;if(!nu.isClockWise(F)){F=F.reverse();for(let Ue=0,Pe=U.length;Ue<Pe;Ue++){const te=U[Ue];nu.isClockWise(te)&&(U[Ue]=te.reverse())}}const ie=nu.triangulateShape(F,U),Ce=F;for(let Ue=0,Pe=U.length;Ue<Pe;Ue++){const te=U[Ue];F=F.concat(te)}function Ge(Ue,Pe,te){return Pe||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ue.clone().addScaledVector(Pe,te)}const ye=F.length,pe=ie.length;function de(Ue,Pe,te){let Gt,Qe,ht;const Ct=Ue.x-Pe.x,Tt=Ue.y-Pe.y,Rt=te.x-Ue.x,$=te.y-Ue.y,J=Ct*Ct+Tt*Tt,fe=Ct*$-Tt*Rt;if(Math.abs(fe)>Number.EPSILON){const ze=Math.sqrt(J),et=Math.sqrt(Rt*Rt+$*$),_e=Pe.x-Tt/ze,At=Pe.y+Ct/ze,Zt=te.x-$/et,Xt=te.y+Rt/et,An=((Zt-_e)*$-(Xt-At)*Rt)/(Ct*$-Tt*Rt);Gt=_e+Ct*An-Ue.x,Qe=At+Tt*An-Ue.y;const j=Gt*Gt+Qe*Qe;if(j<=2)return new ut(Gt,Qe);ht=Math.sqrt(j/2)}else{let ze=!1;Ct>Number.EPSILON?Rt>Number.EPSILON&&(ze=!0):Ct<-Number.EPSILON?Rt<-Number.EPSILON&&(ze=!0):Math.sign(Tt)===Math.sign($)&&(ze=!0),ze?(Gt=-Tt,Qe=Ct,ht=Math.sqrt(J)):(Gt=Ct,Qe=Tt,ht=Math.sqrt(J/2))}return new ut(Gt/ht,Qe/ht)}const Oe=[];for(let Ue=0,Pe=Ce.length,te=Pe-1,Gt=Ue+1;Ue<Pe;Ue++,te++,Gt++)te===Pe&&(te=0),Gt===Pe&&(Gt=0),Oe[Ue]=de(Ce[Ue],Ce[te],Ce[Gt]);const We=[];let ke,$e=Oe.concat();for(let Ue=0,Pe=U.length;Ue<Pe;Ue++){const te=U[Ue];ke=[];for(let Gt=0,Qe=te.length,ht=Qe-1,Ct=Gt+1;Gt<Qe;Gt++,ht++,Ct++)ht===Qe&&(ht=0),Ct===Qe&&(Ct=0),ke[Gt]=de(te[Gt],te[ht],te[Ct]);We.push(ke),$e=$e.concat(ke)}for(let Ue=0;Ue<R;Ue++){const Pe=Ue/R,te=y*Math.cos(Pe*Math.PI/2),Gt=G*Math.sin(Pe*Math.PI/2)+w;for(let Qe=0,ht=Ce.length;Qe<ht;Qe++){const Ct=Ge(Ce[Qe],Oe[Qe],Gt);dt(Ct.x,Ct.y,-te)}for(let Qe=0,ht=U.length;Qe<ht;Qe++){const Ct=U[Qe];ke=We[Qe];for(let Tt=0,Rt=Ct.length;Tt<Rt;Tt++){const $=Ge(Ct[Tt],ke[Tt],Gt);dt($.x,$.y,-te)}}}const ot=G+w;for(let Ue=0;Ue<ye;Ue++){const Pe=m?Ge(F[Ue],$e[Ue],ot):F[Ue];N?(L.copy(K.normals[0]).multiplyScalar(Pe.x),T.copy(K.binormals[0]).multiplyScalar(Pe.y),k.copy(W[0]).add(L).add(T),dt(k.x,k.y,k.z)):dt(Pe.x,Pe.y,0)}for(let Ue=1;Ue<=A;Ue++)for(let Pe=0;Pe<ye;Pe++){const te=m?Ge(F[Pe],$e[Pe],ot):F[Pe];N?(L.copy(K.normals[Ue]).multiplyScalar(te.x),T.copy(K.binormals[Ue]).multiplyScalar(te.y),k.copy(W[Ue]).add(L).add(T),dt(k.x,k.y,k.z)):dt(te.x,te.y,p/A*Ue)}for(let Ue=R-1;Ue>=0;Ue--){const Pe=Ue/R,te=y*Math.cos(Pe*Math.PI/2),Gt=G*Math.sin(Pe*Math.PI/2)+w;for(let Qe=0,ht=Ce.length;Qe<ht;Qe++){const Ct=Ge(Ce[Qe],Oe[Qe],Gt);dt(Ct.x,Ct.y,p+te)}for(let Qe=0,ht=U.length;Qe<ht;Qe++){const Ct=U[Qe];ke=We[Qe];for(let Tt=0,Rt=Ct.length;Tt<Rt;Tt++){const $=Ge(Ct[Tt],ke[Tt],Gt);N?dt($.x,$.y+W[A-1].y,W[A-1].x+te):dt($.x,$.y,p+te)}}}Ne(),tt();function Ne(){const Ue=a.length/3;if(m){let Pe=0,te=ye*Pe;for(let Gt=0;Gt<pe;Gt++){const Qe=ie[Gt];yt(Qe[2]+te,Qe[1]+te,Qe[0]+te)}Pe=A+R*2,te=ye*Pe;for(let Gt=0;Gt<pe;Gt++){const Qe=ie[Gt];yt(Qe[0]+te,Qe[1]+te,Qe[2]+te)}}else{for(let Pe=0;Pe<pe;Pe++){const te=ie[Pe];yt(te[2],te[1],te[0])}for(let Pe=0;Pe<pe;Pe++){const te=ie[Pe];yt(te[0]+ye*A,te[1]+ye*A,te[2]+ye*A)}}n.addGroup(Ue,a.length/3-Ue,0)}function tt(){const Ue=a.length/3;let Pe=0;bt(Ce,Pe),Pe+=Ce.length;for(let te=0,Gt=U.length;te<Gt;te++){const Qe=U[te];bt(Qe,Pe),Pe+=Qe.length}n.addGroup(Ue,a.length/3-Ue,1)}function bt(Ue,Pe){let te=Ue.length;for(;--te>=0;){const Gt=te;let Qe=te-1;Qe<0&&(Qe=Ue.length-1);for(let ht=0,Ct=A+R*2;ht<Ct;ht++){const Tt=ye*ht,Rt=ye*(ht+1),$=Pe+Gt+Tt,J=Pe+Qe+Tt,fe=Pe+Qe+Rt,ze=Pe+Gt+Rt;zt($,J,fe,ze)}}}function dt(Ue,Pe,te){d.push(Ue),d.push(Pe),d.push(te)}function yt(Ue,Pe,te){Nt(Ue),Nt(Pe),Nt(te);const Gt=a.length/3,Qe=x.generateTopUV(n,a,Gt-3,Gt-2,Gt-1);Lt(Qe[0]),Lt(Qe[1]),Lt(Qe[2])}function zt(Ue,Pe,te,Gt){Nt(Ue),Nt(Pe),Nt(Gt),Nt(Pe),Nt(te),Nt(Gt);const Qe=a.length/3,ht=x.generateSideWallUV(n,a,Qe-6,Qe-3,Qe-2,Qe-1);Lt(ht[0]),Lt(ht[1]),Lt(ht[3]),Lt(ht[1]),Lt(ht[2]),Lt(ht[3])}function Nt(Ue){a.push(d[Ue*3+0]),a.push(d[Ue*3+1]),a.push(d[Ue*3+2])}function Lt(Ue){o.push(Ue.x),o.push(Ue.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return CQ(t,n,e)}static fromJSON(e,t){const n=[];for(let o=0,l=e.shapes.length;o<l;o++){const u=t[e.shapes[o]];n.push(u)}const a=e.options.extrudePath;return a!==void 0&&(e.options.extrudePath=new cw[a.type]().fromJSON(a)),new zw(n,e.options)}}const dQ={generateTopUV:function(s,e,t,n,a){const o=e[t*3],l=e[t*3+1],u=e[n*3],d=e[n*3+1],C=e[a*3],A=e[a*3+1];return[new ut(o,l),new ut(u,d),new ut(C,A)]},generateSideWallUV:function(s,e,t,n,a,o){const l=e[t*3],u=e[t*3+1],d=e[t*3+2],C=e[n*3],A=e[n*3+1],p=e[n*3+2],m=e[a*3],y=e[a*3+1],G=e[a*3+2],w=e[o*3],R=e[o*3+1],Z=e[o*3+2];return Math.abs(u-A)<Math.abs(l-C)?[new ut(l,1-d),new ut(C,1-p),new ut(m,1-G),new ut(w,1-Z)]:[new ut(u,1-d),new ut(A,1-p),new ut(y,1-G),new ut(R,1-Z)]}};function CQ(s,e,t){if(t.shapes=[],Array.isArray(s))for(let n=0,a=s.length;n<a;n++){const o=s[n];t.shapes.push(o.uuid)}else t.shapes.push(s.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class _w extends uC{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,a=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(a,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _w(e.radius,e.detail)}}class MG extends uC{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],a=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,a,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new MG(e.radius,e.detail)}}class Dw extends Ln{constructor(e=.5,t=1,n=32,a=1,o=0,l=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:a,thetaStart:o,thetaLength:l},n=Math.max(3,n),a=Math.max(1,a);const u=[],d=[],C=[],A=[];let p=e;const m=(t-e)/a,y=new q,G=new ut;for(let w=0;w<=a;w++){for(let R=0;R<=n;R++){const Z=o+R/n*l;y.x=p*Math.cos(Z),y.y=p*Math.sin(Z),d.push(y.x,y.y,y.z),C.push(0,0,1),G.x=(y.x/t+1)/2,G.y=(y.y/t+1)/2,A.push(G.x,G.y)}p+=m}for(let w=0;w<a;w++){const R=w*(n+1);for(let Z=0;Z<n;Z++){const x=Z+R,W=x,N=x+n+1,K=x+n+2,T=x+1;u.push(W,N,T),u.push(N,K,T)}}this.setIndex(u),this.setAttribute("position",new hn(d,3)),this.setAttribute("normal",new hn(C,3)),this.setAttribute("uv",new hn(A,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dw(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class kw extends Ln{constructor(e=new LA([new ut(0,.5),new ut(-.5,-.5),new ut(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],a=[],o=[],l=[];let u=0,d=0;if(Array.isArray(e)===!1)C(e);else for(let A=0;A<e.length;A++)C(e[A]),this.addGroup(u,d,A),u+=d,d=0;this.setIndex(n),this.setAttribute("position",new hn(a,3)),this.setAttribute("normal",new hn(o,3)),this.setAttribute("uv",new hn(l,2));function C(A){const p=a.length/3,m=A.extractPoints(t);let y=m.shape;const G=m.holes;nu.isClockWise(y)===!1&&(y=y.reverse());for(let R=0,Z=G.length;R<Z;R++){const x=G[R];nu.isClockWise(x)===!0&&(G[R]=x.reverse())}const w=nu.triangulateShape(y,G);for(let R=0,Z=G.length;R<Z;R++){const x=G[R];y=y.concat(x)}for(let R=0,Z=y.length;R<Z;R++){const x=y[R];a.push(x.x,x.y,0),o.push(0,0,1),l.push(x.x,x.y)}for(let R=0,Z=w.length;R<Z;R++){const x=w[R],W=x[0]+p,N=x[1]+p,K=x[2]+p;n.push(W,N,K),d+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return hQ(t,e)}static fromJSON(e,t){const n=[];for(let a=0,o=e.shapes.length;a<o;a++){const l=t[e.shapes[a]];n.push(l)}return new kw(n,e.curveSegments)}}function hQ(s,e){if(e.shapes=[],Array.isArray(s))for(let t=0,n=s.length;t<n;t++){const a=s[t];e.shapes.push(a.uuid)}else e.shapes.push(s.uuid);return e}class NG extends Ln{constructor(e=1,t=32,n=16,a=0,o=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:a,phiLength:o,thetaStart:l,thetaLength:u},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const d=Math.min(l+u,Math.PI);let C=0;const A=[],p=new q,m=new q,y=[],G=[],w=[],R=[];for(let Z=0;Z<=n;Z++){const x=[],W=Z/n;let N=0;Z===0&&l===0?N=.5/t:Z===n&&d===Math.PI&&(N=-.5/t);for(let K=0;K<=t;K++){const T=K/t;p.x=-e*Math.cos(a+T*o)*Math.sin(l+W*u),p.y=e*Math.cos(l+W*u),p.z=e*Math.sin(a+T*o)*Math.sin(l+W*u),G.push(p.x,p.y,p.z),m.copy(p).normalize(),w.push(m.x,m.y,m.z),R.push(T+N,1-W),x.push(C++)}A.push(x)}for(let Z=0;Z<n;Z++)for(let x=0;x<t;x++){const W=A[Z][x+1],N=A[Z][x],K=A[Z+1][x],T=A[Z+1][x+1];(Z!==0||l>0)&&y.push(W,N,T),(Z!==n-1||d<Math.PI)&&y.push(N,K,T)}this.setIndex(y),this.setAttribute("position",new hn(G,3)),this.setAttribute("normal",new hn(w,3)),this.setAttribute("uv",new hn(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new NG(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Uw extends uC{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],a=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,a,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Uw(e.radius,e.detail)}}class Jw extends Ln{constructor(e=1,t=.4,n=12,a=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:a,arc:o},n=Math.floor(n),a=Math.floor(a);const l=[],u=[],d=[],C=[],A=new q,p=new q,m=new q;for(let y=0;y<=n;y++)for(let G=0;G<=a;G++){const w=G/a*o,R=y/n*Math.PI*2;p.x=(e+t*Math.cos(R))*Math.cos(w),p.y=(e+t*Math.cos(R))*Math.sin(w),p.z=t*Math.sin(R),u.push(p.x,p.y,p.z),A.x=e*Math.cos(w),A.y=e*Math.sin(w),m.subVectors(p,A).normalize(),d.push(m.x,m.y,m.z),C.push(G/a),C.push(y/n)}for(let y=1;y<=n;y++)for(let G=1;G<=a;G++){const w=(a+1)*y+G-1,R=(a+1)*(y-1)+G-1,Z=(a+1)*(y-1)+G,x=(a+1)*y+G;l.push(w,R,x),l.push(R,Z,x)}this.setIndex(l),this.setAttribute("position",new hn(u,3)),this.setAttribute("normal",new hn(d,3)),this.setAttribute("uv",new hn(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jw(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ow extends Ln{constructor(e=1,t=.4,n=64,a=8,o=2,l=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:a,p:o,q:l},n=Math.floor(n),a=Math.floor(a);const u=[],d=[],C=[],A=[],p=new q,m=new q,y=new q,G=new q,w=new q,R=new q,Z=new q;for(let W=0;W<=n;++W){const N=W/n*o*Math.PI*2;x(N,o,l,e,y),x(N+.01,o,l,e,G),R.subVectors(G,y),Z.addVectors(G,y),w.crossVectors(R,Z),Z.crossVectors(w,R),w.normalize(),Z.normalize();for(let K=0;K<=a;++K){const T=K/a*Math.PI*2,L=-t*Math.cos(T),k=t*Math.sin(T);p.x=y.x+(L*Z.x+k*w.x),p.y=y.y+(L*Z.y+k*w.y),p.z=y.z+(L*Z.z+k*w.z),d.push(p.x,p.y,p.z),m.subVectors(p,y).normalize(),C.push(m.x,m.y,m.z),A.push(W/n),A.push(K/a)}}for(let W=1;W<=n;W++)for(let N=1;N<=a;N++){const K=(a+1)*(W-1)+(N-1),T=(a+1)*W+(N-1),L=(a+1)*W+N,k=(a+1)*(W-1)+N;u.push(K,T,k),u.push(T,L,k)}this.setIndex(u),this.setAttribute("position",new hn(d,3)),this.setAttribute("normal",new hn(C,3)),this.setAttribute("uv",new hn(A,2));function x(W,N,K,T,L){const k=Math.cos(W),E=Math.sin(W),F=K/N*W,U=Math.cos(F);L.x=T*(2+U)*.5*k,L.y=T*(2+U)*E*.5,L.z=T*Math.sin(F)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ow(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Pw extends Ln{constructor(e=new RH(new q(-1,-1,0),new q(-1,1,0),new q(1,1,0)),t=64,n=1,a=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:a,closed:o};const l=e.computeFrenetFrames(t,o);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;const u=new q,d=new q,C=new ut;let A=new q;const p=[],m=[],y=[],G=[];w(),this.setIndex(G),this.setAttribute("position",new hn(p,3)),this.setAttribute("normal",new hn(m,3)),this.setAttribute("uv",new hn(y,2));function w(){for(let W=0;W<t;W++)R(W);R(o===!1?t:0),x(),Z()}function R(W){A=e.getPointAt(W/t,A);const N=l.normals[W],K=l.binormals[W];for(let T=0;T<=a;T++){const L=T/a*Math.PI*2,k=Math.sin(L),E=-Math.cos(L);d.x=E*N.x+k*K.x,d.y=E*N.y+k*K.y,d.z=E*N.z+k*K.z,d.normalize(),m.push(d.x,d.y,d.z),u.x=A.x+n*d.x,u.y=A.y+n*d.y,u.z=A.z+n*d.z,p.push(u.x,u.y,u.z)}}function Z(){for(let W=1;W<=t;W++)for(let N=1;N<=a;N++){const K=(a+1)*(W-1)+(N-1),T=(a+1)*W+(N-1),L=(a+1)*W+N,k=(a+1)*(W-1)+N;G.push(K,T,k),G.push(T,L,k)}}function x(){for(let W=0;W<=t;W++)for(let N=0;N<=a;N++)C.x=W/t,C.y=N/a,y.push(C.x,C.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Pw(new cw[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class wK extends Ln{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,a=new q,o=new q;if(e.index!==null){const l=e.attributes.position,u=e.index;let d=e.groups;d.length===0&&(d=[{start:0,count:u.count,materialIndex:0}]);for(let C=0,A=d.length;C<A;++C){const p=d[C],m=p.start,y=p.count;for(let G=m,w=m+y;G<w;G+=3)for(let R=0;R<3;R++){const Z=u.getX(G+R),x=u.getX(G+(R+1)%3);a.fromBufferAttribute(l,Z),o.fromBufferAttribute(l,x),mY(a,o,n)===!0&&(t.push(a.x,a.y,a.z),t.push(o.x,o.y,o.z))}}}else{const l=e.attributes.position;for(let u=0,d=l.count/3;u<d;u++)for(let C=0;C<3;C++){const A=3*u+C,p=3*u+(C+1)%3;a.fromBufferAttribute(l,A),o.fromBufferAttribute(l,p),mY(a,o,n)===!0&&(t.push(a.x,a.y,a.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new hn(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function mY(s,e,t){const n=`${s.x},${s.y},${s.z}-${e.x},${e.y},${e.z}`,a=`${e.x},${e.y},${e.z}-${s.x},${s.y},${s.z}`;return t.has(n)===!0||t.has(a)===!0?!1:(t.add(n),t.add(a),!0)}var bY=Object.freeze({__proto__:null,BoxGeometry:$A,CapsuleGeometry:Yw,CircleGeometry:Tw,ConeGeometry:Ew,CylinderGeometry:pb,DodecahedronGeometry:Kw,EdgesGeometry:BK,ExtrudeGeometry:zw,IcosahedronGeometry:_w,LatheGeometry:VG,OctahedronGeometry:MG,PlaneGeometry:Ab,PolyhedronGeometry:uC,RingGeometry:Dw,ShapeGeometry:kw,SphereGeometry:NG,TetrahedronGeometry:Uw,TorusGeometry:Jw,TorusKnotGeometry:Ow,TubeGeometry:Pw,WireframeGeometry:wK});class xK extends Zr{static get type(){return"ShadowMaterial"}constructor(e){super(),this.isShadowMaterial=!0,this.color=new $t(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class WK extends _c{static get type(){return"RawShaderMaterial"}constructor(e){super(e),this.isRawShaderMaterial=!0}}class HG extends Zr{static get type(){return"MeshStandardMaterial"}constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new $t(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gC,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hs,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zl extends HG{static get type(){return"MeshPhysicalMaterial"}constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ut(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return La(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new $t(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new $t(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new $t(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class VK extends Zr{static get type(){return"MeshPhongMaterial"}constructor(e){super(),this.isMeshPhongMaterial=!0,this.color=new $t(16777215),this.specular=new $t(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gC,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hs,this.combine=GG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MK extends Zr{static get type(){return"MeshToonMaterial"}constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.color=new $t(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gC,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class NK extends Zr{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gC,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class HK extends Zr{static get type(){return"MeshLambertMaterial"}constructor(e){super(),this.isMeshLambertMaterial=!0,this.color=new $t(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gC,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hs,this.combine=GG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class XK extends Zr{static get type(){return"MeshMatcapMaterial"}constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.color=new $t(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gC,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class FK extends Eo{static get type(){return"LineDashedMaterial"}constructor(e){super(),this.isLineDashedMaterial=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function NA(s,e,t){return!s||!t&&s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function YK(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function TK(s){function e(a,o){return s[a]-s[o]}const t=s.length,n=new Array(t);for(let a=0;a!==t;++a)n[a]=a;return n.sort(e),n}function wN(s,e,t){const n=s.length,a=new s.constructor(n);for(let o=0,l=0;l!==n;++o){const u=t[o]*e;for(let d=0;d!==e;++d)a[l++]=s[u+d]}return a}function xH(s,e,t,n){let a=1,o=s[0];for(;o!==void 0&&o[n]===void 0;)o=s[a++];if(o===void 0)return;let l=o[n];if(l!==void 0)if(Array.isArray(l))do l=o[n],l!==void 0&&(e.push(o.time),t.push.apply(t,l)),o=s[a++];while(o!==void 0);else if(l.toArray!==void 0)do l=o[n],l!==void 0&&(e.push(o.time),l.toArray(t,t.length)),o=s[a++];while(o!==void 0);else do l=o[n],l!==void 0&&(e.push(o.time),t.push(l)),o=s[a++];while(o!==void 0)}function AQ(s,e,t,n,a=30){const o=s.clone();o.name=e;const l=[];for(let d=0;d<o.tracks.length;++d){const C=o.tracks[d],A=C.getValueSize(),p=[],m=[];for(let y=0;y<C.times.length;++y){const G=C.times[y]*a;if(!(G<t||G>=n)){p.push(C.times[y]);for(let w=0;w<A;++w)m.push(C.values[y*A+w])}}p.length!==0&&(C.times=NA(p,C.times.constructor),C.values=NA(m,C.values.constructor),l.push(C))}o.tracks=l;let u=1/0;for(let d=0;d<o.tracks.length;++d)u>o.tracks[d].times[0]&&(u=o.tracks[d].times[0]);for(let d=0;d<o.tracks.length;++d)o.tracks[d].shift(-1*u);return o.resetDuration(),o}function fQ(s,e=0,t=s,n=30){n<=0&&(n=30);const a=t.tracks.length,o=e/n;for(let l=0;l<a;++l){const u=t.tracks[l],d=u.ValueTypeName;if(d==="bool"||d==="string")continue;const C=s.tracks.find(function(Z){return Z.name===u.name&&Z.ValueTypeName===d});if(C===void 0)continue;let A=0;const p=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(A=p/3);let m=0;const y=C.getValueSize();C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=y/3);const G=u.times.length-1;let w;if(o<=u.times[0]){const Z=A,x=p-A;w=u.values.slice(Z,x)}else if(o>=u.times[G]){const Z=G*p+A,x=Z+p-A;w=u.values.slice(Z,x)}else{const Z=u.createInterpolant(),x=A,W=p-A;Z.evaluate(o),w=Z.resultBuffer.slice(x,W)}d==="quaternion"&&new Ir().fromArray(w).normalize().conjugate().toArray(w);const R=C.times.length;for(let Z=0;Z<R;++Z){const x=Z*y+m;if(d==="quaternion")Ir.multiplyQuaternionsFlat(C.values,x,w,0,C.values,x);else{const W=y-m*2;for(let N=0;N<W;++N)C.values[x+N]-=w[N]}}}return s.blendMode=oH,s}const pQ={convertArray:NA,isTypedArray:YK,getKeyframeOrder:TK,sortedArray:wN,flattenJSON:xH,subclip:AQ,makeClipAdditive:fQ};class mb{constructor(e,t,n,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=a!==void 0?a:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,a=t[n],o=t[n-1];e:{t:{let l;n:{i:if(!(e<a)){for(let u=n+2;;){if(a===void 0){if(e<o)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===u)break;if(o=a,a=t[++n],e<a)break t}l=t.length;break n}if(!(e>=o)){const u=t[1];e<u&&(n=2,o=u);for(let d=n-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===d)break;if(a=o,o=t[--n-1],e>=o)break t}l=n,n=0;break n}break e}for(;n<l;){const u=n+l>>>1;e<t[u]?l=u:n=u+1}if(a=t[n],o=t[n-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(a===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,o,a)}return this.interpolate_(n,o,e,a)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=e*a;for(let l=0;l!==a;++l)t[l]=n[o+l];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class EK extends mb{constructor(e,t,n,a){super(e,t,n,a),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:WA,endingEnd:WA}}intervalChanged_(e,t,n){const a=this.parameterPositions;let o=e-2,l=e+1,u=a[o],d=a[l];if(u===void 0)switch(this.getSettings_().endingStart){case VA:o=e,u=2*t-n;break;case dG:o=a.length-2,u=t+a[o]-a[o+1];break;default:o=e,u=n}if(d===void 0)switch(this.getSettings_().endingEnd){case VA:l=e,d=2*n-t;break;case dG:l=1,d=n+a[1]-a[0];break;default:l=e-1,d=t}const C=(n-t)*.5,A=this.valueSize;this._weightPrev=C/(t-u),this._weightNext=C/(d-n),this._offsetPrev=o*A,this._offsetNext=l*A}interpolate_(e,t,n,a){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=e*u,C=d-u,A=this._offsetPrev,p=this._offsetNext,m=this._weightPrev,y=this._weightNext,G=(n-t)/(a-t),w=G*G,R=w*G,Z=-m*R+2*m*w-m*G,x=(1+m)*R+(-1.5-2*m)*w+(-.5+m)*G+1,W=(-1-y)*R+(1.5+y)*w+.5*G,N=y*R-y*w;for(let K=0;K!==u;++K)o[K]=Z*l[A+K]+x*l[C+K]+W*l[d+K]+N*l[p+K];return o}}class WH extends mb{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e,t,n,a){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=e*u,C=d-u,A=(n-t)/(a-t),p=1-A;for(let m=0;m!==u;++m)o[m]=l[C+m]*p+l[d+m]*A;return o}}class KK extends mb{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e){return this.copySampleValue_(e-1)}}class Uc{constructor(e,t,n,a){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=NA(t,this.TimeBufferType),this.values=NA(n,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:NA(e.times,Array),values:NA(e.values,Array)};const a=e.getInterpolation();a!==e.DefaultInterpolation&&(n.interpolation=a)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new KK(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new WH(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new EK(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case sb:t=this.InterpolantFactoryMethodDiscrete;break;case lb:t=this.InterpolantFactoryMethodLinear;break;case bR:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return sb;case this.InterpolantFactoryMethodLinear:return lb;case this.InterpolantFactoryMethodSmooth:return bR}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,a=t.length;n!==a;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,a=t.length;n!==a;++n)t[n]*=e}return this}trim(e,t){const n=this.times,a=n.length;let o=0,l=a-1;for(;o!==a&&n[o]<e;)++o;for(;l!==-1&&n[l]>t;)--l;if(++l,o!==0||l!==a){o>=l&&(l=Math.max(l,1),o=l-1);const u=this.getValueSize();this.times=n.slice(o,l),this.values=this.values.slice(o*u,l*u)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,a=this.values,o=n.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let u=0;u!==o;u++){const d=n[u];if(typeof d=="number"&&isNaN(d)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,u,d),e=!1;break}if(l!==null&&l>d){console.error("THREE.KeyframeTrack: Out of order keys.",this,u,d,l),e=!1;break}l=d}if(a!==void 0&&YK(a))for(let u=0,d=a.length;u!==d;++u){const C=a[u];if(isNaN(C)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,C),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),a=this.getInterpolation()===bR,o=e.length-1;let l=1;for(let u=1;u<o;++u){let d=!1;const C=e[u],A=e[u+1];if(C!==A&&(u!==1||C!==e[0]))if(a)d=!0;else{const p=u*n,m=p-n,y=p+n;for(let G=0;G!==n;++G){const w=t[p+G];if(w!==t[m+G]||w!==t[y+G]){d=!0;break}}}if(d){if(u!==l){e[l]=e[u];const p=u*n,m=l*n;for(let y=0;y!==n;++y)t[m+y]=t[p+y]}++l}}if(o>0){e[l]=e[o];for(let u=o*n,d=l*n,C=0;C!==n;++C)t[d+C]=t[u+C];++l}return l!==e.length?(this.times=e.slice(0,l),this.values=t.slice(0,l*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,a=new n(this.name,e,t);return a.createInterpolant=this.createInterpolant,a}}Uc.prototype.TimeBufferType=Float32Array;Uc.prototype.ValueBufferType=Float32Array;Uc.prototype.DefaultInterpolation=lb;class ef extends Uc{constructor(e,t,n){super(e,t,n)}}ef.prototype.ValueTypeName="bool";ef.prototype.ValueBufferType=Array;ef.prototype.DefaultInterpolation=sb;ef.prototype.InterpolantFactoryMethodLinear=void 0;ef.prototype.InterpolantFactoryMethodSmooth=void 0;class VH extends Uc{}VH.prototype.ValueTypeName="color";class OA extends Uc{}OA.prototype.ValueTypeName="number";class LK extends mb{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e,t,n,a){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=(n-t)/(a-t);let C=e*u;for(let A=C+u;C!==A;C+=4)Ir.slerpFlat(o,0,l,C-u,l,C,d);return o}}class PA extends Uc{InterpolantFactoryMethodLinear(e){return new LK(this.times,this.values,this.getValueSize(),e)}}PA.prototype.ValueTypeName="quaternion";PA.prototype.InterpolantFactoryMethodSmooth=void 0;class tf extends Uc{constructor(e,t,n){super(e,t,n)}}tf.prototype.ValueTypeName="string";tf.prototype.ValueBufferType=Array;tf.prototype.DefaultInterpolation=sb;tf.prototype.InterpolantFactoryMethodLinear=void 0;tf.prototype.InterpolantFactoryMethodSmooth=void 0;class QA extends Uc{}QA.prototype.ValueTypeName="vector";class ub{constructor(e="",t=-1,n=[],a=ww){this.name=e,this.tracks=n,this.duration=t,this.blendMode=a,this.uuid=hl(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,a=1/(e.fps||1);for(let l=0,u=n.length;l!==u;++l)t.push(bQ(n[l]).scale(a));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],n=e.tracks,a={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,l=n.length;o!==l;++o)t.push(Uc.toJSON(n[o]));return a}static CreateFromMorphTargetSequence(e,t,n,a){const o=t.length,l=[];for(let u=0;u<o;u++){let d=[],C=[];d.push((u+o-1)%o,u,(u+1)%o),C.push(0,1,0);const A=TK(d);d=wN(d,1,A),C=wN(C,1,A),!a&&d[0]===0&&(d.push(o),C.push(C[0])),l.push(new OA(".morphTargetInfluences["+t[u].name+"]",d,C).scale(1/n))}return new this(e,-1,l)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const a=e;n=a.geometry&&a.geometry.animations||a.animations}for(let a=0;a<n.length;a++)if(n[a].name===t)return n[a];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const a={},o=/^([\w-]*?)([\d]+)$/;for(let u=0,d=e.length;u<d;u++){const C=e[u],A=C.name.match(o);if(A&&A.length>1){const p=A[1];let m=a[p];m||(a[p]=m=[]),m.push(C)}}const l=[];for(const u in a)l.push(this.CreateFromMorphTargetSequence(u,a[u],t,n));return l}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(p,m,y,G,w){if(y.length!==0){const R=[],Z=[];xH(y,R,Z,G),R.length!==0&&w.push(new p(m,R,Z))}},a=[],o=e.name||"default",l=e.fps||30,u=e.blendMode;let d=e.length||-1;const C=e.hierarchy||[];for(let p=0;p<C.length;p++){const m=C[p].keys;if(!(!m||m.length===0))if(m[0].morphTargets){const y={};let G;for(G=0;G<m.length;G++)if(m[G].morphTargets)for(let w=0;w<m[G].morphTargets.length;w++)y[m[G].morphTargets[w]]=-1;for(const w in y){const R=[],Z=[];for(let x=0;x!==m[G].morphTargets.length;++x){const W=m[G];R.push(W.time),Z.push(W.morphTarget===w?1:0)}a.push(new OA(".morphTargetInfluence["+w+"]",R,Z))}d=y.length*l}else{const y=".bones["+t[p].name+"]";n(QA,y+".position",m,"pos",a),n(PA,y+".quaternion",m,"rot",a),n(QA,y+".scale",m,"scl",a)}}return a.length===0?null:new this(o,d,a,u)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,a=e.length;n!==a;++n){const o=this.tracks[n];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function mQ(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return OA;case"vector":case"vector2":case"vector3":case"vector4":return QA;case"color":return VH;case"quaternion":return PA;case"bool":case"boolean":return ef;case"string":return tf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function bQ(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=mQ(s.type);if(s.times===void 0){const t=[],n=[];xH(s.keys,t,n,"value"),s.times=t,s.values=n}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const BI={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class MH{constructor(e,t,n){const a=this;let o=!1,l=0,u=0,d;const C=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(A){u++,o===!1&&a.onStart!==void 0&&a.onStart(A,l,u),o=!0},this.itemEnd=function(A){l++,a.onProgress!==void 0&&a.onProgress(A,l,u),l===u&&(o=!1,a.onLoad!==void 0&&a.onLoad())},this.itemError=function(A){a.onError!==void 0&&a.onError(A)},this.resolveURL=function(A){return d?d(A):A},this.setURLModifier=function(A){return d=A,this},this.addHandler=function(A,p){return C.push(A,p),this},this.removeHandler=function(A){const p=C.indexOf(A);return p!==-1&&C.splice(p,2),this},this.getHandler=function(A){for(let p=0,m=C.length;p<m;p+=2){const y=C[p],G=C[p+1];if(y.global&&(y.lastIndex=0),y.test(A))return G}return null}}}const zK=new MH;let Ko=class{constructor(e){this.manager=e!==void 0?e:zK,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(a,o){n.load(e,a,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};Ko.DEFAULT_MATERIAL_NAME="__DEFAULT";const pI={};class vQ extends Error{constructor(e,t){super(e),this.response=t}}class Al extends Ko{constructor(e){super(e)}load(e,t,n,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=BI.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(pI[e]!==void 0){pI[e].push({onLoad:t,onProgress:n,onError:a});return}pI[e]=[],pI[e].push({onLoad:t,onProgress:n,onError:a});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),u=this.mimeType,d=this.responseType;fetch(l).then(C=>{if(C.status===200||C.status===0){if(C.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||C.body===void 0||C.body.getReader===void 0)return C;const A=pI[e],p=C.body.getReader(),m=C.headers.get("X-File-Size")||C.headers.get("Content-Length"),y=m?parseInt(m):0,G=y!==0;let w=0;const R=new ReadableStream({start(Z){x();function x(){p.read().then(({done:W,value:N})=>{if(W)Z.close();else{w+=N.byteLength;const K=new ProgressEvent("progress",{lengthComputable:G,loaded:w,total:y});for(let T=0,L=A.length;T<L;T++){const k=A[T];k.onProgress&&k.onProgress(K)}Z.enqueue(N),x()}},W=>{Z.error(W)})}}});return new Response(R)}else throw new vQ(`fetch for "${C.url}" responded with ${C.status}: ${C.statusText}`,C)}).then(C=>{switch(d){case"arraybuffer":return C.arrayBuffer();case"blob":return C.blob();case"document":return C.text().then(A=>new DOMParser().parseFromString(A,u));case"json":return C.json();default:if(u===void 0)return C.text();{const p=/charset="?([^;"\s]*)"?/i.exec(u),m=p&&p[1]?p[1].toLowerCase():void 0,y=new TextDecoder(m);return C.arrayBuffer().then(G=>y.decode(G))}}}).then(C=>{BI.add(e,C);const A=pI[e];delete pI[e];for(let p=0,m=A.length;p<m;p++){const y=A[p];y.onLoad&&y.onLoad(C)}}).catch(C=>{const A=pI[e];if(A===void 0)throw this.manager.itemError(e),C;delete pI[e];for(let p=0,m=A.length;p<m;p++){const y=A[p];y.onError&&y.onError(C)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class yQ extends Ko{constructor(e){super(e)}load(e,t,n,a){const o=this,l=new Al(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{t(o.parse(JSON.parse(u)))}catch(d){a?a(d):console.error(d),o.manager.itemError(e)}},n,a)}parse(e){const t=[];for(let n=0;n<e.length;n++){const a=ub.parse(e[n]);t.push(a)}return t}}class GQ extends Ko{constructor(e){super(e)}load(e,t,n,a){const o=this,l=[],u=new Xw,d=new Al(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(o.withCredentials);let C=0;function A(p){d.load(e[p],function(m){const y=o.parse(m,!0);l[p]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},C+=1,C===6&&(y.mipmapCount===1&&(u.minFilter=er),u.image=l,u.format=y.format,u.needsUpdate=!0,t&&t(u))},n,a)}if(Array.isArray(e))for(let p=0,m=e.length;p<m;++p)A(p);else d.load(e,function(p){const m=o.parse(p,!0);if(m.isCubemap){const y=m.mipmaps.length/m.mipmapCount;for(let G=0;G<y;G++){l[G]={mipmaps:[]};for(let w=0;w<m.mipmapCount;w++)l[G].mipmaps.push(m.mipmaps[G*m.mipmapCount+w]),l[G].format=m.format,l[G].width=m.width,l[G].height=m.height}u.image=l}else u.image.width=m.width,u.image.height=m.height,u.mipmaps=m.mipmaps;m.mipmapCount===1&&(u.minFilter=er),u.format=m.format,u.needsUpdate=!0,t&&t(u)},n,a);return u}}class vG extends Ko{constructor(e){super(e)}load(e,t,n,a){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=BI.get(e);if(l!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l;const u=AG("img");function d(){A(),BI.add(e,this),t&&t(this),o.manager.itemEnd(e)}function C(p){A(),a&&a(p),o.manager.itemError(e),o.manager.itemEnd(e)}function A(){u.removeEventListener("load",d,!1),u.removeEventListener("error",C,!1)}return u.addEventListener("load",d,!1),u.addEventListener("error",C,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(u.crossOrigin=this.crossOrigin),o.manager.itemStart(e),u.src=e,u}}class BQ extends Ko{constructor(e){super(e)}load(e,t,n,a){const o=new RG;o.colorSpace=Vs;const l=new vG(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);let u=0;function d(C){l.load(e[C],function(A){o.images[C]=A,u++,u===6&&(o.needsUpdate=!0,t&&t(o))},void 0,a)}for(let C=0;C<e.length;++C)d(C);return o}}class ZQ extends Ko{constructor(e){super(e)}load(e,t,n,a){const o=this,l=new tu,u=new Al(this.manager);return u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setPath(this.path),u.setWithCredentials(o.withCredentials),u.load(e,function(d){let C;try{C=o.parse(d)}catch(A){if(a!==void 0)a(A);else{console.error(A);return}}C.image!==void 0?l.image=C.image:C.data!==void 0&&(l.image.width=C.width,l.image.height=C.height,l.image.data=C.data),l.wrapS=C.wrapS!==void 0?C.wrapS:dl,l.wrapT=C.wrapT!==void 0?C.wrapT:dl,l.magFilter=C.magFilter!==void 0?C.magFilter:er,l.minFilter=C.minFilter!==void 0?C.minFilter:er,l.anisotropy=C.anisotropy!==void 0?C.anisotropy:1,C.colorSpace!==void 0&&(l.colorSpace=C.colorSpace),C.flipY!==void 0&&(l.flipY=C.flipY),C.format!==void 0&&(l.format=C.format),C.type!==void 0&&(l.type=C.type),C.mipmaps!==void 0&&(l.mipmaps=C.mipmaps,l.minFilter=Ll),C.mipmapCount===1&&(l.minFilter=er),C.generateMipmaps!==void 0&&(l.generateMipmaps=C.generateMipmaps),l.needsUpdate=!0,t&&t(l,C)},n,a),l}}class _K extends Ko{constructor(e){super(e)}load(e,t,n,a){const o=new fa,l=new vG(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(u){o.image=u,o.needsUpdate=!0,t!==void 0&&t(o)},n,a),o}}class IC extends gi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new $t(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class DK extends IC{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(gi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new $t(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const EM=new Sn,vY=new q,yY=new q;class NH{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ut(512,512),this.map=null,this.mapPass=null,this.matrix=new Sn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new wG,this._frameExtents=new ut(1,1),this._viewportCount=1,this._viewports=[new Si(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;vY.setFromMatrixPosition(e.matrixWorld),t.position.copy(vY),yY.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(yY),t.updateMatrixWorld(),EM.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(EM),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(EM)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SQ extends NH{constructor(){super(new Aa(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=cb*2*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(n!==t.fov||a!==t.aspect||o!==t.far)&&(t.fov=n,t.aspect=a,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class HH extends IC{constructor(e,t,n=0,a=Math.PI/3,o=0,l=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(gi.DEFAULT_UP),this.updateMatrix(),this.target=new gi,this.distance=n,this.angle=a,this.penumbra=o,this.decay=l,this.map=null,this.shadow=new SQ}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const GY=new Sn,D0=new q,KM=new q;class RQ extends NH{constructor(){super(new Aa(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ut(4,2),this._viewportCount=6,this._viewports=[new Si(2,1,1,1),new Si(0,1,1,1),new Si(3,1,1,1),new Si(1,1,1,1),new Si(3,0,1,1),new Si(1,0,1,1)],this._cubeDirections=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],this._cubeUps=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,a=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),D0.setFromMatrixPosition(e.matrixWorld),n.position.copy(D0),KM.copy(n.position),KM.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(KM),n.updateMatrixWorld(),a.makeTranslation(-D0.x,-D0.y,-D0.z),GY.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(GY)}}class XH extends IC{constructor(e,t,n=0,a=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=a,this.shadow=new RQ}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class wQ extends NH{constructor(){super(new Kc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class FH extends IC{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(gi.DEFAULT_UP),this.updateMatrix(),this.target=new gi,this.shadow=new wQ}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class kK extends IC{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class UK extends IC{constructor(e,t,n=10,a=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=a}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class JK{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new q)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,a=e.y,o=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.282095),t.addScaledVector(l[1],.488603*a),t.addScaledVector(l[2],.488603*o),t.addScaledVector(l[3],.488603*n),t.addScaledVector(l[4],1.092548*(n*a)),t.addScaledVector(l[5],1.092548*(a*o)),t.addScaledVector(l[6],.315392*(3*o*o-1)),t.addScaledVector(l[7],1.092548*(n*o)),t.addScaledVector(l[8],.546274*(n*n-a*a)),t}getIrradianceAt(e,t){const n=e.x,a=e.y,o=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.886227),t.addScaledVector(l[1],2*.511664*a),t.addScaledVector(l[2],2*.511664*o),t.addScaledVector(l[3],2*.511664*n),t.addScaledVector(l[4],2*.429043*n*a),t.addScaledVector(l[5],2*.429043*a*o),t.addScaledVector(l[6],.743125*o*o-.247708),t.addScaledVector(l[7],2*.429043*n*o),t.addScaledVector(l[8],.429043*(n*n-a*a)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let a=0;a<9;a++)n[a].fromArray(e,t+a*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let a=0;a<9;a++)n[a].toArray(e,t+a*3);return e}static getBasisAt(e,t){const n=e.x,a=e.y,o=e.z;t[0]=.282095,t[1]=.488603*a,t[2]=.488603*o,t[3]=.488603*n,t[4]=1.092548*n*a,t[5]=1.092548*a*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*n*o,t[8]=.546274*(n*n-a*a)}}class OK extends IC{constructor(e=new JK,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Qw extends Ko{constructor(e){super(e),this.textures={}}load(e,t,n,a){const o=this,l=new Al(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(u){try{t(o.parse(JSON.parse(u)))}catch(d){a?a(d):console.error(d),o.manager.itemError(e)}},n,a)}parse(e){const t=this.textures;function n(o){return t[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),t[o]}const a=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(a.uuid=e.uuid),e.name!==void 0&&(a.name=e.name),e.color!==void 0&&a.color!==void 0&&a.color.setHex(e.color),e.roughness!==void 0&&(a.roughness=e.roughness),e.metalness!==void 0&&(a.metalness=e.metalness),e.sheen!==void 0&&(a.sheen=e.sheen),e.sheenColor!==void 0&&(a.sheenColor=new $t().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(a.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&a.emissive!==void 0&&a.emissive.setHex(e.emissive),e.specular!==void 0&&a.specular!==void 0&&a.specular.setHex(e.specular),e.specularIntensity!==void 0&&(a.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&a.specularColor!==void 0&&a.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(a.shininess=e.shininess),e.clearcoat!==void 0&&(a.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(a.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(a.dispersion=e.dispersion),e.iridescence!==void 0&&(a.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(a.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(a.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(a.transmission=e.transmission),e.thickness!==void 0&&(a.thickness=e.thickness),e.attenuationDistance!==void 0&&(a.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&a.attenuationColor!==void 0&&a.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(a.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(a.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(a.fog=e.fog),e.flatShading!==void 0&&(a.flatShading=e.flatShading),e.blending!==void 0&&(a.blending=e.blending),e.combine!==void 0&&(a.combine=e.combine),e.side!==void 0&&(a.side=e.side),e.shadowSide!==void 0&&(a.shadowSide=e.shadowSide),e.opacity!==void 0&&(a.opacity=e.opacity),e.transparent!==void 0&&(a.transparent=e.transparent),e.alphaTest!==void 0&&(a.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(a.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(a.depthFunc=e.depthFunc),e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(a.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(a.blendSrc=e.blendSrc),e.blendDst!==void 0&&(a.blendDst=e.blendDst),e.blendEquation!==void 0&&(a.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(a.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(a.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(a.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&a.blendColor!==void 0&&a.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(a.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(a.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(a.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(a.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(a.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(a.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(a.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(a.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(a.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(a.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(a.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(a.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(a.rotation=e.rotation),e.linewidth!==void 0&&(a.linewidth=e.linewidth),e.dashSize!==void 0&&(a.dashSize=e.dashSize),e.gapSize!==void 0&&(a.gapSize=e.gapSize),e.scale!==void 0&&(a.scale=e.scale),e.polygonOffset!==void 0&&(a.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(a.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(a.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(a.dithering=e.dithering),e.alphaToCoverage!==void 0&&(a.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(a.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(a.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(a.visible=e.visible),e.toneMapped!==void 0&&(a.toneMapped=e.toneMapped),e.userData!==void 0&&(a.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?a.vertexColors=e.vertexColors>0:a.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const l=e.uniforms[o];switch(a.uniforms[o]={},l.type){case"t":a.uniforms[o].value=n(l.value);break;case"c":a.uniforms[o].value=new $t().setHex(l.value);break;case"v2":a.uniforms[o].value=new ut().fromArray(l.value);break;case"v3":a.uniforms[o].value=new q().fromArray(l.value);break;case"v4":a.uniforms[o].value=new Si().fromArray(l.value);break;case"m3":a.uniforms[o].value=new kn().fromArray(l.value);break;case"m4":a.uniforms[o].value=new Sn().fromArray(l.value);break;default:a.uniforms[o].value=l.value}}if(e.defines!==void 0&&(a.defines=e.defines),e.vertexShader!==void 0&&(a.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(a.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(a.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)a.extensions[o]=e.extensions[o];if(e.lights!==void 0&&(a.lights=e.lights),e.clipping!==void 0&&(a.clipping=e.clipping),e.size!==void 0&&(a.size=e.size),e.sizeAttenuation!==void 0&&(a.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(a.map=n(e.map)),e.matcap!==void 0&&(a.matcap=n(e.matcap)),e.alphaMap!==void 0&&(a.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(a.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(a.bumpScale=e.bumpScale),e.normalMap!==void 0&&(a.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(a.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),a.normalScale=new ut().fromArray(o)}return e.displacementMap!==void 0&&(a.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(a.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(a.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(a.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(a.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(a.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(a.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(a.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(a.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(a.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(a.envMap=n(e.envMap)),e.envMapRotation!==void 0&&a.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(a.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(a.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(a.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(a.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(a.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(a.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(a.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(a.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(a.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(a.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(a.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(a.clearcoatNormalScale=new ut().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(a.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(a.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(a.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(a.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(a.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(a.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(a.sheenRoughnessMap=n(e.sheenRoughnessMap)),a}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return Qw.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:xK,SpriteMaterial:mH,RawShaderMaterial:WK,ShaderMaterial:_c,PointsMaterial:Hw,MeshPhysicalMaterial:zl,MeshStandardMaterial:HG,MeshPhongMaterial:VK,MeshToonMaterial:MK,MeshNormalMaterial:NK,MeshLambertMaterial:HK,MeshDepthMaterial:AH,MeshDistanceMaterial:fH,MeshBasicMaterial:Cl,MeshMatcapMaterial:XK,LineDashedMaterial:FK,LineBasicMaterial:Eo,Material:Zr};return new t[e]}}class oC{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class PK extends Ln{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class QK extends Ko{constructor(e){super(e)}load(e,t,n,a){const o=this,l=new Al(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(u){try{t(o.parse(JSON.parse(u)))}catch(d){a?a(d):console.error(d),o.manager.itemError(e)}},n,a)}parse(e){const t={},n={};function a(y,G){if(t[G]!==void 0)return t[G];const R=y.interleavedBuffers[G],Z=o(y,R.buffer),x=jm(R.type,Z),W=new xG(x,R.stride);return W.uuid=R.uuid,t[G]=W,W}function o(y,G){if(n[G]!==void 0)return n[G];const R=y.arrayBuffers[G],Z=new Uint32Array(R).buffer;return n[G]=Z,Z}const l=e.isInstancedBufferGeometry?new PK:new Ln,u=e.data.index;if(u!==void 0){const y=jm(u.type,u.array);l.setIndex(new Ri(y,1))}const d=e.data.attributes;for(const y in d){const G=d[y];let w;if(G.isInterleavedBufferAttribute){const R=a(e.data,G.data);w=new cC(R,G.itemSize,G.offset,G.normalized)}else{const R=jm(G.type,G.array),Z=G.isInstancedBufferAttribute?UA:Ri;w=new Z(R,G.itemSize,G.normalized)}G.name!==void 0&&(w.name=G.name),G.usage!==void 0&&w.setUsage(G.usage),l.setAttribute(y,w)}const C=e.data.morphAttributes;if(C)for(const y in C){const G=C[y],w=[];for(let R=0,Z=G.length;R<Z;R++){const x=G[R];let W;if(x.isInterleavedBufferAttribute){const N=a(e.data,x.data);W=new cC(N,x.itemSize,x.offset,x.normalized)}else{const N=jm(x.type,x.array);W=new Ri(N,x.itemSize,x.normalized)}x.name!==void 0&&(W.name=x.name),w.push(W)}l.morphAttributes[y]=w}e.data.morphTargetsRelative&&(l.morphTargetsRelative=!0);const p=e.data.groups||e.data.drawcalls||e.data.offsets;if(p!==void 0)for(let y=0,G=p.length;y!==G;++y){const w=p[y];l.addGroup(w.start,w.count,w.materialIndex)}const m=e.data.boundingSphere;if(m!==void 0){const y=new q;m.center!==void 0&&y.fromArray(m.center),l.boundingSphere=new Ao(y,m.radius)}return e.name&&(l.name=e.name),e.userData&&(l.userData=e.userData),l}}class xQ extends Ko{constructor(e){super(e)}load(e,t,n,a){const o=this,l=this.path===""?oC.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||l;const u=new Al(this.manager);u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){let C=null;try{C=JSON.parse(d)}catch(p){a!==void 0&&a(p),console.error("THREE:ObjectLoader: Can't parse "+e+".",p.message);return}const A=C.metadata;if(A===void 0||A.type===void 0||A.type.toLowerCase()==="geometry"){a!==void 0&&a(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(C,t)},n,a)}async loadAsync(e,t){const n=this,a=this.path===""?oC.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new Al(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const l=await o.loadAsync(e,t),u=JSON.parse(l),d=u.metadata;if(d===void 0||d.type===void 0||d.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(u)}parse(e,t){const n=this.parseAnimations(e.animations),a=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,a),l=this.parseImages(e.images,function(){t!==void 0&&t(C)}),u=this.parseTextures(e.textures,l),d=this.parseMaterials(e.materials,u),C=this.parseObject(e.object,o,d,u,n),A=this.parseSkeletons(e.skeletons,C);if(this.bindSkeletons(C,A),this.bindLightTargets(C),t!==void 0){let p=!1;for(const m in l)if(l[m].data instanceof HTMLImageElement){p=!0;break}p===!1&&t(C)}return C}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,n),o=await this.parseImagesAsync(e.images),l=this.parseTextures(e.textures,o),u=this.parseMaterials(e.materials,l),d=this.parseObject(e.object,a,u,l,t),C=this.parseSkeletons(e.skeletons,d);return this.bindSkeletons(d,C),this.bindLightTargets(d),d}parseShapes(e){const t={};if(e!==void 0)for(let n=0,a=e.length;n<a;n++){const o=new LA().fromJSON(e[n]);t[o.uuid]=o}return t}parseSkeletons(e,t){const n={},a={};if(t.traverse(function(o){o.isBone&&(a[o.uuid]=o)}),e!==void 0)for(let o=0,l=e.length;o<l;o++){const u=new WG().fromJSON(e[o],a);n[u.uuid]=u}return n}parseGeometries(e,t){const n={};if(e!==void 0){const a=new QK;for(let o=0,l=e.length;o<l;o++){let u;const d=e[o];switch(d.type){case"BufferGeometry":case"InstancedBufferGeometry":u=a.parse(d);break;default:d.type in bY?u=bY[d.type].fromJSON(d,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${d.type}"`)}u.uuid=d.uuid,d.name!==void 0&&(u.name=d.name),d.userData!==void 0&&(u.userData=d.userData),n[d.uuid]=u}}return n}parseMaterials(e,t){const n={},a={};if(e!==void 0){const o=new Qw;o.setTextures(t);for(let l=0,u=e.length;l<u;l++){const d=e[l];n[d.uuid]===void 0&&(n[d.uuid]=o.parse(d)),a[d.uuid]=n[d.uuid]}}return a}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const a=e[n],o=ub.parse(a);t[o.uuid]=o}return t}parseImages(e,t){const n=this,a={};let o;function l(d){return n.manager.itemStart(d),o.load(d,function(){n.manager.itemEnd(d)},void 0,function(){n.manager.itemError(d),n.manager.itemEnd(d)})}function u(d){if(typeof d=="string"){const C=d,A=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(C)?C:n.resourcePath+C;return l(A)}else return d.data?{data:jm(d.type,d.data),width:d.width,height:d.height}:null}if(e!==void 0&&e.length>0){const d=new MH(t);o=new vG(d),o.setCrossOrigin(this.crossOrigin);for(let C=0,A=e.length;C<A;C++){const p=e[C],m=p.url;if(Array.isArray(m)){const y=[];for(let G=0,w=m.length;G<w;G++){const R=m[G],Z=u(R);Z!==null&&(Z instanceof HTMLImageElement?y.push(Z):y.push(new tu(Z.data,Z.width,Z.height)))}a[p.uuid]=new MA(y)}else{const y=u(p.url);a[p.uuid]=new MA(y)}}}return a}async parseImagesAsync(e){const t=this,n={};let a;async function o(l){if(typeof l=="string"){const u=l,d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:t.resourcePath+u;return await a.loadAsync(d)}else return l.data?{data:jm(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){a=new vG(this.manager),a.setCrossOrigin(this.crossOrigin);for(let l=0,u=e.length;l<u;l++){const d=e[l],C=d.url;if(Array.isArray(C)){const A=[];for(let p=0,m=C.length;p<m;p++){const y=C[p],G=await o(y);G!==null&&(G instanceof HTMLImageElement?A.push(G):A.push(new tu(G.data,G.width,G.height)))}n[d.uuid]=new MA(A)}else{const A=await o(d.url);n[d.uuid]=new MA(A)}}}return n}parseTextures(e,t){function n(o,l){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),l[o])}const a={};if(e!==void 0)for(let o=0,l=e.length;o<l;o++){const u=e[o];u.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',u.uuid),t[u.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",u.image);const d=t[u.image],C=d.data;let A;Array.isArray(C)?(A=new RG,C.length===6&&(A.needsUpdate=!0)):(C&&C.data?A=new tu:A=new fa,C&&(A.needsUpdate=!0)),A.source=d,A.uuid=u.uuid,u.name!==void 0&&(A.name=u.name),u.mapping!==void 0&&(A.mapping=n(u.mapping,WQ)),u.channel!==void 0&&(A.channel=u.channel),u.offset!==void 0&&A.offset.fromArray(u.offset),u.repeat!==void 0&&A.repeat.fromArray(u.repeat),u.center!==void 0&&A.center.fromArray(u.center),u.rotation!==void 0&&(A.rotation=u.rotation),u.wrap!==void 0&&(A.wrapS=n(u.wrap[0],BY),A.wrapT=n(u.wrap[1],BY)),u.format!==void 0&&(A.format=u.format),u.internalFormat!==void 0&&(A.internalFormat=u.internalFormat),u.type!==void 0&&(A.type=u.type),u.colorSpace!==void 0&&(A.colorSpace=u.colorSpace),u.minFilter!==void 0&&(A.minFilter=n(u.minFilter,ZY)),u.magFilter!==void 0&&(A.magFilter=n(u.magFilter,ZY)),u.anisotropy!==void 0&&(A.anisotropy=u.anisotropy),u.flipY!==void 0&&(A.flipY=u.flipY),u.generateMipmaps!==void 0&&(A.generateMipmaps=u.generateMipmaps),u.premultiplyAlpha!==void 0&&(A.premultiplyAlpha=u.premultiplyAlpha),u.unpackAlignment!==void 0&&(A.unpackAlignment=u.unpackAlignment),u.compareFunction!==void 0&&(A.compareFunction=u.compareFunction),u.userData!==void 0&&(A.userData=u.userData),a[u.uuid]=A}return a}parseObject(e,t,n,a,o){let l;function u(m){return t[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",m),t[m]}function d(m){if(m!==void 0){if(Array.isArray(m)){const y=[];for(let G=0,w=m.length;G<w;G++){const R=m[G];n[R]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",R),y.push(n[R])}return y}return n[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),n[m]}}function C(m){return a[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",m),a[m]}let A,p;switch(e.type){case"Scene":l=new pH,e.background!==void 0&&(Number.isInteger(e.background)?l.background=new $t(e.background):l.background=C(e.background)),e.environment!==void 0&&(l.environment=C(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?l.fog=new Mw(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(l.fog=new Vw(e.fog.color,e.fog.density)),e.fog.name!==""&&(l.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(l.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(l.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&l.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(l.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&l.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":l=new Aa(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(l.focus=e.focus),e.zoom!==void 0&&(l.zoom=e.zoom),e.filmGauge!==void 0&&(l.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(l.filmOffset=e.filmOffset),e.view!==void 0&&(l.view=Object.assign({},e.view));break;case"OrthographicCamera":l=new Kc(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(l.zoom=e.zoom),e.view!==void 0&&(l.view=Object.assign({},e.view));break;case"AmbientLight":l=new kK(e.color,e.intensity);break;case"DirectionalLight":l=new FH(e.color,e.intensity),l.target=e.target||"";break;case"PointLight":l=new XH(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":l=new UK(e.color,e.intensity,e.width,e.height);break;case"SpotLight":l=new HH(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),l.target=e.target||"";break;case"HemisphereLight":l=new DK(e.color,e.groundColor,e.intensity);break;case"LightProbe":l=new OK().fromJSON(e);break;case"SkinnedMesh":A=u(e.geometry),p=d(e.material),l=new bH(A,p),e.bindMode!==void 0&&(l.bindMode=e.bindMode),e.bindMatrix!==void 0&&l.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(l.skeleton=e.skeleton);break;case"Mesh":A=u(e.geometry),p=d(e.material),l=new tr(A,p);break;case"InstancedMesh":A=u(e.geometry),p=d(e.material);const m=e.count,y=e.instanceMatrix,G=e.instanceColor;l=new KA(A,p,m),l.instanceMatrix=new UA(new Float32Array(y.array),16),G!==void 0&&(l.instanceColor=new UA(new Float32Array(G.array),G.itemSize));break;case"BatchedMesh":A=u(e.geometry),p=d(e.material),l=new pK(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,p),l.geometry=A,l.perObjectFrustumCulled=e.perObjectFrustumCulled,l.sortObjects=e.sortObjects,l._drawRanges=e.drawRanges,l._reservedRanges=e.reservedRanges,l._visibility=e.visibility,l._active=e.active,l._bounds=e.bounds.map(w=>{const R=new ho;R.min.fromArray(w.boxMin),R.max.fromArray(w.boxMax);const Z=new Ao;return Z.radius=w.sphereRadius,Z.center.fromArray(w.sphereCenter),{boxInitialized:w.boxInitialized,box:R,sphereInitialized:w.sphereInitialized,sphere:Z}}),l._maxInstanceCount=e.maxInstanceCount,l._maxVertexCount=e.maxVertexCount,l._maxIndexCount=e.maxIndexCount,l._geometryInitialized=e.geometryInitialized,l._geometryCount=e.geometryCount,l._matricesTexture=C(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(l._colorsTexture=C(e.colorsTexture.uuid));break;case"LOD":l=new fK;break;case"Line":l=new MI(u(e.geometry),d(e.material));break;case"LineLoop":l=new vH(u(e.geometry),d(e.material));break;case"LineSegments":l=new Dc(u(e.geometry),d(e.material));break;case"PointCloud":case"Points":l=new yH(u(e.geometry),d(e.material));break;case"Sprite":l=new AK(d(e.material));break;case"Group":l=new GI;break;case"Bone":l=new Nw;break;default:l=new gi}if(l.uuid=e.uuid,e.name!==void 0&&(l.name=e.name),e.matrix!==void 0?(l.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(l.matrixAutoUpdate=e.matrixAutoUpdate),l.matrixAutoUpdate&&l.matrix.decompose(l.position,l.quaternion,l.scale)):(e.position!==void 0&&l.position.fromArray(e.position),e.rotation!==void 0&&l.rotation.fromArray(e.rotation),e.quaternion!==void 0&&l.quaternion.fromArray(e.quaternion),e.scale!==void 0&&l.scale.fromArray(e.scale)),e.up!==void 0&&l.up.fromArray(e.up),e.castShadow!==void 0&&(l.castShadow=e.castShadow),e.receiveShadow!==void 0&&(l.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(l.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(l.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(l.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(l.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&l.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(l.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(l.visible=e.visible),e.frustumCulled!==void 0&&(l.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(l.renderOrder=e.renderOrder),e.userData!==void 0&&(l.userData=e.userData),e.layers!==void 0&&(l.layers.mask=e.layers),e.children!==void 0){const m=e.children;for(let y=0;y<m.length;y++)l.add(this.parseObject(m[y],t,n,a,o))}if(e.animations!==void 0){const m=e.animations;for(let y=0;y<m.length;y++){const G=m[y];l.animations.push(o[G])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(l.autoUpdate=e.autoUpdate);const m=e.levels;for(let y=0;y<m.length;y++){const G=m[y],w=l.getObjectByProperty("uuid",G.object);w!==void 0&&l.addLevel(w,G.distance,G.hysteresis)}}return l}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const a=t[n.skeleton];a===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(a,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,a=e.getObjectByProperty("uuid",n);a!==void 0?t.target=a:t.target=new gi}})}}const WQ={UVMapping:bw,CubeReflectionMapping:WI,CubeRefractionMapping:sC,EquirectangularReflectionMapping:uG,EquirectangularRefractionMapping:IG,CubeUVReflectionMapping:Cb},BY={RepeatWrapping:lC,ClampToEdgeWrapping:dl,MirroredRepeatWrapping:rb},ZY={NearestFilter:_r,NearestMipmapNearestFilter:vw,NearestMipmapLinearFilter:xA,LinearFilter:er,LinearMipmapNearestFilter:tb,LinearMipmapLinearFilter:Ll};class jK extends Ko{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=BI.get(e);if(l!==void 0){if(o.manager.itemStart(e),l.then){l.then(C=>{t&&t(C),o.manager.itemEnd(e)}).catch(C=>{a&&a(C)});return}return setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l}const u={};u.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",u.headers=this.requestHeader;const d=fetch(e,u).then(function(C){return C.blob()}).then(function(C){return createImageBitmap(C,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(C){return BI.add(e,C),t&&t(C),o.manager.itemEnd(e),C}).catch(function(C){a&&a(C),BI.remove(e),o.manager.itemError(e),o.manager.itemEnd(e)});BI.add(e,d),o.manager.itemStart(e)}}let tR;class YH{static getContext(){return tR===void 0&&(tR=new(window.AudioContext||window.webkitAudioContext)),tR}static setContext(e){tR=e}}class VQ extends Ko{constructor(e){super(e)}load(e,t,n,a){const o=this,l=new Al(this.manager);l.setResponseType("arraybuffer"),l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(d){try{const C=d.slice(0);YH.getContext().decodeAudioData(C,function(p){t(p)}).catch(u)}catch(C){u(C)}},n,a);function u(d){a?a(d):console.error(d),o.manager.itemError(e)}}}const SY=new Sn,RY=new Sn,hA=new Sn;class MQ{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Aa,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Aa,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,hA.copy(e.projectionMatrix);const a=t.eyeSep/2,o=a*t.near/t.focus,l=t.near*Math.tan(TA*t.fov*.5)/t.zoom;let u,d;RY.elements[12]=-a,SY.elements[12]=a,u=-l*t.aspect+o,d=l*t.aspect+o,hA.elements[0]=2*t.near/(d-u),hA.elements[8]=(d+u)/(d-u),this.cameraL.projectionMatrix.copy(hA),u=-l*t.aspect-o,d=l*t.aspect-o,hA.elements[0]=2*t.near/(d-u),hA.elements[8]=(d+u)/(d-u),this.cameraR.projectionMatrix.copy(hA)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(RY),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(SY)}}class TH{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=wY(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=wY();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function wY(){return performance.now()}const AA=new q,xY=new Ir,NQ=new q,fA=new q;class HQ extends gi{constructor(){super(),this.type="AudioListener",this.context=YH.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new TH}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(AA,xY,NQ),fA.set(0,0,-1).applyQuaternion(xY),t.positionX){const a=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(AA.x,a),t.positionY.linearRampToValueAtTime(AA.y,a),t.positionZ.linearRampToValueAtTime(AA.z,a),t.forwardX.linearRampToValueAtTime(fA.x,a),t.forwardY.linearRampToValueAtTime(fA.y,a),t.forwardZ.linearRampToValueAtTime(fA.z,a),t.upX.linearRampToValueAtTime(n.x,a),t.upY.linearRampToValueAtTime(n.y,a),t.upZ.linearRampToValueAtTime(n.z,a)}else t.setPosition(AA.x,AA.y,AA.z),t.setOrientation(fA.x,fA.y,fA.z,n.x,n.y,n.z)}}class qK extends gi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const pA=new q,WY=new Ir,XQ=new q,mA=new q;class FQ extends qK{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(pA,WY,XQ),mA.set(0,0,1).applyQuaternion(WY);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(pA.x,n),t.positionY.linearRampToValueAtTime(pA.y,n),t.positionZ.linearRampToValueAtTime(pA.z,n),t.orientationX.linearRampToValueAtTime(mA.x,n),t.orientationY.linearRampToValueAtTime(mA.y,n),t.orientationZ.linearRampToValueAtTime(mA.z,n)}else t.setPosition(pA.x,pA.y,pA.z),t.setOrientation(mA.x,mA.y,mA.z)}}class YQ{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class $K{constructor(e,t,n){this.binding=e,this.valueSize=n;let a,o,l;switch(t){case"quaternion":a=this._slerp,o=this._slerpAdditive,l=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":a=this._select,o=this._select,l=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:a=this._lerp,o=this._lerpAdditive,l=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=o,this._setIdentity=l,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,a=this.valueSize,o=e*a+a;let l=this.cumulativeWeight;if(l===0){for(let u=0;u!==a;++u)n[o+u]=n[u];l=t}else{l+=t;const u=t/l;this._mixBufferRegion(n,o,0,u,a)}this.cumulativeWeight=l}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,a=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,a,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,a=e*t+t,o=this.cumulativeWeight,l=this.cumulativeWeightAdditive,u=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const d=t*this._origIndex;this._mixBufferRegion(n,a,d,1-o,t)}l>0&&this._mixBufferRegionAdditive(n,a,this._addIndex*t,1,t);for(let d=t,C=t+t;d!==C;++d)if(n[d]!==n[d+t]){u.setValue(n,a);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,a=n*this._origIndex;e.getValue(t,a);for(let o=n,l=a;o!==l;++o)t[o]=t[a+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,a,o){if(a>=.5)for(let l=0;l!==o;++l)e[t+l]=e[n+l]}_slerp(e,t,n,a){Ir.slerpFlat(e,t,e,t,e,n,a)}_slerpAdditive(e,t,n,a,o){const l=this._workIndex*o;Ir.multiplyQuaternionsFlat(e,l,e,t,e,n),Ir.slerpFlat(e,t,e,t,e,l,a)}_lerp(e,t,n,a,o){const l=1-a;for(let u=0;u!==o;++u){const d=t+u;e[d]=e[d]*l+e[n+u]*a}}_lerpAdditive(e,t,n,a,o){for(let l=0;l!==o;++l){const u=t+l;e[u]=e[u]+e[n+l]*a}}}const EH="\\[\\]\\.:\\/",TQ=new RegExp("["+EH+"]","g"),KH="[^"+EH+"]",EQ="[^"+EH.replace("\\.","")+"]",KQ=/((?:WC+[\/:])*)/.source.replace("WC",KH),LQ=/(WCOD+)?/.source.replace("WCOD",EQ),zQ=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",KH),_Q=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",KH),DQ=new RegExp("^"+KQ+LQ+zQ+_Q+"$"),kQ=["material","materials","bones","map"];class UQ{constructor(e,t,n){const a=n||Bi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,a)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,a=this._bindings[n];a!==void 0&&a.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let a=this._targetGroup.nCachedObjects_,o=n.length;a!==o;++a)n[a].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Bi{constructor(e,t,n){this.path=t,this.parsedPath=n||Bi.parseTrackName(t),this.node=Bi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Bi.Composite(e,t,n):new Bi(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(TQ,"")}static parseTrackName(e){const t=DQ.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},a=n.nodeName&&n.nodeName.lastIndexOf(".");if(a!==void 0&&a!==-1){const o=n.nodeName.substring(a+1);kQ.indexOf(o)!==-1&&(n.nodeName=n.nodeName.substring(0,a),n.objectName=o)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(o){for(let l=0;l<o.length;l++){const u=o[l];if(u.name===t||u.uuid===t)return u;const d=n(u.children);if(d)return d}return null},a=n(e.children);if(a)return a}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)e[t++]=n[a]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,a=t.propertyName;let o=t.propertyIndex;if(e||(e=Bi.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let C=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let A=0;A<e.length;A++)if(e[A].name===C){C=A;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(C!==void 0){if(e[C]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[C]}}const l=e[a];if(l===void 0){const C=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+C+"."+a+" but it wasn't found.",e);return}let u=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?u=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(u=this.Versioning.MatrixWorldNeedsUpdate);let d=this.BindingType.Direct;if(o!==void 0){if(a==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}d=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=o}else l.fromArray!==void 0&&l.toArray!==void 0?(d=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(d=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=a;this.getValue=this.GetterByBindingType[d],this.setValue=this.SetterByBindingTypeAndVersioning[d][u]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Bi.Composite=UQ;Bi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Bi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Bi.prototype.GetterByBindingType=[Bi.prototype._getValue_direct,Bi.prototype._getValue_array,Bi.prototype._getValue_arrayElement,Bi.prototype._getValue_toArray];Bi.prototype.SetterByBindingTypeAndVersioning=[[Bi.prototype._setValue_direct,Bi.prototype._setValue_direct_setNeedsUpdate,Bi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Bi.prototype._setValue_array,Bi.prototype._setValue_array_setNeedsUpdate,Bi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Bi.prototype._setValue_arrayElement,Bi.prototype._setValue_arrayElement_setNeedsUpdate,Bi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Bi.prototype._setValue_fromArray,Bi.prototype._setValue_fromArray_setNeedsUpdate,Bi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class JQ{constructor(){this.isAnimationObjectGroup=!0,this.uuid=hl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,a=arguments.length;n!==a;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,l=o.length;let u,d=e.length,C=this.nCachedObjects_;for(let A=0,p=arguments.length;A!==p;++A){const m=arguments[A],y=m.uuid;let G=t[y];if(G===void 0){G=d++,t[y]=G,e.push(m);for(let w=0,R=l;w!==R;++w)o[w].push(new Bi(m,n[w],a[w]))}else if(G<C){u=e[G];const w=--C,R=e[w];t[R.uuid]=G,e[G]=R,t[y]=w,e[w]=m;for(let Z=0,x=l;Z!==x;++Z){const W=o[Z],N=W[w];let K=W[G];W[G]=N,K===void 0&&(K=new Bi(m,n[Z],a[Z])),W[w]=K}}else e[G]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=C}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,a=n.length;let o=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const d=arguments[l],C=d.uuid,A=t[C];if(A!==void 0&&A>=o){const p=o++,m=e[p];t[m.uuid]=A,e[A]=m,t[C]=p,e[p]=d;for(let y=0,G=a;y!==G;++y){const w=n[y],R=w[p],Z=w[A];w[A]=R,w[p]=Z}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,a=n.length;let o=this.nCachedObjects_,l=e.length;for(let u=0,d=arguments.length;u!==d;++u){const C=arguments[u],A=C.uuid,p=t[A];if(p!==void 0)if(delete t[A],p<o){const m=--o,y=e[m],G=--l,w=e[G];t[y.uuid]=p,e[p]=y,t[w.uuid]=m,e[m]=w,e.pop();for(let R=0,Z=a;R!==Z;++R){const x=n[R],W=x[m],N=x[G];x[p]=W,x[m]=N,x.pop()}}else{const m=--l,y=e[m];m>0&&(t[y.uuid]=p),e[p]=y,e.pop();for(let G=0,w=a;G!==w;++G){const R=n[G];R[p]=R[m],R.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const n=this._bindingsIndicesByPath;let a=n[e];const o=this._bindings;if(a!==void 0)return o[a];const l=this._paths,u=this._parsedPaths,d=this._objects,C=d.length,A=this.nCachedObjects_,p=new Array(C);a=o.length,n[e]=a,l.push(e),u.push(t),o.push(p);for(let m=A,y=d.length;m!==y;++m){const G=d[m];p[m]=new Bi(G,e,t)}return p}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const a=this._paths,o=this._parsedPaths,l=this._bindings,u=l.length-1,d=l[u],C=e[u];t[C]=n,l[n]=d,l.pop(),o[n]=o[u],o.pop(),a[n]=a[u],a.pop()}}}class e9{constructor(e,t,n=null,a=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=a;const o=t.tracks,l=o.length,u=new Array(l),d={endingStart:WA,endingEnd:WA};for(let C=0;C!==l;++C){const A=o[C].createInterpolant(null);u[C]=A,A.settings=d}this._interpolantSettings=d,this._interpolants=u,this._propertyBindings=new Array(l),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=TE,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const a=this._clip.duration,o=e._clip.duration,l=o/a,u=a/o;e.warp(1,l,t),this.warp(u,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const a=this._mixer,o=a.time,l=this.timeScale;let u=this._timeScaleInterpolant;u===null&&(u=a._lendControlInterpolant(),this._timeScaleInterpolant=u);const d=u.parameterPositions,C=u.sampleValues;return d[0]=o,d[1]=o+n,C[0]=e/l,C[1]=t/l,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,a){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const d=(e-o)*n;d<0||n===0?t=0:(this._startTime=null,t=n*d)}t*=this._updateTimeScale(e);const l=this._updateTime(t),u=this._updateWeight(e);if(u>0){const d=this._interpolants,C=this._propertyBindings;switch(this.blendMode){case oH:for(let A=0,p=d.length;A!==p;++A)d[A].evaluate(l),C[A].accumulateAdditive(u);break;case ww:default:for(let A=0,p=d.length;A!==p;++A)d[A].evaluate(l),C[A].accumulate(a,u)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const a=n.evaluate(e)[0];t*=a,e>n.parameterPositions[1]&&(this.stopFading(),a===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const a=n.evaluate(e)[0];t*=a,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let a=this.time+e,o=this._loopCount;const l=n===EE;if(e===0)return o===-1?a:l&&(o&1)===1?t-a:a;if(n===YE){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=t)a=t;else if(a<0)a=0;else{this.time=a;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,l)):this._setEndings(this.repetitions===0,!0,l)),a>=t||a<0){const u=Math.floor(a/t);a-=t*u,o+=Math.abs(u);const d=this.repetitions-o;if(d<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a=e>0?t:0,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(d===1){const C=e<0;this._setEndings(C,!C,l)}else this._setEndings(!1,!1,l);this._loopCount=o,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:u})}}else this.time=a;if(l&&(o&1)===1)return t-a}return a}_setEndings(e,t,n){const a=this._interpolantSettings;n?(a.endingStart=VA,a.endingEnd=VA):(e?a.endingStart=this.zeroSlopeAtStart?VA:WA:a.endingStart=dG,t?a.endingEnd=this.zeroSlopeAtEnd?VA:WA:a.endingEnd=dG)}_scheduleFading(e,t,n){const a=this._mixer,o=a.time;let l=this._weightInterpolant;l===null&&(l=a._lendControlInterpolant(),this._weightInterpolant=l);const u=l.parameterPositions,d=l.sampleValues;return u[0]=o,d[0]=t,u[1]=o+e,d[1]=n,this}}const OQ=new Float32Array(1);class PQ extends au{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,a=e._clip.tracks,o=a.length,l=e._propertyBindings,u=e._interpolants,d=n.uuid,C=this._bindingsByRootAndName;let A=C[d];A===void 0&&(A={},C[d]=A);for(let p=0;p!==o;++p){const m=a[p],y=m.name;let G=A[y];if(G!==void 0)++G.referenceCount,l[p]=G;else{if(G=l[p],G!==void 0){G._cacheIndex===null&&(++G.referenceCount,this._addInactiveBinding(G,d,y));continue}const w=t&&t._propertyBindings[p].binding.parsedPath;G=new $K(Bi.create(n,y,w),m.ValueTypeName,m.getValueSize()),++G.referenceCount,this._addInactiveBinding(G,d,y),l[p]=G}u[p].resultBuffer=G.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,a=e._clip.uuid,o=this._actionsByClip[a];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,a,n)}const t=e._propertyBindings;for(let n=0,a=t.length;n!==a;++n){const o=t[n];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,a=t.length;n!==a;++n){const o=t[n];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const a=this._actions,o=this._actionsByClip;let l=o[t];if(l===void 0)l={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=l;else{const u=l.knownActions;e._byClipCacheIndex=u.length,u.push(e)}e._cacheIndex=a.length,a.push(e),l.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],a=e._cacheIndex;n._cacheIndex=a,t[a]=n,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,l=this._actionsByClip,u=l[o],d=u.knownActions,C=d[d.length-1],A=e._byClipCacheIndex;C._byClipCacheIndex=A,d[A]=C,d.pop(),e._byClipCacheIndex=null;const p=u.actionByRoot,m=(e._localRoot||this._root).uuid;delete p[m],d.length===0&&delete l[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,a=t.length;n!==a;++n){const o=t[n];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,a=this._nActiveActions++,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,a=--this._nActiveActions,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_addInactiveBinding(e,t,n){const a=this._bindingsByRootAndName,o=this._bindings;let l=a[t];l===void 0&&(l={},a[t]=l),l[n]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,a=n.rootNode.uuid,o=n.path,l=this._bindingsByRootAndName,u=l[a],d=t[t.length-1],C=e._cacheIndex;d._cacheIndex=C,t[C]=d,t.pop(),delete u[o],Object.keys(u).length===0&&delete l[a]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,a=this._nActiveBindings++,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,a=--this._nActiveBindings,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new WH(new Float32Array(2),new Float32Array(2),1,OQ),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,a=--this._nActiveControlInterpolants,o=t[a];e.__cacheIndex=a,t[a]=e,o.__cacheIndex=n,t[n]=o}clipAction(e,t,n){const a=t||this._root,o=a.uuid;let l=typeof e=="string"?ub.findByName(a,e):e;const u=l!==null?l.uuid:e,d=this._actionsByClip[u];let C=null;if(n===void 0&&(l!==null?n=l.blendMode:n=ww),d!==void 0){const p=d.actionByRoot[o];if(p!==void 0&&p.blendMode===n)return p;C=d.knownActions[0],l===null&&(l=C._clip)}if(l===null)return null;const A=new e9(this,l,t,n);return this._bindAction(A,C),this._addInactiveAction(A,u,o),A}existingAction(e,t){const n=t||this._root,a=n.uuid,o=typeof e=="string"?ub.findByName(n,e):e,l=o?o.uuid:e,u=this._actionsByClip[l];return u!==void 0&&u.actionByRoot[a]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,a=this.time+=e,o=Math.sign(e),l=this._accuIndex^=1;for(let C=0;C!==n;++C)t[C]._update(a,e,o,l);const u=this._bindings,d=this._nActiveBindings;for(let C=0;C!==d;++C)u[C].apply(l);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,a=this._actionsByClip,o=a[n];if(o!==void 0){const l=o.knownActions;for(let u=0,d=l.length;u!==d;++u){const C=l[u];this._deactivateAction(C);const A=C._cacheIndex,p=t[t.length-1];C._cacheIndex=null,C._byClipCacheIndex=null,p._cacheIndex=A,t[A]=p,t.pop(),this._removeInactiveBindingsForAction(C)}delete a[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const l in n){const u=n[l].actionByRoot,d=u[t];d!==void 0&&(this._deactivateAction(d),this._removeInactiveAction(d))}const a=this._bindingsByRootAndName,o=a[t];if(o!==void 0)for(const l in o){const u=o[l];u.restoreOriginalState(),this._removeInactiveBinding(u)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class LH{constructor(e){this.value=e}clone(){return new LH(this.value.clone===void 0?this.value:this.value.clone())}}let QQ=0;class jQ extends au{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:QQ++}),this.name="",this.usage=CG,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,a=t.length;n<a;n++){const o=Array.isArray(t[n])?t[n]:[t[n]];for(let l=0;l<o.length;l++)this.uniforms.push(o[l].clone())}return this}clone(){return new this.constructor().copy(this)}}class qQ extends xG{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class $Q{constructor(e,t,n,a,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=a,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const VY=new Sn;class t9{constructor(e,t,n=0,a=1/0){this.ray=new qA(e,t),this.near=n,this.far=a,this.camera=null,this.layers=new EA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return VY.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(VY),this}intersectObject(e,t=!0,n=[]){return xN(e,this,n,t),n.sort(MY),n}intersectObjects(e,t=!0,n=[]){for(let a=0,o=e.length;a<o;a++)xN(e[a],this,n,t);return n.sort(MY),n}}function MY(s,e){return s.distance-e.distance}function xN(s,e,t,n){let a=!0;if(s.layers.test(e.layers)&&s.raycast(e,t)===!1&&(a=!1),a===!0&&n===!0){const o=s.children;for(let l=0,u=o.length;l<u;l++)xN(o[l],e,t,!0)}}class WN{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(La(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ej{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class zH{constructor(e,t,n,a){zH.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,a)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,a){const o=this.elements;return o[0]=e,o[2]=t,o[1]=n,o[3]=a,this}}const NY=new ut;class tj{constructor(e=new ut(1/0,1/0),t=new ut(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=NY.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,NY).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const HY=new q,nR=new q;class nj{constructor(e=new q,t=new q){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){HY.subVectors(e,this.start),nR.subVectors(this.end,this.start);const n=nR.dot(nR);let o=nR.dot(HY)/n;return t&&(o=La(o,0,1)),o}closestPointToPoint(e,t,n){const a=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(a).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const XY=new q;class ij extends gi{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Ln,a=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let l=0,u=1,d=32;l<d;l++,u++){const C=l/d*Math.PI*2,A=u/d*Math.PI*2;a.push(Math.cos(C),Math.sin(C),1,Math.cos(A),Math.sin(A),1)}n.setAttribute("position",new hn(a,3));const o=new Eo({fog:!1,toneMapped:!1});this.cone=new Dc(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),XY.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(XY),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const iC=new q,iR=new Sn,LM=new Sn;class aj extends Dc{constructor(e){const t=n9(e),n=new Ln,a=[],o=[],l=new $t(0,0,1),u=new $t(0,1,0);for(let C=0;C<t.length;C++){const A=t[C];A.parent&&A.parent.isBone&&(a.push(0,0,0),a.push(0,0,0),o.push(l.r,l.g,l.b),o.push(u.r,u.g,u.b))}n.setAttribute("position",new hn(a,3)),n.setAttribute("color",new hn(o,3));const d=new Eo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,d),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,a=n.getAttribute("position");LM.copy(this.root.matrixWorld).invert();for(let o=0,l=0;o<t.length;o++){const u=t[o];u.parent&&u.parent.isBone&&(iR.multiplyMatrices(LM,u.matrixWorld),iC.setFromMatrixPosition(iR),a.setXYZ(l,iC.x,iC.y,iC.z),iR.multiplyMatrices(LM,u.parent.matrixWorld),iC.setFromMatrixPosition(iR),a.setXYZ(l+1,iC.x,iC.y,iC.z),l+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function n9(s){const e=[];s.isBone===!0&&e.push(s);for(let t=0;t<s.children.length;t++)e.push.apply(e,n9(s.children[t]));return e}class rj extends tr{constructor(e,t,n){const a=new NG(t,4,2),o=new Cl({wireframe:!0,fog:!1,toneMapped:!1});super(a,o),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const oj=new q,FY=new $t,YY=new $t;class sj extends gi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const a=new MG(t);a.rotateY(Math.PI*.5),this.material=new Cl({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=a.getAttribute("position"),l=new Float32Array(o.count*3);a.setAttribute("color",new Ri(l,3)),this.add(new tr(a,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");FY.copy(this.light.color),YY.copy(this.light.groundColor);for(let n=0,a=t.count;n<a;n++){const o=n<a/2?FY:YY;t.setXYZ(n,o.r,o.g,o.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(oj.setFromMatrixPosition(this.light.matrixWorld).negate())}}class lj extends Dc{constructor(e=10,t=10,n=4473924,a=8947848){n=new $t(n),a=new $t(a);const o=t/2,l=e/t,u=e/2,d=[],C=[];for(let m=0,y=0,G=-u;m<=t;m++,G+=l){d.push(-u,0,G,u,0,G),d.push(G,0,-u,G,0,u);const w=m===o?n:a;w.toArray(C,y),y+=3,w.toArray(C,y),y+=3,w.toArray(C,y),y+=3,w.toArray(C,y),y+=3}const A=new Ln;A.setAttribute("position",new hn(d,3)),A.setAttribute("color",new hn(C,3));const p=new Eo({vertexColors:!0,toneMapped:!1});super(A,p),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class cj extends Dc{constructor(e=10,t=16,n=8,a=64,o=4473924,l=8947848){o=new $t(o),l=new $t(l);const u=[],d=[];if(t>1)for(let p=0;p<t;p++){const m=p/t*(Math.PI*2),y=Math.sin(m)*e,G=Math.cos(m)*e;u.push(0,0,0),u.push(y,0,G);const w=p&1?o:l;d.push(w.r,w.g,w.b),d.push(w.r,w.g,w.b)}for(let p=0;p<n;p++){const m=p&1?o:l,y=e-e/n*p;for(let G=0;G<a;G++){let w=G/a*(Math.PI*2),R=Math.sin(w)*y,Z=Math.cos(w)*y;u.push(R,0,Z),d.push(m.r,m.g,m.b),w=(G+1)/a*(Math.PI*2),R=Math.sin(w)*y,Z=Math.cos(w)*y,u.push(R,0,Z),d.push(m.r,m.g,m.b)}}const C=new Ln;C.setAttribute("position",new hn(u,3)),C.setAttribute("color",new hn(d,3));const A=new Eo({vertexColors:!0,toneMapped:!1});super(C,A),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const TY=new q,aR=new q,EY=new q;class gj extends gi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let a=new Ln;a.setAttribute("position",new hn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new Eo({fog:!1,toneMapped:!1});this.lightPlane=new MI(a,o),this.add(this.lightPlane),a=new Ln,a.setAttribute("position",new hn([0,0,0,0,0,1],3)),this.targetLine=new MI(a,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),TY.setFromMatrixPosition(this.light.matrixWorld),aR.setFromMatrixPosition(this.light.target.matrixWorld),EY.subVectors(aR,TY),this.lightPlane.lookAt(aR),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(aR),this.targetLine.scale.z=EY.length()}}const rR=new q,Ka=new SG;class uj extends Dc{constructor(e){const t=new Ln,n=new Eo({color:16777215,vertexColors:!0,toneMapped:!1}),a=[],o=[],l={};u("n1","n2"),u("n2","n4"),u("n4","n3"),u("n3","n1"),u("f1","f2"),u("f2","f4"),u("f4","f3"),u("f3","f1"),u("n1","f1"),u("n2","f2"),u("n3","f3"),u("n4","f4"),u("p","n1"),u("p","n2"),u("p","n3"),u("p","n4"),u("u1","u2"),u("u2","u3"),u("u3","u1"),u("c","t"),u("p","c"),u("cn1","cn2"),u("cn3","cn4"),u("cf1","cf2"),u("cf3","cf4");function u(G,w){d(G),d(w)}function d(G){a.push(0,0,0),o.push(0,0,0),l[G]===void 0&&(l[G]=[]),l[G].push(a.length/3-1)}t.setAttribute("position",new hn(a,3)),t.setAttribute("color",new hn(o,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=l,this.update();const C=new $t(16755200),A=new $t(16711680),p=new $t(43775),m=new $t(16777215),y=new $t(3355443);this.setColors(C,A,p,m,y)}setColors(e,t,n,a,o){const u=this.geometry.getAttribute("color");u.setXYZ(0,e.r,e.g,e.b),u.setXYZ(1,e.r,e.g,e.b),u.setXYZ(2,e.r,e.g,e.b),u.setXYZ(3,e.r,e.g,e.b),u.setXYZ(4,e.r,e.g,e.b),u.setXYZ(5,e.r,e.g,e.b),u.setXYZ(6,e.r,e.g,e.b),u.setXYZ(7,e.r,e.g,e.b),u.setXYZ(8,e.r,e.g,e.b),u.setXYZ(9,e.r,e.g,e.b),u.setXYZ(10,e.r,e.g,e.b),u.setXYZ(11,e.r,e.g,e.b),u.setXYZ(12,e.r,e.g,e.b),u.setXYZ(13,e.r,e.g,e.b),u.setXYZ(14,e.r,e.g,e.b),u.setXYZ(15,e.r,e.g,e.b),u.setXYZ(16,e.r,e.g,e.b),u.setXYZ(17,e.r,e.g,e.b),u.setXYZ(18,e.r,e.g,e.b),u.setXYZ(19,e.r,e.g,e.b),u.setXYZ(20,e.r,e.g,e.b),u.setXYZ(21,e.r,e.g,e.b),u.setXYZ(22,e.r,e.g,e.b),u.setXYZ(23,e.r,e.g,e.b),u.setXYZ(24,t.r,t.g,t.b),u.setXYZ(25,t.r,t.g,t.b),u.setXYZ(26,t.r,t.g,t.b),u.setXYZ(27,t.r,t.g,t.b),u.setXYZ(28,t.r,t.g,t.b),u.setXYZ(29,t.r,t.g,t.b),u.setXYZ(30,t.r,t.g,t.b),u.setXYZ(31,t.r,t.g,t.b),u.setXYZ(32,n.r,n.g,n.b),u.setXYZ(33,n.r,n.g,n.b),u.setXYZ(34,n.r,n.g,n.b),u.setXYZ(35,n.r,n.g,n.b),u.setXYZ(36,n.r,n.g,n.b),u.setXYZ(37,n.r,n.g,n.b),u.setXYZ(38,a.r,a.g,a.b),u.setXYZ(39,a.r,a.g,a.b),u.setXYZ(40,o.r,o.g,o.b),u.setXYZ(41,o.r,o.g,o.b),u.setXYZ(42,o.r,o.g,o.b),u.setXYZ(43,o.r,o.g,o.b),u.setXYZ(44,o.r,o.g,o.b),u.setXYZ(45,o.r,o.g,o.b),u.setXYZ(46,o.r,o.g,o.b),u.setXYZ(47,o.r,o.g,o.b),u.setXYZ(48,o.r,o.g,o.b),u.setXYZ(49,o.r,o.g,o.b),u.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,a=1;Ka.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),$a("c",t,e,Ka,0,0,-1),$a("t",t,e,Ka,0,0,1),$a("n1",t,e,Ka,-n,-a,-1),$a("n2",t,e,Ka,n,-a,-1),$a("n3",t,e,Ka,-n,a,-1),$a("n4",t,e,Ka,n,a,-1),$a("f1",t,e,Ka,-n,-a,1),$a("f2",t,e,Ka,n,-a,1),$a("f3",t,e,Ka,-n,a,1),$a("f4",t,e,Ka,n,a,1),$a("u1",t,e,Ka,n*.7,a*1.1,-1),$a("u2",t,e,Ka,-n*.7,a*1.1,-1),$a("u3",t,e,Ka,0,a*2,-1),$a("cf1",t,e,Ka,-n,0,1),$a("cf2",t,e,Ka,n,0,1),$a("cf3",t,e,Ka,0,-a,1),$a("cf4",t,e,Ka,0,a,1),$a("cn1",t,e,Ka,-n,0,-1),$a("cn2",t,e,Ka,n,0,-1),$a("cn3",t,e,Ka,0,-a,-1),$a("cn4",t,e,Ka,0,a,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function $a(s,e,t,n,a,o,l){rR.set(a,o,l).unproject(n);const u=e[s];if(u!==void 0){const d=t.getAttribute("position");for(let C=0,A=u.length;C<A;C++)d.setXYZ(u[C],rR.x,rR.y,rR.z)}}const oR=new ho;class Ij extends Dc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new Float32Array(8*3),o=new Ln;o.setIndex(new Ri(n,1)),o.setAttribute("position",new Ri(a,3)),super(o,new Eo({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&oR.setFromObject(this.object),oR.isEmpty())return;const t=oR.min,n=oR.max,a=this.geometry.attributes.position,o=a.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=t.x,o[4]=n.y,o[5]=n.z,o[6]=t.x,o[7]=t.y,o[8]=n.z,o[9]=n.x,o[10]=t.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=t.z,o[15]=t.x,o[16]=n.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=n.x,o[22]=t.y,o[23]=t.z,a.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class dj extends Dc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new Ln;o.setIndex(new Ri(n,1)),o.setAttribute("position",new hn(a,3)),super(o,new Eo({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Cj extends MI{constructor(e,t=1,n=16776960){const a=n,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],l=new Ln;l.setAttribute("position",new hn(o,3)),l.computeBoundingSphere(),super(l,new Eo({color:a,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const u=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],d=new Ln;d.setAttribute("position",new hn(u,3)),d.computeBoundingSphere(),this.add(new tr(d,new Cl({color:a,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const KY=new q;let sR,zM;class hj extends gi{constructor(e=new q(0,0,1),t=new q(0,0,0),n=1,a=16776960,o=n*.2,l=o*.2){super(),this.type="ArrowHelper",sR===void 0&&(sR=new Ln,sR.setAttribute("position",new hn([0,0,0,0,1,0],3)),zM=new pb(0,.5,1,5,1),zM.translate(0,-.5,0)),this.position.copy(t),this.line=new MI(sR,new Eo({color:a,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new tr(zM,new Cl({color:a,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,l)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{KY.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(KY,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Aj extends Dc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],a=new Ln;a.setAttribute("position",new hn(t,3)),a.setAttribute("color",new hn(n,3));const o=new Eo({vertexColors:!0,toneMapped:!1});super(a,o),this.type="AxesHelper"}setColors(e,t,n){const a=new $t,o=this.geometry.attributes.color.array;return a.set(e),a.toArray(o,0),a.toArray(o,3),a.set(t),a.toArray(o,6),a.toArray(o,9),a.set(n),a.toArray(o,12),a.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class fj{constructor(){this.type="ShapePath",this.color=new $t,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new fG,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,a){return this.currentPath.quadraticCurveTo(e,t,n,a),this}bezierCurveTo(e,t,n,a,o,l){return this.currentPath.bezierCurveTo(e,t,n,a,o,l),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(Z){const x=[];for(let W=0,N=Z.length;W<N;W++){const K=Z[W],T=new LA;T.curves=K.curves,x.push(T)}return x}function n(Z,x){const W=x.length;let N=!1;for(let K=W-1,T=0;T<W;K=T++){let L=x[K],k=x[T],E=k.x-L.x,F=k.y-L.y;if(Math.abs(F)>Number.EPSILON){if(F<0&&(L=x[T],E=-E,k=x[K],F=-F),Z.y<L.y||Z.y>k.y)continue;if(Z.y===L.y){if(Z.x===L.x)return!0}else{const U=F*(Z.x-L.x)-E*(Z.y-L.y);if(U===0)return!0;if(U<0)continue;N=!N}}else{if(Z.y!==L.y)continue;if(k.x<=Z.x&&Z.x<=L.x||L.x<=Z.x&&Z.x<=k.x)return!0}}return N}const a=nu.isClockWise,o=this.subPaths;if(o.length===0)return[];let l,u,d;const C=[];if(o.length===1)return u=o[0],d=new LA,d.curves=u.curves,C.push(d),C;let A=!a(o[0].getPoints());A=e?!A:A;const p=[],m=[];let y=[],G=0,w;m[G]=void 0,y[G]=[];for(let Z=0,x=o.length;Z<x;Z++)u=o[Z],w=u.getPoints(),l=a(w),l=e?!l:l,l?(!A&&m[G]&&G++,m[G]={s:new LA,p:w},m[G].s.curves=u.curves,A&&G++,y[G]=[]):y[G].push({h:u,p:w[0]});if(!m[0])return t(o);if(m.length>1){let Z=!1,x=0;for(let W=0,N=m.length;W<N;W++)p[W]=[];for(let W=0,N=m.length;W<N;W++){const K=y[W];for(let T=0;T<K.length;T++){const L=K[T];let k=!0;for(let E=0;E<m.length;E++)n(L.p,m[E].p)&&(W!==E&&x++,k?(k=!1,p[E].push(L)):Z=!0);k&&p[W].push(L)}}x>0&&Z===!1&&(y=p)}let R;for(let Z=0,x=m.length;Z<x;Z++){d=m[Z].s,C.push(d),R=y[Z];for(let W=0,N=R.length;W<N;W++)d.holes.push(R[W].h)}return C}}class pj extends au{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}class mj extends zc{constructor(e=1,t=1,n=1,a={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...a,count:n}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:yG}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=yG);const bj=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:QN,AddEquation:rC,AddOperation:xE,AdditiveAnimationBlendMode:oH,AdditiveBlending:AN,AgXToneMapping:HE,AlphaFormat:eH,AlwaysCompare:QE,AlwaysDepth:wR,AlwaysStencilFunc:bN,AmbientLight:kK,AnimationAction:e9,AnimationClip:ub,AnimationLoader:yQ,AnimationMixer:PQ,AnimationObjectGroup:JQ,AnimationUtils:pQ,ArcCurve:mK,ArrayCamera:dK,ArrowHelper:hj,AttachedBindMode:mN,Audio:qK,AudioAnalyser:YQ,AudioContext:YH,AudioListener:HQ,AudioLoader:VQ,AxesHelper:Aj,BackSide:ss,BasicDepthPacking:LE,BasicShadowMap:cE,BatchedMesh:pK,Bone:Nw,BooleanKeyframeTrack:ef,Box2:tj,Box3:ho,Box3Helper:dj,BoxGeometry:$A,BoxHelper:Ij,BufferAttribute:Ri,BufferGeometry:Ln,BufferGeometryLoader:QK,ByteType:jN,Cache:BI,Camera:SG,CameraHelper:uj,CanvasTexture:zP,CapsuleGeometry:Yw,CatmullRomCurve3:bK,CineonToneMapping:ME,CircleGeometry:Tw,ClampToEdgeWrapping:dl,Clock:TH,Color:$t,ColorKeyframeTrack:VH,ColorManagement:mi,CompressedArrayTexture:KP,CompressedCubeTexture:LP,CompressedTexture:Xw,CompressedTextureLoader:GQ,ConeGeometry:Ew,ConstantAlphaFactor:SE,ConstantColorFactor:BE,Controls:pj,CubeCamera:rK,CubeReflectionMapping:WI,CubeRefractionMapping:sC,CubeTexture:RG,CubeTextureLoader:BQ,CubeUVReflectionMapping:Cb,CubicBezierCurve:BH,CubicBezierCurve3:vK,CubicInterpolant:EK,CullFaceBack:hN,CullFaceFront:lE,CullFaceFrontBack:v3,CullFaceNone:sE,Curve:kc,CurvePath:GK,CustomBlending:gE,CustomToneMapping:NE,CylinderGeometry:pb,Cylindrical:ej,Data3DTexture:uH,DataArrayTexture:xw,DataTexture:tu,DataTextureLoader:ZQ,DataUtils:WD,DecrementStencilOp:M3,DecrementWrapStencilOp:H3,DefaultLoadingManager:zK,DepthFormat:YA,DepthStencilFormat:kA,DepthTexture:hH,DetachedBindMode:FE,DirectionalLight:FH,DirectionalLightHelper:gj,DiscreteInterpolant:KK,DodecahedronGeometry:Kw,DoubleSide:Kl,DstAlphaFactor:mE,DstColorFactor:vE,DynamicCopyUsage:O3,DynamicDrawUsage:jE,DynamicReadUsage:k3,EdgesGeometry:BK,EllipseCurve:Fw,EqualCompare:UE,EqualDepth:WR,EqualStencilFunc:T3,EquirectangularReflectionMapping:uG,EquirectangularRefractionMapping:IG,Euler:Hs,EventDispatcher:au,ExtrudeGeometry:zw,FileLoader:Al,Float16BufferAttribute:FD,Float32BufferAttribute:hn,FloatType:Ns,Fog:Mw,FogExp2:Vw,FramebufferTexture:EP,FrontSide:iu,Frustum:wG,GLBufferAttribute:$Q,GLSL1:Q3,GLSL3:vN,GreaterCompare:JE,GreaterDepth:MR,GreaterEqualCompare:PE,GreaterEqualDepth:VR,GreaterEqualStencilFunc:z3,GreaterStencilFunc:K3,GridHelper:lj,Group:GI,HalfFloatType:hb,HemisphereLight:DK,HemisphereLightHelper:sj,IcosahedronGeometry:_w,ImageBitmapLoader:jK,ImageLoader:vG,ImageUtils:eK,IncrementStencilOp:V3,IncrementWrapStencilOp:N3,InstancedBufferAttribute:UA,InstancedBufferGeometry:PK,InstancedInterleavedBuffer:qQ,InstancedMesh:KA,Int16BufferAttribute:HD,Int32BufferAttribute:XD,Int8BufferAttribute:VD,IntType:yw,InterleavedBuffer:xG,InterleavedBufferAttribute:cC,Interpolant:mb,InterpolateDiscrete:sb,InterpolateLinear:lb,InterpolateSmooth:bR,InvertStencilOp:X3,KeepStencilOp:GA,KeyframeTrack:Uc,LOD:fK,LatheGeometry:VG,Layers:EA,LessCompare:kE,LessDepth:xR,LessEqualCompare:lH,LessEqualDepth:_A,LessEqualStencilFunc:E3,LessStencilFunc:Y3,Light:IC,LightProbe:OK,Line:MI,Line3:nj,LineBasicMaterial:Eo,LineCurve:ZH,LineCurve3:yK,LineDashedMaterial:FK,LineLoop:vH,LineSegments:Dc,LinearFilter:er,LinearInterpolant:WH,LinearMipMapLinearFilter:Z3,LinearMipMapNearestFilter:B3,LinearMipmapLinearFilter:Ll,LinearMipmapNearestFilter:tb,LinearSRGBColorSpace:jA,LinearToneMapping:WE,LinearTransfer:ZG,Loader:Ko,LoaderUtils:oC,LoadingManager:MH,LoopOnce:YE,LoopPingPong:EE,LoopRepeat:TE,LuminanceAlphaFormat:iH,LuminanceFormat:nH,MOUSE:vA,Material:Zr,MaterialLoader:Qw,MathUtils:gH,Matrix2:zH,Matrix3:kn,Matrix4:Sn,MaxEquation:CE,Mesh:tr,MeshBasicMaterial:Cl,MeshDepthMaterial:AH,MeshDistanceMaterial:fH,MeshLambertMaterial:HK,MeshMatcapMaterial:XK,MeshNormalMaterial:NK,MeshPhongMaterial:VK,MeshPhysicalMaterial:zl,MeshStandardMaterial:HG,MeshToonMaterial:MK,MinEquation:dE,MirroredRepeatWrapping:rb,MixOperation:wE,MultiplyBlending:pN,MultiplyOperation:GG,NearestFilter:_r,NearestMipMapLinearFilter:G3,NearestMipMapNearestFilter:y3,NearestMipmapLinearFilter:xA,NearestMipmapNearestFilter:vw,NeutralToneMapping:XE,NeverCompare:DE,NeverDepth:RR,NeverStencilFunc:F3,NoBlending:RI,NoColorSpace:vI,NoToneMapping:eu,NormalAnimationBlendMode:ww,NormalBlending:FA,NotEqualCompare:OE,NotEqualDepth:NR,NotEqualStencilFunc:L3,NumberKeyframeTrack:OA,Object3D:gi,ObjectLoader:xQ,ObjectSpaceNormalMap:_E,OctahedronGeometry:MG,OneFactor:AE,OneMinusConstantAlphaFactor:RE,OneMinusConstantColorFactor:ZE,OneMinusDstAlphaFactor:bE,OneMinusDstColorFactor:yE,OneMinusSrcAlphaFactor:SR,OneMinusSrcColorFactor:pE,OrthographicCamera:Kc,PCFShadowMap:mw,PCFSoftShadowMap:nG,PMREMGenerator:yN,Path:fG,PerspectiveCamera:Aa,Plane:bI,PlaneGeometry:Ab,PlaneHelper:Cj,PointLight:XH,PointLightHelper:rj,Points:yH,PointsMaterial:Hw,PolarGridHelper:cj,PolyhedronGeometry:uC,PositionalAudio:FQ,PropertyBinding:Bi,PropertyMixer:$K,QuadraticBezierCurve:SH,QuadraticBezierCurve3:RH,Quaternion:Ir,QuaternionKeyframeTrack:PA,QuaternionLinearInterpolant:LK,RED_GREEN_RGTC2_Format:aw,RED_RGTC1_Format:rH,REVISION:yG,RGBADepthPacking:zE,RGBAFormat:To,RGBAIntegerFormat:Rw,RGBA_ASTC_10x10_Format:qR,RGBA_ASTC_10x5_Format:PR,RGBA_ASTC_10x6_Format:QR,RGBA_ASTC_10x8_Format:jR,RGBA_ASTC_12x10_Format:$R,RGBA_ASTC_12x12_Format:ew,RGBA_ASTC_4x4_Format:LR,RGBA_ASTC_5x4_Format:zR,RGBA_ASTC_5x5_Format:_R,RGBA_ASTC_6x5_Format:DR,RGBA_ASTC_6x6_Format:kR,RGBA_ASTC_8x5_Format:UR,RGBA_ASTC_8x6_Format:JR,RGBA_ASTC_8x8_Format:OR,RGBA_BPTC_Format:sG,RGBA_ETC2_EAC_Format:KR,RGBA_PVRTC_2BPPV1_Format:YR,RGBA_PVRTC_4BPPV1_Format:FR,RGBA_S3TC_DXT1_Format:aG,RGBA_S3TC_DXT3_Format:rG,RGBA_S3TC_DXT5_Format:oG,RGBDepthPacking:R3,RGBFormat:tH,RGBIntegerFormat:S3,RGB_BPTC_SIGNED_Format:tw,RGB_BPTC_UNSIGNED_Format:nw,RGB_ETC1_Format:TR,RGB_ETC2_Format:ER,RGB_PVRTC_2BPPV1_Format:XR,RGB_PVRTC_4BPPV1_Format:HR,RGB_S3TC_DXT1_Format:iG,RGDepthPacking:w3,RGFormat:aH,RGIntegerFormat:Sw,RawShaderMaterial:WK,Ray:qA,Raycaster:t9,RectAreaLight:UK,RedFormat:Zw,RedIntegerFormat:BG,ReinhardToneMapping:VE,RenderTarget:tK,RepeatWrapping:lC,ReplaceStencilOp:W3,ReverseSubtractEquation:IE,RingGeometry:Dw,SIGNED_RED_GREEN_RGTC2_Format:rw,SIGNED_RED_RGTC1_Format:iw,SRGBColorSpace:Vs,SRGBTransfer:ki,Scene:pH,ShaderChunk:qn,ShaderLib:Ec,ShaderMaterial:_c,ShadowMaterial:xK,Shape:LA,ShapeGeometry:kw,ShapePath:fj,ShapeUtils:nu,ShortType:qN,Skeleton:WG,SkeletonHelper:aj,SkinnedMesh:bH,Source:MA,Sphere:Ao,SphereGeometry:NG,Spherical:WN,SphericalHarmonics3:JK,SplineCurve:wH,SpotLight:HH,SpotLightHelper:ij,Sprite:AK,SpriteMaterial:mH,SrcAlphaFactor:ZR,SrcAlphaSaturateFactor:GE,SrcColorFactor:fE,StaticCopyUsage:J3,StaticDrawUsage:CG,StaticReadUsage:D3,StereoCamera:MQ,StreamCopyUsage:P3,StreamDrawUsage:_3,StreamReadUsage:U3,StringKeyframeTrack:tf,SubtractEquation:uE,SubtractiveBlending:fN,TOUCH:yA,TangentSpaceNormalMap:gC,TetrahedronGeometry:Uw,Texture:fa,TextureLoader:_K,TextureUtils:mP,TorusGeometry:Jw,TorusKnotGeometry:Ow,Triangle:Ms,TriangleFanDrawMode:ow,TriangleStripDrawMode:sH,TrianglesDrawMode:KE,TubeGeometry:Pw,UVMapping:bw,Uint16BufferAttribute:IH,Uint32BufferAttribute:dH,Uint8BufferAttribute:MD,Uint8ClampedBufferAttribute:ND,Uniform:LH,UniformsGroup:jQ,UniformsLib:qt,UniformsUtils:aK,UnsignedByteType:Lc,UnsignedInt248Type:DA,UnsignedInt5999Type:$N,UnsignedIntType:VI,UnsignedShort4444Type:Gw,UnsignedShort5551Type:Bw,UnsignedShortType:ob,VSMShadowMap:Yc,Vector2:ut,Vector3:q,Vector4:Si,VectorKeyframeTrack:QA,VideoTexture:TP,WebGL3DRenderTarget:bD,WebGLArrayRenderTarget:mD,WebGLCoordinateSystem:$g,WebGLCubeRenderTarget:oK,WebGLMultipleRenderTargets:mj,WebGLRenderTarget:zc,WebGLRenderer:CK,WebGLUtils:IK,WebGPUCoordinateSystem:hG,WireframeGeometry:wK,WrapAroundEnding:dG,ZeroCurvatureEnding:WA,ZeroFactor:hE,ZeroSlopeEnding:VA,ZeroStencilOp:x3,createCanvasElement:$E},Symbol.toStringTag,{value:"Module"}));var i9={exports:{}},ZA={};/**
 * @license React
 * react-reconciler-constants.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var s=1,e=4,t=16,n=536870912,a=s,o=e,l=t,u=n,d=0,C=1;ZA.ConcurrentRoot=C,ZA.ContinuousEventPriority=o,ZA.DefaultEventPriority=l,ZA.DiscreteEventPriority=a,ZA.IdleEventPriority=u,ZA.LegacyRoot=d})();i9.exports=ZA;var eb=i9.exports;function vj(s){let e;const t=new Set,n=(C,A)=>{const p=typeof C=="function"?C(e):C;if(p!==e){const m=e;e=A?p:Object.assign({},e,p),t.forEach(y=>y(e,m))}},a=()=>e,o=(C,A=a,p=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let m=A(e);function y(){const G=A(e);if(!p(m,G)){const w=m;C(m=G,w)}}return t.add(y),()=>t.delete(y)},d={setState:n,getState:a,subscribe:(C,A,p)=>A||p?o(C,A,p):(t.add(C),()=>t.delete(C)),destroy:()=>t.clear()};return e=s(n,a,d),d}const yj=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),LY=yj?Fe.useEffect:Fe.useLayoutEffect;function Gj(s){const e=typeof s=="function"?vj(s):s,t=(n=e.getState,a=Object.is)=>{const[,o]=Fe.useReducer(R=>R+1,0),l=e.getState(),u=Fe.useRef(l),d=Fe.useRef(n),C=Fe.useRef(a),A=Fe.useRef(!1),p=Fe.useRef();p.current===void 0&&(p.current=n(l));let m,y=!1;(u.current!==l||d.current!==n||C.current!==a||A.current)&&(m=n(l),y=!a(p.current,m)),LY(()=>{y&&(p.current=m),u.current=l,d.current=n,C.current=a,A.current=!1});const G=Fe.useRef(l);LY(()=>{const R=()=>{try{const x=e.getState(),W=d.current(x);C.current(p.current,W)||(u.current=x,p.current=W,o())}catch{A.current=!0,o()}},Z=e.subscribe(R);return e.getState()!==G.current&&R(),Z},[]);const w=y?m:p.current;return Fe.useDebugValue(w),w};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const a=n.length<=0;return{value:n.shift(),done:a}}}},t}const Bj=s=>typeof s=="object"&&typeof s.then=="function",HA=[];function a9(s,e,t=(n,a)=>n===a){if(s===e)return!0;if(!s||!e)return!1;const n=s.length;if(e.length!==n)return!1;for(let a=0;a<n;a++)if(!t(s[a],e[a]))return!1;return!0}function r9(s,e=null,t=!1,n={}){e===null&&(e=[s]);for(const o of HA)if(a9(e,o.keys,o.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return n.lifespan&&n.lifespan>0&&(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(o.remove,n.lifespan)),o.response;if(!t)throw o.promise}const a={keys:e,equal:n.equal,remove:()=>{const o=HA.indexOf(a);o!==-1&&HA.splice(o,1)},promise:(Bj(s)?s:s(...e)).then(o=>{a.response=o,n.lifespan&&n.lifespan>0&&(a.timeout=setTimeout(a.remove,n.lifespan))}).catch(o=>a.error=o)};if(HA.push(a),!t)throw a.promise}const Zj=(s,e,t)=>r9(s,e,!1,t),Sj=(s,e,t)=>void r9(s,e,!0,t),Rj=s=>{if(s===void 0||s.length===0)HA.splice(0,HA.length);else{const e=HA.find(t=>a9(s,t.keys,t.equal));e&&e.remove()}};var o9={exports:{}},s9={exports:{}},_M={exports:{}},DM={},zY;function wj(){return zY||(zY=1,function(s){/**
 * @license React
 * scheduler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=!1,t=!1,n=5;function a(j,ue){var Ve=j.length;j.push(ue),u(j,ue,Ve)}function o(j){return j.length===0?null:j[0]}function l(j){if(j.length===0)return null;var ue=j[0],Ve=j.pop();return Ve!==ue&&(j[0]=Ve,d(j,Ve,0)),ue}function u(j,ue,Ve){for(var qe=Ve;qe>0;){var Me=qe-1>>>1,se=j[Me];if(C(se,ue)>0)j[Me]=ue,j[qe]=se,qe=Me;else return}}function d(j,ue,Ve){for(var qe=Ve,Me=j.length,se=Me>>>1;qe<se;){var Re=(qe+1)*2-1,De=j[Re],Q=Re+1,st=j[Q];if(C(De,ue)<0)Q<Me&&C(st,De)<0?(j[qe]=st,j[Q]=ue,qe=Q):(j[qe]=De,j[Re]=ue,qe=Re);else if(Q<Me&&C(st,ue)<0)j[qe]=st,j[Q]=ue,qe=Q;else return}}function C(j,ue){var Ve=j.sortIndex-ue.sortIndex;return Ve!==0?Ve:j.id-ue.id}var A=1,p=2,m=3,y=4,G=5;function w(j,ue){}var R=typeof performance=="object"&&typeof performance.now=="function";if(R){var Z=performance;s.unstable_now=function(){return Z.now()}}else{var x=Date,W=x.now();s.unstable_now=function(){return x.now()-W}}var N=1073741823,K=-1,T=250,L=5e3,k=1e4,E=N,F=[],U=[],le=1,ie=null,Ce=m,Ge=!1,ye=!1,pe=!1,de=typeof setTimeout=="function"?setTimeout:null,Oe=typeof clearTimeout=="function"?clearTimeout:null,We=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ke(j){for(var ue=o(U);ue!==null;){if(ue.callback===null)l(U);else if(ue.startTime<=j)l(U),ue.sortIndex=ue.expirationTime,a(F,ue);else return;ue=o(U)}}function $e(j){if(pe=!1,ke(j),!ye)if(o(F)!==null)ye=!0,_e(ot);else{var ue=o(U);ue!==null&&At($e,ue.startTime-j)}}function ot(j,ue){ye=!1,pe&&(pe=!1,Zt()),Ge=!0;var Ve=Ce;try{var qe;if(!t)return Ne(j,ue)}finally{ie=null,Ce=Ve,Ge=!1}}function Ne(j,ue){var Ve=ue;for(ke(Ve),ie=o(F);ie!==null&&!e&&!(ie.expirationTime>Ve&&(!j||Tt()));){var qe=ie.callback;if(typeof qe=="function"){ie.callback=null,Ce=ie.priorityLevel;var Me=ie.expirationTime<=Ve,se=qe(Me);Ve=s.unstable_now(),typeof se=="function"?ie.callback=se:ie===o(F)&&l(F),ke(Ve)}else l(F);ie=o(F)}if(ie!==null)return!0;var Re=o(U);return Re!==null&&At($e,Re.startTime-Ve),!1}function tt(j,ue){switch(j){case A:case p:case m:case y:case G:break;default:j=m}var Ve=Ce;Ce=j;try{return ue()}finally{Ce=Ve}}function bt(j){var ue;switch(Ce){case A:case p:case m:ue=m;break;default:ue=Ce;break}var Ve=Ce;Ce=ue;try{return j()}finally{Ce=Ve}}function dt(j){var ue=Ce;return function(){var Ve=Ce;Ce=ue;try{return j.apply(this,arguments)}finally{Ce=Ve}}}function yt(j,ue,Ve){var qe=s.unstable_now(),Me;if(typeof Ve=="object"&&Ve!==null){var se=Ve.delay;typeof se=="number"&&se>0?Me=qe+se:Me=qe}else Me=qe;var Re;switch(j){case A:Re=K;break;case p:Re=T;break;case G:Re=E;break;case y:Re=k;break;case m:default:Re=L;break}var De=Me+Re,Q={id:le++,callback:ue,priorityLevel:j,startTime:Me,expirationTime:De,sortIndex:-1};return Me>qe?(Q.sortIndex=Me,a(U,Q),o(F)===null&&Q===o(U)&&(pe?Zt():pe=!0,At($e,Me-qe))):(Q.sortIndex=De,a(F,Q),!ye&&!Ge&&(ye=!0,_e(ot))),Q}function zt(){}function Nt(){!ye&&!Ge&&(ye=!0,_e(ot))}function Lt(){return o(F)}function Ue(j){j.callback=null}function Pe(){return Ce}var te=!1,Gt=null,Qe=-1,ht=n,Ct=-1;function Tt(){var j=s.unstable_now()-Ct;return!(j<ht)}function Rt(){}function $(j){if(j<0||j>125){console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported");return}j>0?ht=Math.floor(1e3/j):ht=n}var J=function(){if(Gt!==null){var j=s.unstable_now();Ct=j;var ue=!0,Ve=!0;try{Ve=Gt(ue,j)}finally{Ve?fe():(te=!1,Gt=null)}}else te=!1},fe;if(typeof We=="function")fe=function(){We(J)};else if(typeof MessageChannel<"u"){var ze=new MessageChannel,et=ze.port2;ze.port1.onmessage=J,fe=function(){et.postMessage(null)}}else fe=function(){de(J,0)};function _e(j){Gt=j,te||(te=!0,fe())}function At(j,ue){Qe=de(function(){j(s.unstable_now())},ue)}function Zt(){Oe(Qe),Qe=-1}var Xt=Rt,An=null;s.unstable_IdlePriority=G,s.unstable_ImmediatePriority=A,s.unstable_LowPriority=y,s.unstable_NormalPriority=m,s.unstable_Profiling=An,s.unstable_UserBlockingPriority=p,s.unstable_cancelCallback=Ue,s.unstable_continueExecution=Nt,s.unstable_forceFrameRate=$,s.unstable_getCurrentPriorityLevel=Pe,s.unstable_getFirstCallbackNode=Lt,s.unstable_next=bt,s.unstable_pauseExecution=zt,s.unstable_requestPaint=Xt,s.unstable_runWithPriority=tt,s.unstable_scheduleCallback=yt,s.unstable_shouldYield=Tt,s.unstable_wrapCallback=dt,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()}(DM)),DM}var _Y;function xj(){return _Y||(_Y=1,_M.exports=wj()),_M.exports}/**
 * @license React
 * react-reconciler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */s9.exports=function(e){var t={},n=Fe,a=xj(),o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=!1;function u(c){l=c}function d(c){if(!l){for(var g=arguments.length,f=new Array(g>1?g-1:0),v=1;v<g;v++)f[v-1]=arguments[v];A("warn",c,f)}}function C(c){if(!l){for(var g=arguments.length,f=new Array(g>1?g-1:0),v=1;v<g;v++)f[v-1]=arguments[v];A("error",c,f)}}function A(c,g,f){{var v=o.ReactDebugCurrentFrame,B=v.getStackAddendum();B!==""&&(g+="%s",f=f.concat([B]));var V=f.map(function(H){return String(H)});V.unshift("Warning: "+g),Function.prototype.apply.call(console[c],console,V)}}var p=Object.assign;function m(c){return c._reactInternals}function y(c,g){c._reactInternals=g}var G=!1,w=!1,R=!1,Z=!1,x=!1,W=!1,N=!0,K=!0,T=!0,L=0,k=1,E=2,F=3,U=4,le=5,ie=6,Ce=7,Ge=8,ye=9,pe=10,de=11,Oe=12,We=13,ke=14,$e=15,ot=16,Ne=17,tt=18,bt=19,dt=21,yt=22,zt=23,Nt=24,Lt=25,Ue=Symbol.for("react.element"),Pe=Symbol.for("react.portal"),te=Symbol.for("react.fragment"),Gt=Symbol.for("react.strict_mode"),Qe=Symbol.for("react.profiler"),ht=Symbol.for("react.provider"),Ct=Symbol.for("react.context"),Tt=Symbol.for("react.forward_ref"),Rt=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),J=Symbol.for("react.memo"),fe=Symbol.for("react.lazy"),ze=Symbol.for("react.scope"),et=Symbol.for("react.debug_trace_mode"),_e=Symbol.for("react.offscreen"),At=Symbol.for("react.legacy_hidden"),Zt=Symbol.for("react.cache"),Xt=Symbol.for("react.tracing_marker"),An=Symbol.iterator,j="@@iterator";function ue(c){if(c===null||typeof c!="object")return null;var g=An&&c[An]||c[j];return typeof g=="function"?g:null}function Ve(c,g,f){var v=c.displayName;if(v)return v;var B=g.displayName||g.name||"";return B!==""?f+"("+B+")":f}function qe(c){return c.displayName||"Context"}function Me(c){if(c==null)return null;if(typeof c.tag=="number"&&C("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case te:return"Fragment";case Pe:return"Portal";case Qe:return"Profiler";case Gt:return"StrictMode";case Rt:return"Suspense";case $:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case Ct:var g=c;return qe(g)+".Consumer";case ht:var f=c;return qe(f._context)+".Provider";case Tt:return Ve(c,c.render,"ForwardRef");case J:var v=c.displayName||null;return v!==null?v:Me(c.type)||"Memo";case fe:{var B=c,V=B._payload,H=B._init;try{return Me(H(V))}catch{return null}}}return null}function se(c,g,f){var v=g.displayName||g.name||"";return c.displayName||(v!==""?f+"("+v+")":f)}function Re(c){return c.displayName||"Context"}function De(c){var g=c.tag,f=c.type;switch(g){case Nt:return"Cache";case ye:var v=f;return Re(v)+".Consumer";case pe:var B=f;return Re(B._context)+".Provider";case tt:return"DehydratedFragment";case de:return se(f,f.render,"ForwardRef");case Ce:return"Fragment";case le:return f;case U:return"Portal";case F:return"Root";case ie:return"Text";case ot:return Me(f);case Ge:return f===Gt?"StrictMode":"Mode";case yt:return"Offscreen";case Oe:return"Profiler";case dt:return"Scope";case We:return"Suspense";case bt:return"SuspenseList";case Lt:return"TracingMarker";case k:case L:case Ne:case E:case ke:case $e:if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;break}return null}var Q=0,st=1,be=2,Be=4,Ft=be|Be,wt=16,ln=32,Yn=64,un=128,bn=256,ui=512,bi=1024,aa=2048,Ui=4096,pa=Ui|Be,ua=8192,ce=16384,pt=aa|Be|Yn|ui|bi|ce,Kt=32767,ne=32768,Te=65536,nt=131072,Vt=1048576,kt=2097152,dn=4194304,Ut=8388608,D=16777216,he=33554432,Ze=Be|bi|0,Se=be|Be|wt|ln|ui|Ui|ua,Ae=Be|Yn|ui|ua,mt=aa|wt,Wt=dn|Ut|kt,Dt=o.ReactCurrentOwner;function Ot(c){var g=c,f=c;if(c.alternate)for(;g.return;)g=g.return;else{var v=g;do g=v,(g.flags&(be|Ui))!==Q&&(f=g.return),v=g.return;while(v)}return g.tag===F?f:null}function Yt(c){return Ot(c)===c}function Rn(c){{var g=Dt.current;if(g!==null&&g.tag===k){var f=g,v=f.stateNode;v._warnedAboutRefsInRender||C("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",De(f)||"A component"),v._warnedAboutRefsInRender=!0}}var B=m(c);return B?Ot(B)===B:!1}function sn(c){if(Ot(c)!==c)throw new Error("Unable to find node on an unmounted component.")}function On(c){var g=c.alternate;if(!g){var f=Ot(c);if(f===null)throw new Error("Unable to find node on an unmounted component.");return f!==c?null:c}for(var v=c,B=g;;){var V=v.return;if(V===null)break;var H=V.alternate;if(H===null){var _=V.return;if(_!==null){v=B=_;continue}break}if(V.child===H.child){for(var O=V.child;O;){if(O===v)return sn(V),c;if(O===B)return sn(V),g;O=O.sibling}throw new Error("Unable to find node on an unmounted component.")}if(v.return!==B.return)v=V,B=H;else{for(var oe=!1,Ie=V.child;Ie;){if(Ie===v){oe=!0,v=V,B=H;break}if(Ie===B){oe=!0,B=V,v=H;break}Ie=Ie.sibling}if(!oe){for(Ie=H.child;Ie;){if(Ie===v){oe=!0,v=H,B=V;break}if(Ie===B){oe=!0,B=H,v=V;break}Ie=Ie.sibling}if(!oe)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(v.alternate!==B)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(v.tag!==F)throw new Error("Unable to find node on an unmounted component.");return v.stateNode.current===v?c:g}function Ii(c){var g=On(c);return g!==null?vi(g):null}function vi(c){if(c.tag===le||c.tag===ie)return c;for(var g=c.child;g!==null;){var f=vi(g);if(f!==null)return f;g=g.sibling}return null}function Va(c){var g=On(c);return g!==null?ti(g):null}function ti(c){if(c.tag===le||c.tag===ie)return c;for(var g=c.child;g!==null;){if(g.tag!==U){var f=ti(g);if(f!==null)return f}g=g.sibling}return null}var In=Array.isArray;function Fi(c){return In(c)}var ni=e.getPublicInstance,Dr=e.getRootHostContext,ls=e.getChildHostContext,ma=e.prepareForCommit,nr=e.resetAfterCommit,di=e.createInstance,ba=e.appendInitialChild,Lo=e.finalizeInitialChildren,za=e.prepareUpdate,kr=e.shouldSetTextContent,Ur=e.createTextInstance,ru=e.scheduleTimeout,Jc=e.cancelTimeout,NI=e.noTimeout;e.now;var Oc=e.isPrimaryRenderer,HI=e.warnsIfNotActing,fo=e.supportsMutation,Pn=e.supportsPersistence,dr=e.supportsHydration,dC=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var Tn=e.preparePortalMount;e.preparePortalMount,e.getInstanceFromScope;var nf=e.getCurrentEventPriority,wr=e.detachDeletedInstance,ou=e.supportsMicrotasks,Pc=e.scheduleMicrotask,kl=e.supportsTestSelectors,ir=e.findFiberRoot,ra=e.getBoundingRect,af=e.getTextContent,Cr=e.isHiddenSubtree,po=e.matchAccessibilityRole,fl=e.setFocusIfFocusable,vb=e.setupIntersectionObserver,XI=e.appendChild,su=e.appendChildToContainer,rf=e.commitTextUpdate,Qc=e.commitMount,of=e.commitUpdate,sf=e.insertBefore,Ul=e.insertInContainerBefore,FI=e.removeChild,jc=e.removeChildFromContainer,lu=e.resetTextContent,lf=e.hideInstance,cf=e.hideTextInstance,gf=e.unhideInstance,uf=e.unhideTextInstance,z=e.clearContainer,ge=e.cloneInstance,Ke=e.createContainerChildSet,je=e.appendChildToContainerChildSet,Ht=e.finalizeContainerChildren,Bn=e.replaceContainerChildren;e.getOffscreenContainerType;var cn=e.getOffscreenContainerProps,Wn=e.cloneHiddenInstance,$n=e.cloneHiddenTextInstance,wi=e.canHydrateInstance,Yi=e.canHydrateTextInstance,Ti=e.canHydrateSuspenseInstance,Ji=e.isSuspenseInstancePending,ta=e.isSuspenseInstanceFallback,hi=e.registerSuspenseInstanceRetry,Xs=e.getNextHydratableSibling,YI=e.getFirstHydratableChild,CC=e.getFirstHydratableChildWithinContainer,yb=e.getFirstHydratableChildWithinSuspenseInstance,Jl=e.hydrateInstance,hC=e.hydrateTextInstance,AC=e.hydrateSuspenseInstance,Gb=e.getNextHydratableInstanceAfterSuspenseInstance,TG=e.commitHydratedContainer,tx=e.commitHydratedSuspenseInstance,EG=e.clearSuspenseBoundary,Bb=e.clearSuspenseBoundaryFromContainer,KG=e.shouldDeleteUnhydratedTailInstances,LG=e.didNotMatchHydratedContainerTextInstance,zG=e.didNotMatchHydratedTextInstance,nx=e.didNotHydrateInstanceWithinContainer,Ol=e.didNotHydrateInstanceWithinSuspenseInstance,ix=e.didNotHydrateInstance,Zb=e.didNotFindHydratableInstanceWithinContainer,Sb=e.didNotFindHydratableTextInstanceWithinContainer,Rb=e.didNotFindHydratableSuspenseInstanceWithinContainer,ax=e.didNotFindHydratableInstanceWithinSuspenseInstance,If=e.didNotFindHydratableTextInstanceWithinSuspenseInstance,_G=e.didNotFindHydratableSuspenseInstanceWithinSuspenseInstance,mo=e.didNotFindHydratableInstance,Pl=e.didNotFindHydratableTextInstance,Ma=e.didNotFindHydratableSuspenseInstance,Ql=e.errorHydratingContainer,cu=0,fC,DG,TI,kG,UG,df,JG;function OG(){}OG.__reactDisabledLog=!0;function rx(){{if(cu===0){fC=console.log,DG=console.info,TI=console.warn,kG=console.error,UG=console.group,df=console.groupCollapsed,JG=console.groupEnd;var c={configurable:!0,enumerable:!0,value:OG,writable:!0};Object.defineProperties(console,{info:c,log:c,warn:c,error:c,group:c,groupCollapsed:c,groupEnd:c})}cu++}}function PG(){{if(cu--,cu===0){var c={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:p({},c,{value:fC}),info:p({},c,{value:DG}),warn:p({},c,{value:TI}),error:p({},c,{value:kG}),group:p({},c,{value:UG}),groupCollapsed:p({},c,{value:df}),groupEnd:p({},c,{value:JG})})}cu<0&&C("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var wb=o.ReactCurrentDispatcher,xb;function qc(c,g,f){{if(xb===void 0)try{throw Error()}catch(B){var v=B.stack.trim().match(/\n( *(at )?)/);xb=v&&v[1]||""}return`
`+xb+c}}var Cf=!1,jl;{var Wb=typeof WeakMap=="function"?WeakMap:Map;jl=new Wb}function hf(c,g){if(!c||Cf)return"";{var f=jl.get(c);if(f!==void 0)return f}var v;Cf=!0;var B=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var V;V=wb.current,wb.current=null,rx();try{if(g){var H=function(){throw Error()};if(Object.defineProperty(H.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(H,[])}catch(vt){v=vt}Reflect.construct(c,[],H)}else{try{H.call()}catch(vt){v=vt}c.call(H.prototype)}}else{try{throw Error()}catch(vt){v=vt}c()}}catch(vt){if(vt&&v&&typeof vt.stack=="string"){for(var _=vt.stack.split(`
`),O=v.stack.split(`
`),oe=_.length-1,Ie=O.length-1;oe>=1&&Ie>=0&&_[oe]!==O[Ie];)Ie--;for(;oe>=1&&Ie>=0;oe--,Ie--)if(_[oe]!==O[Ie]){if(oe!==1||Ie!==1)do if(oe--,Ie--,Ie<0||_[oe]!==O[Ie]){var xe=`
`+_[oe].replace(" at new "," at ");return c.displayName&&xe.includes("<anonymous>")&&(xe=xe.replace("<anonymous>",c.displayName)),typeof c=="function"&&jl.set(c,xe),xe}while(oe>=1&&Ie>=0);break}}}finally{Cf=!1,wb.current=V,PG(),Error.prepareStackTrace=B}var Je=c?c.displayName||c.name:"",it=Je?qc(Je):"";return typeof c=="function"&&jl.set(c,it),it}function QG(c,g,f){return hf(c,!0)}function Vb(c,g,f){return hf(c,!1)}function ox(c){var g=c.prototype;return!!(g&&g.isReactComponent)}function Mb(c,g,f){if(c==null)return"";if(typeof c=="function")return hf(c,ox(c));if(typeof c=="string")return qc(c);switch(c){case Rt:return qc("Suspense");case $:return qc("SuspenseList")}if(typeof c=="object")switch(c.$$typeof){case Tt:return Vb(c.render);case J:return Mb(c.type,g,f);case fe:{var v=c,B=v._payload,V=v._init;try{return Mb(V(B),g,f)}catch{}}}return""}var jG=Object.prototype.hasOwnProperty,qG={},$G=o.ReactDebugCurrentFrame;function Af(c){if(c){var g=c._owner,f=Mb(c.type,c._source,g?g.type:null);$G.setExtraStackFrame(f)}else $G.setExtraStackFrame(null)}function Fs(c,g,f,v,B){{var V=Function.call.bind(jG);for(var H in c)if(V(c,H)){var _=void 0;try{if(typeof c[H]!="function"){var O=Error((v||"React class")+": "+f+" type `"+H+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof c[H]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw O.name="Invariant Violation",O}_=c[H](g,H,v,f,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(oe){_=oe}_&&!(_ instanceof Error)&&(Af(B),C("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",v||"React class",f,H,typeof _),Af(null)),_ instanceof Error&&!(_.message in qG)&&(qG[_.message]=!0,Af(B),C("Failed %s type: %s",f,_.message),Af(null))}}}var ff=[],pf;pf=[];var pl=-1;function $c(c){return{current:c}}function xr(c,g){if(pl<0){C("Unexpected pop.");return}g!==pf[pl]&&C("Unexpected Fiber popped."),c.current=ff[pl],ff[pl]=null,pf[pl]=null,pl--}function hr(c,g,f){pl++,ff[pl]=c.current,pf[pl]=f,c.current=g}var Nb;Nb={};var Jr={};Object.freeze(Jr);var Or=$c(Jr),zo=$c(!1),mf=Jr;function Ys(c,g,f){return f&&ml(g)?mf:Or.current}function eB(c,g,f){{var v=c.stateNode;v.__reactInternalMemoizedUnmaskedChildContext=g,v.__reactInternalMemoizedMaskedChildContext=f}}function EI(c,g){{var f=c.type,v=f.contextTypes;if(!v)return Jr;var B=c.stateNode;if(B&&B.__reactInternalMemoizedUnmaskedChildContext===g)return B.__reactInternalMemoizedMaskedChildContext;var V={};for(var H in v)V[H]=g[H];{var _=De(c)||"Unknown";Fs(v,V,"context",_)}return B&&eB(c,g,V),V}}function bf(){return zo.current}function ml(c){{var g=c.childContextTypes;return g!=null}}function vf(c){xr(zo,c),xr(Or,c)}function yf(c){xr(zo,c),xr(Or,c)}function tB(c,g,f){{if(Or.current!==Jr)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");hr(Or,g,c),hr(zo,f,c)}}function Hb(c,g,f){{var v=c.stateNode,B=g.childContextTypes;if(typeof v.getChildContext!="function"){{var V=De(c)||"Unknown";Nb[V]||(Nb[V]=!0,C("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",V,V))}return f}var H=v.getChildContext();for(var _ in H)if(!(_ in B))throw new Error((De(c)||"Unknown")+'.getChildContext(): key "'+_+'" is not defined in childContextTypes.');{var O=De(c)||"Unknown";Fs(B,H,"child context",O)}return p({},f,H)}}function ar(c){{var g=c.stateNode,f=g&&g.__reactInternalMemoizedMergedChildContext||Jr;return mf=Or.current,hr(Or,f,c),hr(zo,zo.current,c),!0}}function Xb(c,g,f){{var v=c.stateNode;if(!v)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(f){var B=Hb(c,g,mf);v.__reactInternalMemoizedMergedChildContext=B,xr(zo,c),xr(Or,c),hr(Or,B,c),hr(zo,f,c)}else xr(zo,c),hr(zo,f,c)}}function sx(c){{if(!Yt(c)||c.tag!==k)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var g=c;do{switch(g.tag){case F:return g.stateNode.context;case k:{var f=g.type;if(ml(f))return g.stateNode.__reactInternalMemoizedMergedChildContext;break}}g=g.return}while(g!==null);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}}var KI=0,nB=1,Nn=0,Hi=1,Ai=2,Ia=8,bo=16,iB=Math.clz32?Math.clz32:cx,pC=Math.log,lx=Math.LN2;function cx(c){var g=c>>>0;return g===0?32:31-(pC(g)/lx|0)|0}var Fb=31,Bt=0,Na=0,zn=1,Ts=2,ql=4,gu=8,bl=16,mC=32,uu=4194240,LI=64,Gf=128,bC=256,Yb=512,Bf=1024,Tb=2048,Eb=4096,Kb=8192,Iu=16384,vC=32768,du=65536,Zf=131072,Sf=262144,yC=524288,Lb=1048576,eg=2097152,Cu=130023424,$l=4194304,GC=8388608,zb=16777216,BC=33554432,_b=67108864,aB=$l,ZC=134217728,Rf=268435455,vl=268435456,hu=536870912,_o=1073741824;function Zn(c){{if(c&zn)return"Sync";if(c&Ts)return"InputContinuousHydration";if(c&ql)return"InputContinuous";if(c&gu)return"DefaultHydration";if(c&bl)return"Default";if(c&mC)return"TransitionHydration";if(c&uu)return"Transition";if(c&Cu)return"Retry";if(c&ZC)return"SelectiveHydration";if(c&vl)return"IdleHydration";if(c&hu)return"Idle";if(c&_o)return"Offscreen"}}var Zi=-1,oa=LI,Qn=$l;function Es(c){switch(ag(c)){case zn:return zn;case Ts:return Ts;case ql:return ql;case gu:return gu;case bl:return bl;case mC:return mC;case LI:case Gf:case bC:case Yb:case Bf:case Tb:case Eb:case Kb:case Iu:case vC:case du:case Zf:case Sf:case yC:case Lb:case eg:return c&uu;case $l:case GC:case zb:case BC:case _b:return c&Cu;case ZC:return ZC;case vl:return vl;case hu:return hu;case _o:return _o;default:return C("Should have found matching lanes. This is a bug in React."),c}}function tg(c,g){var f=c.pendingLanes;if(f===Bt)return Bt;var v=Bt,B=c.suspendedLanes,V=c.pingedLanes,H=f&Rf;if(H!==Bt){var _=H&~B;if(_!==Bt)v=Es(_);else{var O=H&V;O!==Bt&&(v=Es(O))}}else{var oe=f&~B;oe!==Bt?v=Es(oe):V!==Bt&&(v=Es(V))}if(v===Bt)return Bt;if(g!==Bt&&g!==v&&(g&B)===Bt){var Ie=ag(v),xe=ag(g);if(Ie>=xe||Ie===bl&&(xe&uu)!==Bt)return g}(v&ql)!==Bt&&(v|=f&bl);var Je=c.entangledLanes;if(Je!==Bt)for(var it=c.entanglements,vt=v&Je;vt>0;){var xt=Do(vt),fn=1<<xt;v|=it[xt],vt&=~fn}return v}function Db(c,g){for(var f=c.eventTimes,v=Zi;g>0;){var B=Do(g),V=1<<B,H=f[B];H>v&&(v=H),g&=~V}return v}function fi(c,g){switch(c){case zn:case Ts:case ql:return g+250;case gu:case bl:case mC:case LI:case Gf:case bC:case Yb:case Bf:case Tb:case Eb:case Kb:case Iu:case vC:case du:case Zf:case Sf:case yC:case Lb:case eg:return g+5e3;case $l:case GC:case zb:case BC:case _b:return Zi;case ZC:case vl:case hu:case _o:return Zi;default:return C("Should have found matching lanes. This is a bug in React."),Zi}}function ec(c,g){for(var f=c.pendingLanes,v=c.suspendedLanes,B=c.pingedLanes,V=c.expirationTimes,H=f;H>0;){var _=Do(H),O=1<<_,oe=V[_];oe===Zi?((O&v)===Bt||(O&B)!==Bt)&&(V[_]=fi(O,g)):oe<=g&&(c.expiredLanes|=O),H&=~O}}function ng(c){return Es(c.pendingLanes)}function tc(c){var g=c.pendingLanes&~_o;return g!==Bt?g:g&_o?_o:Bt}function Ks(c){return(c&zn)!==Bt}function Ls(c){return(c&Rf)!==Bt}function ig(c){return(c&Cu)===c}function wf(c){return(c&uu)===c}function xf(c,g){var f=Ts|ql|gu|bl;return(g&f)!==Bt}function gx(c,g){return(g&c.expiredLanes)!==Bt}function zI(c){return(c&uu)!==0}function Pr(){var c=oa;return oa<<=1,oa&uu||(oa=LI),c}function kb(){var c=Qn;return Qn<<=1,Qn&Cu||(Qn=$l),c}function ag(c){return c&-c}function Au(c){return ag(c)}function Do(c){return 31-iB(c)}function SC(c){return Do(c)}function va(c,g){return(c&g)!==Bt}function nc(c,g){return(c&g)===g}function En(c,g){return c|g}function _I(c,g){return c&~g}function DI(c,g){return c&g}function RC(c){return c}function ic(c,g){return c!==Na&&c<g?c:g}function Ub(c){for(var g=[],f=0;f<Fb;f++)g.push(c);return g}function zs(c,g,f){c.pendingLanes|=g,g!==hu&&(c.suspendedLanes=Bt,c.pingedLanes=Bt);var v=c.eventTimes,B=SC(g);v[B]=f}function rB(c,g){c.suspendedLanes|=g,c.pingedLanes&=~g;for(var f=c.expirationTimes,v=g;v>0;){var B=Do(v),V=1<<B;f[B]=Zi,v&=~V}}function Jb(c,g,f){c.pingedLanes|=c.suspendedLanes&g}function ux(c,g){var f=c.pendingLanes&~g;c.pendingLanes=g,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=g,c.mutableReadLanes&=g,c.entangledLanes&=g;for(var v=c.entanglements,B=c.eventTimes,V=c.expirationTimes,H=f;H>0;){var _=Do(H),O=1<<_;v[_]=Bt,B[_]=Zi,V[_]=Zi,H&=~O}}function Ob(c,g){for(var f=c.entangledLanes|=g,v=c.entanglements,B=f;B;){var V=Do(B),H=1<<V;H&g|v[V]&g&&(v[V]|=g),B&=~H}}function oB(c,g){var f=ag(g),v;switch(f){case ql:v=Ts;break;case bl:v=gu;break;case LI:case Gf:case bC:case Yb:case Bf:case Tb:case Eb:case Kb:case Iu:case vC:case du:case Zf:case Sf:case yC:case Lb:case eg:case $l:case GC:case zb:case BC:case _b:v=mC;break;case hu:v=vl;break;default:v=Na;break}return(v&(c.suspendedLanes|g))!==Na?Na:v}function Pb(c,g,f){if(ks)for(var v=c.pendingUpdatersLaneMap;f>0;){var B=SC(f),V=1<<B,H=v[B];H.add(g),f&=~V}}function Qb(c,g){if(ks)for(var f=c.pendingUpdatersLaneMap,v=c.memoizedUpdaters;g>0;){var B=SC(g),V=1<<B,H=f[B];H.size>0&&(H.forEach(function(_){var O=_.alternate;(O===null||!v.has(O))&&v.add(_)}),H.clear()),g&=~V}}var _s=zn,wC=ql,kI=bl,Wf=hu,xC=Na;function Ds(){return xC}function rr(c){xC=c}function or(c,g){var f=xC;try{return xC=c,g()}finally{xC=f}}function Ix(c,g){return c!==0&&c<g?c:g}function Vf(c,g){return c>g?c:g}function Mf(c,g){return c!==0&&c<g}function rg(c){var g=ag(c);return Mf(_s,g)?Mf(wC,g)?Ls(g)?kI:Wf:wC:_s}var sB=a.unstable_scheduleCallback,jb=a.unstable_cancelCallback,dx=a.unstable_shouldYield,Cx=a.unstable_requestPaint,sa=a.unstable_now,_a=a.unstable_ImmediatePriority,Pt=a.unstable_UserBlockingPriority,Qr=a.unstable_NormalPriority,cs=a.unstable_IdlePriority,hx=a.unstable_yieldValue,Ax=a.unstable_setDisableYieldValue,UI=null,Wr=null,en=null,Ei=!1,ks=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u";function fx(c){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var g=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(g.isDisabled)return!0;if(!g.supportsFiber)return C("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{N&&(c=p({},c,{getLaneLabelMap:bx,injectProfilingHooks:mx})),UI=g.inject(c),Wr=g}catch(f){C("React instrumentation encountered an error: %s.",f)}return!!g.checkDCE}function px(c,g){if(Wr&&typeof Wr.onScheduleFiberRoot=="function")try{Wr.onScheduleFiberRoot(UI,c,g)}catch(f){Ei||(Ei=!0,C("React instrumentation encountered an error: %s",f))}}function lB(c,g){if(Wr&&typeof Wr.onCommitFiberRoot=="function")try{var f=(c.current.flags&un)===un;if(K){var v;switch(g){case _s:v=_a;break;case wC:v=Pt;break;case kI:v=Qr;break;case Wf:v=cs;break;default:v=Qr;break}Wr.onCommitFiberRoot(UI,c,v,f)}}catch(B){Ei||(Ei=!0,C("React instrumentation encountered an error: %s",B))}}function WC(c){if(Wr&&typeof Wr.onPostCommitFiberRoot=="function")try{Wr.onPostCommitFiberRoot(UI,c)}catch(g){Ei||(Ei=!0,C("React instrumentation encountered an error: %s",g))}}function JI(c){if(Wr&&typeof Wr.onCommitFiberUnmount=="function")try{Wr.onCommitFiberUnmount(UI,c)}catch(g){Ei||(Ei=!0,C("React instrumentation encountered an error: %s",g))}}function sr(c){if(typeof hx=="function"&&(Ax(c),u(c)),Wr&&typeof Wr.setStrictMode=="function")try{Wr.setStrictMode(UI,c)}catch(g){Ei||(Ei=!0,C("React instrumentation encountered an error: %s",g))}}function mx(c){en=c}function bx(){{for(var c=new Map,g=1,f=0;f<Fb;f++){var v=Zn(g);c.set(g,v),g*=2}return c}}function vx(c){en!==null&&typeof en.markCommitStarted=="function"&&en.markCommitStarted(c)}function cB(){en!==null&&typeof en.markCommitStopped=="function"&&en.markCommitStopped()}function VC(c){en!==null&&typeof en.markComponentRenderStarted=="function"&&en.markComponentRenderStarted(c)}function fu(){en!==null&&typeof en.markComponentRenderStopped=="function"&&en.markComponentRenderStopped()}function gB(c){en!==null&&typeof en.markComponentPassiveEffectMountStarted=="function"&&en.markComponentPassiveEffectMountStarted(c)}function yx(){en!==null&&typeof en.markComponentPassiveEffectMountStopped=="function"&&en.markComponentPassiveEffectMountStopped()}function Gx(c){en!==null&&typeof en.markComponentPassiveEffectUnmountStarted=="function"&&en.markComponentPassiveEffectUnmountStarted(c)}function Bx(){en!==null&&typeof en.markComponentPassiveEffectUnmountStopped=="function"&&en.markComponentPassiveEffectUnmountStopped()}function Zx(c){en!==null&&typeof en.markComponentLayoutEffectMountStarted=="function"&&en.markComponentLayoutEffectMountStarted(c)}function Sx(){en!==null&&typeof en.markComponentLayoutEffectMountStopped=="function"&&en.markComponentLayoutEffectMountStopped()}function uB(c){en!==null&&typeof en.markComponentLayoutEffectUnmountStarted=="function"&&en.markComponentLayoutEffectUnmountStarted(c)}function qb(){en!==null&&typeof en.markComponentLayoutEffectUnmountStopped=="function"&&en.markComponentLayoutEffectUnmountStopped()}function Rx(c,g,f){en!==null&&typeof en.markComponentErrored=="function"&&en.markComponentErrored(c,g,f)}function IB(c,g,f){en!==null&&typeof en.markComponentSuspended=="function"&&en.markComponentSuspended(c,g,f)}function wx(c){en!==null&&typeof en.markLayoutEffectsStarted=="function"&&en.markLayoutEffectsStarted(c)}function xx(){en!==null&&typeof en.markLayoutEffectsStopped=="function"&&en.markLayoutEffectsStopped()}function $b(c){en!==null&&typeof en.markPassiveEffectsStarted=="function"&&en.markPassiveEffectsStarted(c)}function vn(){en!==null&&typeof en.markPassiveEffectsStopped=="function"&&en.markPassiveEffectsStopped()}function ei(c){en!==null&&typeof en.markRenderStarted=="function"&&en.markRenderStarted(c)}function xi(){en!==null&&typeof en.markRenderYielded=="function"&&en.markRenderYielded()}function la(){en!==null&&typeof en.markRenderStopped=="function"&&en.markRenderStopped()}function yl(c){en!==null&&typeof en.markRenderScheduled=="function"&&en.markRenderScheduled(c)}function dB(c,g){en!==null&&typeof en.markForceUpdateScheduled=="function"&&en.markForceUpdateScheduled(c,g)}function ev(c,g){en!==null&&typeof en.markStateUpdateScheduled=="function"&&en.markStateUpdateScheduled(c,g)}function Wx(c,g){return c===g&&(c!==0||1/c===1/g)||c!==c&&g!==g}var gs=typeof Object.is=="function"?Object.is:Wx,Us=null,ft=!1,Ha=!1;function Vn(c){Us===null?Us=[c]:Us.push(c)}function OI(c){ft=!0,Vn(c)}function Gl(){ft&&Vr()}function Vr(){if(!Ha&&Us!==null){Ha=!0;var c=0,g=Ds();try{var f=!0,v=Us;for(rr(_s);c<v.length;c++){var B=v[c];do B=B(f);while(B!==null)}Us=null,ft=!1}catch(V){throw Us!==null&&(Us=Us.slice(c+1)),sB(_a,Vr),V}finally{rr(g),Ha=!1}}return null}function Js(c){var g=c.current.memoizedState;return g.isDehydrated}var MC=o.ReactCurrentBatchConfig,PI=null;function NC(){return MC.transition}function QI(c,g){if(gs(c,g))return!0;if(typeof c!="object"||c===null||typeof g!="object"||g===null)return!1;var f=Object.keys(c),v=Object.keys(g);if(f.length!==v.length)return!1;for(var B=0;B<f.length;B++){var V=f[B];if(!jG.call(g,V)||!gs(c[V],g[V]))return!1}return!0}function tv(c){switch(c._debugOwner&&c._debugOwner.type,c._debugSource,c.tag){case le:return qc(c.type);case ot:return qc("Lazy");case We:return qc("Suspense");case bt:return qc("SuspenseList");case L:case E:case $e:return Vb(c.type);case de:return Vb(c.type.render);case k:return QG(c.type);default:return""}}function Nf(c){try{var g="",f=c;do g+=tv(f),f=f.return;while(f);return g}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}var Hf=o.ReactDebugCurrentFrame,vo=null,pu=!1;function nv(){{if(vo===null)return null;var c=vo._debugOwner;if(c!==null&&typeof c<"u")return De(c)}return null}function iv(){return vo===null?"":Nf(vo)}function lr(){Hf.getCurrentStack=null,vo=null,pu=!1}function Xa(c){Hf.getCurrentStack=iv,vo=c,pu=!1}function us(c){pu=c}var ko={recordUnsafeLifecycleWarnings:function(c,g){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(c,g){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}};{var av=function(c){for(var g=null,f=c;f!==null;)f.mode&Ia&&(g=f),f=f.return;return g},ac=function(c){var g=[];return c.forEach(function(f){g.push(f)}),g.sort().join(", ")},mu=[],og=[],Bl=[],bu=[],vu=[],yu=[],rc=new Set;ko.recordUnsafeLifecycleWarnings=function(c,g){rc.has(c.type)||(typeof g.componentWillMount=="function"&&g.componentWillMount.__suppressDeprecationWarning!==!0&&mu.push(c),c.mode&Ia&&typeof g.UNSAFE_componentWillMount=="function"&&og.push(c),typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps.__suppressDeprecationWarning!==!0&&Bl.push(c),c.mode&Ia&&typeof g.UNSAFE_componentWillReceiveProps=="function"&&bu.push(c),typeof g.componentWillUpdate=="function"&&g.componentWillUpdate.__suppressDeprecationWarning!==!0&&vu.push(c),c.mode&Ia&&typeof g.UNSAFE_componentWillUpdate=="function"&&yu.push(c))},ko.flushPendingUnsafeLifecycleWarnings=function(){var c=new Set;mu.length>0&&(mu.forEach(function(Je){c.add(De(Je)||"Component"),rc.add(Je.type)}),mu=[]);var g=new Set;og.length>0&&(og.forEach(function(Je){g.add(De(Je)||"Component"),rc.add(Je.type)}),og=[]);var f=new Set;Bl.length>0&&(Bl.forEach(function(Je){f.add(De(Je)||"Component"),rc.add(Je.type)}),Bl=[]);var v=new Set;bu.length>0&&(bu.forEach(function(Je){v.add(De(Je)||"Component"),rc.add(Je.type)}),bu=[]);var B=new Set;vu.length>0&&(vu.forEach(function(Je){B.add(De(Je)||"Component"),rc.add(Je.type)}),vu=[]);var V=new Set;if(yu.length>0&&(yu.forEach(function(Je){V.add(De(Je)||"Component"),rc.add(Je.type)}),yu=[]),g.size>0){var H=ac(g);C(`Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.

Please update the following components: %s`,H)}if(v.size>0){var _=ac(v);C(`Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state

Please update the following components: %s`,_)}if(V.size>0){var O=ac(V);C(`Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.

Please update the following components: %s`,O)}if(c.size>0){var oe=ac(c);d(`componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.
* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,oe)}if(f.size>0){var Ie=ac(f);d(`componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state
* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,Ie)}if(B.size>0){var xe=ac(B);d(`componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,xe)}};var HC=new Map,jI=new Set;ko.recordLegacyContextWarning=function(c,g){var f=av(c);if(f===null){C("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.");return}if(!jI.has(c.type)){var v=HC.get(f);(c.type.contextTypes!=null||c.type.childContextTypes!=null||g!==null&&typeof g.getChildContext=="function")&&(v===void 0&&(v=[],HC.set(f,v)),v.push(c))}},ko.flushLegacyContextWarning=function(){HC.forEach(function(c,g){if(c.length!==0){var f=c[0],v=new Set;c.forEach(function(V){v.add(De(V)||"Component"),jI.add(V.type)});var B=ac(v);try{Xa(f),C(`Legacy context API has been detected within a strict-mode tree.

The old API will be supported in all 16.x releases, but applications using it should migrate to the new version.

Please update the following components: %s

Learn more about this warning here: https://reactjs.org/link/legacy-context`,B)}finally{lr()}}})},ko.discardPendingWarnings=function(){mu=[],og=[],Bl=[],bu=[],vu=[],yu=[],HC=new Map}}function rv(c){{var g=typeof Symbol=="function"&&Symbol.toStringTag,f=g&&c[Symbol.toStringTag]||c.constructor.name||"Object";return f}}function qI(c){try{return oc(c),!1}catch{return!0}}function oc(c){return""+c}function Uo(c){if(qI(c))return C("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",rv(c)),oc(c)}function Vx(c,g){if(qI(c))return C("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.",g,rv(c)),oc(c)}function ai(c,g){if(c&&c.defaultProps){var f=p({},g),v=c.defaultProps;for(var B in v)f[B]===void 0&&(f[B]=v[B]);return f}return g}var Gu=$c(null),sg;sg={};var lg=null,sc=null,ov=null,Xf=!1;function Ff(){lg=null,sc=null,ov=null,Xf=!1}function CB(){Xf=!0}function Yf(){Xf=!1}function hB(c,g,f){Oc?(hr(Gu,g._currentValue,c),g._currentValue=f,g._currentRenderer!==void 0&&g._currentRenderer!==null&&g._currentRenderer!==sg&&C("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),g._currentRenderer=sg):(hr(Gu,g._currentValue2,c),g._currentValue2=f,g._currentRenderer2!==void 0&&g._currentRenderer2!==null&&g._currentRenderer2!==sg&&C("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),g._currentRenderer2=sg)}function XC(c,g){var f=Gu.current;xr(Gu,g),Oc?c._currentValue=f:c._currentValue2=f}function Tf(c,g,f){for(var v=c;v!==null;){var B=v.alternate;if(nc(v.childLanes,g)?B!==null&&!nc(B.childLanes,g)&&(B.childLanes=En(B.childLanes,g)):(v.childLanes=En(v.childLanes,g),B!==null&&(B.childLanes=En(B.childLanes,g))),v===f)break;v=v.return}v!==f&&C("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function Mx(c,g,f){Nx(c,g,f)}function Nx(c,g,f){var v=c.child;for(v!==null&&(v.return=c);v!==null;){var B=void 0,V=v.dependencies;if(V!==null){B=v.child;for(var H=V.firstContext;H!==null;){if(H.context===g){if(v.tag===k){var _=Au(f),O=Ig(Zi,_);O.tag=Zl;var oe=v.updateQueue;if(oe!==null){var Ie=oe.shared,xe=Ie.pending;xe===null?O.next=O:(O.next=xe.next,xe.next=O),Ie.pending=O}}v.lanes=En(v.lanes,f);var Je=v.alternate;Je!==null&&(Je.lanes=En(Je.lanes,f)),Tf(v.return,f,c),V.lanes=En(V.lanes,f);break}H=H.next}}else if(v.tag===pe)B=v.type===c.type?null:v.child;else if(v.tag===tt){var it=v.return;if(it===null)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");it.lanes=En(it.lanes,f);var vt=it.alternate;vt!==null&&(vt.lanes=En(vt.lanes,f)),Tf(it,f,c),B=v.sibling}else B=v.child;if(B!==null)B.return=v;else for(B=v;B!==null;){if(B===c){B=null;break}var xt=B.sibling;if(xt!==null){xt.return=B.return,B=xt;break}B=B.return}v=B}}function lc(c,g){lg=c,sc=null,ov=null;var f=c.dependencies;if(f!==null){var v=f.firstContext;v!==null&&(va(f.lanes,g)&&xp(),f.firstContext=null)}}function Fa(c){Xf&&C("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var g=Oc?c._currentValue:c._currentValue2;if(ov!==c){var f={context:c,memoizedValue:g,next:null};if(sc===null){if(lg===null)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");sc=f,lg.dependencies={lanes:Bt,firstContext:f}}else sc=sc.next=f}return g}var cg=null;function sv(c){cg===null?cg=[c]:cg.push(c)}function Hx(){if(cg!==null){for(var c=0;c<cg.length;c++){var g=cg[c],f=g.interleaved;if(f!==null){g.interleaved=null;var v=f.next,B=g.pending;if(B!==null){var V=B.next;B.next=v,f.next=V}g.pending=f}}cg=null}}var gg=0,$I=1,Zl=2,FC=3,Mr=!1,ug,Hn;ug=!1,Hn=null;function ed(c){var g={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:Bt},effects:null};c.updateQueue=g}function lv(c,g){var f=g.updateQueue,v=c.updateQueue;if(f===v){var B={baseState:v.baseState,firstBaseUpdate:v.firstBaseUpdate,lastBaseUpdate:v.lastBaseUpdate,shared:v.shared,effects:v.effects};g.updateQueue=B}}function Ig(c,g){var f={eventTime:c,lane:g,tag:gg,payload:null,callback:null,next:null};return f}function dg(c,g,f){var v=c.updateQueue;if(v!==null){var B=v.shared;if(Sa(c)){var V=B.interleaved;V===null?(g.next=g,sv(B)):(g.next=V.next,V.next=g),B.interleaved=g}else{var H=B.pending;H===null?g.next=g:(g.next=H.next,H.next=g),B.pending=g}Hn===B&&!ug&&(C("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),ug=!0)}}function td(c,g,f){var v=g.updateQueue;if(v!==null){var B=v.shared;if(zI(f)){var V=B.lanes;V=DI(V,c.pendingLanes);var H=En(V,f);B.lanes=H,Ob(c,H)}}}function Bu(c,g){var f=c.updateQueue,v=c.alternate;if(v!==null){var B=v.updateQueue;if(f===B){var V=null,H=null,_=f.firstBaseUpdate;if(_!==null){var O=_;do{var oe={eventTime:O.eventTime,lane:O.lane,tag:O.tag,payload:O.payload,callback:O.callback,next:null};H===null?V=H=oe:(H.next=oe,H=oe),O=O.next}while(O!==null);H===null?V=H=g:(H.next=g,H=g)}else V=H=g;f={baseState:B.baseState,firstBaseUpdate:V,lastBaseUpdate:H,shared:B.shared,effects:B.effects},c.updateQueue=f;return}}var Ie=f.lastBaseUpdate;Ie===null?f.firstBaseUpdate=g:Ie.next=g,f.lastBaseUpdate=g}function Xx(c,g,f,v,B,V){switch(f.tag){case $I:{var H=f.payload;if(typeof H=="function"){CB();var _=H.call(V,v,B);{if(c.mode&Ia){sr(!0);try{H.call(V,v,B)}finally{sr(!1)}}Yf()}return _}return H}case FC:c.flags=c.flags&~Te|un;case gg:{var O=f.payload,oe;if(typeof O=="function"){CB(),oe=O.call(V,v,B);{if(c.mode&Ia){sr(!0);try{O.call(V,v,B)}finally{sr(!1)}}Yf()}}else oe=O;return oe==null?v:p({},v,oe)}case Zl:return Mr=!0,v}return v}function YC(c,g,f,v){var B=c.updateQueue;Mr=!1,Hn=B.shared;var V=B.firstBaseUpdate,H=B.lastBaseUpdate,_=B.shared.pending;if(_!==null){B.shared.pending=null;var O=_,oe=O.next;O.next=null,H===null?V=oe:H.next=oe,H=O;var Ie=c.alternate;if(Ie!==null){var xe=Ie.updateQueue,Je=xe.lastBaseUpdate;Je!==H&&(Je===null?xe.firstBaseUpdate=oe:Je.next=oe,xe.lastBaseUpdate=O)}}if(V!==null){var it=B.baseState,vt=Bt,xt=null,fn=null,Kn=null,Gn=V;do{var Qi=Gn.lane,Di=Gn.eventTime;if(nc(v,Qi)){if(Kn!==null){var lt={eventTime:Di,lane:Na,tag:Gn.tag,payload:Gn.payload,callback:Gn.callback,next:null};Kn=Kn.next=lt}it=Xx(c,B,Gn,it,g,f);var we=Gn.callback;if(we!==null&&Gn.lane!==Na){c.flags|=Yn;var Mt=B.effects;Mt===null?B.effects=[Gn]:Mt.push(Gn)}}else{var Ye={eventTime:Di,lane:Qi,tag:Gn.tag,payload:Gn.payload,callback:Gn.callback,next:null};Kn===null?(fn=Kn=Ye,xt=it):Kn=Kn.next=Ye,vt=En(vt,Qi)}if(Gn=Gn.next,Gn===null){if(_=B.shared.pending,_===null)break;var rn=_,nn=rn.next;rn.next=null,Gn=nn,B.lastBaseUpdate=rn,B.shared.pending=null}}while(!0);Kn===null&&(xt=it),B.baseState=xt,B.firstBaseUpdate=fn,B.lastBaseUpdate=Kn;var jn=B.shared.interleaved;if(jn!==null){var _n=jn;do vt=En(vt,_n.lane),_n=_n.next;while(_n!==jn)}else V===null&&(B.shared.lanes=Bt);Qp(vt),c.lanes=vt,c.memoizedState=it}Hn=null}function Fx(c,g){if(typeof c!="function")throw new Error("Invalid argument passed as callback. Expected a function. Instead "+("received: "+c));c.call(g)}function Ef(){Mr=!1}function Kf(){return Mr}function cv(c,g,f){var v=g.effects;if(g.effects=null,v!==null)for(var B=0;B<v.length;B++){var V=v[B],H=V.callback;H!==null&&(V.callback=null,Fx(H,f))}}var Lf={},gv=new n.Component().refs,jr,Os,Ps,nd,Zu,Is,ya,uv,Iv,dv;{jr=new Set,Os=new Set,Ps=new Set,nd=new Set,uv=new Set,Zu=new Set,Iv=new Set,dv=new Set;var zf=new Set;ya=function(c,g){if(!(c===null||typeof c=="function")){var f=g+"_"+c;zf.has(f)||(zf.add(f),C("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",g,c))}},Is=function(c,g){if(g===void 0){var f=Me(c)||"Component";Zu.has(f)||(Zu.add(f),C("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",f))}},Object.defineProperty(Lf,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(Lf)}function _f(c,g,f,v){var B=c.memoizedState,V=f(v,B);{if(c.mode&Ia){sr(!0);try{V=f(v,B)}finally{sr(!1)}}Is(g,V)}var H=V==null?B:p({},B,V);if(c.memoizedState=H,c.lanes===Bt){var _=c.updateQueue;_.baseState=H}}var id={isMounted:Rn,enqueueSetState:function(c,g,f){var v=m(c),B=Kr(),V=Vl(v),H=Ig(B,V);H.payload=g,f!=null&&(ya(f,"setState"),H.callback=f),dg(v,H);var _=Pa(v,V,B);_!==null&&td(_,v,V),ev(v,V)},enqueueReplaceState:function(c,g,f){var v=m(c),B=Kr(),V=Vl(v),H=Ig(B,V);H.tag=$I,H.payload=g,f!=null&&(ya(f,"replaceState"),H.callback=f),dg(v,H);var _=Pa(v,V,B);_!==null&&td(_,v,V),ev(v,V)},enqueueForceUpdate:function(c,g){var f=m(c),v=Kr(),B=Vl(f),V=Ig(v,B);V.tag=Zl,g!=null&&(ya(g,"forceUpdate"),V.callback=g),dg(f,V);var H=Pa(f,B,v);H!==null&&td(H,f,B),dB(f,B)}};function Cv(c,g,f,v,B,V,H){var _=c.stateNode;if(typeof _.shouldComponentUpdate=="function"){var O=_.shouldComponentUpdate(v,V,H);{if(c.mode&Ia){sr(!0);try{O=_.shouldComponentUpdate(v,V,H)}finally{sr(!1)}}O===void 0&&C("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",Me(g)||"Component")}return O}return g.prototype&&g.prototype.isPureReactComponent?!QI(f,v)||!QI(B,V):!0}function Yx(c,g,f){var v=c.stateNode;{var B=Me(g)||"Component",V=v.render;V||(g.prototype&&typeof g.prototype.render=="function"?C("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",B):C("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",B)),v.getInitialState&&!v.getInitialState.isReactClassApproved&&!v.state&&C("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",B),v.getDefaultProps&&!v.getDefaultProps.isReactClassApproved&&C("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",B),v.propTypes&&C("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",B),v.contextType&&C("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",B),v.contextTypes&&C("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",B),g.contextType&&g.contextTypes&&!Iv.has(g)&&(Iv.add(g),C("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",B)),typeof v.componentShouldUpdate=="function"&&C("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",B),g.prototype&&g.prototype.isPureReactComponent&&typeof v.shouldComponentUpdate<"u"&&C("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",Me(g)||"A pure component"),typeof v.componentDidUnmount=="function"&&C("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",B),typeof v.componentDidReceiveProps=="function"&&C("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",B),typeof v.componentWillRecieveProps=="function"&&C("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",B),typeof v.UNSAFE_componentWillRecieveProps=="function"&&C("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",B);var H=v.props!==f;v.props!==void 0&&H&&C("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",B,B),v.defaultProps&&C("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",B,B),typeof v.getSnapshotBeforeUpdate=="function"&&typeof v.componentDidUpdate!="function"&&!Ps.has(g)&&(Ps.add(g),C("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",Me(g))),typeof v.getDerivedStateFromProps=="function"&&C("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",B),typeof v.getDerivedStateFromError=="function"&&C("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",B),typeof g.getSnapshotBeforeUpdate=="function"&&C("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",B);var _=v.state;_&&(typeof _!="object"||Fi(_))&&C("%s.state: must be set to an object or null",B),typeof v.getChildContext=="function"&&typeof g.childContextTypes!="object"&&C("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",B)}}function AB(c,g){g.updater=id,c.stateNode=g,y(g,c),g._reactInternalInstance=Lf}function Df(c,g,f){var v=!1,B=Jr,V=Jr,H=g.contextType;if("contextType"in g){var _=H===null||H!==void 0&&H.$$typeof===Ct&&H._context===void 0;if(!_&&!dv.has(g)){dv.add(g);var O="";H===void 0?O=" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":typeof H!="object"?O=" However, it is set to a "+typeof H+".":H.$$typeof===ht?O=" Did you accidentally pass the Context.Provider instead?":H._context!==void 0?O=" Did you accidentally pass the Context.Consumer instead?":O=" However, it is set to an object with keys {"+Object.keys(H).join(", ")+"}.",C("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",Me(g)||"Component",O)}}if(typeof H=="object"&&H!==null)V=Fa(H);else{B=Ys(c,g,!0);var oe=g.contextTypes;v=oe!=null,V=v?EI(c,B):Jr}var Ie=new g(f,V);if(c.mode&Ia){sr(!0);try{Ie=new g(f,V)}finally{sr(!1)}}var xe=c.memoizedState=Ie.state!==null&&Ie.state!==void 0?Ie.state:null;AB(c,Ie);{if(typeof g.getDerivedStateFromProps=="function"&&xe===null){var Je=Me(g)||"Component";Os.has(Je)||(Os.add(Je),C("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",Je,Ie.state===null?"null":"undefined",Je))}if(typeof g.getDerivedStateFromProps=="function"||typeof Ie.getSnapshotBeforeUpdate=="function"){var it=null,vt=null,xt=null;if(typeof Ie.componentWillMount=="function"&&Ie.componentWillMount.__suppressDeprecationWarning!==!0?it="componentWillMount":typeof Ie.UNSAFE_componentWillMount=="function"&&(it="UNSAFE_componentWillMount"),typeof Ie.componentWillReceiveProps=="function"&&Ie.componentWillReceiveProps.__suppressDeprecationWarning!==!0?vt="componentWillReceiveProps":typeof Ie.UNSAFE_componentWillReceiveProps=="function"&&(vt="UNSAFE_componentWillReceiveProps"),typeof Ie.componentWillUpdate=="function"&&Ie.componentWillUpdate.__suppressDeprecationWarning!==!0?xt="componentWillUpdate":typeof Ie.UNSAFE_componentWillUpdate=="function"&&(xt="UNSAFE_componentWillUpdate"),it!==null||vt!==null||xt!==null){var fn=Me(g)||"Component",Kn=typeof g.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";nd.has(fn)||(nd.add(fn),C(`Unsafe legacy lifecycles will not be called for components using new component APIs.

%s uses %s but also contains the following legacy lifecycles:%s%s%s

The above lifecycles should be removed. Learn more about this warning here:
https://reactjs.org/link/unsafe-component-lifecycles`,fn,Kn,it!==null?`
  `+it:"",vt!==null?`
  `+vt:"",xt!==null?`
  `+xt:""))}}}return v&&eB(c,B,V),Ie}function Tx(c,g){var f=g.state;typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),f!==g.state&&(C("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",De(c)||"Component"),id.enqueueReplaceState(g,g.state,null))}function hv(c,g,f,v){var B=g.state;if(typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(f,v),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(f,v),g.state!==B){{var V=De(c)||"Component";jr.has(V)||(jr.add(V),C("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",V))}id.enqueueReplaceState(g,g.state,null)}}function Av(c,g,f,v){Yx(c,g,f);var B=c.stateNode;B.props=f,B.state=c.memoizedState,B.refs=gv,ed(c);var V=g.contextType;if(typeof V=="object"&&V!==null)B.context=Fa(V);else{var H=Ys(c,g,!0);B.context=EI(c,H)}{if(B.state===f){var _=Me(g)||"Component";uv.has(_)||(uv.add(_),C("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",_))}c.mode&Ia&&ko.recordLegacyContextWarning(c,B),ko.recordUnsafeLifecycleWarnings(c,B)}B.state=c.memoizedState;var O=g.getDerivedStateFromProps;if(typeof O=="function"&&(_f(c,g,O,f),B.state=c.memoizedState),typeof g.getDerivedStateFromProps!="function"&&typeof B.getSnapshotBeforeUpdate!="function"&&(typeof B.UNSAFE_componentWillMount=="function"||typeof B.componentWillMount=="function")&&(Tx(c,B),YC(c,f,B,v),B.state=c.memoizedState),typeof B.componentDidMount=="function"){var oe=Be;oe|=dn,(c.mode&bo)!==Nn&&(oe|=D),c.flags|=oe}}function fB(c,g,f,v){var B=c.stateNode,V=c.memoizedProps;B.props=V;var H=B.context,_=g.contextType,O=Jr;if(typeof _=="object"&&_!==null)O=Fa(_);else{var oe=Ys(c,g,!0);O=EI(c,oe)}var Ie=g.getDerivedStateFromProps,xe=typeof Ie=="function"||typeof B.getSnapshotBeforeUpdate=="function";!xe&&(typeof B.UNSAFE_componentWillReceiveProps=="function"||typeof B.componentWillReceiveProps=="function")&&(V!==f||H!==O)&&hv(c,B,f,O),Ef();var Je=c.memoizedState,it=B.state=Je;if(YC(c,f,B,v),it=c.memoizedState,V===f&&Je===it&&!bf()&&!Kf()){if(typeof B.componentDidMount=="function"){var vt=Be;vt|=dn,(c.mode&bo)!==Nn&&(vt|=D),c.flags|=vt}return!1}typeof Ie=="function"&&(_f(c,g,Ie,f),it=c.memoizedState);var xt=Kf()||Cv(c,g,V,f,Je,it,O);if(xt){if(!xe&&(typeof B.UNSAFE_componentWillMount=="function"||typeof B.componentWillMount=="function")&&(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"){var fn=Be;fn|=dn,(c.mode&bo)!==Nn&&(fn|=D),c.flags|=fn}}else{if(typeof B.componentDidMount=="function"){var Kn=Be;Kn|=dn,(c.mode&bo)!==Nn&&(Kn|=D),c.flags|=Kn}c.memoizedProps=f,c.memoizedState=it}return B.props=f,B.state=it,B.context=O,xt}function Ex(c,g,f,v,B){var V=g.stateNode;lv(c,g);var H=g.memoizedProps,_=g.type===g.elementType?H:ai(g.type,H);V.props=_;var O=g.pendingProps,oe=V.context,Ie=f.contextType,xe=Jr;if(typeof Ie=="object"&&Ie!==null)xe=Fa(Ie);else{var Je=Ys(g,f,!0);xe=EI(g,Je)}var it=f.getDerivedStateFromProps,vt=typeof it=="function"||typeof V.getSnapshotBeforeUpdate=="function";!vt&&(typeof V.UNSAFE_componentWillReceiveProps=="function"||typeof V.componentWillReceiveProps=="function")&&(H!==O||oe!==xe)&&hv(g,V,v,xe),Ef();var xt=g.memoizedState,fn=V.state=xt;if(YC(g,v,V,B),fn=g.memoizedState,H===O&&xt===fn&&!bf()&&!Kf()&&!R)return typeof V.componentDidUpdate=="function"&&(H!==c.memoizedProps||xt!==c.memoizedState)&&(g.flags|=Be),typeof V.getSnapshotBeforeUpdate=="function"&&(H!==c.memoizedProps||xt!==c.memoizedState)&&(g.flags|=bi),!1;typeof it=="function"&&(_f(g,f,it,v),fn=g.memoizedState);var Kn=Kf()||Cv(g,f,_,v,xt,fn,xe)||R;return Kn?(!vt&&(typeof V.UNSAFE_componentWillUpdate=="function"||typeof V.componentWillUpdate=="function")&&(typeof V.componentWillUpdate=="function"&&V.componentWillUpdate(v,fn,xe),typeof V.UNSAFE_componentWillUpdate=="function"&&V.UNSAFE_componentWillUpdate(v,fn,xe)),typeof V.componentDidUpdate=="function"&&(g.flags|=Be),typeof V.getSnapshotBeforeUpdate=="function"&&(g.flags|=bi)):(typeof V.componentDidUpdate=="function"&&(H!==c.memoizedProps||xt!==c.memoizedState)&&(g.flags|=Be),typeof V.getSnapshotBeforeUpdate=="function"&&(H!==c.memoizedProps||xt!==c.memoizedState)&&(g.flags|=bi),g.memoizedProps=v,g.memoizedState=fn),V.props=v,V.state=fn,V.context=xe,Kn}var Su=[],ad=0,rd=null,Ru=0,Da=[],ka=0,yo=null,Jo=1,Oo="";function Cg(c){return Wu(),(c.flags&Vt)!==Q}function Kx(c){return Wu(),Ru}function Lx(){var c=Oo,g=Jo,f=g&~pB(g);return f.toString(32)+c}function wu(c,g){Wu(),Su[ad++]=Ru,Su[ad++]=rd,rd=c,Ru=g}function fv(c,g,f){Wu(),Da[ka++]=Jo,Da[ka++]=Oo,Da[ka++]=yo,yo=c;var v=Jo,B=Oo,V=kf(v)-1,H=v&~(1<<V),_=f+1,O=kf(g)+V;if(O>30){var oe=V-V%5,Ie=(1<<oe)-1,xe=(H&Ie).toString(32),Je=H>>oe,it=V-oe,vt=kf(g)+it,xt=_<<it,fn=xt|Je,Kn=xe+B;Jo=1<<vt|fn,Oo=Kn}else{var Gn=_<<V,Qi=Gn|H,Di=B;Jo=1<<O|Qi,Oo=Di}}function xu(c){Wu();var g=c.return;if(g!==null){var f=1,v=0;wu(c,f),fv(c,f,v)}}function kf(c){return 32-iB(c)}function pB(c){return 1<<kf(c)-1}function pv(c){for(;c===rd;)rd=Su[--ad],Su[ad]=null,Ru=Su[--ad],Su[ad]=null;for(;c===yo;)yo=Da[--ka],Da[ka]=null,Oo=Da[--ka],Da[ka]=null,Jo=Da[--ka],Da[ka]=null}function Uf(){return Wu(),yo!==null?{id:Jo,overflow:Oo}:null}function mB(c,g){Wu(),Da[ka++]=Jo,Da[ka++]=Oo,Da[ka++]=yo,Jo=g.id,Oo=g.overflow,yo=c}function Wu(){Ar()||C("Expected to be hydrating. This is a bug in React. Please file an issue.")}var Ga=null,Nr=null,Hr=!1,cc=!1,gc=null;function zx(){Hr&&C("We should not be hydrating here. This is a bug in React. Please file a bug.")}function _x(){cc=!0}function Dx(c){if(!dr)return!1;var g=c.stateNode.containerInfo;return Nr=CC(g),Ga=c,Hr=!0,gc=null,cc=!1,!0}function kx(c,g,f){return dr?(Nr=yb(g),Ga=c,Hr=!0,gc=null,cc=!1,f!==null&&mB(c,f),!0):!1}function Jf(c,g){switch(c.tag){case F:nx(c.stateNode.containerInfo,g);break;case le:ix(c.type,c.memoizedProps,c.stateNode,g);break;case We:var f=c.memoizedState;f.dehydrated!==null&&Ol(f.dehydrated,g);break}}function bB(c,g){Jf(c,g);var f=TZ();f.stateNode=g,f.return=c;var v=c.deletions;v===null?(c.deletions=[f],c.flags|=wt):v.push(f)}function od(c,g){{if(cc)return;switch(c.tag){case F:{var f=c.stateNode.containerInfo;switch(g.tag){case le:var v=g.type,B=g.pendingProps;Zb(f,v,B);break;case ie:var V=g.pendingProps;Sb(f,V);break;case We:Rb(f);break}break}case le:{var H=c.type,_=c.memoizedProps,O=c.stateNode;switch(g.tag){case le:var oe=g.type,Ie=g.pendingProps;mo(H,_,O,oe,Ie);break;case ie:var xe=g.pendingProps;Pl(H,_,O,xe);break;case We:Ma(H,_,O);break}break}case We:{var Je=c.memoizedState,it=Je.dehydrated;if(it!==null)switch(g.tag){case le:var vt=g.type,xt=g.pendingProps;ax(it,vt,xt);break;case ie:var fn=g.pendingProps;If(it,fn);break;case We:_G(it);break}break}default:return}}}function Of(c,g){g.flags=g.flags&~Ui|be,od(c,g)}function mv(c,g){switch(c.tag){case le:{var f=c.type,v=c.pendingProps,B=wi(g,f,v);return B!==null?(c.stateNode=B,Ga=c,Nr=YI(B),!0):!1}case ie:{var V=c.pendingProps,H=Yi(g,V);return H!==null?(c.stateNode=H,Ga=c,Nr=null,!0):!1}case We:{{var _=Ti(g);if(_!==null){var O={dehydrated:_,treeContext:Uf(),retryLane:_o};c.memoizedState=O;var oe=EZ(_);return oe.return=c,c.child=oe,Ga=c,Nr=null,!0}}return!1}default:return!1}}function bv(c){return(c.mode&Hi)!==Nn&&(c.flags&un)===Q}function vv(c){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function yv(c){if(Hr){var g=Nr;if(!g){bv(c)&&(od(Ga,c),vv()),Of(Ga,c),Hr=!1,Ga=c;return}var f=g;if(!mv(c,g)){bv(c)&&(od(Ga,c),vv()),g=Xs(f);var v=Ga;if(!g||!mv(c,g)){Of(Ga,c),Hr=!1,Ga=c;return}bB(v,f)}}}function Ux(c,g,f){if(!dr)throw new Error("Expected prepareToHydrateHostInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var v=c.stateNode,B=!cc,V=Jl(v,c.type,c.memoizedProps,g,f,c,B);return c.updateQueue=V,V!==null}function TC(c){if(!dr)throw new Error("Expected prepareToHydrateHostTextInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var g=c.stateNode,f=c.memoizedProps,v=!cc,B=hC(g,f,c,v);if(B){var V=Ga;if(V!==null){var H=(V.mode&Hi)!==Nn;switch(V.tag){case F:{var _=V.stateNode.containerInfo;LG(_,g,f,H);break}case le:{var O=V.type,oe=V.memoizedProps,Ie=V.stateNode;zG(O,oe,Ie,g,f,H);break}}}}return B}function Gv(c){if(!dr)throw new Error("Expected prepareToHydrateHostSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var g=c.memoizedState,f=g!==null?g.dehydrated:null;if(!f)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");AC(f,c)}function EC(c){if(!dr)throw new Error("Expected skipPastDehydratedSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var g=c.memoizedState,f=g!==null?g.dehydrated:null;if(!f)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return Gb(f)}function vB(c){for(var g=c.return;g!==null&&g.tag!==le&&g.tag!==F&&g.tag!==We;)g=g.return;Ga=g}function KC(c){if(!dr||c!==Ga)return!1;if(!Hr)return vB(c),Hr=!0,!1;if(c.tag!==F&&(c.tag!==le||KG(c.type)&&!kr(c.type,c.memoizedProps))){var g=Nr;if(g)if(bv(c))Bv(c),vv();else for(;g;)bB(c,g),g=Xs(g)}return vB(c),c.tag===We?Nr=EC(c):Nr=Ga?Xs(c.stateNode):null,!0}function yB(){return Hr&&Nr!==null}function Bv(c){for(var g=Nr;g;)Jf(c,g),g=Xs(g)}function uc(){dr&&(Ga=null,Nr=null,Hr=!1,cc=!1)}function LC(){gc!==null&&(Yy(gc),gc=null)}function Ar(){return Hr}function qr(c){gc===null?gc=[c]:gc.push(c)}var hg,zC,Vu,Zv,_C,Pf=function(c,g){};hg=!1,zC=!1,Vu={},Zv={},_C={},Pf=function(c,g){if(!(c===null||typeof c!="object")&&!(!c._store||c._store.validated||c.key!=null)){if(typeof c._store!="object")throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");c._store.validated=!0;var f=De(g)||"Component";Zv[f]||(Zv[f]=!0,C('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};function Ic(c,g,f){var v=f.ref;if(v!==null&&typeof v!="function"&&typeof v!="object"){if((c.mode&Ia||W)&&!(f._owner&&f._self&&f._owner.stateNode!==f._self)){var B=De(c)||"Component";Vu[B]||(C('A string ref, "%s", has been found within a strict mode tree. String refs are a source of potential bugs and should be avoided. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',v),Vu[B]=!0)}if(f._owner){var V=f._owner,H;if(V){var _=V;if(_.tag!==k)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");H=_.stateNode}if(!H)throw new Error("Missing owner for string ref "+v+". This error is likely caused by a bug in React. Please file an issue.");var O=H;Vx(v,"ref");var oe=""+v;if(g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===oe)return g.ref;var Ie=function(xe){var Je=O.refs;Je===gv&&(Je=O.refs={}),xe===null?delete Je[oe]:Je[oe]=xe};return Ie._stringRef=oe,Ie}else{if(typeof v!="string")throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!f._owner)throw new Error("Element ref was specified as a string ("+v+`) but no owner was set. This could happen for one of the following reasons:
1. You may be adding a ref to a function component
2. You may be adding a ref to a component that was not created inside a component's render method
3. You have multiple copies of React loaded
See https://reactjs.org/link/refs-must-have-owner for more information.`)}}return v}function Qf(c,g){var f=Object.prototype.toString.call(g);throw new Error("Objects are not valid as a React child (found: "+(f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f)+"). If you meant to render a collection of children, use an array instead.")}function Mu(c){{var g=De(c)||"Component";if(_C[g])return;_C[g]=!0,C("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it.")}}function Sv(c){var g=c._payload,f=c._init;return f(g)}function GB(c){function g(Ye,lt){if(c){var we=Ye.deletions;we===null?(Ye.deletions=[lt],Ye.flags|=wt):we.push(lt)}}function f(Ye,lt){if(!c)return null;for(var we=lt;we!==null;)g(Ye,we),we=we.sibling;return null}function v(Ye,lt){for(var we=new Map,Mt=lt;Mt!==null;)Mt.key!==null?we.set(Mt.key,Mt):we.set(Mt.index,Mt),Mt=Mt.sibling;return we}function B(Ye,lt){var we=_g(Ye,lt);return we.index=0,we.sibling=null,we}function V(Ye,lt,we){if(Ye.index=we,!c)return Ye.flags|=Vt,lt;var Mt=Ye.alternate;if(Mt!==null){var rn=Mt.index;return rn<lt?(Ye.flags|=be,lt):rn}else return Ye.flags|=be,lt}function H(Ye){return c&&Ye.alternate===null&&(Ye.flags|=be),Ye}function _(Ye,lt,we,Mt){if(lt===null||lt.tag!==ie){var rn=im(we,Ye.mode,Mt);return rn.return=Ye,rn}else{var nn=B(lt,we);return nn.return=Ye,nn}}function O(Ye,lt,we,Mt){var rn=we.type;if(rn===te)return Ie(Ye,lt,we.props.children,Mt,we.key);if(lt!==null&&(lt.elementType===rn||gt(lt,we)||typeof rn=="object"&&rn!==null&&rn.$$typeof===fe&&Sv(rn)===lt.type)){var nn=B(lt,we.props);return nn.ref=Ic(Ye,lt,we),nn.return=Ye,nn._debugSource=we._source,nn._debugOwner=we._owner,nn}var jn=Uh(we,Ye.mode,Mt);return jn.ref=Ic(Ye,lt,we),jn.return=Ye,jn}function oe(Ye,lt,we,Mt){if(lt===null||lt.tag!==U||lt.stateNode.containerInfo!==we.containerInfo||lt.stateNode.implementation!==we.implementation){var rn=am(we,Ye.mode,Mt);return rn.return=Ye,rn}else{var nn=B(lt,we.children||[]);return nn.return=Ye,nn}}function Ie(Ye,lt,we,Mt,rn){if(lt===null||lt.tag!==Ce){var nn=aI(we,Ye.mode,Mt,rn);return nn.return=Ye,nn}else{var jn=B(lt,we);return jn.return=Ye,jn}}function xe(Ye,lt,we){if(typeof lt=="string"&&lt!==""||typeof lt=="number"){var Mt=im(""+lt,Ye.mode,we);return Mt.return=Ye,Mt}if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case Ue:{var rn=Uh(lt,Ye.mode,we);return rn.ref=Ic(Ye,null,lt),rn.return=Ye,rn}case Pe:{var nn=am(lt,Ye.mode,we);return nn.return=Ye,nn}case fe:{var jn=lt._payload,_n=lt._init;return xe(Ye,_n(jn),we)}}if(Fi(lt)||ue(lt)){var Ni=aI(lt,Ye.mode,we,null);return Ni.return=Ye,Ni}Qf(Ye,lt)}return typeof lt=="function"&&Mu(Ye),null}function Je(Ye,lt,we,Mt){var rn=lt!==null?lt.key:null;if(typeof we=="string"&&we!==""||typeof we=="number")return rn!==null?null:_(Ye,lt,""+we,Mt);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case Ue:return we.key===rn?O(Ye,lt,we,Mt):null;case Pe:return we.key===rn?oe(Ye,lt,we,Mt):null;case fe:{var nn=we._payload,jn=we._init;return Je(Ye,lt,jn(nn),Mt)}}if(Fi(we)||ue(we))return rn!==null?null:Ie(Ye,lt,we,Mt,null);Qf(Ye,we)}return typeof we=="function"&&Mu(Ye),null}function it(Ye,lt,we,Mt,rn){if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number"){var nn=Ye.get(we)||null;return _(lt,nn,""+Mt,rn)}if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case Ue:{var jn=Ye.get(Mt.key===null?we:Mt.key)||null;return O(lt,jn,Mt,rn)}case Pe:{var _n=Ye.get(Mt.key===null?we:Mt.key)||null;return oe(lt,_n,Mt,rn)}case fe:{var Ni=Mt._payload,pi=Mt._init;return it(Ye,lt,we,pi(Ni),rn)}}if(Fi(Mt)||ue(Mt)){var $i=Ye.get(we)||null;return Ie(lt,$i,Mt,rn,null)}Qf(lt,Mt)}return typeof Mt=="function"&&Mu(lt),null}function vt(Ye,lt,we){{if(typeof Ye!="object"||Ye===null)return lt;switch(Ye.$$typeof){case Ue:case Pe:Pf(Ye,we);var Mt=Ye.key;if(typeof Mt!="string")break;if(lt===null){lt=new Set,lt.add(Mt);break}if(!lt.has(Mt)){lt.add(Mt);break}C("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.",Mt);break;case fe:{var rn=Ye._payload,nn=Ye._init;vt(nn(rn),lt,we);break}}}return lt}function xt(Ye,lt,we,Mt){for(var rn=null,nn=0;nn<we.length;nn++){var jn=we[nn];rn=vt(jn,rn,Ye)}for(var _n=null,Ni=null,pi=lt,$i=0,oi=0,Dn=null;pi!==null&&oi<we.length;oi++){pi.index>oi?(Dn=pi,pi=null):Dn=pi.sibling;var ga=Je(Ye,pi,we[oi],Mt);if(ga===null){pi===null&&(pi=Dn);break}c&&pi&&ga.alternate===null&&g(Ye,pi),$i=V(ga,$i,oi),Ni===null?_n=ga:Ni.sibling=ga,Ni=ga,pi=Dn}if(oi===we.length){if(f(Ye,pi),Ar()){var na=oi;wu(Ye,na)}return _n}if(pi===null){for(;oi<we.length;oi++){var io=xe(Ye,we[oi],Mt);io!==null&&($i=V(io,$i,oi),Ni===null?_n=io:Ni.sibling=io,Ni=io)}if(Ar()){var ja=oi;wu(Ye,ja)}return _n}for(var ao=v(Ye,pi);oi<we.length;oi++){var ro=it(ao,Ye,oi,we[oi],Mt);ro!==null&&(c&&ro.alternate!==null&&ao.delete(ro.key===null?oi:ro.key),$i=V(ro,$i,oi),Ni===null?_n=ro:Ni.sibling=ro,Ni=ro)}if(c&&ao.forEach(function(oI){return g(Ye,oI)}),Ar()){var Wo=oi;wu(Ye,Wo)}return _n}function fn(Ye,lt,we,Mt){var rn=ue(we);if(typeof rn!="function")throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");{typeof Symbol=="function"&&we[Symbol.toStringTag]==="Generator"&&(zC||C("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),zC=!0),we.entries===rn&&(hg||C("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),hg=!0);var nn=rn.call(we);if(nn)for(var jn=null,_n=nn.next();!_n.done;_n=nn.next()){var Ni=_n.value;jn=vt(Ni,jn,Ye)}}var pi=rn.call(we);if(pi==null)throw new Error("An iterable object provided no iterator.");for(var $i=null,oi=null,Dn=lt,ga=0,na=0,io=null,ja=pi.next();Dn!==null&&!ja.done;na++,ja=pi.next()){Dn.index>na?(io=Dn,Dn=null):io=Dn.sibling;var ao=Je(Ye,Dn,ja.value,Mt);if(ao===null){Dn===null&&(Dn=io);break}c&&Dn&&ao.alternate===null&&g(Ye,Dn),ga=V(ao,ga,na),oi===null?$i=ao:oi.sibling=ao,oi=ao,Dn=io}if(ja.done){if(f(Ye,Dn),Ar()){var ro=na;wu(Ye,ro)}return $i}if(Dn===null){for(;!ja.done;na++,ja=pi.next()){var Wo=xe(Ye,ja.value,Mt);Wo!==null&&(ga=V(Wo,ga,na),oi===null?$i=Wo:oi.sibling=Wo,oi=Wo)}if(Ar()){var oI=na;wu(Ye,oI)}return $i}for(var Dg=v(Ye,Dn);!ja.done;na++,ja=pi.next()){var oo=it(Dg,Ye,na,ja.value,Mt);oo!==null&&(c&&oo.alternate!==null&&Dg.delete(oo.key===null?na:oo.key),ga=V(oo,ga,na),oi===null?$i=oo:oi.sibling=oo,oi=oo)}if(c&&Dg.forEach(function(g0){return g(Ye,g0)}),Ar()){var kg=na;wu(Ye,kg)}return $i}function Kn(Ye,lt,we,Mt){if(lt!==null&&lt.tag===ie){f(Ye,lt.sibling);var rn=B(lt,we);return rn.return=Ye,rn}f(Ye,lt);var nn=im(we,Ye.mode,Mt);return nn.return=Ye,nn}function Gn(Ye,lt,we,Mt){for(var rn=we.key,nn=lt;nn!==null;){if(nn.key===rn){var jn=we.type;if(jn===te){if(nn.tag===Ce){f(Ye,nn.sibling);var _n=B(nn,we.props.children);return _n.return=Ye,_n._debugSource=we._source,_n._debugOwner=we._owner,_n}}else if(nn.elementType===jn||gt(nn,we)||typeof jn=="object"&&jn!==null&&jn.$$typeof===fe&&Sv(jn)===nn.type){f(Ye,nn.sibling);var Ni=B(nn,we.props);return Ni.ref=Ic(Ye,nn,we),Ni.return=Ye,Ni._debugSource=we._source,Ni._debugOwner=we._owner,Ni}f(Ye,nn);break}else g(Ye,nn);nn=nn.sibling}if(we.type===te){var pi=aI(we.props.children,Ye.mode,Mt,we.key);return pi.return=Ye,pi}else{var $i=Uh(we,Ye.mode,Mt);return $i.ref=Ic(Ye,lt,we),$i.return=Ye,$i}}function Qi(Ye,lt,we,Mt){for(var rn=we.key,nn=lt;nn!==null;){if(nn.key===rn)if(nn.tag===U&&nn.stateNode.containerInfo===we.containerInfo&&nn.stateNode.implementation===we.implementation){f(Ye,nn.sibling);var jn=B(nn,we.children||[]);return jn.return=Ye,jn}else{f(Ye,nn);break}else g(Ye,nn);nn=nn.sibling}var _n=am(we,Ye.mode,Mt);return _n.return=Ye,_n}function Di(Ye,lt,we,Mt){var rn=typeof we=="object"&&we!==null&&we.type===te&&we.key===null;if(rn&&(we=we.props.children),typeof we=="object"&&we!==null){switch(we.$$typeof){case Ue:return H(Gn(Ye,lt,we,Mt));case Pe:return H(Qi(Ye,lt,we,Mt));case fe:{var nn=we._payload,jn=we._init;return Di(Ye,lt,jn(nn),Mt)}}if(Fi(we))return xt(Ye,lt,we,Mt);if(ue(we))return fn(Ye,lt,we,Mt);Qf(Ye,we)}return typeof we=="string"&&we!==""||typeof we=="number"?H(Kn(Ye,lt,""+we,Mt)):(typeof we=="function"&&Mu(Ye),f(Ye,lt))}return Di}var sd=GB(!0),BB=GB(!1);function Rv(c,g){if(c!==null&&g.child!==c.child)throw new Error("Resuming work not yet implemented.");if(g.child!==null){var f=g.child,v=_g(f,f.pendingProps);for(g.child=v,v.return=g;f.sibling!==null;)f=f.sibling,v=v.sibling=_g(f,f.pendingProps),v.return=g;v.sibling=null}}function Jx(c,g){for(var f=c.child;f!==null;)Oy(f,g),f=f.sibling}var DC={},Ag=$c(DC),kC=$c(DC),jf=$c(DC);function UC(c){if(c===DC)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return c}function wv(){var c=UC(jf.current);return c}function xv(c,g){hr(jf,g,c),hr(kC,c,c),hr(Ag,DC,c);var f=Dr(g);xr(Ag,c),hr(Ag,f,c)}function ld(c){xr(Ag,c),xr(kC,c),xr(jf,c)}function JC(){var c=UC(Ag.current);return c}function ZB(c){var g=UC(jf.current),f=UC(Ag.current),v=ls(f,c.type,g);f!==v&&(hr(kC,c,c),hr(Ag,v,c))}function Wv(c){kC.current===c&&(xr(Ag,c),xr(kC,c))}var Vv=0,SB=1,RB=1,OC=2,ds=$c(Vv);function Mv(c,g){return(c&g)!==0}function cd(c){return c&SB}function Nv(c,g){return c&SB|g}function Ox(c,g){return c|g}function fg(c,g){hr(ds,g,c)}function gd(c){xr(ds,c)}function Px(c,g){var f=c.memoizedState;return f!==null?f.dehydrated!==null:(c.memoizedProps,!0)}function PC(c){for(var g=c;g!==null;){if(g.tag===We){var f=g.memoizedState;if(f!==null){var v=f.dehydrated;if(v===null||Ji(v)||ta(v))return g}}else if(g.tag===bt&&g.memoizedProps.revealOrder!==void 0){var B=(g.flags&un)!==Q;if(B)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===c)return null;for(;g.sibling===null;){if(g.return===null||g.return===c)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Cs=0,Ki=1,pg=2,da=4,cr=8,qf=[];function Hv(){for(var c=0;c<qf.length;c++){var g=qf[c];Oc?g._workInProgressVersionPrimary=null:g._workInProgressVersionSecondary=null}qf.length=0}function wB(c,g){var f=g._getVersion,v=f(g._source);c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[g,v]:c.mutableSourceEagerHydrationData.push(g,v)}var tn=o.ReactCurrentDispatcher,Go=o.ReactCurrentBatchConfig,Xv,Nu;Xv=new Set;var Hu=Bt,Mi=null,Ba=null,Ua=null,$f=!1,QC=!1,jC=0,Qx=0,jx=25,ct=null,hs=null,mg=-1,ep=!1;function ri(){{var c=ct;hs===null?hs=[c]:hs.push(c)}}function Et(){{var c=ct;hs!==null&&(mg++,hs[mg]!==c&&qx(c))}}function ud(c){c!=null&&!Fi(c)&&C("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",ct,typeof c)}function qx(c){{var g=De(Mi);if(!Xv.has(g)&&(Xv.add(g),hs!==null)){for(var f="",v=30,B=0;B<=mg;B++){for(var V=hs[B],H=B===mg?c:V,_=B+1+". "+V;_.length<v;)_+=" ";_+=H+`
`,f+=_}C(`React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks

   Previous render            Next render
   ------------------------------------------------------
%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
`,g,f)}}}function Xr(){throw new Error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`)}function Id(c,g){if(ep)return!1;if(g===null)return C("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",ct),!1;c.length!==g.length&&C(`The final argument passed to %s changed size between renders. The order and size of this array must remain constant.

Previous: %s
Incoming: %s`,ct,"["+g.join(", ")+"]","["+c.join(", ")+"]");for(var f=0;f<g.length&&f<c.length;f++)if(!gs(c[f],g[f]))return!1;return!0}function dd(c,g,f,v,B,V){Hu=V,Mi=g,hs=c!==null?c._debugHookTypes:null,mg=-1,ep=c!==null&&c.type!==g.type,g.memoizedState=null,g.updateQueue=null,g.lanes=Bt,c!==null&&c.memoizedState!==null?tn.current=Oi:hs!==null?tn.current=YB:tn.current=jv;var H=f(v,B);if(QC){var _=0;do{if(QC=!1,jC=0,_>=jx)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");_+=1,ep=!1,Ba=null,Ua=null,g.updateQueue=null,mg=-1,tn.current=hp,H=f(v,B)}while(QC)}tn.current=Cp,g._debugHookTypes=hs;var O=Ba!==null&&Ba.next!==null;if(Hu=Bt,Mi=null,Ba=null,Ua=null,ct=null,hs=null,mg=-1,c!==null&&(c.flags&Wt)!==(g.flags&Wt)&&(c.mode&Hi)!==Nn&&C("Internal React error: Expected static flag was missing. Please notify the React team."),$f=!1,O)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return H}function Xu(){var c=jC!==0;return jC=0,c}function xB(c,g,f){g.updateQueue=c.updateQueue,(g.mode&bo)!==Nn?g.flags&=~(he|D|aa|Be):g.flags&=~(aa|Be),c.lanes=_I(c.lanes,f)}function Fv(){if(tn.current=Cp,$f){for(var c=Mi.memoizedState;c!==null;){var g=c.queue;g!==null&&(g.pending=null),c=c.next}$f=!1}Hu=Bt,Mi=null,Ba=null,Ua=null,hs=null,mg=-1,ct=null,Pv=!1,QC=!1,jC=0}function Sl(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ua===null?Mi.memoizedState=Ua=c:Ua=Ua.next=c,Ua}function Rl(){var c;if(Ba===null){var g=Mi.alternate;g!==null?c=g.memoizedState:c=null}else c=Ba.next;var f;if(Ua===null?f=Mi.memoizedState:f=Ua.next,f!==null)Ua=f,f=Ua.next,Ba=c;else{if(c===null)throw new Error("Rendered more hooks than during the previous render.");Ba=c;var v={memoizedState:Ba.memoizedState,baseState:Ba.baseState,baseQueue:Ba.baseQueue,queue:Ba.queue,next:null};Ua===null?Mi.memoizedState=Ua=v:Ua=Ua.next=v}return Ua}function WB(){return{lastEffect:null,stores:null}}function Yv(c,g){return typeof g=="function"?g(c):g}function Tv(c,g,f){var v=Sl(),B;f!==void 0?B=f(g):B=g,v.memoizedState=v.baseState=B;var V={pending:null,interleaved:null,lanes:Bt,dispatch:null,lastRenderedReducer:c,lastRenderedState:B};v.queue=V;var H=V.dispatch=vg.bind(null,Mi,V);return[v.memoizedState,H]}function Ev(c,g,f){var v=Rl(),B=v.queue;if(B===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");B.lastRenderedReducer=c;var V=Ba,H=V.baseQueue,_=B.pending;if(_!==null){if(H!==null){var O=H.next,oe=_.next;H.next=oe,_.next=O}V.baseQueue!==H&&C("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),V.baseQueue=H=_,B.pending=null}if(H!==null){var Ie=H.next,xe=V.baseState,Je=null,it=null,vt=null,xt=Ie;do{var fn=xt.lane;if(nc(Hu,fn)){if(vt!==null){var Gn={lane:Na,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null};vt=vt.next=Gn}if(xt.hasEagerState)xe=xt.eagerState;else{var Qi=xt.action;xe=c(xe,Qi)}}else{var Kn={lane:fn,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null};vt===null?(it=vt=Kn,Je=xe):vt=vt.next=Kn,Mi.lanes=En(Mi.lanes,fn),Qp(fn)}xt=xt.next}while(xt!==null&&xt!==Ie);vt===null?Je=xe:vt.next=it,gs(xe,v.memoizedState)||xp(),v.memoizedState=xe,v.baseState=Je,v.baseQueue=vt,B.lastRenderedState=xe}var Di=B.interleaved;if(Di!==null){var Ye=Di;do{var lt=Ye.lane;Mi.lanes=En(Mi.lanes,lt),Qp(lt),Ye=Ye.next}while(Ye!==Di)}else H===null&&(B.lanes=Bt);var we=B.dispatch;return[v.memoizedState,we]}function Kv(c,g,f){var v=Rl(),B=v.queue;if(B===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");B.lastRenderedReducer=c;var V=B.dispatch,H=B.pending,_=v.memoizedState;if(H!==null){B.pending=null;var O=H.next,oe=O;do{var Ie=oe.action;_=c(_,Ie),oe=oe.next}while(oe!==O);gs(_,v.memoizedState)||xp(),v.memoizedState=_,v.baseQueue===null&&(v.baseState=_),B.lastRenderedState=_}return[_,V]}function qH(c,g,f){}function $H(c,g,f){}function Lv(c,g,f){var v=Mi,B=Sl(),V,H=Ar();if(H){if(f===void 0)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");V=f(),Nu||V!==f()&&(C("The result of getServerSnapshot should be cached to avoid an infinite loop"),Nu=!0)}else{if(V=g(),!Nu){var _=g();gs(V,_)||(C("The result of getSnapshot should be cached to avoid an infinite loop"),Nu=!0)}var O=Nh();if(O===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");xf(O,Hu)||Bo(v,g,V)}B.memoizedState=V;var oe={value:V,getSnapshot:g};return B.queue=oe,Fu(zv.bind(null,v,oe,c),[c]),v.flags|=aa,hd(Ki|cr,Cd.bind(null,v,oe,V,g),void 0,null),V}function tp(c,g,f){var v=Mi,B=Rl(),V=g();if(!Nu){var H=g();gs(V,H)||(C("The result of getSnapshot should be cached to avoid an infinite loop"),Nu=!0)}var _=B.memoizedState,O=!gs(_,V);O&&(B.memoizedState=V,xp());var oe=B.queue;if(Yu(zv.bind(null,v,oe,c),[c]),oe.getSnapshot!==g||O||Ua!==null&&Ua.memoizedState.tag&Ki){v.flags|=aa,hd(Ki|cr,Cd.bind(null,v,oe,V,g),void 0,null);var Ie=Nh();if(Ie===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");xf(Ie,Hu)||Bo(v,g,V)}return V}function Bo(c,g,f){c.flags|=ce;var v={getSnapshot:g,value:f},B=Mi.updateQueue;if(B===null)B=WB(),Mi.updateQueue=B,B.stores=[v];else{var V=B.stores;V===null?B.stores=[v]:V.push(v)}}function Cd(c,g,f,v){g.value=f,g.getSnapshot=v,VB(g)&&_v(c)}function zv(c,g,f){var v=function(){VB(g)&&_v(c)};return f(v)}function VB(c){var g=c.getSnapshot,f=c.value;try{var v=g();return!gs(f,v)}catch{return!0}}function _v(c){Pa(c,zn,Zi)}function qC(c){var g=Sl();typeof c=="function"&&(c=c()),g.memoizedState=g.baseState=c;var f={pending:null,interleaved:null,lanes:Bt,dispatch:null,lastRenderedReducer:Yv,lastRenderedState:c};g.queue=f;var v=f.dispatch=$x.bind(null,Mi,f);return[g.memoizedState,v]}function np(c){return Ev(Yv)}function ip(c){return Kv(Yv)}function hd(c,g,f,v){var B={tag:c,create:g,destroy:f,deps:v,next:null},V=Mi.updateQueue;if(V===null)V=WB(),Mi.updateQueue=V,V.lastEffect=B.next=B;else{var H=V.lastEffect;if(H===null)V.lastEffect=B.next=B;else{var _=H.next;H.next=B,B.next=_,V.lastEffect=B}}return B}function ap(c){var g=Sl();{var f={current:c};return g.memoizedState=f,f}}function rp(c){var g=Rl();return g.memoizedState}function $C(c,g,f,v){var B=Sl(),V=v===void 0?null:v;Mi.flags|=c,B.memoizedState=hd(Ki|g,f,void 0,V)}function eh(c,g,f,v){var B=Rl(),V=v===void 0?null:v,H=void 0;if(Ba!==null){var _=Ba.memoizedState;if(H=_.destroy,V!==null){var O=_.deps;if(Id(V,O)){B.memoizedState=hd(g,f,H,V);return}}}Mi.flags|=c,B.memoizedState=hd(Ki|g,f,H,V)}function Fu(c,g){return(Mi.mode&bo)!==Nn?$C(he|aa|Ut,cr,c,g):$C(aa|Ut,cr,c,g)}function Yu(c,g){return eh(aa,cr,c,g)}function Dv(c,g){return $C(Be,pg,c,g)}function op(c,g){return eh(Be,pg,c,g)}function kv(c,g){var f=Be;return f|=dn,(Mi.mode&bo)!==Nn&&(f|=D),$C(f,da,c,g)}function sp(c,g){return eh(Be,da,c,g)}function MB(c,g){if(typeof g=="function"){var f=g,v=c();return f(v),function(){f(null)}}else if(g!=null){var B=g;B.hasOwnProperty("current")||C("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(B).join(", ")+"}");var V=c();return B.current=V,function(){B.current=null}}}function bg(c,g,f){typeof g!="function"&&C("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",g!==null?typeof g:"null");var v=f!=null?f.concat([c]):null,B=Be;return B|=dn,(Mi.mode&bo)!==Nn&&(B|=D),$C(B,da,MB.bind(null,g,c),v)}function Ad(c,g,f){typeof g!="function"&&C("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",g!==null?typeof g:"null");var v=f!=null?f.concat([c]):null;return eh(Be,da,MB.bind(null,g,c),v)}function th(c,g){}var fd=th;function Uv(c,g){var f=Sl(),v=g===void 0?null:g;return f.memoizedState=[c,v],c}function lp(c,g){var f=Rl(),v=g===void 0?null:g,B=f.memoizedState;if(B!==null&&v!==null){var V=B[1];if(Id(v,V))return B[0]}return f.memoizedState=[c,v],c}function cp(c,g){var f=Sl(),v=g===void 0?null:g,B=c();return f.memoizedState=[B,v],B}function gp(c,g){var f=Rl(),v=g===void 0?null:g,B=f.memoizedState;if(B!==null&&v!==null){var V=B[1];if(Id(v,V))return B[0]}var H=c();return f.memoizedState=[H,v],H}function pd(c){var g=qC(c),f=g[0],v=g[1];return Fu(function(){var B=Go.transition;Go.transition={};try{v(c)}finally{Go.transition=B}},[c]),f}function Tu(c){var g=np(),f=g[0],v=g[1];return Yu(function(){var B=Go.transition;Go.transition={};try{v(c)}finally{Go.transition=B}},[c]),f}function up(c){var g=ip(),f=g[0],v=g[1];return Yu(function(){var B=Go.transition;Go.transition={};try{v(c)}finally{Go.transition=B}},[c]),f}function NB(c,g,f){var v=Ds();rr(Ix(v,wC)),c(!0);var B=Go.transition;Go.transition={};var V=Go.transition;Go.transition._updatedFibers=new Set;try{c(!1),g()}finally{if(rr(v),Go.transition=B,B===null&&V._updatedFibers){var H=V._updatedFibers.size;H>10&&d("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),V._updatedFibers.clear()}}}function md(){var c=qC(!1),g=c[0],f=c[1],v=NB.bind(null,f),B=Sl();return B.memoizedState=v,[g,v]}function Jv(){var c=np(),g=c[0],f=Rl(),v=f.memoizedState;return[g,v]}function Ov(){var c=ip(),g=c[0],f=Rl(),v=f.memoizedState;return[g,v]}var Pv=!1;function HB(){return Pv}function Ip(){var c=Sl(),g=Nh(),f=g.identifierPrefix,v;if(Ar()){var B=Lx();v=":"+f+"R"+B;var V=jC++;V>0&&(v+="H"+V.toString(32)),v+=":"}else{var H=Qx++;v=":"+f+"r"+H.toString(32)+":"}return c.memoizedState=v,v}function nh(){var c=Rl(),g=c.memoizedState;return g}function vg(c,g,f){typeof arguments[3]=="function"&&C("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var v=Vl(c),B={lane:v,action:f,hasEagerState:!1,eagerState:null,next:null};if(XB(c))FB(g,B);else{bd(c,g,B);var V=Kr(),H=Pa(c,v,V);H!==null&&dp(H,g,v)}Qv(c,v)}function $x(c,g,f){typeof arguments[3]=="function"&&C("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var v=Vl(c),B={lane:v,action:f,hasEagerState:!1,eagerState:null,next:null};if(XB(c))FB(g,B);else{bd(c,g,B);var V=c.alternate;if(c.lanes===Bt&&(V===null||V.lanes===Bt)){var H=g.lastRenderedReducer;if(H!==null){var _;_=tn.current,tn.current=$r;try{var O=g.lastRenderedState,oe=H(O,f);if(B.hasEagerState=!0,B.eagerState=oe,gs(oe,O))return}catch{}finally{tn.current=_}}}var Ie=Kr(),xe=Pa(c,v,Ie);xe!==null&&dp(xe,g,v)}Qv(c,v)}function XB(c){var g=c.alternate;return c===Mi||g!==null&&g===Mi}function FB(c,g){QC=$f=!0;var f=c.pending;f===null?g.next=g:(g.next=f.next,f.next=g),c.pending=g}function bd(c,g,f,v){if(Sa(c)){var B=g.interleaved;B===null?(f.next=f,sv(g)):(f.next=B.next,B.next=f),g.interleaved=f}else{var V=g.pending;V===null?f.next=f:(f.next=V.next,V.next=f),g.pending=f}}function dp(c,g,f){if(zI(f)){var v=g.lanes;v=DI(v,c.pendingLanes);var B=En(v,f);g.lanes=B,Ob(c,B)}}function Qv(c,g,f){ev(c,g)}var Cp={readContext:Fa,useCallback:Xr,useContext:Xr,useEffect:Xr,useImperativeHandle:Xr,useInsertionEffect:Xr,useLayoutEffect:Xr,useMemo:Xr,useReducer:Xr,useRef:Xr,useState:Xr,useDebugValue:Xr,useDeferredValue:Xr,useTransition:Xr,useMutableSource:Xr,useSyncExternalStore:Xr,useId:Xr,unstable_isNewReconciler:w},jv=null,YB=null,Oi=null,hp=null,Po=null,$r=null,ih=null;{var Ap=function(){C("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},wn=function(){C("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};jv={readContext:function(c){return Fa(c)},useCallback:function(c,g){return ct="useCallback",ri(),ud(g),Uv(c,g)},useContext:function(c){return ct="useContext",ri(),Fa(c)},useEffect:function(c,g){return ct="useEffect",ri(),ud(g),Fu(c,g)},useImperativeHandle:function(c,g,f){return ct="useImperativeHandle",ri(),ud(f),bg(c,g,f)},useInsertionEffect:function(c,g){return ct="useInsertionEffect",ri(),ud(g),Dv(c,g)},useLayoutEffect:function(c,g){return ct="useLayoutEffect",ri(),ud(g),kv(c,g)},useMemo:function(c,g){ct="useMemo",ri(),ud(g);var f=tn.current;tn.current=Po;try{return cp(c,g)}finally{tn.current=f}},useReducer:function(c,g,f){ct="useReducer",ri();var v=tn.current;tn.current=Po;try{return Tv(c,g,f)}finally{tn.current=v}},useRef:function(c){return ct="useRef",ri(),ap(c)},useState:function(c){ct="useState",ri();var g=tn.current;tn.current=Po;try{return qC(c)}finally{tn.current=g}},useDebugValue:function(c,g){return ct="useDebugValue",ri(),void 0},useDeferredValue:function(c){return ct="useDeferredValue",ri(),pd(c)},useTransition:function(){return ct="useTransition",ri(),md()},useMutableSource:function(c,g,f){return ct="useMutableSource",ri(),void 0},useSyncExternalStore:function(c,g,f){return ct="useSyncExternalStore",ri(),Lv(c,g,f)},useId:function(){return ct="useId",ri(),Ip()},unstable_isNewReconciler:w},YB={readContext:function(c){return Fa(c)},useCallback:function(c,g){return ct="useCallback",Et(),Uv(c,g)},useContext:function(c){return ct="useContext",Et(),Fa(c)},useEffect:function(c,g){return ct="useEffect",Et(),Fu(c,g)},useImperativeHandle:function(c,g,f){return ct="useImperativeHandle",Et(),bg(c,g,f)},useInsertionEffect:function(c,g){return ct="useInsertionEffect",Et(),Dv(c,g)},useLayoutEffect:function(c,g){return ct="useLayoutEffect",Et(),kv(c,g)},useMemo:function(c,g){ct="useMemo",Et();var f=tn.current;tn.current=Po;try{return cp(c,g)}finally{tn.current=f}},useReducer:function(c,g,f){ct="useReducer",Et();var v=tn.current;tn.current=Po;try{return Tv(c,g,f)}finally{tn.current=v}},useRef:function(c){return ct="useRef",Et(),ap(c)},useState:function(c){ct="useState",Et();var g=tn.current;tn.current=Po;try{return qC(c)}finally{tn.current=g}},useDebugValue:function(c,g){return ct="useDebugValue",Et(),void 0},useDeferredValue:function(c){return ct="useDeferredValue",Et(),pd(c)},useTransition:function(){return ct="useTransition",Et(),md()},useMutableSource:function(c,g,f){return ct="useMutableSource",Et(),void 0},useSyncExternalStore:function(c,g,f){return ct="useSyncExternalStore",Et(),Lv(c,g,f)},useId:function(){return ct="useId",Et(),Ip()},unstable_isNewReconciler:w},Oi={readContext:function(c){return Fa(c)},useCallback:function(c,g){return ct="useCallback",Et(),lp(c,g)},useContext:function(c){return ct="useContext",Et(),Fa(c)},useEffect:function(c,g){return ct="useEffect",Et(),Yu(c,g)},useImperativeHandle:function(c,g,f){return ct="useImperativeHandle",Et(),Ad(c,g,f)},useInsertionEffect:function(c,g){return ct="useInsertionEffect",Et(),op(c,g)},useLayoutEffect:function(c,g){return ct="useLayoutEffect",Et(),sp(c,g)},useMemo:function(c,g){ct="useMemo",Et();var f=tn.current;tn.current=$r;try{return gp(c,g)}finally{tn.current=f}},useReducer:function(c,g,f){ct="useReducer",Et();var v=tn.current;tn.current=$r;try{return Ev(c,g,f)}finally{tn.current=v}},useRef:function(c){return ct="useRef",Et(),rp()},useState:function(c){ct="useState",Et();var g=tn.current;tn.current=$r;try{return np(c)}finally{tn.current=g}},useDebugValue:function(c,g){return ct="useDebugValue",Et(),fd()},useDeferredValue:function(c){return ct="useDeferredValue",Et(),Tu(c)},useTransition:function(){return ct="useTransition",Et(),Jv()},useMutableSource:function(c,g,f){return ct="useMutableSource",Et(),void 0},useSyncExternalStore:function(c,g,f){return ct="useSyncExternalStore",Et(),tp(c,g)},useId:function(){return ct="useId",Et(),nh()},unstable_isNewReconciler:w},hp={readContext:function(c){return Fa(c)},useCallback:function(c,g){return ct="useCallback",Et(),lp(c,g)},useContext:function(c){return ct="useContext",Et(),Fa(c)},useEffect:function(c,g){return ct="useEffect",Et(),Yu(c,g)},useImperativeHandle:function(c,g,f){return ct="useImperativeHandle",Et(),Ad(c,g,f)},useInsertionEffect:function(c,g){return ct="useInsertionEffect",Et(),op(c,g)},useLayoutEffect:function(c,g){return ct="useLayoutEffect",Et(),sp(c,g)},useMemo:function(c,g){ct="useMemo",Et();var f=tn.current;tn.current=ih;try{return gp(c,g)}finally{tn.current=f}},useReducer:function(c,g,f){ct="useReducer",Et();var v=tn.current;tn.current=ih;try{return Kv(c,g,f)}finally{tn.current=v}},useRef:function(c){return ct="useRef",Et(),rp()},useState:function(c){ct="useState",Et();var g=tn.current;tn.current=ih;try{return ip(c)}finally{tn.current=g}},useDebugValue:function(c,g){return ct="useDebugValue",Et(),fd()},useDeferredValue:function(c){return ct="useDeferredValue",Et(),up(c)},useTransition:function(){return ct="useTransition",Et(),Ov()},useMutableSource:function(c,g,f){return ct="useMutableSource",Et(),void 0},useSyncExternalStore:function(c,g,f){return ct="useSyncExternalStore",Et(),tp(c,g)},useId:function(){return ct="useId",Et(),nh()},unstable_isNewReconciler:w},Po={readContext:function(c){return Ap(),Fa(c)},useCallback:function(c,g){return ct="useCallback",wn(),ri(),Uv(c,g)},useContext:function(c){return ct="useContext",wn(),ri(),Fa(c)},useEffect:function(c,g){return ct="useEffect",wn(),ri(),Fu(c,g)},useImperativeHandle:function(c,g,f){return ct="useImperativeHandle",wn(),ri(),bg(c,g,f)},useInsertionEffect:function(c,g){return ct="useInsertionEffect",wn(),ri(),Dv(c,g)},useLayoutEffect:function(c,g){return ct="useLayoutEffect",wn(),ri(),kv(c,g)},useMemo:function(c,g){ct="useMemo",wn(),ri();var f=tn.current;tn.current=Po;try{return cp(c,g)}finally{tn.current=f}},useReducer:function(c,g,f){ct="useReducer",wn(),ri();var v=tn.current;tn.current=Po;try{return Tv(c,g,f)}finally{tn.current=v}},useRef:function(c){return ct="useRef",wn(),ri(),ap(c)},useState:function(c){ct="useState",wn(),ri();var g=tn.current;tn.current=Po;try{return qC(c)}finally{tn.current=g}},useDebugValue:function(c,g){return ct="useDebugValue",wn(),ri(),void 0},useDeferredValue:function(c){return ct="useDeferredValue",wn(),ri(),pd(c)},useTransition:function(){return ct="useTransition",wn(),ri(),md()},useMutableSource:function(c,g,f){return ct="useMutableSource",wn(),ri(),void 0},useSyncExternalStore:function(c,g,f){return ct="useSyncExternalStore",wn(),ri(),Lv(c,g,f)},useId:function(){return ct="useId",wn(),ri(),Ip()},unstable_isNewReconciler:w},$r={readContext:function(c){return Ap(),Fa(c)},useCallback:function(c,g){return ct="useCallback",wn(),Et(),lp(c,g)},useContext:function(c){return ct="useContext",wn(),Et(),Fa(c)},useEffect:function(c,g){return ct="useEffect",wn(),Et(),Yu(c,g)},useImperativeHandle:function(c,g,f){return ct="useImperativeHandle",wn(),Et(),Ad(c,g,f)},useInsertionEffect:function(c,g){return ct="useInsertionEffect",wn(),Et(),op(c,g)},useLayoutEffect:function(c,g){return ct="useLayoutEffect",wn(),Et(),sp(c,g)},useMemo:function(c,g){ct="useMemo",wn(),Et();var f=tn.current;tn.current=$r;try{return gp(c,g)}finally{tn.current=f}},useReducer:function(c,g,f){ct="useReducer",wn(),Et();var v=tn.current;tn.current=$r;try{return Ev(c,g,f)}finally{tn.current=v}},useRef:function(c){return ct="useRef",wn(),Et(),rp()},useState:function(c){ct="useState",wn(),Et();var g=tn.current;tn.current=$r;try{return np(c)}finally{tn.current=g}},useDebugValue:function(c,g){return ct="useDebugValue",wn(),Et(),fd()},useDeferredValue:function(c){return ct="useDeferredValue",wn(),Et(),Tu(c)},useTransition:function(){return ct="useTransition",wn(),Et(),Jv()},useMutableSource:function(c,g,f){return ct="useMutableSource",wn(),Et(),void 0},useSyncExternalStore:function(c,g,f){return ct="useSyncExternalStore",wn(),Et(),tp(c,g)},useId:function(){return ct="useId",wn(),Et(),nh()},unstable_isNewReconciler:w},ih={readContext:function(c){return Ap(),Fa(c)},useCallback:function(c,g){return ct="useCallback",wn(),Et(),lp(c,g)},useContext:function(c){return ct="useContext",wn(),Et(),Fa(c)},useEffect:function(c,g){return ct="useEffect",wn(),Et(),Yu(c,g)},useImperativeHandle:function(c,g,f){return ct="useImperativeHandle",wn(),Et(),Ad(c,g,f)},useInsertionEffect:function(c,g){return ct="useInsertionEffect",wn(),Et(),op(c,g)},useLayoutEffect:function(c,g){return ct="useLayoutEffect",wn(),Et(),sp(c,g)},useMemo:function(c,g){ct="useMemo",wn(),Et();var f=tn.current;tn.current=$r;try{return gp(c,g)}finally{tn.current=f}},useReducer:function(c,g,f){ct="useReducer",wn(),Et();var v=tn.current;tn.current=$r;try{return Kv(c,g,f)}finally{tn.current=v}},useRef:function(c){return ct="useRef",wn(),Et(),rp()},useState:function(c){ct="useState",wn(),Et();var g=tn.current;tn.current=$r;try{return ip(c)}finally{tn.current=g}},useDebugValue:function(c,g){return ct="useDebugValue",wn(),Et(),fd()},useDeferredValue:function(c){return ct="useDeferredValue",wn(),Et(),up(c)},useTransition:function(){return ct="useTransition",wn(),Et(),Ov()},useMutableSource:function(c,g,f){return ct="useMutableSource",wn(),Et(),void 0},useSyncExternalStore:function(c,g,f){return ct="useSyncExternalStore",wn(),Et(),tp(c,g)},useId:function(){return ct="useId",wn(),Et(),nh()},unstable_isNewReconciler:w}}var As=a.unstable_now,TB=0,Eu=-1,wl=-1,fp=-1,pp=!1,mp=!1;function EB(){return pp}function Zo(){mp=!0}function ah(){pp=!1,mp=!1}function bp(){pp=mp,mp=!1}function dc(){return TB}function qv(){TB=As()}function Cc(c){wl=As(),c.actualStartTime<0&&(c.actualStartTime=As())}function yg(c){wl=-1}function Ku(c,g){if(wl>=0){var f=As()-wl;c.actualDuration+=f,g&&(c.selfBaseDuration=f),wl=-1}}function So(c){if(Eu>=0){var g=As()-Eu;Eu=-1;for(var f=c.return;f!==null;){switch(f.tag){case F:var v=f.stateNode;v.effectDuration+=g;return;case Oe:var B=f.stateNode;B.effectDuration+=g;return}f=f.return}}}function vd(c){if(fp>=0){var g=As()-fp;fp=-1;for(var f=c.return;f!==null;){switch(f.tag){case F:var v=f.stateNode;v!==null&&(v.passiveEffectDuration+=g);return;case Oe:var B=f.stateNode;B!==null&&(B.passiveEffectDuration+=g);return}f=f.return}}}function Fr(){Eu=As()}function vp(){fp=As()}function yd(c){for(var g=c.child;g;)c.actualDuration+=g.actualDuration,g=g.sibling}function rh(c,g){return{value:c,source:g,stack:Nf(g)}}function KB(c,g){return!0}function $v(c,g){try{var f=KB(c,g);if(f===!1)return;var v=g.value,B=g.source,V=g.stack,H=V!==null?V:"";if(v!=null&&v._suppressLogging){if(c.tag===k)return;console.error(v)}var _=B?De(B):null,O=_?"The above error occurred in the <"+_+"> component:":"The above error occurred in one of your React components:",oe;if(c.tag===F)oe=`Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.`;else{var Ie=De(c)||"Anonymous";oe="React will try to recreate this component tree from scratch "+("using the error boundary you provided, "+Ie+".")}var xe=O+`
`+H+`

`+(""+oe);console.error(xe)}catch(Je){setTimeout(function(){throw Je})}}var eW=typeof WeakMap=="function"?WeakMap:Map;function oh(c,g,f){var v=Ig(Zi,f);v.tag=FC,v.payload={element:null};var B=g.value;return v.callback=function(){YZ(B),$v(c,g)},v}function Gd(c,g,f){var v=Ig(Zi,f);v.tag=FC;var B=c.type.getDerivedStateFromError;if(typeof B=="function"){var V=g.value;v.payload=function(){return B(V)},v.callback=function(){Qo(c),$v(c,g)}}var H=c.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(v.callback=function(){Qo(c),$v(c,g),typeof B!="function"&&FW(this);var O=g.value,oe=g.stack;this.componentDidCatch(O,{componentStack:oe!==null?oe:""}),typeof B!="function"&&(va(c.lanes,zn)||C("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",De(c)||"Unknown"))}),v}function ey(c,g,f){var v=c.pingCache,B;if(v===null?(v=c.pingCache=new eW,B=new Set,v.set(g,B)):(B=v.get(g),B===void 0&&(B=new Set,v.set(g,B))),!B.has(f)){B.add(f);var V=_y.bind(null,c,g,f);ks&&Jt(c,f),g.then(V,V)}}function tW(c,g,f,v){var B=c.updateQueue;if(B===null){var V=new Set;V.add(f),c.updateQueue=V}else B.add(f)}function yp(c,g){var f=c.tag;if((c.mode&Hi)===Nn&&(f===L||f===de||f===$e)){var v=c.alternate;v?(c.updateQueue=v.updateQueue,c.memoizedState=v.memoizedState,c.lanes=v.lanes):(c.updateQueue=null,c.memoizedState=null)}}function LB(c){var g=c;do{if(g.tag===We&&Px(g))return g;g=g.return}while(g!==null);return null}function zB(c,g,f,v,B){if((c.mode&Hi)===Nn){if(c===g)c.flags|=Te;else{if(c.flags|=un,f.flags|=nt,f.flags&=~(pt|ne),Pn&&G){var V=c.alternate;if(V===null){var H=c.child,_=H.child;if(_!==null){var O=_.memoizedProps.children,oe=cn("hidden",O);_.pendingProps=oe,_.memoizedProps=oe}}}if(f.tag===k){var Ie=f.alternate;if(Ie===null)f.tag=Ne;else{var xe=Ig(Zi,zn);xe.tag=Zl,dg(f,xe)}}f.lanes=En(f.lanes,zn)}return c}return c.flags|=Te,c.lanes=B,c}function nW(c,g,f,v,B){if(f.flags|=ne,ks&&Jt(c,B),v!==null&&typeof v=="object"&&typeof v.then=="function"){var V=v;yp(f);var H=LB(g);if(H!==null){H.flags&=~bn,zB(H,g,f,c,B),H.mode&Hi&&ey(c,V,B),tW(H,c,V);return}else{if(!Ks(B)){ey(c,V,B),Ky();return}var _=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.");v=_}}else if(Ar()&&f.mode&Hi){_x();var O=LB(g);if(O!==null){(O.flags&Te)===Q&&(O.flags|=bn),zB(O,g,f,c,B),qr(v);return}}HZ(v),v=rh(v,f);var oe=g;do{switch(oe.tag){case F:{var Ie=v;oe.flags|=Te;var xe=Au(B);oe.lanes=En(oe.lanes,xe);var Je=oh(oe,Ie,xe);Bu(oe,Je);return}case k:var it=v,vt=oe.type,xt=oe.stateNode;if((oe.flags&un)===Q&&(typeof vt.getDerivedStateFromError=="function"||xt!==null&&typeof xt.componentDidCatch=="function"&&!$p(xt))){oe.flags|=Te;var fn=Au(B);oe.lanes=En(oe.lanes,fn);var Kn=Gd(oe,it,fn);Bu(oe,Kn);return}break}oe=oe.return}while(oe!==null)}function iW(){return null}function xl(c){c.flags|=Be}function _B(c){c.flags|=ui,c.flags|=kt}function DB(c,g){var f=c!==null&&c.child===g.child;if(f)return!0;if((g.flags&wt)!==Q)return!1;for(var v=g.child;v!==null;){if((v.flags&Se)!==Q||(v.subtreeFlags&Se)!==Q)return!1;v=v.sibling}return!0}var sh,lh,Gp,Bd;if(fo)sh=function(c,g,f,v){for(var B=g.child;B!==null;){if(B.tag===le||B.tag===ie)ba(c,B.stateNode);else if(B.tag!==U){if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B===g)return;for(;B.sibling===null;){if(B.return===null||B.return===g)return;B=B.return}B.sibling.return=B.return,B=B.sibling}},lh=function(c,g){},Gp=function(c,g,f,v,B){var V=c.memoizedProps;if(V!==v){var H=g.stateNode,_=JC(),O=za(H,f,V,v,B,_);g.updateQueue=O,O&&xl(g)}},Bd=function(c,g,f,v){f!==v&&xl(g)};else if(Pn){sh=function(c,g,f,v){for(var B=g.child;B!==null;){if(B.tag===le){var V=B.stateNode;if(f&&v){var H=B.memoizedProps,_=B.type;V=Wn(V,_,H,B)}ba(c,V)}else if(B.tag===ie){var O=B.stateNode;if(f&&v){var oe=B.memoizedProps;O=$n(O,oe,B)}ba(c,O)}else if(B.tag!==U){if(B.tag===yt&&B.memoizedState!==null){var Ie=B.child;Ie!==null&&(Ie.return=B),sh(c,B,!0,!0)}else if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B=B,B===g)return;for(;B.sibling===null;){if(B.return===null||B.return===g)return;B=B.return}B.sibling.return=B.return,B=B.sibling}};var Bp=function(c,g,f,v){for(var B=g.child;B!==null;){if(B.tag===le){var V=B.stateNode;if(f&&v){var H=B.memoizedProps,_=B.type;V=Wn(V,_,H,B)}je(c,V)}else if(B.tag===ie){var O=B.stateNode;if(f&&v){var oe=B.memoizedProps;O=$n(O,oe,B)}je(c,O)}else if(B.tag!==U){if(B.tag===yt&&B.memoizedState!==null){var Ie=B.child;Ie!==null&&(Ie.return=B),Bp(c,B,!0,!0)}else if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B=B,B===g)return;for(;B.sibling===null;){if(B.return===null||B.return===g)return;B=B.return}B.sibling.return=B.return,B=B.sibling}};lh=function(c,g){var f=g.stateNode,v=DB(c,g);if(!v){var B=f.containerInfo,V=Ke(B);Bp(V,g,!1,!1),f.pendingChildren=V,xl(g),Ht(B,V)}},Gp=function(c,g,f,v,B){var V=c.stateNode,H=c.memoizedProps,_=DB(c,g);if(_&&H===v){g.stateNode=V;return}var O=g.stateNode,oe=JC(),Ie=null;if(H!==v&&(Ie=za(O,f,H,v,B,oe)),_&&Ie===null){g.stateNode=V;return}var xe=ge(V,Ie,f,H,v,g,_,O);Lo(xe,f,v,B,oe)&&xl(g),g.stateNode=xe,_?xl(g):sh(xe,g,!1,!1)},Bd=function(c,g,f,v){if(f!==v){var B=wv(),V=JC();g.stateNode=Ur(v,B,V,g),xl(g)}else g.stateNode=c.stateNode}}else lh=function(c,g){},Gp=function(c,g,f,v,B){},Bd=function(c,g,f,v){};function Lu(c,g){if(!Ar())switch(c.tailMode){case"hidden":{for(var f=c.tail,v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?c.tail=null:v.sibling=null;break}case"collapsed":{for(var B=c.tail,V=null;B!==null;)B.alternate!==null&&(V=B),B=B.sibling;V===null?!g&&c.tail!==null?c.tail.sibling=null:c.tail=null:V.sibling=null;break}}}function Ja(c){var g=c.alternate!==null&&c.alternate.child===c.child,f=Bt,v=Q;if(g){if((c.mode&Ai)!==Nn){for(var O=c.selfBaseDuration,oe=c.child;oe!==null;)f=En(f,En(oe.lanes,oe.childLanes)),v|=oe.subtreeFlags&Wt,v|=oe.flags&Wt,O+=oe.treeBaseDuration,oe=oe.sibling;c.treeBaseDuration=O}else for(var Ie=c.child;Ie!==null;)f=En(f,En(Ie.lanes,Ie.childLanes)),v|=Ie.subtreeFlags&Wt,v|=Ie.flags&Wt,Ie.return=c,Ie=Ie.sibling;c.subtreeFlags|=v}else{if((c.mode&Ai)!==Nn){for(var B=c.actualDuration,V=c.selfBaseDuration,H=c.child;H!==null;)f=En(f,En(H.lanes,H.childLanes)),v|=H.subtreeFlags,v|=H.flags,B+=H.actualDuration,V+=H.treeBaseDuration,H=H.sibling;c.actualDuration=B,c.treeBaseDuration=V}else for(var _=c.child;_!==null;)f=En(f,En(_.lanes,_.childLanes)),v|=_.subtreeFlags,v|=_.flags,_.return=c,_=_.sibling;c.subtreeFlags|=v}return c.childLanes=f,g}function kB(c,g,f){var v=g.pendingProps;switch(pv(g),g.tag){case E:case ot:case $e:case L:case de:case Ce:case Ge:case Oe:case ye:case ke:return Ja(g),null;case k:{var B=g.type;return ml(B)&&vf(g),Ja(g),null}case F:{var V=g.stateNode;if(ld(g),yf(g),Hv(),V.pendingContext&&(V.context=V.pendingContext,V.pendingContext=null),c===null||c.child===null){var H=KC(g);if(H)xl(g);else if(c!==null){var _=c.memoizedState;(!_.isDehydrated||(g.flags&bn)!==Q)&&(g.flags|=bi,LC())}}return lh(c,g),Ja(g),null}case le:{Wv(g);var O=wv(),oe=g.type;if(c!==null&&g.stateNode!=null)Gp(c,g,oe,v,O),c.ref!==g.ref&&_B(g);else{if(!v){if(g.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return Ja(g),null}var Ie=JC(),xe=KC(g);if(xe)Ux(g,O,Ie)&&xl(g);else{var Je=di(oe,v,O,Ie,g);sh(Je,g,!1,!1),g.stateNode=Je,Lo(Je,oe,v,O,Ie)&&xl(g)}g.ref!==null&&_B(g)}return Ja(g),null}case ie:{var it=v;if(c&&g.stateNode!=null){var vt=c.memoizedProps;Bd(c,g,vt,it)}else{if(typeof it!="string"&&g.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var xt=wv(),fn=JC(),Kn=KC(g);Kn?TC(g)&&xl(g):g.stateNode=Ur(it,xt,fn,g)}return Ja(g),null}case We:{gd(g);var Gn=g.memoizedState;{if(yB()&&(g.mode&Hi)!==Nn&&(g.flags&un)===Q)return Bv(g),uc(),g.flags|=bn|ne|Te,g;if(Gn!==null&&Gn.dehydrated!==null){var Qi=KC(g);if(c===null){if(!Qi)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(Gv(g),Ja(g),(g.mode&Ai)!==Nn){var Di=Gn!==null;if(Di){var Ye=g.child;Ye!==null&&(g.treeBaseDuration-=Ye.treeBaseDuration)}}return null}else{if(uc(),(g.flags&un)===Q&&(g.memoizedState=null),g.flags|=Be,Ja(g),(g.mode&Ai)!==Nn){var lt=Gn!==null;if(lt){var we=g.child;we!==null&&(g.treeBaseDuration-=we.treeBaseDuration)}}return null}}LC()}if((g.flags&un)!==Q)return g.lanes=f,(g.mode&Ai)!==Nn&&yd(g),g;var Mt=Gn!==null,rn=!1;if(c===null)KC(g);else{var nn=c.memoizedState;rn=nn!==null}if(Mt&&!rn){var jn=g.child;if(jn.flags|=ua,(g.mode&Hi)!==Nn){var _n=c===null&&(g.memoizedProps.unstable_avoidThisFallback!==!0||!x);_n||Mv(ds.current,RB)?jp():Ky()}}var Ni=g.updateQueue;if(Ni!==null&&(g.flags|=Be),Ja(g),(g.mode&Ai)!==Nn&&Mt){var pi=g.child;pi!==null&&(g.treeBaseDuration-=pi.treeBaseDuration)}return null}case U:return ld(g),lh(c,g),c===null&&Tn(g.stateNode.containerInfo),Ja(g),null;case pe:var $i=g.type._context;return XC($i,g),Ja(g),null;case Ne:{var oi=g.type;return ml(oi)&&vf(g),Ja(g),null}case bt:{gd(g);var Dn=g.memoizedState;if(Dn===null)return Ja(g),null;var ga=(g.flags&un)!==Q,na=Dn.rendering;if(na===null)if(ga)Lu(Dn,!1);else{var io=qp()&&(c===null||(c.flags&un)===Q);if(!io)for(var ja=g.child;ja!==null;){var ao=PC(ja);if(ao!==null){ga=!0,g.flags|=un,Lu(Dn,!1);var ro=ao.updateQueue;return ro!==null&&(g.updateQueue=ro,g.flags|=Be),g.subtreeFlags=Q,Jx(g,f),fg(g,Nv(ds.current,OC)),g.child}ja=ja.sibling}Dn.tail!==null&&sa()>wh()&&(g.flags|=un,ga=!0,Lu(Dn,!1),g.lanes=aB)}else{if(!ga){var Wo=PC(na);if(Wo!==null){g.flags|=un,ga=!0;var oI=Wo.updateQueue;if(oI!==null&&(g.updateQueue=oI,g.flags|=Be),Lu(Dn,!0),Dn.tail===null&&Dn.tailMode==="hidden"&&!na.alternate&&!Ar())return Ja(g),null}else sa()*2-Dn.renderingStartTime>wh()&&f!==_o&&(g.flags|=un,ga=!0,Lu(Dn,!1),g.lanes=aB)}if(Dn.isBackwards)na.sibling=g.child,g.child=na;else{var Dg=Dn.last;Dg!==null?Dg.sibling=na:g.child=na,Dn.last=na}}if(Dn.tail!==null){var oo=Dn.tail;Dn.rendering=oo,Dn.tail=oo.sibling,Dn.renderingStartTime=sa(),oo.sibling=null;var kg=ds.current;return ga?kg=Nv(kg,OC):kg=cd(kg),fg(g,kg),oo}return Ja(g),null}case dt:break;case yt:case zt:{Hh(g);var g0=g.memoizedState,u0=g0!==null;if(c!==null){var OZ=c.memoizedState,zW=OZ!==null;zW!==u0&&!Z&&(g.flags|=ua)}return!u0||(g.mode&Hi)===Nn?Ja(g):va(wo,_o)&&(Ja(g),fo&&g.subtreeFlags&(be|Be)&&(g.flags|=ua)),null}case Nt:return null;case Lt:return null}throw new Error("Unknown unit of work tag ("+g.tag+"). This error is likely caused by a bug in React. Please file an issue.")}var hc=o.ReactCurrentOwner,eo=!1,ty,Zd,ny,iy,Zp,zu,ay,ch;ty={},Zd={},ny={},iy={},Zp={},zu=!1,ay={},ch={};function gr(c,g,f,v){c===null?g.child=BB(g,null,f,v):g.child=sd(g,c.child,f,v)}function Sp(c,g,f,v){g.child=sd(g,c.child,null,v),g.child=sd(g,null,f,v)}function gh(c,g,f,v,B){if(g.type!==g.elementType){var V=f.propTypes;V&&Fs(V,v,"prop",Me(f))}var H=f.render,_=g.ref,O,oe;lc(g,B),VC(g);{if(hc.current=g,us(!0),O=dd(c,g,H,v,_,B),oe=Xu(),g.mode&Ia){sr(!0);try{O=dd(c,g,H,v,_,B),oe=Xu()}finally{sr(!1)}}us(!1)}return fu(),c!==null&&!eo?(xB(c,g,B),Ac(c,g,B)):(Ar()&&oe&&xu(g),g.flags|=st,gr(c,g,O,B),g.child)}function Sd(c,g,f,v,B){if(c===null){var V=f.type;if(Hl(V)&&f.compare===null&&f.defaultProps===void 0){var H=V;return H=Nl(V),g.tag=$e,g.type=H,gy(g,V),Rd(c,g,H,v,B)}{var _=V.propTypes;_&&Fs(_,v,"prop",Me(V))}var O=kh(f.type,null,v,g,g.mode,B);return O.ref=g.ref,O.return=g,g.child=O,O}{var oe=f.type,Ie=oe.propTypes;Ie&&Fs(Ie,v,"prop",Me(oe))}var xe=c.child,Je=Ay(c,B);if(!Je){var it=xe.memoizedProps,vt=f.compare;if(vt=vt!==null?vt:QI,vt(it,v)&&c.ref===g.ref)return Ac(c,g,B)}g.flags|=st;var xt=_g(xe,v);return xt.ref=g.ref,xt.return=g,g.child=xt,xt}function Rd(c,g,f,v,B){if(g.type!==g.elementType){var V=g.elementType;if(V.$$typeof===fe){var H=V,_=H._payload,O=H._init;try{V=O(_)}catch{V=null}var oe=V&&V.propTypes;oe&&Fs(oe,v,"prop",Me(V))}}if(c!==null){var Ie=c.memoizedProps;if(QI(Ie,v)&&c.ref===g.ref&&g.type===c.type)if(eo=!1,Ay(c,B))(c.flags&nt)!==Q&&(eo=!0);else return g.lanes=c.lanes,Ac(c,g,B)}return OB(c,g,f,v,B)}function UB(c,g,f){var v=g.pendingProps,B=v.children,V=c!==null?c.memoizedState:null;if(v.mode==="hidden"||Z)if((g.mode&Hi)===Nn){var H={baseLanes:Bt,cachePool:null};g.memoizedState=H,$u(g,f)}else if(va(f,_o)){var xe={baseLanes:Bt,cachePool:null};g.memoizedState=xe;var Je=V!==null?V.baseLanes:f;$u(g,Je)}else{var _=null,O;if(V!==null){var oe=V.baseLanes;O=En(oe,f)}else O=f;g.lanes=g.childLanes=_o;var Ie={baseLanes:O,cachePool:_};return g.memoizedState=Ie,g.updateQueue=null,$u(g,O),null}else{var it;V!==null?(it=En(V.baseLanes,f),g.memoizedState=null):it=f,$u(g,it)}return gr(c,g,B,f),g.child}function ry(c,g,f){var v=g.pendingProps;return gr(c,g,v,f),g.child}function oy(c,g,f){var v=g.pendingProps.children;return gr(c,g,v,f),g.child}function aW(c,g,f){{g.flags|=Be;{var v=g.stateNode;v.effectDuration=0,v.passiveEffectDuration=0}}var B=g.pendingProps,V=B.children;return gr(c,g,V,f),g.child}function JB(c,g){var f=g.ref;(c===null&&f!==null||c!==null&&c.ref!==f)&&(g.flags|=ui,g.flags|=kt)}function OB(c,g,f,v,B){if(g.type!==g.elementType){var V=f.propTypes;V&&Fs(V,v,"prop",Me(f))}var H;{var _=Ys(g,f,!0);H=EI(g,_)}var O,oe;lc(g,B),VC(g);{if(hc.current=g,us(!0),O=dd(c,g,f,v,H,B),oe=Xu(),g.mode&Ia){sr(!0);try{O=dd(c,g,f,v,H,B),oe=Xu()}finally{sr(!1)}}us(!1)}return fu(),c!==null&&!eo?(xB(c,g,B),Ac(c,g,B)):(Ar()&&oe&&xu(g),g.flags|=st,gr(c,g,O,B),g.child)}function PB(c,g,f,v,B){{switch(Im(g)){case!1:{var V=g.stateNode,H=g.type,_=new H(g.memoizedProps,V.context),O=_.state;V.updater.enqueueSetState(V,O,null);break}case!0:{g.flags|=un,g.flags|=Te;var oe=new Error("Simulated error coming from DevTools"),Ie=Au(B);g.lanes=En(g.lanes,Ie);var xe=Gd(g,rh(oe,g),Ie);Bu(g,xe);break}}if(g.type!==g.elementType){var Je=f.propTypes;Je&&Fs(Je,v,"prop",Me(f))}}var it;ml(f)?(it=!0,ar(g)):it=!1,lc(g,B);var vt=g.stateNode,xt;vt===null?(c!==null&&(c.alternate=null,g.alternate=null,g.flags|=be),Df(g,f,v),Av(g,f,v,B),xt=!0):c===null?xt=fB(g,f,v,B):xt=Ex(c,g,f,v,B);var fn=sy(c,g,f,xt,it,B);{var Kn=g.stateNode;xt&&Kn.props!==v&&(zu||C("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",De(g)||"a component"),zu=!0)}return fn}function sy(c,g,f,v,B,V){JB(c,g);var H=(g.flags&un)!==Q;if(!v&&!H)return B&&Xb(g,f,!1),Ac(c,g,V);var _=g.stateNode;hc.current=g;var O;if(H&&typeof f.getDerivedStateFromError!="function")O=null,yg();else{VC(g);{if(us(!0),O=_.render(),g.mode&Ia){sr(!0);try{_.render()}finally{sr(!1)}}us(!1)}fu()}return g.flags|=st,c!==null&&H?Sp(c,g,O,V):gr(c,g,O,V),g.memoizedState=_.state,B&&Xb(g,f,!0),g.child}function QB(c){var g=c.stateNode;g.pendingContext?tB(c,g.pendingContext,g.pendingContext!==g.context):g.context&&tB(c,g.context,!1),xv(c,g.containerInfo)}function rW(c,g,f){if(QB(g),c===null)throw new Error("Should have a current fiber. This is a bug in React.");var v=g.pendingProps,B=g.memoizedState,V=B.element;lv(c,g),YC(g,v,null,f);var H=g.memoizedState;g.stateNode;var _=H.element;if(dr&&B.isDehydrated){var O={element:_,isDehydrated:!1,cache:H.cache,transitions:H.transitions},oe=g.updateQueue;if(oe.baseState=O,g.memoizedState=O,g.flags&bn){var Ie=new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.");return jB(c,g,_,f,Ie)}else if(_!==V){var xe=new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering.");return jB(c,g,_,f,xe)}else{Dx(g);var Je=BB(g,null,_,f);g.child=Je;for(var it=Je;it;)it.flags=it.flags&~be|Ui,it=it.sibling}}else{if(uc(),_===V)return Ac(c,g,f);gr(c,g,_,f)}return g.child}function jB(c,g,f,v,B){return uc(),qr(B),g.flags|=bn,gr(c,g,f,v),g.child}function oW(c,g,f){ZB(g),c===null&&yv(g);var v=g.type,B=g.pendingProps,V=c!==null?c.memoizedProps:null,H=B.children,_=kr(v,B);return _?H=null:V!==null&&kr(v,V)&&(g.flags|=ln),JB(c,g),gr(c,g,H,f),g.child}function ly(c,g){return c===null&&yv(g),null}function sW(c,g,f,v){c!==null&&(c.alternate=null,g.alternate=null,g.flags|=be);var B=g.pendingProps,V=f,H=V._payload,_=V._init,O=_(H);g.type=O;var oe=g.tag=ys(O),Ie=ai(O,B),xe;switch(oe){case L:return gy(g,O),g.type=O=Nl(O),xe=OB(null,g,O,Ie,v),xe;case k:return g.type=O=ky(O),xe=PB(null,g,O,Ie,v),xe;case de:return g.type=O=Uy(O),xe=gh(null,g,O,Ie,v),xe;case ke:{if(g.type!==g.elementType){var Je=O.propTypes;Je&&Fs(Je,Ie,"prop",Me(O))}return xe=Sd(null,g,O,ai(O.type,Ie),v),xe}}var it="";throw O!==null&&typeof O=="object"&&O.$$typeof===fe&&(it=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+O+". "+("Lazy element type must resolve to a class or function."+it))}function lW(c,g,f,v,B){c!==null&&(c.alternate=null,g.alternate=null,g.flags|=be),g.tag=k;var V;return ml(f)?(V=!0,ar(g)):V=!1,lc(g,B),Df(g,f,v),Av(g,f,v,B),sy(null,g,f,!0,V,B)}function cy(c,g,f,v){c!==null&&(c.alternate=null,g.alternate=null,g.flags|=be);var B=g.pendingProps,V;{var H=Ys(g,f,!1);V=EI(g,H)}lc(g,v);var _,O;VC(g);{if(f.prototype&&typeof f.prototype.render=="function"){var oe=Me(f)||"Unknown";ty[oe]||(C("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",oe,oe),ty[oe]=!0)}g.mode&Ia&&ko.recordLegacyContextWarning(g,null),us(!0),hc.current=g,_=dd(null,g,f,B,V,v),O=Xu(),us(!1)}if(fu(),g.flags|=st,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0){var Ie=Me(f)||"Unknown";Zd[Ie]||(C("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",Ie,Ie,Ie),Zd[Ie]=!0)}if(typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0){{var xe=Me(f)||"Unknown";Zd[xe]||(C("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",xe,xe,xe),Zd[xe]=!0)}g.tag=k,g.memoizedState=null,g.updateQueue=null;var Je=!1;return ml(f)?(Je=!0,ar(g)):Je=!1,g.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,ed(g),AB(g,_),Av(g,f,B,v),sy(null,g,f,!0,Je,v)}else{if(g.tag=L,g.mode&Ia){sr(!0);try{_=dd(null,g,f,B,V,v),O=Xu()}finally{sr(!1)}}return Ar()&&O&&xu(g),gr(null,g,_,v),gy(g,f),g.child}}function gy(c,g){{if(g&&g.childContextTypes&&C("%s(...): childContextTypes cannot be defined on a function component.",g.displayName||g.name||"Component"),c.ref!==null){var f="",v=nv();v&&(f+=`

Check the render method of \``+v+"`.");var B=v||"",V=c._debugSource;V&&(B=V.fileName+":"+V.lineNumber),Zp[B]||(Zp[B]=!0,C("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",f))}if(typeof g.getDerivedStateFromProps=="function"){var H=Me(g)||"Unknown";iy[H]||(C("%s: Function components do not support getDerivedStateFromProps.",H),iy[H]=!0)}if(typeof g.contextType=="object"&&g.contextType!==null){var _=Me(g)||"Unknown";ny[_]||(C("%s: Function components do not support contextType.",_),ny[_]=!0)}}}var wd={dehydrated:null,treeContext:null,retryLane:Na};function uh(c){return{baseLanes:c,cachePool:iW()}}function qB(c,g){var f=null;return{baseLanes:En(c.baseLanes,g),cachePool:f}}function cW(c,g,f,v){if(g!==null){var B=g.memoizedState;if(B===null)return!1}return Mv(c,OC)}function $B(c,g){return _I(c.childLanes,g)}function eZ(c,g,f){var v=g.pendingProps;dm(g)&&(g.flags|=un);var B=ds.current,V=!1,H=(g.flags&un)!==Q;if(H||cW(B,c)?(V=!0,g.flags&=~un):(c===null||c.memoizedState!==null)&&(B=Ox(B,RB)),B=cd(B),fg(g,B),c===null){yv(g);{var _=g.memoizedState;if(_!==null){var O=_.dehydrated;if(O!==null)return Iy(g,O)}}var oe=v.children,Ie=v.fallback;if(V){var xe=gW(g,oe,Ie,f),Je=g.child;return Je.memoizedState=uh(f),g.memoizedState=wd,xe}else return Rp(g,oe)}else{var it=c.memoizedState;if(it!==null){{var vt=it.dehydrated;if(vt!==null)if(H){if(g.flags&bn)return g.flags&=~bn,wp(c,g,f,new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering."));if(g.memoizedState!==null)return g.child=c.child,g.flags|=un,null;var xt=v.children,fn=v.fallback,Kn=uW(c,g,xt,fn,f),Gn=g.child;return Gn.memoizedState=uh(f),g.memoizedState=wd,Kn}else return IW(c,g,vt,it,f)}if(V){var Qi=v.fallback,Di=v.children,Ye=iZ(c,g,Di,Qi,f),lt=g.child,we=c.child.memoizedState;return lt.memoizedState=we===null?uh(f):qB(we,f),lt.childLanes=$B(c,f),g.memoizedState=wd,Ye}else{var Mt=v.children,rn=nZ(c,g,Mt,f);return g.memoizedState=null,rn}}else if(V){var nn=v.fallback,jn=v.children,_n=iZ(c,g,jn,nn,f),Ni=g.child,pi=c.child.memoizedState;return Ni.memoizedState=pi===null?uh(f):qB(pi,f),Ni.childLanes=$B(c,f),g.memoizedState=wd,_n}else{var $i=v.children,oi=nZ(c,g,$i,f);return g.memoizedState=null,oi}}}function Rp(c,g,f){var v=c.mode,B={mode:"visible",children:g},V=uy(B,v);return V.return=c,c.child=V,V}function gW(c,g,f,v){var B=c.mode,V=c.child,H={mode:"hidden",children:g},_,O;return(B&Hi)===Nn&&V!==null?(_=V,_.childLanes=Bt,_.pendingProps=H,c.mode&Ai&&(_.actualDuration=0,_.actualStartTime=-1,_.selfBaseDuration=0,_.treeBaseDuration=0),O=aI(f,B,v,null)):(_=uy(H,B),O=aI(f,B,v,null)),_.return=c,O.return=c,_.sibling=O,c.child=_,O}function uy(c,g,f){return jy(c,g,Bt,null)}function tZ(c,g){return _g(c,g)}function nZ(c,g,f,v){var B=c.child,V=B.sibling,H=tZ(B,{mode:"visible",children:f});if((g.mode&Hi)===Nn&&(H.lanes=v),H.return=g,H.sibling=null,V!==null){var _=g.deletions;_===null?(g.deletions=[V],g.flags|=wt):_.push(V)}return g.child=H,H}function iZ(c,g,f,v,B){var V=g.mode,H=c.child,_=H.sibling,O={mode:"hidden",children:f},oe;if((V&Hi)===Nn&&g.child!==H){var Ie=g.child;oe=Ie,oe.childLanes=Bt,oe.pendingProps=O,g.mode&Ai&&(oe.actualDuration=0,oe.actualStartTime=-1,oe.selfBaseDuration=H.selfBaseDuration,oe.treeBaseDuration=H.treeBaseDuration),g.deletions=null}else oe=tZ(H,O),oe.subtreeFlags=H.subtreeFlags&Wt;var xe;return _!==null?xe=_g(_,v):(xe=aI(v,V,B,null),xe.flags|=be),xe.return=g,oe.return=g,oe.sibling=xe,g.child=oe,xe}function wp(c,g,f,v){v!==null&&qr(v),sd(g,c.child,null,f);var B=g.pendingProps,V=B.children,H=Rp(g,V);return H.flags|=be,g.memoizedState=null,H}function uW(c,g,f,v,B){var V=g.mode,H={mode:"visible",children:f},_=uy(H,V),O=aI(v,V,B,null);return O.flags|=be,_.return=g,O.return=g,_.sibling=O,g.child=_,(g.mode&Hi)!==Nn&&sd(g,c.child,null,B),O}function Iy(c,g,f){return(c.mode&Hi)===Nn?(C("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),c.lanes=zn):ta(g)?c.lanes=gu:c.lanes=_o,null}function IW(c,g,f,v,B){if(zx(),(g.mode&Hi)===Nn)return wp(c,g,B,null);if(ta(f))return wp(c,g,B,new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering."));var V=va(B,c.childLanes);if(eo||V){var H=Nh();if(H!==null){var _=oB(H,B);if(_!==Na&&_!==v.retryLane){v.retryLane=_;var O=Zi;Pa(c,_,O)}}return Ky(),wp(c,g,B,new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition."))}else if(Ji(f)){g.flags|=un,g.child=c.child;var oe=Dy.bind(null,c);return hi(f,oe),null}else{kx(g,f,v.treeContext);var Ie=g.pendingProps,xe=Ie.children,Je=Rp(g,xe);return Je.flags|=Ui,Je}}function aZ(c,g,f){c.lanes=En(c.lanes,g);var v=c.alternate;v!==null&&(v.lanes=En(v.lanes,g)),Tf(c.return,g,f)}function dW(c,g,f){for(var v=g;v!==null;){if(v.tag===We){var B=v.memoizedState;B!==null&&aZ(v,f,c)}else if(v.tag===bt)aZ(v,f,c);else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===c)return;for(;v.sibling===null;){if(v.return===null||v.return===c)return;v=v.return}v.sibling.return=v.return,v=v.sibling}}function CW(c){for(var g=c,f=null;g!==null;){var v=g.alternate;v!==null&&PC(v)===null&&(f=g),g=g.sibling}return f}function hW(c){if(c!==void 0&&c!=="forwards"&&c!=="backwards"&&c!=="together"&&!ay[c])if(ay[c]=!0,typeof c=="string")switch(c.toLowerCase()){case"together":case"forwards":case"backwards":{C('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',c,c.toLowerCase());break}case"forward":case"backward":{C('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',c,c.toLowerCase());break}default:C('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',c);break}else C('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',c)}function AW(c,g){c!==void 0&&!ch[c]&&(c!=="collapsed"&&c!=="hidden"?(ch[c]=!0,C('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',c)):g!=="forwards"&&g!=="backwards"&&(ch[c]=!0,C('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',c)))}function rZ(c,g){{var f=Fi(c),v=!f&&typeof ue(c)=="function";if(f||v){var B=f?"array":"iterable";return C("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",B,g,B),!1}}return!0}function fW(c,g){if((g==="forwards"||g==="backwards")&&c!==void 0&&c!==null&&c!==!1)if(Fi(c)){for(var f=0;f<c.length;f++)if(!rZ(c[f],f))return}else{var v=ue(c);if(typeof v=="function"){var B=v.call(c);if(B)for(var V=B.next(),H=0;!V.done;V=B.next()){if(!rZ(V.value,H))return;H++}}else C('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',g)}}function dy(c,g,f,v,B){var V=c.memoizedState;V===null?c.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:v,tail:f,tailMode:B}:(V.isBackwards=g,V.rendering=null,V.renderingStartTime=0,V.last=v,V.tail=f,V.tailMode=B)}function Cy(c,g,f){var v=g.pendingProps,B=v.revealOrder,V=v.tail,H=v.children;hW(B),AW(V,B),fW(H,B),gr(c,g,H,f);var _=ds.current,O=Mv(_,OC);if(O)_=Nv(_,OC),g.flags|=un;else{var oe=c!==null&&(c.flags&un)!==Q;oe&&dW(g,g.child,f),_=cd(_)}if(fg(g,_),(g.mode&Hi)===Nn)g.memoizedState=null;else switch(B){case"forwards":{var Ie=CW(g.child),xe;Ie===null?(xe=g.child,g.child=null):(xe=Ie.sibling,Ie.sibling=null),dy(g,!1,xe,Ie,V);break}case"backwards":{var Je=null,it=g.child;for(g.child=null;it!==null;){var vt=it.alternate;if(vt!==null&&PC(vt)===null){g.child=it;break}var xt=it.sibling;it.sibling=Je,Je=it,it=xt}dy(g,!0,Je,null,V);break}case"together":{dy(g,!1,null,null,void 0);break}default:g.memoizedState=null}return g.child}function hy(c,g,f){xv(g,g.stateNode.containerInfo);var v=g.pendingProps;return c===null?g.child=sd(g,null,v,f):gr(c,g,v,f),g.child}var oZ=!1;function pW(c,g,f){var v=g.type,B=v._context,V=g.pendingProps,H=g.memoizedProps,_=V.value;{"value"in V||oZ||(oZ=!0,C("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var O=g.type.propTypes;O&&Fs(O,V,"prop","Context.Provider")}if(hB(g,B,_),H!==null){var oe=H.value;if(gs(oe,_)){if(H.children===V.children&&!bf())return Ac(c,g,f)}else Mx(g,B,f)}var Ie=V.children;return gr(c,g,Ie,f),g.child}var Ih=!1;function dh(c,g,f){var v=g.type;v._context===void 0?v!==v.Consumer&&(Ih||(Ih=!0,C("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):v=v._context;var B=g.pendingProps,V=B.children;typeof V!="function"&&C("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),lc(g,f);var H=Fa(v);VC(g);var _;return hc.current=g,us(!0),_=V(H),us(!1),fu(),g.flags|=st,gr(c,g,_,f),g.child}function xp(){eo=!0}function Ac(c,g,f){return c!==null&&(g.dependencies=c.dependencies),yg(),Qp(g.lanes),va(f,g.childLanes)?(Rv(c,g),g.child):null}function mW(c,g,f){{var v=g.return;if(v===null)throw new Error("Cannot swap the root fiber.");if(c.alternate=null,g.alternate=null,f.index=g.index,f.sibling=g.sibling,f.return=g.return,f.ref=g.ref,g===v.child)v.child=f;else{var B=v.child;if(B===null)throw new Error("Expected parent to have a child.");for(;B.sibling!==g;)if(B=B.sibling,B===null)throw new Error("Expected to find the previous sibling.");B.sibling=f}var V=v.deletions;return V===null?(v.deletions=[c],v.flags|=wt):V.push(c),f.flags|=be,f}}function Ay(c,g){var f=c.lanes;return!!va(f,g)}function bW(c,g,f){switch(g.tag){case F:QB(g),g.stateNode,uc();break;case le:ZB(g);break;case k:{var v=g.type;ml(v)&&ar(g);break}case U:xv(g,g.stateNode.containerInfo);break;case pe:{var B=g.memoizedProps.value,V=g.type._context;hB(g,V,B);break}case Oe:{var H=va(f,g.childLanes);H&&(g.flags|=Be);{var _=g.stateNode;_.effectDuration=0,_.passiveEffectDuration=0}}break;case We:{var O=g.memoizedState;if(O!==null){if(O.dehydrated!==null)return fg(g,cd(ds.current)),g.flags|=un,null;var oe=g.child,Ie=oe.childLanes;if(va(f,Ie))return eZ(c,g,f);fg(g,cd(ds.current));var xe=Ac(c,g,f);return xe!==null?xe.sibling:null}else fg(g,cd(ds.current));break}case bt:{var Je=(c.flags&un)!==Q,it=va(f,g.childLanes);if(Je){if(it)return Cy(c,g,f);g.flags|=un}var vt=g.memoizedState;if(vt!==null&&(vt.rendering=null,vt.tail=null,vt.lastEffect=null),fg(g,ds.current),it)break;return null}case yt:case zt:return g.lanes=Bt,UB(c,g,f)}return Ac(c,g,f)}function sZ(c,g,f){if(g._debugNeedsRemount&&c!==null)return mW(c,g,kh(g.type,g.key,g.pendingProps,g._debugOwner||null,g.mode,g.lanes));if(c!==null){var v=c.memoizedProps,B=g.pendingProps;if(v!==B||bf()||g.type!==c.type)eo=!0;else{var V=Ay(c,f);if(!V&&(g.flags&un)===Q)return eo=!1,bW(c,g,f);(c.flags&nt)!==Q?eo=!0:eo=!1}}else if(eo=!1,Ar()&&Cg(g)){var H=g.index,_=Kx();fv(g,_,H)}switch(g.lanes=Bt,g.tag){case E:return cy(c,g,g.type,f);case ot:{var O=g.elementType;return sW(c,g,O,f)}case L:{var oe=g.type,Ie=g.pendingProps,xe=g.elementType===oe?Ie:ai(oe,Ie);return OB(c,g,oe,xe,f)}case k:{var Je=g.type,it=g.pendingProps,vt=g.elementType===Je?it:ai(Je,it);return PB(c,g,Je,vt,f)}case F:return rW(c,g,f);case le:return oW(c,g,f);case ie:return ly(c,g);case We:return eZ(c,g,f);case U:return hy(c,g,f);case de:{var xt=g.type,fn=g.pendingProps,Kn=g.elementType===xt?fn:ai(xt,fn);return gh(c,g,xt,Kn,f)}case Ce:return ry(c,g,f);case Ge:return oy(c,g,f);case Oe:return aW(c,g,f);case pe:return pW(c,g,f);case ye:return dh(c,g,f);case ke:{var Gn=g.type,Qi=g.pendingProps,Di=ai(Gn,Qi);if(g.type!==g.elementType){var Ye=Gn.propTypes;Ye&&Fs(Ye,Di,"prop",Me(Gn))}return Di=ai(Gn.type,Di),Sd(c,g,Gn,Di,f)}case $e:return Rd(c,g,g.type,g.pendingProps,f);case Ne:{var lt=g.type,we=g.pendingProps,Mt=g.elementType===lt?we:ai(lt,we);return lW(c,g,lt,Mt,f)}case bt:return Cy(c,g,f);case dt:break;case yt:return UB(c,g,f)}throw new Error("Unknown unit of work tag ("+g.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function vW(c,g,f){switch(pv(g),g.tag){case k:{var v=g.type;ml(v)&&vf(g);var B=g.flags;return B&Te?(g.flags=B&~Te|un,(g.mode&Ai)!==Nn&&yd(g),g):null}case F:{ld(g),yf(g),Hv();var V=g.flags;return(V&Te)!==Q&&(V&un)===Q?(g.flags=V&~Te|un,g):null}case le:return Wv(g),null;case We:{gd(g);{var H=g.memoizedState;if(H!==null&&H.dehydrated!==null){if(g.alternate===null)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");uc()}}var _=g.flags;return _&Te?(g.flags=_&~Te|un,(g.mode&Ai)!==Nn&&yd(g),g):null}case bt:return gd(g),null;case U:return ld(g),null;case pe:var O=g.type._context;return XC(O,g),null;case yt:case zt:return Hh(g),null;case Nt:return null;default:return null}}function fy(c,g,f){switch(pv(g),g.tag){case k:{var v=g.type.childContextTypes;v!=null&&vf(g);break}case F:{ld(g),yf(g),Hv();break}case le:{Wv(g);break}case U:ld(g);break;case We:gd(g);break;case bt:gd(g);break;case pe:var B=g.type._context;XC(B,g);break;case yt:case zt:Hh(g);break}}function lZ(c,g,f,v,B,V,H,_,O){var oe=Array.prototype.slice.call(arguments,3);try{g.apply(f,oe)}catch(Ie){this.onError(Ie)}}var cZ=lZ;if(typeof window<"u"&&typeof window.dispatchEvent=="function"&&typeof document<"u"&&typeof document.createEvent=="function"){var py=document.createElement("react");cZ=function(g,f,v,B,V,H,_,O,oe){if(typeof document>"u"||document===null)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var Ie=document.createEvent("Event"),xe=!1,Je=!0,it=window.event,vt=Object.getOwnPropertyDescriptor(window,"event");function xt(){py.removeEventListener(lt,Kn,!1),typeof window.event<"u"&&window.hasOwnProperty("event")&&(window.event=it)}var fn=Array.prototype.slice.call(arguments,3);function Kn(){xe=!0,xt(),f.apply(v,fn),Je=!1}var Gn,Qi=!1,Di=!1;function Ye(we){if(Gn=we.error,Qi=!0,Gn===null&&we.colno===0&&we.lineno===0&&(Di=!0),we.defaultPrevented&&Gn!=null&&typeof Gn=="object")try{Gn._suppressLogging=!0}catch{}}var lt="react-"+(g||"invokeguardedcallback");if(window.addEventListener("error",Ye),py.addEventListener(lt,Kn,!1),Ie.initEvent(lt,!1,!1),py.dispatchEvent(Ie),vt&&Object.defineProperty(window,"event",vt),xe&&Je&&(Qi?Di&&(Gn=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):Gn=new Error(`An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the "Pause on exceptions" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue.`),this.onError(Gn)),window.removeEventListener("error",Ye),!xe)return xt(),lZ.apply(this,arguments)}}var yW=cZ,Ch=!1,Wp=null,GW={onError:function(c){Ch=!0,Wp=c}};function gZ(c,g,f,v,B,V,H,_,O){Ch=!1,Wp=null,yW.apply(GW,arguments)}function BW(){return Ch}function uZ(){if(Ch){var c=Wp;return Ch=!1,Wp=null,c}else throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}var IZ=null;IZ=new Set;var Vp=!1,Gg=!1,ZW=typeof WeakSet=="function"?WeakSet:Set,Qt=null,xd=null,Qs=null;function Ca(c){gZ(null,function(){throw c}),uZ()}var my=function(c,g){if(g.props=c.memoizedProps,g.state=c.memoizedState,c.mode&Ai)try{Fr(),g.componentWillUnmount()}finally{So(c)}else g.componentWillUnmount()};function Wd(c,g){try{fs(da,c)}catch(f){Ca(f),_i(c,g,f)}}function hh(c,g,f){try{my(c,f)}catch(v){Ca(v),_i(c,g,v)}}function SW(c,g,f){try{f.componentDidMount()}catch(v){Ca(v),_i(c,g,v)}}function dZ(c,g){try{ph(c)}catch(f){Ca(f),_i(c,g,f)}}function Mp(c,g){var f=c.ref;if(f!==null)if(typeof f=="function"){var v;try{if(K&&T&&c.mode&Ai)try{Fr(),v=f(null)}finally{So(c)}else v=f(null)}catch(B){Ca(B),_i(c,g,B)}typeof v=="function"&&C("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",De(c))}else f.current=null}function Bg(c,g,f){try{f()}catch(v){Ca(v),_i(c,g,v)}}var Ah=!1;function CZ(c,g){ma(c.containerInfo),Qt=g,fh();var f=Ah;return Ah=!1,f}function fh(){for(;Qt!==null;){var c=Qt,g=c.child;(c.subtreeFlags&Ze)!==Q&&g!==null?(bs(g,c),Qt=g):_u()}}function _u(){for(;Qt!==null;){var c=Qt;Xa(c);try{Zg(c)}catch(f){Ca(f),_i(c,c.return,f)}lr();var g=c.sibling;if(g!==null){bs(g,c.return),Qt=g;return}Qt=c.return}}function Zg(c){var g=c.alternate,f=c.flags;if((f&bi)!==Q){switch(Xa(c),c.tag){case L:case de:case $e:break;case k:{if(g!==null){var v=g.memoizedProps,B=g.memoizedState,V=c.stateNode;c.type===c.elementType&&!zu&&(V.props!==c.memoizedProps&&C("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",De(c)||"instance"),V.state!==c.memoizedState&&C("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",De(c)||"instance"));var H=V.getSnapshotBeforeUpdate(c.elementType===c.type?v:ai(c.type,v),B);{var _=IZ;H===void 0&&!_.has(c.type)&&(_.add(c.type),C("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",De(c)))}V.__reactInternalSnapshotBeforeUpdate=H}break}case F:{if(fo){var O=c.stateNode;z(O.containerInfo)}break}case le:case ie:case U:case Ne:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}lr()}}function Oa(c,g,f){var v=g.updateQueue,B=v!==null?v.lastEffect:null;if(B!==null){var V=B.next,H=V;do{if((H.tag&c)===c){var _=H.destroy;H.destroy=void 0,_!==void 0&&((c&cr)!==Cs?Gx(g):(c&da)!==Cs&&uB(g),Bg(g,f,_),(c&cr)!==Cs?Bx():(c&da)!==Cs&&qb())}H=H.next}while(H!==V)}}function fs(c,g){var f=g.updateQueue,v=f!==null?f.lastEffect:null;if(v!==null){var B=v.next,V=B;do{if((V.tag&c)===c){(c&cr)!==Cs?gB(g):(c&da)!==Cs&&Zx(g);var H=V.create;V.destroy=H(),(c&cr)!==Cs?yx():(c&da)!==Cs&&Sx();{var _=V.destroy;if(_!==void 0&&typeof _!="function"){var O=void 0;(V.tag&da)!==Q?O="useLayoutEffect":(V.tag&pg)!==Q?O="useInsertionEffect":O="useEffect";var oe=void 0;_===null?oe=" You returned null. If your effect does not require clean up, return undefined (or nothing).":typeof _.then=="function"?oe=`

It looks like you wrote `+O+`(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:

`+O+`(() => {
  async function fetchData() {
    // You can await here
    const response = await MyAPI.getData(someId);
    // ...
  }
  fetchData();
}, [someId]); // Or [] if effect doesn't need props or state

Learn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching`:oe=" You returned: "+_,C("%s must not return anything besides a function, which is used for clean-up.%s",O,oe)}}}V=V.next}while(V!==B)}}function by(c,g){if((g.flags&Be)!==Q)switch(g.tag){case Oe:{var f=g.stateNode.passiveEffectDuration,v=g.memoizedProps,B=v.id,V=v.onPostCommit,H=dc(),_=g.alternate===null?"mount":"update";EB()&&(_="nested-update"),typeof V=="function"&&V(B,_,f,H);var O=g.return;e:for(;O!==null;){switch(O.tag){case F:var oe=O.stateNode;oe.passiveEffectDuration+=f;break e;case Oe:var Ie=O.stateNode;Ie.passiveEffectDuration+=f;break e}O=O.return}break}}}function RW(c,g,f,v){if((f.flags&Ae)!==Q)switch(f.tag){case L:case de:case $e:{if(!Gg)if(f.mode&Ai)try{Fr(),fs(da|Ki,f)}finally{So(f)}else fs(da|Ki,f);break}case k:{var B=f.stateNode;if(f.flags&Be&&!Gg)if(g===null)if(f.type===f.elementType&&!zu&&(B.props!==f.memoizedProps&&C("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",De(f)||"instance"),B.state!==f.memoizedState&&C("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",De(f)||"instance")),f.mode&Ai)try{Fr(),B.componentDidMount()}finally{So(f)}else B.componentDidMount();else{var V=f.elementType===f.type?g.memoizedProps:ai(f.type,g.memoizedProps),H=g.memoizedState;if(f.type===f.elementType&&!zu&&(B.props!==f.memoizedProps&&C("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",De(f)||"instance"),B.state!==f.memoizedState&&C("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",De(f)||"instance")),f.mode&Ai)try{Fr(),B.componentDidUpdate(V,H,B.__reactInternalSnapshotBeforeUpdate)}finally{So(f)}else B.componentDidUpdate(V,H,B.__reactInternalSnapshotBeforeUpdate)}var _=f.updateQueue;_!==null&&(f.type===f.elementType&&!zu&&(B.props!==f.memoizedProps&&C("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",De(f)||"instance"),B.state!==f.memoizedState&&C("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",De(f)||"instance")),cv(f,_,B));break}case F:{var O=f.updateQueue;if(O!==null){var oe=null;if(f.child!==null)switch(f.child.tag){case le:oe=ni(f.child.stateNode);break;case k:oe=f.child.stateNode;break}cv(f,O,oe)}break}case le:{var Ie=f.stateNode;if(g===null&&f.flags&Be){var xe=f.type,Je=f.memoizedProps;Qc(Ie,xe,Je,f)}break}case ie:break;case U:break;case Oe:{{var it=f.memoizedProps,vt=it.onCommit,xt=it.onRender,fn=f.stateNode.effectDuration,Kn=dc(),Gn=g===null?"mount":"update";EB()&&(Gn="nested-update"),typeof xt=="function"&&xt(f.memoizedProps.id,Gn,f.actualDuration,f.treeBaseDuration,f.actualStartTime,Kn);{typeof vt=="function"&&vt(f.memoizedProps.id,Gn,fn,Kn),zy(f);var Qi=f.return;e:for(;Qi!==null;){switch(Qi.tag){case F:var Di=Qi.stateNode;Di.effectDuration+=fn;break e;case Oe:var Ye=Qi.stateNode;Ye.effectDuration+=fn;break e}Qi=Qi.return}}}break}case We:{Hp(c,f);break}case bt:case Ne:case dt:case yt:case zt:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}Gg||f.flags&ui&&ph(f)}function hZ(c){switch(c.tag){case L:case de:case $e:{if(c.mode&Ai)try{Fr(),Wd(c,c.return)}finally{So(c)}else Wd(c,c.return);break}case k:{var g=c.stateNode;typeof g.componentDidMount=="function"&&SW(c,c.return,g),dZ(c,c.return);break}case le:{dZ(c,c.return);break}}}function AZ(c,g){var f=null;if(fo)for(var v=c;;){if(v.tag===le){if(f===null){f=v;var B=v.stateNode;g?lf(B):gf(v.stateNode,v.memoizedProps)}}else if(v.tag===ie){if(f===null){var V=v.stateNode;g?cf(V):uf(V,v.memoizedProps)}}else if(!((v.tag===yt||v.tag===zt)&&v.memoizedState!==null&&v!==c)){if(v.child!==null){v.child.return=v,v=v.child;continue}}if(v===c)return;for(;v.sibling===null;){if(v.return===null||v.return===c)return;f===v&&(f=null),v=v.return}f===v&&(f=null),v.sibling.return=v.return,v=v.sibling}}function ph(c){var g=c.ref;if(g!==null){var f=c.stateNode,v;switch(c.tag){case le:v=ni(f);break;default:v=f}if(typeof g=="function"){var B;if(c.mode&Ai)try{Fr(),B=g(v)}finally{So(c)}else B=g(v);typeof B=="function"&&C("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",De(c))}else g.hasOwnProperty("current")||C("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",De(c)),g.current=v}}function js(c){var g=c.ref;if(g!==null)if(typeof g=="function")if(c.mode&Ai)try{Fr(),g(null)}finally{So(c)}else g(null);else g.current=null}function Np(c,g,f){switch(JI(g),g.tag){case L:case de:case ke:case $e:{var v=g.updateQueue;if(v!==null){var B=v.lastEffect;if(B!==null){var V=B.next,H=V;do{var _=H,O=_.destroy,oe=_.tag;O!==void 0&&((oe&pg)!==Cs?Bg(g,f,O):(oe&da)!==Cs&&(uB(g),g.mode&Ai?(Fr(),Bg(g,f,O),So(g)):Bg(g,f,O),qb())),H=H.next}while(H!==V)}}return}case k:{Mp(g,f);var Ie=g.stateNode;typeof Ie.componentWillUnmount=="function"&&hh(g,f,Ie);return}case le:{Mp(g,f);return}case U:{fo?yy(c,g,f):Pn&&Yr(g);return}case tt:return;case dt:return}}function mh(c,g,f){for(var v=g;;){if(Np(c,v,f),v.child!==null&&(!fo||v.tag!==U)){v.child.return=v,v=v.child;continue}if(v===g)return;for(;v.sibling===null;){if(v.return===null||v.return===g)return;v=v.return}v.sibling.return=v.return,v=v.sibling}}function fc(c){var g=c.alternate;g!==null&&(g.return=null),c.return=null}function pc(c){var g=c.alternate;g!==null&&(c.alternate=null,pc(g));{if(c.child=null,c.deletions=null,c.sibling=null,c.tag===le){var f=c.stateNode;f!==null&&wr(f)}c.stateNode=null,c._debugOwner=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}}function Yr(c){if(Pn){var g=c.stateNode,f=g.containerInfo,v=Ke(f);Bn(f,v)}}function Tr(c){if(Pn){switch(c.tag){case k:case le:case ie:return;case F:case U:{var g=c.stateNode,f=g.containerInfo,v=g.pendingChildren;Bn(f,v);return}}throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}}function vy(c){for(var g=c.return;g!==null;){if(Ro(g))return g;g=g.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}function Ro(c){return c.tag===le||c.tag===F||c.tag===U}function Wl(c){var g=c;e:for(;;){for(;g.sibling===null;){if(g.return===null||Ro(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;g.tag!==le&&g.tag!==ie&&g.tag!==tt;){if(g.flags&be||g.child===null||g.tag===U)continue e;g.child.return=g,g=g.child}if(!(g.flags&be))return g.stateNode}}function qs(c){if(fo){var g=vy(c);switch(g.tag){case le:{var f=g.stateNode;g.flags&ln&&(lu(f),g.flags&=~ln);var v=Wl(c);Sg(c,v,f);break}case F:case U:{var B=g.stateNode.containerInfo,V=Wl(c);bh(c,V,B);break}default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}}function bh(c,g,f){var v=c.tag,B=v===le||v===ie;if(B){var V=c.stateNode;g?Ul(f,V,g):su(f,V)}else if(v!==U){var H=c.child;if(H!==null){bh(H,g,f);for(var _=H.sibling;_!==null;)bh(_,g,f),_=_.sibling}}}function Sg(c,g,f){var v=c.tag,B=v===le||v===ie;if(B){var V=c.stateNode;g?sf(f,V,g):XI(f,V)}else if(v!==U){var H=c.child;if(H!==null){Sg(H,g,f);for(var _=H.sibling;_!==null;)Sg(_,g,f),_=_.sibling}}}function yy(c,g,f){for(var v=g,B=!1,V,H;;){if(!B){var _=v.return;e:for(;;){if(_===null)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");var O=_.stateNode;switch(_.tag){case le:V=O,H=!1;break e;case F:V=O.containerInfo,H=!0;break e;case U:V=O.containerInfo,H=!0;break e}_=_.return}B=!0}if(v.tag===le||v.tag===ie)mh(c,v,f),H?jc(V,v.stateNode):FI(V,v.stateNode);else if(v.tag===tt)H?Bb(V,v.stateNode):EG(V,v.stateNode);else if(v.tag===U){if(v.child!==null){V=v.stateNode.containerInfo,H=!0,v.child.return=v,v=v.child;continue}}else if(Np(c,v,f),v.child!==null){v.child.return=v,v=v.child;continue}if(v===g)return;for(;v.sibling===null;){if(v.return===null||v.return===g)return;v=v.return,v.tag===U&&(B=!1)}v.sibling.return=v.return,v=v.sibling}}function Vd(c,g,f){fo?yy(c,g,f):mh(c,g,f),fc(g)}function Md(c,g){if(!fo){switch(g.tag){case L:case de:case ke:case $e:{if(Oa(pg|Ki,g,g.return),fs(pg|Ki,g),g.mode&Ai)try{Fr(),Oa(da|Ki,g,g.return)}finally{So(g)}else Oa(da|Ki,g,g.return);return}case Oe:return;case We:{$s(g),Nd(g);return}case bt:{Nd(g);return}case F:{if(dr&&c!==null){var f=c.memoizedState;if(f.isDehydrated){var v=g.stateNode;TG(v.containerInfo)}}break}case yt:case zt:return}Tr(g);return}switch(g.tag){case L:case de:case ke:case $e:{if(Oa(pg|Ki,g,g.return),fs(pg|Ki,g),g.mode&Ai)try{Fr(),Oa(da|Ki,g,g.return)}finally{So(g)}else Oa(da|Ki,g,g.return);return}case k:return;case le:{var B=g.stateNode;if(B!=null){var V=g.memoizedProps,H=c!==null?c.memoizedProps:V,_=g.type,O=g.updateQueue;g.updateQueue=null,O!==null&&of(B,O,_,H,V,g)}return}case ie:{if(g.stateNode===null)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var oe=g.stateNode,Ie=g.memoizedProps,xe=c!==null?c.memoizedProps:Ie;rf(oe,xe,Ie);return}case F:{if(dr&&c!==null){var Je=c.memoizedState;if(Je.isDehydrated){var it=g.stateNode;TG(it.containerInfo)}}return}case Oe:return;case We:{$s(g),Nd(g);return}case bt:{Nd(g);return}case Ne:return}throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}function $s(c){c.memoizedState}function Hp(c,g){if(dr){var f=g.memoizedState;if(f===null){var v=g.alternate;if(v!==null){var B=v.memoizedState;if(B!==null){var V=B.dehydrated;V!==null&&tx(V)}}}}}function Nd(c){var g=c.updateQueue;if(g!==null){c.updateQueue=null;var f=c.stateNode;f===null&&(f=c.stateNode=new ZW),g.forEach(function(v){var B=YW.bind(null,c,v);if(!f.has(v)){if(f.add(v),ks)if(xd!==null&&Qs!==null)Jt(Qs,xd);else throw Error("Expected finished root and lanes to be set. This is a bug in React.");v.then(B,B)}})}}function fZ(c){fo&&lu(c.stateNode)}function pZ(c,g,f){xd=f,Qs=c,Qt=g,Xp(c,f),xd=null,Qs=null}function Xp(c,g){for(;Qt!==null;){var f=Qt,v=f.deletions;if(v!==null)for(var B=0;B<v.length;B++){var V=v[B];try{Vd(c,V,f)}catch(_){Ca(_),_i(V,f,_)}}var H=f.child;(f.subtreeFlags&Se)!==Q&&H!==null?(bs(H,f),Qt=H):mZ(c,g)}}function mZ(c,g){for(;Qt!==null;){var f=Qt;Xa(f);try{wW(f,c,g)}catch(B){Ca(B),_i(f,f.return,B)}lr();var v=f.sibling;if(v!==null){bs(v,f.return),Qt=v;return}Qt=f.return}}function wW(c,g,f){var v=c.flags;if(v&ln&&fZ(c),v&ui){var B=c.alternate;B!==null&&js(B)}if(v&ua)switch(c.tag){case We:{var V=c.memoizedState,H=V!==null;if(H){var _=c.alternate,O=_!==null&&_.memoizedState!==null;O||Ey()}break}case yt:{var oe=c.memoizedState,Ie=oe!==null,xe=c.alternate,Je=xe!==null&&xe.memoizedState!==null,it=c;fo&&AZ(it,Ie);{if(Ie&&!Je&&(it.mode&Hi)!==Nn){Qt=it;for(var vt=it.child;vt!==null;)Qt=vt,Gy(vt),vt=vt.sibling}break}}}var xt=v&(be|Be|Ui);switch(xt){case be:{qs(c),c.flags&=~be;break}case Ft:{qs(c),c.flags&=~be;var fn=c.alternate;Md(fn,c);break}case Ui:{c.flags&=~Ui;break}case pa:{c.flags&=~Ui;var Kn=c.alternate;Md(Kn,c);break}case Be:{var Gn=c.alternate;Md(Gn,c);break}}}function Rg(c,g,f){xd=f,Qs=g,Qt=c,vh(c,g,f),xd=null,Qs=null}function vh(c,g,f){for(var v=(c.mode&Hi)!==Nn;Qt!==null;){var B=Qt,V=B.child;if(B.tag===yt&&v){var H=B.memoizedState!==null,_=H||Vp;if(_){el(c,g,f);continue}else{var O=B.alternate,oe=O!==null&&O.memoizedState!==null,Ie=oe||Gg,xe=Vp,Je=Gg;Vp=_,Gg=Ie,Gg&&!Je&&(Qt=B,bZ(B));for(var it=V;it!==null;)Qt=it,vh(it,g,f),it=it.sibling;Qt=B,Vp=xe,Gg=Je,el(c,g,f);continue}}(B.subtreeFlags&Ae)!==Q&&V!==null?(bs(V,B),Qt=V):el(c,g,f)}}function el(c,g,f){for(;Qt!==null;){var v=Qt;if((v.flags&Ae)!==Q){var B=v.alternate;Xa(v);try{RW(g,B,v,f)}catch(H){Ca(H),_i(v,v.return,H)}lr()}if(v===c){Qt=null;return}var V=v.sibling;if(V!==null){bs(V,v.return),Qt=V;return}Qt=v.return}}function Gy(c){for(;Qt!==null;){var g=Qt,f=g.child;switch(g.tag){case L:case de:case ke:case $e:{if(g.mode&Ai)try{Fr(),Oa(da,g,g.return)}finally{So(g)}else Oa(da,g,g.return);break}case k:{Mp(g,g.return);var v=g.stateNode;typeof v.componentWillUnmount=="function"&&hh(g,g.return,v);break}case le:{Mp(g,g.return);break}case yt:{var B=g.memoizedState!==null;if(B){Fp(c);continue}break}}f!==null?(f.return=g,Qt=f):Fp(c)}}function Fp(c){for(;Qt!==null;){var g=Qt;if(g===c){Qt=null;return}var f=g.sibling;if(f!==null){f.return=g.return,Qt=f;return}Qt=g.return}}function bZ(c){for(;Qt!==null;){var g=Qt,f=g.child;if(g.tag===yt){var v=g.memoizedState!==null;if(v){vZ(c);continue}}f!==null?(f.return=g,Qt=f):vZ(c)}}function vZ(c){for(;Qt!==null;){var g=Qt;Xa(g);try{hZ(g)}catch(v){Ca(v),_i(g,g.return,v)}if(lr(),g===c){Qt=null;return}var f=g.sibling;if(f!==null){f.return=g.return,Qt=f;return}Qt=g.return}}function yZ(c,g){Qt=g,wg(g,c)}function wg(c,g){for(;Qt!==null;){var f=Qt,v=f.child;(f.subtreeFlags&mt)!==Q&&v!==null?(bs(v,f),Qt=v):Hd(c,g)}}function Hd(c,g){for(;Qt!==null;){var f=Qt;if((f.flags&aa)!==Q){Xa(f);try{Xd(g,f)}catch(B){Ca(B),_i(f,f.return,B)}lr()}if(f===c){Qt=null;return}var v=f.sibling;if(v!==null){bs(v,f.return),Qt=v;return}Qt=f.return}}function Xd(c,g){switch(g.tag){case L:case de:case $e:{if(g.mode&Ai){vp();try{fs(cr|Ki,g)}finally{vd(g)}}else fs(cr|Ki,g);break}}}function Yp(c){Qt=c,Tp()}function Tp(){for(;Qt!==null;){var c=Qt,g=c.child;if((Qt.flags&wt)!==Q){var f=c.deletions;if(f!==null){for(var v=0;v<f.length;v++){var B=f[v];Qt=B,Du(B,c)}{var V=c.alternate;if(V!==null){var H=V.child;if(H!==null){V.child=null;do{var _=H.sibling;H.sibling=null,H=_}while(H!==null)}}}Qt=c}}(c.subtreeFlags&mt)!==Q&&g!==null?(bs(g,c),Qt=g):ps()}}function ps(){for(;Qt!==null;){var c=Qt;(c.flags&aa)!==Q&&(Xa(c),ms(c),lr());var g=c.sibling;if(g!==null){bs(g,c.return),Qt=g;return}Qt=c.return}}function ms(c){switch(c.tag){case L:case de:case $e:{c.mode&Ai?(vp(),Oa(cr|Ki,c,c.return),vd(c)):Oa(cr|Ki,c,c.return);break}}}function Du(c,g){for(;Qt!==null;){var f=Qt;Xa(f),bc(f,g),lr();var v=f.child;v!==null?(bs(v,f),Qt=v):mc(c)}}function mc(c){for(;Qt!==null;){var g=Qt,f=g.sibling,v=g.return;if(pc(g),g===c){Qt=null;return}if(f!==null){bs(f,v),Qt=f;return}Qt=v}}function bc(c,g){switch(c.tag){case L:case de:case $e:{c.mode&Ai?(vp(),Oa(cr,c,g),vd(c)):Oa(cr,c,g);break}}}var GZ=!1;function bs(c,g){!GZ&&c.return!==g&&(GZ=!0,C("Internal React error: Return pointer is inconsistent with parent.")),c.return=g}function xW(c){switch(c.tag){case L:case de:case $e:{try{fs(da|Ki,c)}catch(f){Ca(f),_i(c,c.return,f)}break}case k:{var g=c.stateNode;try{g.componentDidMount()}catch(f){Ca(f),_i(c,c.return,f)}break}}}function ku(c){switch(c.tag){case L:case de:case $e:{try{fs(cr|Ki,c)}catch(g){Ca(g),_i(c,c.return,g)}break}}}function BZ(c){switch(c.tag){case L:case de:case $e:{try{Oa(da|Ki,c,c.return)}catch(f){Ca(f),_i(c,c.return,f)}break}case k:{var g=c.stateNode;typeof g.componentWillUnmount=="function"&&hh(c,c.return,g);break}}}function By(c){switch(c.tag){case L:case de:case $e:try{Oa(cr|Ki,c,c.return)}catch(g){Ca(g),_i(c,c.return,g)}}}var Uu=0,Ep=1,Fd=2,Kp=3,Lp=4;if(typeof Symbol=="function"&&Symbol.for){var tl=Symbol.for;Uu=tl("selector.component"),Ep=tl("selector.has_pseudo_class"),Fd=tl("selector.role"),Kp=tl("selector.test_id"),Lp=tl("selector.text")}function fr(c){return{$$typeof:Uu,value:c}}function vs(c){return{$$typeof:Ep,value:c}}function nl(c){return{$$typeof:Fd,value:c}}function Ju(c){return{$$typeof:Lp,value:c}}function xg(c){return{$$typeof:Kp,value:c}}function Zy(c){var g=dC(c);if(g!=null){if(typeof g.memoizedProps["data-testname"]!="string")throw new Error("Invalid host root specified. Should be either a React container or a node with a testname attribute.");return g}else{var f=ir(c);if(f===null)throw new Error("Could not find React container within specified host subtree.");return f.stateNode.current}}function zp(c,g){switch(g.$$typeof){case Uu:if(c.type===g.value)return!0;break;case Ep:return WW(c,g.value);case Fd:if(c.tag===le){var f=c.stateNode;if(po(f,g.value))return!0}break;case Lp:if(c.tag===le||c.tag===ie){var v=af(c);if(v!==null&&v.indexOf(g.value)>=0)return!0}break;case Kp:if(c.tag===le){var B=c.memoizedProps["data-testname"];if(typeof B=="string"&&B.toLowerCase()===g.value.toLowerCase())return!0}break;default:throw new Error("Invalid selector type specified.")}return!1}function Sy(c){switch(c.$$typeof){case Uu:var g=Me(c.value)||"Unknown";return"<"+g+">";case Ep:return":has("+(Sy(c)||"")+")";case Fd:return'[role="'+c.value+'"]';case Lp:return'"'+c.value+'"';case Kp:return'[data-testname="'+c.value+'"]';default:throw new Error("Invalid selector type specified.")}}function ZZ(c,g){for(var f=[],v=[c,0],B=0;B<v.length;){var V=v[B++],H=v[B++],_=g[H];if(!(V.tag===le&&Cr(V))){for(;_!=null&&zp(V,_);)H++,_=g[H];if(H===g.length)f.push(V);else for(var O=V.child;O!==null;)v.push(O,H),O=O.sibling}}return f}function WW(c,g){for(var f=[c,0],v=0;v<f.length;){var B=f[v++],V=f[v++],H=g[V];if(!(B.tag===le&&Cr(B))){for(;H!=null&&zp(B,H);)V++,H=g[V];if(V===g.length)return!0;for(var _=B.child;_!==null;)f.push(_,V),_=_.sibling}}return!1}function yh(c,g){if(!kl)throw new Error("Test selector API is not supported by this renderer.");for(var f=Zy(c),v=ZZ(f,g),B=[],V=Array.from(v),H=0;H<V.length;){var _=V[H++];if(_.tag===le){if(Cr(_))continue;B.push(_.stateNode)}else for(var O=_.child;O!==null;)V.push(O),O=O.sibling}return B}function SZ(c,g){if(!kl)throw new Error("Test selector API is not supported by this renderer.");for(var f=Zy(c),v=0,B=[],V=[f,0],H=0;H<V.length;){var _=V[H++],O=V[H++],oe=g[O];if(!(_.tag===le&&Cr(_))&&(zp(_,oe)&&(B.push(Sy(oe)),O++,O>v&&(v=O)),O<g.length))for(var Ie=_.child;Ie!==null;)V.push(Ie,O),Ie=Ie.sibling}if(v<g.length){for(var xe=[],Je=v;Je<g.length;Je++)xe.push(Sy(g[Je]));return`findAllNodes was able to match part of the selector:
`+("  "+B.join(" > ")+`

`)+`No matching component was found for:
`+("  "+xe.join(" > "))}return null}function Ry(c,g){if(!kl)throw new Error("Test selector API is not supported by this renderer.");for(var f=yh(c,g),v=[],B=0;B<f.length;B++)v.push(ra(f[B]));for(var V=v.length-1;V>0;V--)for(var H=v[V],_=H.x,O=_+H.width,oe=H.y,Ie=oe+H.height,xe=V-1;xe>=0;xe--)if(V!==xe){var Je=v[xe],it=Je.x,vt=it+Je.width,xt=Je.y,fn=xt+Je.height;if(_>=it&&oe>=xt&&O<=vt&&Ie<=fn){v.splice(V,1);break}else if(_===it&&H.width===Je.width&&!(fn<oe)&&!(xt>Ie)){xt>oe&&(Je.height+=xt-oe,Je.y=oe),fn<Ie&&(Je.height=Ie-xt),v.splice(V,1);break}else if(oe===xt&&H.height===Je.height&&!(vt<_)&&!(it>O)){it>_&&(Je.width+=it-_,Je.x=_),vt<O&&(Je.width=O-it),v.splice(V,1);break}}return v}function RZ(c,g){if(!kl)throw new Error("Test selector API is not supported by this renderer.");for(var f=Zy(c),v=ZZ(f,g),B=Array.from(v),V=0;V<B.length;){var H=B[V++];if(!Cr(H)){if(H.tag===le){var _=H.stateNode;if(fl(_))return!0}for(var O=H.child;O!==null;)B.push(O),O=O.sibling}}return!1}var Gh=[];function wy(){kl&&Gh.forEach(function(c){return c()})}function xy(c,g,f,v){if(!kl)throw new Error("Test selector API is not supported by this renderer.");var B=yh(c,g),V=vb(B,f,v),H=V.disconnect,_=V.observe,O=V.unobserve,oe=function(){var Ie=yh(c,g);B.forEach(function(xe){Ie.indexOf(xe)<0&&O(xe)}),Ie.forEach(function(xe){B.indexOf(xe)<0&&_(xe)})};return Gh.push(oe),{disconnect:function(){var Ie=Gh.indexOf(oe);Ie>=0&&Gh.splice(Ie,1),H()}}}var Wy=o.ReactCurrentActQueue;function VW(c){{var g=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0,f=typeof jest<"u";return HI&&f&&g!==!1}}function wZ(){{var c=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0;return!c&&Wy.current!==null&&C("The current testing environment is not configured to support act(...)"),c}}var MW=Math.ceil,Vy=o.ReactCurrentDispatcher,_p=o.ReactCurrentOwner,Pi=o.ReactCurrentBatchConfig,il=o.ReactCurrentActQueue,Za=0,Wg=1,pr=2,Li=4,al=0,Bh=1,Ou=2,Dp=3,to=4,xZ=5,vc=6,Xn=Za,Ya=null,zi=null,ca=Bt,wo=Bt,Pu=$c(Bt),qi=al,Vg=null,Zh=Bt,Qu=Bt,Yd=Bt,ju=null,Er=null,Sh=0,My=500,WZ=1/0,Rh=500;function yc(){WZ=sa()+Rh}function wh(){return WZ}var xh=!1,kp=null,rl=null,Mg=!1,Gc=null,Wh=Bt,Vh=[],Ny=50,Ng=0,Hg=null,Hy=50,qu=0,Xg=Zi,Mh=Bt;function Nh(){return Ya}function Kr(){return(Xn&(pr|Li))!==Za?sa():(Xg!==Zi||(Xg=sa()),Xg)}function Vl(c){var g=c.mode;if((g&Hi)===Nn)return zn;if((Xn&pr)!==Za&&ca!==Bt)return Au(ca);var f=NC()!==PI;if(f){if(Pi.transition!==null){var v=Pi.transition;v._updatedFibers||(v._updatedFibers=new Set),v._updatedFibers.add(c)}return Mh===Na&&(Mh=Pr()),Mh}var B=Ds();if(B!==Na)return B;var V=nf();return V}function Xy(c){var g=c.mode;return(g&Hi)===Nn?zn:kb()}function Pa(c,g,f){Kd();var v=Bc(c,g);return v===null?null:(zs(v,g,f),(Xn&pr)!==Bt&&v===Ya?EW(c):(ks&&Pb(v,c,g),Wi(c),v===Ya&&((Xn&pr)===Za&&(Qu=En(Qu,g)),qi===to&&Ra(v,ca)),Ta(v,f),g===zn&&Xn===Za&&(c.mode&Hi)===Nn&&!il.isBatchingLegacy&&(yc(),Gl())),v)}function NW(c,g,f){var v=c.current;v.lanes=g,zs(c,g,f),Ta(c,f)}function Bc(c,g){c.lanes=En(c.lanes,g);var f=c.alternate;f!==null&&(f.lanes=En(f.lanes,g)),f===null&&(c.flags&(be|Ui))!==Q&&ol(c);for(var v=c,B=c.return;B!==null;)B.childLanes=En(B.childLanes,g),f=B.alternate,f!==null?f.childLanes=En(f.childLanes,g):(B.flags&(be|Ui))!==Q&&ol(c),v=B,B=B.return;if(v.tag===F){var V=v.stateNode;return V}else return null}function Sa(c,g){return Ya!==null&&(c.mode&Hi)!==Nn&&(Xn&pr)===Za}function Ta(c,g){var f=c.callbackNode;ec(c,g);var v=tg(c,c===Ya?ca:Bt);if(v===Bt){f!==null&&nI(f),c.callbackNode=null,c.callbackPriority=Na;return}var B=ag(v),V=c.callbackPriority;if(V===B&&!(il.current!==null&&f!==tI)){f==null&&V!==zn&&C("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.");return}f!=null&&nI(f);var H;if(B===zn)c.tag===KI?(il.isBatchingLegacy!==null&&(il.didScheduleLegacyUpdate=!0),OI(VZ.bind(null,c))):Vn(VZ.bind(null,c)),ou?il.current!==null?il.current.push(Vr):Pc(function(){Xn===Za&&Vr()}):Ld(_a,Vr),H=null;else{var _;switch(rg(v)){case _s:_=_a;break;case wC:_=Pt;break;case kI:_=Qr;break;case Wf:_=cs;break;default:_=Qr;break}H=Ld(_,Up.bind(null,c))}c.callbackPriority=B,c.callbackNode=H}function Up(c,g){if(ah(),Xg=Zi,Mh=Bt,(Xn&(pr|Li))!==Za)throw new Error("Should not already be working.");var f=c.callbackNode,v=no();if(v&&c.callbackNode!==f)return null;var B=tg(c,c===Ya?ca:Bt);if(B===Bt)return null;var V=!xf(c,B)&&!gx(c,B)&&!g,H=V?Yg(c,B):Fh(c,B);if(H!==al){if(H===Ou){var _=tc(c);_!==Bt&&(B=_,H=Fy(c,_))}if(H===Bh){var O=Vg;throw Fg(c,Bt),Ra(c,B),Ta(c,sa()),O}if(H===vc)Ra(c,B);else{var oe=!xf(c,B),Ie=c.current.alternate;if(oe&&!XW(Ie)){if(H=Fh(c,B),H===Ou){var xe=tc(c);xe!==Bt&&(B=xe,H=Fy(c,xe))}if(H===Bh){var Je=Vg;throw Fg(c,Bt),Ra(c,B),Ta(c,sa()),Je}}c.finishedWork=Ie,c.finishedLanes=B,HW(c,H,B)}}return Ta(c,sa()),c.callbackNode===f?Up.bind(null,c):null}function Fy(c,g){var f=ju;if(Js(c)){var v=Fg(c,g);v.flags|=bn,Ql(c.containerInfo)}var B=Fh(c,g);if(B!==Ou){var V=Er;Er=f,V!==null&&Yy(V)}return B}function Yy(c){Er===null?Er=c:Er.push.apply(Er,c)}function HW(c,g,f){switch(g){case al:case Bh:throw new Error("Root did not complete. This is a bug in React.");case Ou:{Tg(c,Er);break}case Dp:{if(Ra(c,f),ig(f)&&!Kg()){var v=Sh+My-sa();if(v>10){var B=tg(c,Bt);if(B!==Bt)break;var V=c.suspendedLanes;if(!nc(V,f)){Kr(),Jb(c,V);break}c.timeoutHandle=ru(Tg.bind(null,c,Er),v);break}}Tg(c,Er);break}case to:{if(Ra(c,f),wf(f))break;if(!Kg()){var H=Db(c,f),_=H,O=sa()-_,oe=Eg(O)-O;if(oe>10){c.timeoutHandle=ru(Tg.bind(null,c,Er),oe);break}}Tg(c,Er);break}case xZ:{Tg(c,Er);break}default:throw new Error("Unknown root exit status.")}}function XW(c){for(var g=c;;){if(g.flags&ce){var f=g.updateQueue;if(f!==null){var v=f.stores;if(v!==null)for(var B=0;B<v.length;B++){var V=v[B],H=V.getSnapshot,_=V.value;try{if(!gs(H(),_))return!1}catch{return!1}}}}var O=g.child;if(g.subtreeFlags&ce&&O!==null){O.return=g,g=O;continue}if(g===c)return!0;for(;g.sibling===null;){if(g.return===null||g.return===c)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}return!0}function Ra(c,g){g=_I(g,Yd),g=_I(g,Qu),rB(c,g)}function VZ(c){if(bp(),(Xn&(pr|Li))!==Za)throw new Error("Should not already be working.");no();var g=tg(c,Bt);if(!va(g,zn))return Ta(c,sa()),null;var f=Fh(c,g);if(c.tag!==KI&&f===Ou){var v=tc(c);v!==Bt&&(g=v,f=Fy(c,v))}if(f===Bh){var B=Vg;throw Fg(c,Bt),Ra(c,g),Ta(c,sa()),B}if(f===vc)throw new Error("Root did not complete. This is a bug in React.");var V=c.current.alternate;return c.finishedWork=V,c.finishedLanes=g,Tg(c,Er),Ta(c,sa()),null}function Jp(c,g){g!==Bt&&(Ob(c,En(g,zn)),Ta(c,sa()),(Xn&(pr|Li))===Za&&(yc(),Vr()))}function MZ(c){var g=Ds(),f=Pi.transition;try{return Pi.transition=null,rr(kI),c()}finally{rr(g),Pi.transition=f}}function NZ(c,g){var f=Xn;Xn|=Wg;try{return c(g)}finally{Xn=f,Xn===Za&&!il.isBatchingLegacy&&(yc(),Gl())}}function Op(c,g,f,v,B){var V=Ds(),H=Pi.transition;try{return Pi.transition=null,rr(_s),c(g,f,v,B)}finally{rr(V),Pi.transition=H,Xn===Za&&yc()}}function Td(c){Gc!==null&&Gc.tag===KI&&(Xn&(pr|Li))===Za&&no();var g=Xn;Xn|=Wg;var f=Pi.transition,v=Ds();try{return Pi.transition=null,rr(_s),c?c():void 0}finally{rr(v),Pi.transition=f,Xn=g,(Xn&(pr|Li))===Za&&Vr()}}function Pp(){return(Xn&(pr|Li))!==Za}function Ty(c){var g=Xn;Xn|=Wg;var f=Pi.transition,v=Ds();try{Pi.transition=null,rr(_s),c()}finally{rr(v),Pi.transition=f,Xn=g,Xn===Za&&(yc(),Vr())}}function $u(c,g){hr(Pu,wo,c),wo=En(wo,g)}function Hh(c){wo=Pu.current,xr(Pu,c)}function Fg(c,g){c.finishedWork=null,c.finishedLanes=Bt;var f=c.timeoutHandle;if(f!==NI&&(c.timeoutHandle=NI,Jc(f)),zi!==null)for(var v=zi.return;v!==null;){var B=v.alternate;fy(B,v),v=v.return}Ya=c;var V=_g(c.current,null);return zi=V,ca=wo=g,qi=al,Vg=null,Zh=Bt,Qu=Bt,Yd=Bt,ju=null,Er=null,Hx(),ko.discardPendingWarnings(),V}function Ml(c,g){do{var f=zi;try{if(Ff(),Fv(),lr(),_p.current=null,f===null||f.return===null){qi=Bh,Vg=g,zi=null;return}if(K&&f.mode&Ai&&Ku(f,!0),N)if(fu(),g!==null&&typeof g=="object"&&typeof g.then=="function"){var v=g;IB(f,v,ca)}else Rx(f,g,ca);nW(c,f.return,f,g,ca),Kh(f)}catch(B){g=B,zi===f&&f!==null?(f=f.return,zi=f):f=zi;continue}return}while(!0)}function Zc(){var c=Vy.current;return Vy.current=Cp,c===null?Cp:c}function Xh(c){Vy.current=c}function Ey(){Sh=sa()}function Qp(c){Zh=En(c,Zh)}function jp(){qi===al&&(qi=Dp)}function Ky(){(qi===al||qi===Dp||qi===Ou)&&(qi=to),Ya!==null&&(Ls(Zh)||Ls(Qu))&&Ra(Ya,ca)}function HZ(c){qi!==to&&(qi=Ou),ju===null?ju=[c]:ju.push(c)}function qp(){return qi===al}function Fh(c,g){var f=Xn;Xn|=pr;var v=Zc();if(Ya!==c||ca!==g){if(ks){var B=c.memoizedUpdaters;B.size>0&&(Jt(c,ca),B.clear()),Qb(c,g)}Fg(c,g)}ei(g);do try{Yh();break}catch(V){Ml(c,V)}while(!0);if(Ff(),Xn=f,Xh(v),zi!==null)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return la(),Ya=null,ca=Bt,qi}function Yh(){for(;zi!==null;)Eh(zi)}function Yg(c,g){var f=Xn;Xn|=pr;var v=Zc();if(Ya!==c||ca!==g){if(ks){var B=c.memoizedUpdaters;B.size>0&&(Jt(c,ca),B.clear()),Qb(c,g)}yc(),Fg(c,g)}ei(g);do try{Th();break}catch(V){Ml(c,V)}while(!0);return Ff(),Xh(v),Xn=f,zi!==null?(xi(),al):(la(),Ya=null,ca=Bt,qi)}function Th(){for(;zi!==null&&!dx();)Eh(zi)}function Eh(c){var g=c.alternate;Xa(c);var f;(c.mode&Ai)!==Nn?(Cc(c),f=wa(g,c,wo),Ku(c,!0)):f=wa(g,c,wo),lr(),c.memoizedProps=c.pendingProps,f===null?Kh(c):zi=f,_p.current=null}function Kh(c){var g=c;do{var f=g.alternate,v=g.return;if((g.flags&ne)===Q){Xa(g);var B=void 0;if((g.mode&Ai)===Nn?B=kB(f,g,wo):(Cc(g),B=kB(f,g,wo),Ku(g,!1)),lr(),B!==null){zi=B;return}}else{var V=vW(f,g);if(V!==null){V.flags&=Kt,zi=V;return}if((g.mode&Ai)!==Nn){Ku(g,!1);for(var H=g.actualDuration,_=g.child;_!==null;)H+=_.actualDuration,_=_.sibling;g.actualDuration=H}if(v!==null)v.flags|=ne,v.subtreeFlags=Q,v.deletions=null;else{qi=vc,zi=null;return}}var O=g.sibling;if(O!==null){zi=O;return}g=v,zi=g}while(g!==null);qi===al&&(qi=xZ)}function Tg(c,g){var f=Ds(),v=Pi.transition;try{Pi.transition=null,rr(_s),Ly(c,g,f)}finally{Pi.transition=v,rr(f)}return null}function Ly(c,g,f){do no();while(Gc!==null);if(TW(),(Xn&(pr|Li))!==Za)throw new Error("Should not already be working.");var v=c.finishedWork,B=c.finishedLanes;if(vx(B),v===null)return cB(),null;if(B===Bt&&C("root.finishedLanes should not be empty during a commit. This is a bug in React."),c.finishedWork=null,c.finishedLanes=Bt,v===c.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");c.callbackNode=null,c.callbackPriority=Na;var V=En(v.lanes,v.childLanes);ux(c,V),c===Ya&&(Ya=null,zi=null,ca=Bt),((v.subtreeFlags&mt)!==Q||(v.flags&mt)!==Q)&&(Mg||(Mg=!0,Ld(Qr,function(){return no(),null})));var H=(v.subtreeFlags&(Ze|Se|Ae|mt))!==Q,_=(v.flags&(Ze|Se|Ae|mt))!==Q;if(H||_){var O=Pi.transition;Pi.transition=null;var oe=Ds();rr(_s);var Ie=Xn;Xn|=Li,_p.current=null,CZ(c,v),qv(),pZ(c,v,B),nr(c.containerInfo),c.current=v,wx(B),Rg(v,c,B),xx(),Cx(),Xn=Ie,rr(oe),Pi.transition=O}else c.current=v,qv();var xe=Mg;if(Mg&&(Mg=!1,Gc=c,Wh=B),V=c.pendingLanes,V===Bt&&(rl=null),xe||Lh(c.current,!1),lB(v.stateNode,f),ks&&c.memoizedUpdaters.clear(),wy(),Ta(c,sa()),g!==null)for(var Je=c.onRecoverableError,it=0;it<g.length;it++){var vt=g[it];Je(vt)}if(xh){xh=!1;var xt=kp;throw kp=null,xt}return va(Wh,zn)&&c.tag!==KI&&no(),V=c.pendingLanes,va(V,zn)?(Zo(),c===Hg?Ng++:(Ng=0,Hg=c)):Ng=0,Vr(),cB(),null}function no(){if(Gc!==null){var c=rg(Wh),g=Vf(kI,c),f=Pi.transition,v=Ds();try{return Pi.transition=null,rr(g),XZ()}finally{rr(v),Pi.transition=f}}return!1}function zy(c){Vh.push(c),Mg||(Mg=!0,Ld(Qr,function(){return no(),null}))}function XZ(){if(Gc===null)return!1;var c=Gc,g=Wh;if(Gc=null,Wh=Bt,(Xn&(pr|Li))!==Za)throw new Error("Cannot flush passive effects while already rendering.");$b(g);var f=Xn;Xn|=Li,Yp(c.current),yZ(c,c.current);{var v=Vh;Vh=[];for(var B=0;B<v.length;B++){var V=v[B];by(c,V)}}vn(),Lh(c.current,!0),Xn=f,Vr(),qu=Gc===null?0:qu+1,WC(c);{var H=c.current.stateNode;H.effectDuration=0,H.passiveEffectDuration=0}return!0}function $p(c){return rl!==null&&rl.has(c)}function FW(c){rl===null?rl=new Set([c]):rl.add(c)}function FZ(c){xh||(xh=!0,kp=c)}var YZ=FZ;function Ed(c,g,f){var v=rh(f,g),B=oh(c,v,zn);dg(c,B);var V=Kr(),H=Bc(c,zn);H!==null&&(zs(H,zn,V),Ta(H,V))}function _i(c,g,f){if(c.tag===F){Ed(c,c,f);return}var v=null;for(v=g;v!==null;){if(v.tag===F){Ed(v,c,f);return}else if(v.tag===k){var B=v.type,V=v.stateNode;if(typeof B.getDerivedStateFromError=="function"||typeof V.componentDidCatch=="function"&&!$p(V)){var H=rh(f,c),_=Gd(v,H,zn);dg(v,_);var O=Kr(),oe=Bc(v,zn);oe!==null&&(zs(oe,zn,O),Ta(oe,O));return}}v=v.return}C(`Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.

Error message:

%s`,f)}function _y(c,g,f){var v=c.pingCache;v!==null&&v.delete(g);var B=Kr();Jb(c,f),Qa(c),Ya===c&&nc(ca,f)&&(qi===to||qi===Dp&&ig(ca)&&sa()-Sh<My?Fg(c,Bt):Yd=En(Yd,f)),Ta(c,B)}function eI(c,g){g===Na&&(g=Xy(c));var f=Kr(),v=Bc(c,g);v!==null&&(zs(v,g,f),Ta(v,f))}function Dy(c){var g=c.memoizedState,f=Na;g!==null&&(f=g.retryLane),eI(c,f)}function YW(c,g){var f=Na,v;switch(c.tag){case We:v=c.stateNode;var B=c.memoizedState;B!==null&&(f=B.retryLane);break;case bt:v=c.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}v!==null&&v.delete(g),eI(c,f)}function Eg(c){return c<120?120:c<480?480:c<1080?1080:c<1920?1920:c<3e3?3e3:c<4320?4320:MW(c/1960)*1960}function Kd(){if(Ng>Ny)throw Ng=0,Hg=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");qu>Hy&&(qu=0,C("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}function TW(){ko.flushLegacyContextWarning(),ko.flushPendingUnsafeLifecycleWarnings()}function Lh(c,g){Xa(c),mr(c,D,BZ),g&&mr(c,he,By),mr(c,D,xW),g&&mr(c,he,ku),lr()}function mr(c,g,f){for(var v=c,B=null;v!==null;){var V=v.subtreeFlags&g;v!==B&&v.child!==null&&V!==Q?v=v.child:((v.flags&g)!==Q&&f(v),v.sibling!==null?v=v.sibling:v=B=v.return)}}var ha=null;function ol(c){{if((Xn&pr)!==Za||!(c.mode&Hi))return;var g=c.tag;if(g!==E&&g!==F&&g!==k&&g!==L&&g!==de&&g!==ke&&g!==$e)return;var f=De(c)||"ReactComponent";if(ha!==null){if(ha.has(f))return;ha.add(f)}else ha=new Set([f]);var v=vo;try{Xa(c),C("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{v?Xa(c):lr()}}}var wa;{var br=null;wa=function(c,g,f){var v=Jh(br,g);try{return sZ(c,g,f)}catch(V){if(V!==null&&typeof V=="object"&&typeof V.then=="function")throw V;if(Ff(),Fv(),fy(c,g),Jh(g,v),g.mode&Ai&&Cc(g),gZ(null,sZ,null,c,g,f),BW()){var B=uZ();typeof B=="object"&&B!==null&&B._suppressLogging&&typeof V=="object"&&V!==null&&!V._suppressLogging&&(V._suppressLogging=!0)}throw V}}}var em=!1,zh;zh=new Set;function EW(c){if(pu&&!HB())switch(c.tag){case L:case de:case $e:{var g=zi&&De(zi)||"Unknown",f=g;if(!zh.has(f)){zh.add(f);var v=De(c)||"Unknown";C("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",v,g,g)}break}case k:{em||(C("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),em=!0);break}}}function Jt(c,g){if(ks){var f=c.memoizedUpdaters;f.forEach(function(v){Pb(c,v,g)})}}var tI={};function Ld(c,g){{var f=il.current;return f!==null?(f.push(g),tI):sB(c,g)}}function nI(c){if(c!==tI)return jb(c)}function Kg(){return il.current!==null}function Wi(c){{if(c.mode&Hi){if(!wZ())return}else if(!VW()||Xn!==Za||c.tag!==L&&c.tag!==de&&c.tag!==$e)return;if(il.current===null){var g=vo;try{Xa(c),C(`An update to %s inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`,De(c))}finally{g?Xa(c):lr()}}}}function Qa(c){c.tag!==KI&&wZ()&&il.current===null&&C(`A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`)}var Vi=null,Sc=null,_h=function(c){Vi=c};function Nl(c){{if(Vi===null)return c;var g=Vi(c);return g===void 0?c:g.current}}function ky(c){return Nl(c)}function Uy(c){{if(Vi===null)return c;var g=Vi(c);if(g===void 0){if(c!=null&&typeof c.render=="function"){var f=Nl(c.render);if(c.render!==f){var v={$$typeof:Tt,render:f};return c.displayName!==void 0&&(v.displayName=c.displayName),v}}return c}return g.current}}function gt(c,g){{if(Vi===null)return!1;var f=c.elementType,v=g.type,B=!1,V=typeof v=="object"&&v!==null?v.$$typeof:null;switch(c.tag){case k:{typeof v=="function"&&(B=!0);break}case L:{(typeof v=="function"||V===fe)&&(B=!0);break}case de:{(V===Tt||V===fe)&&(B=!0);break}case ke:case $e:{(V===J||V===fe)&&(B=!0);break}default:return!1}if(B){var H=Vi(f);if(H!==void 0&&H===Vi(v))return!0}return!1}}function Qo(c){{if(Vi===null||typeof WeakSet!="function")return;Sc===null&&(Sc=new WeakSet),Sc.add(c)}}var Lg=function(c,g){{if(Vi===null)return;var f=g.staleFamilies,v=g.updatedFamilies;no(),Td(function(){Ci(c.current,v,f)})}},Jy=function(c,g){{if(c.context!==Jr)return;no(),Td(function(){lm(g,c,null,null)})}};function Ci(c,g,f){{var v=c.alternate,B=c.child,V=c.sibling,H=c.tag,_=c.type,O=null;switch(H){case L:case $e:case k:O=_;break;case de:O=_.render;break}if(Vi===null)throw new Error("Expected resolveFamily to be set during hot reload.");var oe=!1,Ie=!1;if(O!==null){var xe=Vi(O);xe!==void 0&&(f.has(xe)?Ie=!0:g.has(xe)&&(H===k?Ie=!0:oe=!0))}Sc!==null&&(Sc.has(c)||v!==null&&Sc.has(v))&&(Ie=!0),Ie&&(c._debugNeedsRemount=!0),(Ie||oe)&&Pa(c,zn,Zi),B!==null&&!Ie&&Ci(B,g,f),V!==null&&Ci(V,g,f)}}var _t=function(c,g){{var f=new Set,v=new Set(g.map(function(B){return B.current}));return zg(c.current,v,f),f}};function zg(c,g,f){{var v=c.child,B=c.sibling,V=c.tag,H=c.type,_=null;switch(V){case L:case $e:case k:_=H;break;case de:_=H.render;break}var O=!1;_!==null&&g.has(_)&&(O=!0),O?KW(c,f):v!==null&&zg(v,g,f),B!==null&&zg(B,g,f)}}function KW(c,g){{var f=Lr(c,g);if(f)return;for(var v=c;;){switch(v.tag){case le:g.add(v.stateNode);return;case U:g.add(v.stateNode.containerInfo);return;case F:g.add(v.stateNode.containerInfo);return}if(v.return===null)throw new Error("Expected to reach root first.");v=v.return}}}function Lr(c,g){for(var f=c,v=!1;;){if(f.tag===le)v=!0,g.add(f.stateNode);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===c)return v;for(;f.sibling===null;){if(f.return===null||f.return===c)return v;f=f.return}f.sibling.return=f.return,f=f.sibling}return!1}var Dh;{Dh=!1;try{var iI=Object.preventExtensions({})}catch{Dh=!0}}function zd(c,g,f,v){this.tag=c,this.key=f,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=g,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=v,this.flags=Q,this.subtreeFlags=Q,this.deletions=null,this.lanes=Bt,this.childLanes=Bt,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,!Dh&&typeof Object.preventExtensions=="function"&&Object.preventExtensions(this)}var xo=function(c,g,f,v){return new zd(c,g,f,v)};function tm(c){var g=c.prototype;return!!(g&&g.isReactComponent)}function Hl(c){return typeof c=="function"&&!tm(c)&&c.defaultProps===void 0}function ys(c){if(typeof c=="function")return tm(c)?k:L;if(c!=null){var g=c.$$typeof;if(g===Tt)return de;if(g===J)return ke}return E}function _g(c,g){var f=c.alternate;f===null?(f=xo(c.tag,g,c.key,c.mode),f.elementType=c.elementType,f.type=c.type,f.stateNode=c.stateNode,f._debugSource=c._debugSource,f._debugOwner=c._debugOwner,f._debugHookTypes=c._debugHookTypes,f.alternate=c,c.alternate=f):(f.pendingProps=g,f.type=c.type,f.flags=Q,f.subtreeFlags=Q,f.deletions=null,f.actualDuration=0,f.actualStartTime=-1),f.flags=c.flags&Wt,f.childLanes=c.childLanes,f.lanes=c.lanes,f.child=c.child,f.memoizedProps=c.memoizedProps,f.memoizedState=c.memoizedState,f.updateQueue=c.updateQueue;var v=c.dependencies;switch(f.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},f.sibling=c.sibling,f.index=c.index,f.ref=c.ref,f.selfBaseDuration=c.selfBaseDuration,f.treeBaseDuration=c.treeBaseDuration,f._debugNeedsRemount=c._debugNeedsRemount,f.tag){case E:case L:case $e:f.type=Nl(c.type);break;case k:f.type=ky(c.type);break;case de:f.type=Uy(c.type);break}return f}function Oy(c,g){c.flags&=Wt|be;var f=c.alternate;if(f===null)c.childLanes=Bt,c.lanes=g,c.child=null,c.subtreeFlags=Q,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null,c.selfBaseDuration=0,c.treeBaseDuration=0;else{c.childLanes=f.childLanes,c.lanes=f.lanes,c.child=f.child,c.subtreeFlags=Q,c.deletions=null,c.memoizedProps=f.memoizedProps,c.memoizedState=f.memoizedState,c.updateQueue=f.updateQueue,c.type=f.type;var v=f.dependencies;c.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},c.selfBaseDuration=f.selfBaseDuration,c.treeBaseDuration=f.treeBaseDuration}return c}function Py(c,g,f){var v;return c===nB?(v=Hi,g===!0&&(v|=Ia,v|=bo)):v=Nn,ks&&(v|=Ai),xo(F,null,null,v)}function kh(c,g,f,v,B,V){var H=E,_=c;if(typeof c=="function")tm(c)?(H=k,_=ky(_)):_=Nl(_);else if(typeof c=="string")H=le;else e:switch(c){case te:return aI(f.children,B,V,g);case Gt:H=Ge,B|=Ia,(B&Hi)!==Nn&&(B|=bo);break;case Qe:return e2(f,B,V,g);case Rt:return Qy(f,B,V,g);case $:return nm(f,B,V,g);case _e:return jy(f,B,V,g);case At:case ze:case Zt:case Xt:case et:default:{if(typeof c=="object"&&c!==null)switch(c.$$typeof){case ht:H=pe;break e;case Ct:H=ye;break e;case Tt:H=de,_=Uy(_);break e;case J:H=ke;break e;case fe:H=ot,_=null;break e}var O="";{(c===void 0||typeof c=="object"&&c!==null&&Object.keys(c).length===0)&&(O+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var oe=v?De(v):null;oe&&(O+=`

Check the render method of \``+oe+"`.")}throw new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) "+("but got: "+(c==null?c:typeof c)+"."+O))}}var Ie=xo(H,f,g,B);return Ie.elementType=c,Ie.type=_,Ie.lanes=V,Ie._debugOwner=v,Ie}function Uh(c,g,f){var v=null;v=c._owner;var B=c.type,V=c.key,H=c.props,_=kh(B,V,H,v,g,f);return _._debugSource=c._source,_._debugOwner=c._owner,_}function aI(c,g,f,v){var B=xo(Ce,c,v,g);return B.lanes=f,B}function e2(c,g,f,v){typeof c.id!="string"&&C('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof c.id);var B=xo(Oe,c,v,g|Ai);return B.elementType=Qe,B.lanes=f,B.stateNode={effectDuration:0,passiveEffectDuration:0},B}function Qy(c,g,f,v){var B=xo(We,c,v,g);return B.elementType=Rt,B.lanes=f,B}function nm(c,g,f,v){var B=xo(bt,c,v,g);return B.elementType=$,B.lanes=f,B}function jy(c,g,f,v){var B=xo(yt,c,v,g);B.elementType=_e,B.lanes=f;var V={};return B.stateNode=V,B}function im(c,g,f){var v=xo(ie,c,null,g);return v.lanes=f,v}function TZ(){var c=xo(le,null,null,Nn);return c.elementType="DELETED",c}function EZ(c){var g=xo(tt,null,null,Nn);return g.stateNode=c,g}function am(c,g,f){var v=c.children!==null?c.children:[],B=xo(U,v,c.key,g);return B.lanes=f,B.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},B}function Jh(c,g){return c===null&&(c=xo(E,null,null,Nn)),c.tag=g.tag,c.key=g.key,c.elementType=g.elementType,c.type=g.type,c.stateNode=g.stateNode,c.return=g.return,c.child=g.child,c.sibling=g.sibling,c.index=g.index,c.ref=g.ref,c.pendingProps=g.pendingProps,c.memoizedProps=g.memoizedProps,c.updateQueue=g.updateQueue,c.memoizedState=g.memoizedState,c.dependencies=g.dependencies,c.mode=g.mode,c.flags=g.flags,c.subtreeFlags=g.subtreeFlags,c.deletions=g.deletions,c.lanes=g.lanes,c.childLanes=g.childLanes,c.alternate=g.alternate,c.actualDuration=g.actualDuration,c.actualStartTime=g.actualStartTime,c.selfBaseDuration=g.selfBaseDuration,c.treeBaseDuration=g.treeBaseDuration,c._debugSource=g._debugSource,c._debugOwner=g._debugOwner,c._debugNeedsRemount=g._debugNeedsRemount,c._debugHookTypes=g._debugHookTypes,c}function qy(c,g,f,v,B){this.tag=g,this.containerInfo=c,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=NI,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=Na,this.eventTimes=Ub(Bt),this.expirationTimes=Ub(Zi),this.pendingLanes=Bt,this.suspendedLanes=Bt,this.pingedLanes=Bt,this.expiredLanes=Bt,this.mutableReadLanes=Bt,this.finishedLanes=Bt,this.entangledLanes=Bt,this.entanglements=Ub(Bt),this.identifierPrefix=v,this.onRecoverableError=B,dr&&(this.mutableSourceEagerHydrationData=null),this.effectDuration=0,this.passiveEffectDuration=0;{this.memoizedUpdaters=new Set;for(var V=this.pendingUpdatersLaneMap=[],H=0;H<Fb;H++)V.push(new Set)}switch(g){case nB:this._debugRootType=f?"hydrateRoot()":"createRoot()";break;case KI:this._debugRootType=f?"hydrate()":"render()";break}}function rm(c,g,f,v,B,V,H,_,O,oe){var Ie=new qy(c,g,f,_,O),xe=Py(g,V);Ie.current=xe,xe.stateNode=Ie;{var Je={element:v,isDehydrated:f,cache:null,transitions:null};xe.memoizedState=Je}return ed(xe),Ie}var Oh="18.0.0-fc46dba67-20220329";function $y(c,g,f){var v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return Uo(v),{$$typeof:Pe,key:v==null?null:""+v,children:c,containerInfo:g,implementation:f}}var _d,rI;_d=!1,rI={};function Ph(c){if(!c)return Jr;var g=m(c),f=sx(g);if(g.tag===k){var v=g.type;if(ml(v))return Hb(g,v,f)}return f}function om(c){var g=m(c);if(g===void 0){if(typeof c.render=="function")throw new Error("Unable to find node on an unmounted component.");var f=Object.keys(c).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+f)}var v=Ii(g);return v===null?null:v.stateNode}function Qh(c,g){{var f=m(c);if(f===void 0){if(typeof c.render=="function")throw new Error("Unable to find node on an unmounted component.");var v=Object.keys(c).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+v)}var B=Ii(f);if(B===null)return null;if(B.mode&Ia){var V=De(f)||"Component";if(!rI[V]){rI[V]=!0;var H=vo;try{Xa(B),f.mode&Ia?C("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",g,g,V):C("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",g,g,V)}finally{H?Xa(H):lr()}}}return B.stateNode}}function e0(c,g,f,v,B,V,H,_){var O=!1,oe=null;return rm(c,g,O,oe,f,v,B,V,H)}function sm(c,g,f,v,B,V,H,_,O,oe){var Ie=!0,xe=rm(f,v,Ie,c,B,V,H,_,O);xe.context=Ph(null);var Je=xe.current,it=Kr(),vt=Vl(Je),xt=Ig(it,vt);return xt.callback=g??null,dg(Je,xt),NW(xe,vt,it),xe}function lm(c,g,f,v){px(g,c);var B=g.current,V=Kr(),H=Vl(B);yl(H);var _=Ph(f);g.context===null?g.context=_:g.pendingContext=_,pu&&vo!==null&&!_d&&(_d=!0,C(`Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.

Check the render method of %s.`,De(vo)||"Unknown"));var O=Ig(V,H);O.payload={element:c},v=v===void 0?null:v,v!==null&&(typeof v!="function"&&C("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",v),O.callback=v),dg(B,O);var oe=Pa(B,H,V);return oe!==null&&td(oe,B,H),H}function cm(c){var g=c.current;if(!g.child)return null;switch(g.child.tag){case le:return ni(g.child.stateNode);default:return g.child.stateNode}}function KZ(c){switch(c.tag){case F:var g=c.stateNode;if(Js(g)){var f=ng(g);Jp(g,f)}break;case We:var v=Kr();Td(function(){return Pa(c,zn,v)});var B=zn;Dd(c,B);break}}function gm(c,g){var f=c.memoizedState;f!==null&&f.dehydrated!==null&&(f.retryLane=ic(f.retryLane,g))}function Dd(c,g){gm(c,g);var f=c.alternate;f&&gm(f,g)}function LW(c){if(c.tag===We){var g=Kr(),f=ZC;Pa(c,f,g),Dd(c,f)}}function um(c){if(c.tag===We){var g=Kr(),f=Vl(c);Pa(c,f,g),Dd(c,f)}}function t0(c){var g=Va(c);return g===null?null:g.stateNode}var jh=function(c){return null};function Im(c){return jh(c)}var qh=function(c){return!1};function dm(c){return qh(c)}var n0=null,i0=null,a0=null,LZ=null,Cm=null,r0=null,o0=null,s0=null,zZ=null;{var hm=function(c,g,f){var v=g[f],B=Fi(c)?c.slice():p({},c);return f+1===g.length?(Fi(B)?B.splice(v,1):delete B[v],B):(B[v]=hm(c[v],g,f+1),B)},$h=function(c,g){return hm(c,g,0)},_Z=function(c,g,f,v){var B=g[v],V=Fi(c)?c.slice():p({},c);if(v+1===g.length){var H=f[v];V[H]=V[B],Fi(V)?V.splice(B,1):delete V[B]}else V[B]=_Z(c[B],g,f,v+1);return V},DZ=function(c,g,f){if(g.length!==f.length){d("copyWithRename() expects paths of the same length");return}else for(var v=0;v<f.length-1;v++)if(g[v]!==f[v]){d("copyWithRename() expects paths to be the same except for the deepest key");return}return _Z(c,g,f,0)},l0=function(c,g,f,v){if(f>=g.length)return v;var B=g[f],V=Fi(c)?c.slice():p({},c);return V[B]=l0(c[B],g,f+1,v),V},c0=function(c,g,f){return l0(c,g,0,f)},Am=function(c,g){for(var f=c.memoizedState;f!==null&&g>0;)f=f.next,g--;return f};n0=function(c,g,f,v){var B=Am(c,g);if(B!==null){var V=c0(B.memoizedState,f,v);B.memoizedState=V,B.baseState=V,c.memoizedProps=p({},c.memoizedProps),Pa(c,zn,Zi)}},i0=function(c,g,f){var v=Am(c,g);if(v!==null){var B=$h(v.memoizedState,f);v.memoizedState=B,v.baseState=B,c.memoizedProps=p({},c.memoizedProps),Pa(c,zn,Zi)}},a0=function(c,g,f,v){var B=Am(c,g);if(B!==null){var V=DZ(B.memoizedState,f,v);B.memoizedState=V,B.baseState=V,c.memoizedProps=p({},c.memoizedProps),Pa(c,zn,Zi)}},LZ=function(c,g,f){c.pendingProps=c0(c.memoizedProps,g,f),c.alternate&&(c.alternate.pendingProps=c.pendingProps),Pa(c,zn,Zi)},Cm=function(c,g){c.pendingProps=$h(c.memoizedProps,g),c.alternate&&(c.alternate.pendingProps=c.pendingProps),Pa(c,zn,Zi)},r0=function(c,g,f){c.pendingProps=DZ(c.memoizedProps,g,f),c.alternate&&(c.alternate.pendingProps=c.pendingProps),Pa(c,zn,Zi)},o0=function(c){Pa(c,zn,Zi)},s0=function(c){jh=c},zZ=function(c){qh=c}}function kZ(c){var g=Ii(c);return g===null?null:g.stateNode}function fm(c){return null}function UZ(){return vo}function JZ(c){var g=c.findFiberByHostInstance,f=o.ReactCurrentDispatcher;return fx({bundleType:c.bundleType,version:c.version,rendererPackageName:c.rendererPackageName,rendererConfig:c.rendererConfig,overrideHookState:n0,overrideHookStateDeletePath:i0,overrideHookStateRenamePath:a0,overrideProps:LZ,overridePropsDeletePath:Cm,overridePropsRenamePath:r0,setErrorHandler:s0,setSuspenseHandler:zZ,scheduleUpdate:o0,currentDispatcherRef:f,findHostInstanceByFiber:kZ,findFiberByHostInstance:g||fm,findHostInstancesForRefresh:_t,scheduleRefresh:Lg,scheduleRoot:Jy,setRefreshHandler:_h,getCurrentFiber:UZ,reconcilerVersion:Oh})}return t.attemptContinuousHydration=LW,t.attemptHydrationAtCurrentPriority=um,t.attemptSynchronousHydration=KZ,t.batchedUpdates=NZ,t.createComponentSelector=fr,t.createContainer=e0,t.createHasPseudoClassSelector=vs,t.createHydrationContainer=sm,t.createPortal=$y,t.createRoleSelector=nl,t.createTestNameSelector=xg,t.createTextSelector=Ju,t.deferredUpdates=MZ,t.discreteUpdates=Op,t.findAllNodes=yh,t.findBoundingRects=Ry,t.findHostInstance=om,t.findHostInstanceWithNoPortals=t0,t.findHostInstanceWithWarning=Qh,t.flushControlled=Ty,t.flushPassiveEffects=no,t.flushSync=Td,t.focusWithin=RZ,t.getCurrentUpdatePriority=Ds,t.getFindAllNodesFailureDescription=SZ,t.getPublicRootInstance=cm,t.injectIntoDevTools=JZ,t.isAlreadyRendering=Pp,t.observeVisibleRects=xy,t.registerMutableSourceForHydration=wB,t.runWithPriority=or,t.shouldError=Im,t.shouldSuspend=dm,t.updateContainer=lm,t};var Wj=s9.exports;o9.exports=Wj;var Vj=o9.exports;const Mj=KN(Vj);var l9={exports:{}},c9={};(function(s){/**
 * @license React
 * scheduler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=!1,t=!1,n=5;function a(j,ue){var Ve=j.length;j.push(ue),u(j,ue,Ve)}function o(j){return j.length===0?null:j[0]}function l(j){if(j.length===0)return null;var ue=j[0],Ve=j.pop();return Ve!==ue&&(j[0]=Ve,d(j,Ve,0)),ue}function u(j,ue,Ve){for(var qe=Ve;qe>0;){var Me=qe-1>>>1,se=j[Me];if(C(se,ue)>0)j[Me]=ue,j[qe]=se,qe=Me;else return}}function d(j,ue,Ve){for(var qe=Ve,Me=j.length,se=Me>>>1;qe<se;){var Re=(qe+1)*2-1,De=j[Re],Q=Re+1,st=j[Q];if(C(De,ue)<0)Q<Me&&C(st,De)<0?(j[qe]=st,j[Q]=ue,qe=Q):(j[qe]=De,j[Re]=ue,qe=Re);else if(Q<Me&&C(st,ue)<0)j[qe]=st,j[Q]=ue,qe=Q;else return}}function C(j,ue){var Ve=j.sortIndex-ue.sortIndex;return Ve!==0?Ve:j.id-ue.id}var A=1,p=2,m=3,y=4,G=5;function w(j,ue){}var R=typeof performance=="object"&&typeof performance.now=="function";if(R){var Z=performance;s.unstable_now=function(){return Z.now()}}else{var x=Date,W=x.now();s.unstable_now=function(){return x.now()-W}}var N=1073741823,K=-1,T=250,L=5e3,k=1e4,E=N,F=[],U=[],le=1,ie=null,Ce=m,Ge=!1,ye=!1,pe=!1,de=typeof setTimeout=="function"?setTimeout:null,Oe=typeof clearTimeout=="function"?clearTimeout:null,We=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ke(j){for(var ue=o(U);ue!==null;){if(ue.callback===null)l(U);else if(ue.startTime<=j)l(U),ue.sortIndex=ue.expirationTime,a(F,ue);else return;ue=o(U)}}function $e(j){if(pe=!1,ke(j),!ye)if(o(F)!==null)ye=!0,_e(ot);else{var ue=o(U);ue!==null&&At($e,ue.startTime-j)}}function ot(j,ue){ye=!1,pe&&(pe=!1,Zt()),Ge=!0;var Ve=Ce;try{var qe;if(!t)return Ne(j,ue)}finally{ie=null,Ce=Ve,Ge=!1}}function Ne(j,ue){var Ve=ue;for(ke(Ve),ie=o(F);ie!==null&&!e&&!(ie.expirationTime>Ve&&(!j||Tt()));){var qe=ie.callback;if(typeof qe=="function"){ie.callback=null,Ce=ie.priorityLevel;var Me=ie.expirationTime<=Ve,se=qe(Me);Ve=s.unstable_now(),typeof se=="function"?ie.callback=se:ie===o(F)&&l(F),ke(Ve)}else l(F);ie=o(F)}if(ie!==null)return!0;var Re=o(U);return Re!==null&&At($e,Re.startTime-Ve),!1}function tt(j,ue){switch(j){case A:case p:case m:case y:case G:break;default:j=m}var Ve=Ce;Ce=j;try{return ue()}finally{Ce=Ve}}function bt(j){var ue;switch(Ce){case A:case p:case m:ue=m;break;default:ue=Ce;break}var Ve=Ce;Ce=ue;try{return j()}finally{Ce=Ve}}function dt(j){var ue=Ce;return function(){var Ve=Ce;Ce=ue;try{return j.apply(this,arguments)}finally{Ce=Ve}}}function yt(j,ue,Ve){var qe=s.unstable_now(),Me;if(typeof Ve=="object"&&Ve!==null){var se=Ve.delay;typeof se=="number"&&se>0?Me=qe+se:Me=qe}else Me=qe;var Re;switch(j){case A:Re=K;break;case p:Re=T;break;case G:Re=E;break;case y:Re=k;break;case m:default:Re=L;break}var De=Me+Re,Q={id:le++,callback:ue,priorityLevel:j,startTime:Me,expirationTime:De,sortIndex:-1};return Me>qe?(Q.sortIndex=Me,a(U,Q),o(F)===null&&Q===o(U)&&(pe?Zt():pe=!0,At($e,Me-qe))):(Q.sortIndex=De,a(F,Q),!ye&&!Ge&&(ye=!0,_e(ot))),Q}function zt(){}function Nt(){!ye&&!Ge&&(ye=!0,_e(ot))}function Lt(){return o(F)}function Ue(j){j.callback=null}function Pe(){return Ce}var te=!1,Gt=null,Qe=-1,ht=n,Ct=-1;function Tt(){var j=s.unstable_now()-Ct;return!(j<ht)}function Rt(){}function $(j){if(j<0||j>125){console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported");return}j>0?ht=Math.floor(1e3/j):ht=n}var J=function(){if(Gt!==null){var j=s.unstable_now();Ct=j;var ue=!0,Ve=!0;try{Ve=Gt(ue,j)}finally{Ve?fe():(te=!1,Gt=null)}}else te=!1},fe;if(typeof We=="function")fe=function(){We(J)};else if(typeof MessageChannel<"u"){var ze=new MessageChannel,et=ze.port2;ze.port1.onmessage=J,fe=function(){et.postMessage(null)}}else fe=function(){de(J,0)};function _e(j){Gt=j,te||(te=!0,fe())}function At(j,ue){Qe=de(function(){j(s.unstable_now())},ue)}function Zt(){Oe(Qe),Qe=-1}var Xt=Rt,An=null;s.unstable_IdlePriority=G,s.unstable_ImmediatePriority=A,s.unstable_LowPriority=y,s.unstable_NormalPriority=m,s.unstable_Profiling=An,s.unstable_UserBlockingPriority=p,s.unstable_cancelCallback=Ue,s.unstable_continueExecution=Nt,s.unstable_forceFrameRate=$,s.unstable_getCurrentPriorityLevel=Pe,s.unstable_getFirstCallbackNode=Lt,s.unstable_next=bt,s.unstable_pauseExecution=zt,s.unstable_requestPaint=Xt,s.unstable_runWithPriority=tt,s.unstable_scheduleCallback=yt,s.unstable_shouldYield=Tt,s.unstable_wrapCallback=dt,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(c9);l9.exports=c9;var DY=l9.exports;const _H={},Nj=s=>void Object.assign(_H,s);function Hj(s,e){function t(A,{args:p=[],attach:m,...y},G){let w=`${A[0].toUpperCase()}${A.slice(1)}`,R;if(A==="primitive"){if(y.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const Z=y.object;R=Pm(Z,{type:A,root:G,attach:m,primitive:!0})}else{const Z=_H[w];if(!Z)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(p))throw new Error("R3F: The args prop must be an array!");R=Pm(new Z(...p),{type:A,root:G,attach:m,memoizedProps:{args:p}})}return R.__r3f.attach===void 0&&(R.isBufferGeometry?R.__r3f.attach="geometry":R.isMaterial&&(R.__r3f.attach="material")),w!=="inject"&&JM(R,y),R}function n(A,p){let m=!1;if(p){var y,G;(y=p.__r3f)!=null&&y.attach?UM(A,p,p.__r3f.attach):p.isObject3D&&A.isObject3D&&(A.add(p),m=!0),m||(G=A.__r3f)==null||G.objects.push(p),p.__r3f||Pm(p,{}),p.__r3f.parent=A,MN(p),Qm(p)}}function a(A,p,m){let y=!1;if(p){var G,w;if((G=p.__r3f)!=null&&G.attach)UM(A,p,p.__r3f.attach);else if(p.isObject3D&&A.isObject3D){p.parent=A,p.dispatchEvent({type:"added"}),A.dispatchEvent({type:"childadded",child:p});const R=A.children.filter(x=>x!==p),Z=R.indexOf(m);A.children=[...R.slice(0,Z),p,...R.slice(Z)],y=!0}y||(w=A.__r3f)==null||w.objects.push(p),p.__r3f||Pm(p,{}),p.__r3f.parent=A,MN(p),Qm(p)}}function o(A,p,m=!1){A&&[...A].forEach(y=>l(p,y,m))}function l(A,p,m){if(p){var y,G,w;if(p.__r3f&&(p.__r3f.parent=null),(y=A.__r3f)!=null&&y.objects&&(A.__r3f.objects=A.__r3f.objects.filter(N=>N!==p)),(G=p.__r3f)!=null&&G.attach)PY(A,p,p.__r3f.attach);else if(p.isObject3D&&A.isObject3D){var R;A.remove(p),(R=p.__r3f)!=null&&R.root&&_j(yR(p),p)}const x=(w=p.__r3f)==null?void 0:w.primitive,W=!x&&(m===void 0?p.dispose!==null:m);if(!x){var Z;o((Z=p.__r3f)==null?void 0:Z.objects,p,W),o(p.children,p,W)}if(delete p.__r3f,W&&p.dispose&&p.type!=="Scene"){const N=()=>{try{p.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?DY.unstable_scheduleCallback(DY.unstable_IdlePriority,N):N()}Qm(A)}}function u(A,p,m,y){var G;const w=(G=A.__r3f)==null?void 0:G.parent;if(!w)return;const R=t(p,m,A.__r3f.root);if(A.children){for(const Z of A.children)Z.__r3f&&n(R,Z);A.children=A.children.filter(Z=>!Z.__r3f)}A.__r3f.objects.forEach(Z=>n(R,Z)),A.__r3f.objects=[],A.__r3f.autoRemovedBeforeAppend||l(w,A),R.parent&&(R.__r3f.autoRemovedBeforeAppend=!0),n(w,R),R.raycast&&R.__r3f.eventCount&&yR(R).getState().internal.interaction.push(R),[y,y.alternate].forEach(Z=>{Z!==null&&(Z.stateNode=R,Z.ref&&(typeof Z.ref=="function"?Z.ref(R):Z.ref.current=R))})}const d=()=>{};return{reconciler:Mj({createInstance:t,removeChild:l,appendChild:n,appendInitialChild:n,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(A,p)=>{if(!p)return;const m=A.getState().scene;m.__r3f&&(m.__r3f.root=A,n(m,p))},removeChildFromContainer:(A,p)=>{p&&l(A.getState().scene,p)},insertInContainerBefore:(A,p,m)=>{if(!p||!m)return;const y=A.getState().scene;y.__r3f&&a(y,p,m)},getRootHostContext:()=>null,getChildHostContext:A=>A,finalizeInitialChildren(A){var p;return!!((p=A==null?void 0:A.__r3f)!=null?p:{}).handlers},prepareUpdate(A,p,m,y){var G;if(((G=A==null?void 0:A.__r3f)!=null?G:{}).primitive&&y.object&&y.object!==A)return[!0];{const{args:R=[],children:Z,...x}=y,{args:W=[],children:N,...K}=m;if(!Array.isArray(R))throw new Error("R3F: the args prop must be an array!");if(R.some((L,k)=>L!==W[k]))return[!0];const T=A9(A,x,K,!0);return T.changes.length?[!1,T]:null}},commitUpdate(A,[p,m],y,G,w,R){p?u(A,y,w,R):JM(A,m)},commitMount(A,p,m,y){var G;const w=(G=A.__r3f)!=null?G:{};A.raycast&&w.handlers&&w.eventCount&&yR(A).getState().internal.interaction.push(A)},getPublicInstance:A=>A,prepareForCommit:()=>null,preparePortalMount:A=>Pm(A.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(A){var p;const{attach:m,parent:y}=(p=A.__r3f)!=null?p:{};m&&y&&PY(y,A,m),A.isObject3D&&(A.visible=!1),Qm(A)},unhideInstance(A,p){var m;const{attach:y,parent:G}=(m=A.__r3f)!=null?m:{};y&&G&&UM(G,A,y),(A.isObject3D&&p.visible==null||p.visible)&&(A.visible=!0),Qm(A)},createTextInstance:d,hideTextInstance:d,unhideTextInstance:d,getCurrentEventPriority:()=>e?e():eb.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&ia.fun(performance.now)?performance.now:ia.fun(Date.now)?Date.now:()=>0,scheduleTimeout:ia.fun(setTimeout)?setTimeout:void 0,cancelTimeout:ia.fun(clearTimeout)?clearTimeout:void 0}),applyProps:JM}}var kY,UY;const kM=s=>"colorSpace"in s||"outputColorSpace"in s,g9=()=>{var s;return(s=_H.ColorManagement)!=null?s:null},u9=s=>s&&s.isOrthographicCamera,Xj=s=>s&&s.hasOwnProperty("current"),XG=typeof window<"u"&&((kY=window.document)!=null&&kY.createElement||((UY=window.navigator)==null?void 0:UY.product)==="ReactNative")?Fe.useLayoutEffect:Fe.useEffect;function I9(s){const e=Fe.useRef(s);return XG(()=>void(e.current=s),[s]),e}function Fj({set:s}){return XG(()=>(s(new Promise(()=>null)),()=>s(!1)),[s]),null}class d9 extends Fe.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}d9.getDerivedStateFromError=()=>({error:!0});const C9="__default",JY=new Map,Yj=s=>s&&!!s.memoized&&!!s.changes;function h9(s){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(s)?Math.min(Math.max(s[0],t),s[1]):s}const k0=s=>{var e;return(e=s.__r3f)==null?void 0:e.root.getState()};function yR(s){let e=s.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const ia={obj:s=>s===Object(s)&&!ia.arr(s)&&typeof s!="function",fun:s=>typeof s=="function",str:s=>typeof s=="string",num:s=>typeof s=="number",boo:s=>typeof s=="boolean",und:s=>s===void 0,arr:s=>Array.isArray(s),equ(s,e,{arrays:t="shallow",objects:n="reference",strict:a=!0}={}){if(typeof s!=typeof e||!!s!=!!e)return!1;if(ia.str(s)||ia.num(s)||ia.boo(s))return s===e;const o=ia.obj(s);if(o&&n==="reference")return s===e;const l=ia.arr(s);if(l&&t==="reference")return s===e;if((l||o)&&s===e)return!0;let u;for(u in s)if(!(u in e))return!1;if(o&&t==="shallow"&&n==="shallow"){for(u in a?e:s)if(!ia.equ(s[u],e[u],{strict:a,objects:"reference"}))return!1}else for(u in a?e:s)if(s[u]!==e[u])return!1;if(ia.und(u)){if(l&&s.length===0&&e.length===0||o&&Object.keys(s).length===0&&Object.keys(e).length===0)return!0;if(s!==e)return!1}return!0}};function Tj(s){const e={nodes:{},materials:{}};return s&&s.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function Ej(s){s.dispose&&s.type!=="Scene"&&s.dispose();for(const e in s)e.dispose==null||e.dispose(),delete s[e]}function Pm(s,e){const t=s;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},s}function VN(s,e){let t=s;if(e.includes("-")){const n=e.split("-"),a=n.pop();return t=n.reduce((o,l)=>o[l],s),{target:t,key:a}}else return{target:t,key:e}}const OY=/-\d+$/;function UM(s,e,t){if(ia.str(t)){if(OY.test(t)){const o=t.replace(OY,""),{target:l,key:u}=VN(s,o);Array.isArray(l[u])||(l[u]=[])}const{target:n,key:a}=VN(s,t);e.__r3f.previousAttach=n[a],n[a]=e}else e.__r3f.previousAttach=t(s,e)}function PY(s,e,t){var n,a;if(ia.str(t)){const{target:o,key:l}=VN(s,t),u=e.__r3f.previousAttach;u===void 0?delete o[l]:o[l]=u}else(n=e.__r3f)==null||n.previousAttach==null||n.previousAttach(s,e);(a=e.__r3f)==null||delete a.previousAttach}function A9(s,{children:e,key:t,ref:n,...a},{children:o,key:l,ref:u,...d}={},C=!1){const A=s.__r3f,p=Object.entries(a),m=[];if(C){const G=Object.keys(d);for(let w=0;w<G.length;w++)a.hasOwnProperty(G[w])||p.unshift([G[w],C9+"remove"])}p.forEach(([G,w])=>{var R;if((R=s.__r3f)!=null&&R.primitive&&G==="object"||ia.equ(w,d[G]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(G))return m.push([G,w,!0,[]]);let Z=[];G.includes("-")&&(Z=G.split("-")),m.push([G,w,!1,Z]);for(const x in a){const W=a[x];x.startsWith(`${G}-`)&&m.push([x,W,!1,x.split("-")])}});const y={...a};return A!=null&&A.memoizedProps&&A!=null&&A.memoizedProps.args&&(y.args=A.memoizedProps.args),A!=null&&A.memoizedProps&&A!=null&&A.memoizedProps.attach&&(y.attach=A.memoizedProps.attach),{memoized:y,changes:m}}const Kj=typeof process<"u"&&!0;function JM(s,e){var t;const n=s.__r3f,a=n==null?void 0:n.root,o=a==null||a.getState==null?void 0:a.getState(),{memoized:l,changes:u}=Yj(e)?e:A9(s,e),d=n==null?void 0:n.eventCount;s.__r3f&&(s.__r3f.memoizedProps=l);for(let m=0;m<u.length;m++){let[y,G,w,R]=u[m];if(kM(s)){const N="srgb",K="srgb-linear";y==="encoding"?(y="colorSpace",G=G===3001?N:K):y==="outputEncoding"&&(y="outputColorSpace",G=G===3001?N:K)}let Z=s,x=Z[y];if(R.length&&(x=R.reduce((W,N)=>W[N],s),!(x&&x.set))){const[W,...N]=R.reverse();Z=N.reverse().reduce((K,T)=>K[T],s),y=W}if(G===C9+"remove")if(Z.constructor){let W=JY.get(Z.constructor);W||(W=new Z.constructor,JY.set(Z.constructor,W)),G=W[y]}else G=0;if(w&&n)G?n.handlers[y]=G:delete n.handlers[y],n.eventCount=Object.keys(n.handlers).length;else if(x&&x.set&&(x.copy||x instanceof EA)){if(Array.isArray(G))x.fromArray?x.fromArray(G):x.set(...G);else if(x.copy&&G&&G.constructor&&(Kj?x.constructor.name===G.constructor.name:x.constructor===G.constructor))x.copy(G);else if(G!==void 0){var C;const W=(C=x)==null?void 0:C.isColor;!W&&x.setScalar?x.setScalar(G):x instanceof EA&&G instanceof EA?x.mask=G.mask:x.set(G),!g9()&&o&&!o.linear&&W&&x.convertSRGBToLinear()}}else{var A;if(Z[y]=G,(A=Z[y])!=null&&A.isTexture&&Z[y].format===To&&Z[y].type===Lc&&o){const W=Z[y];kM(W)&&kM(o.gl)?W.colorSpace=o.gl.outputColorSpace:W.encoding=o.gl.outputEncoding}}Qm(s)}if(n&&n.parent&&s.raycast&&d!==n.eventCount){const m=yR(s).getState().internal,y=m.interaction.indexOf(s);y>-1&&m.interaction.splice(y,1),n.eventCount&&m.interaction.push(s)}return!(u.length===1&&u[0][0]==="onUpdate")&&u.length&&(t=s.__r3f)!=null&&t.parent&&MN(s),s}function Qm(s){var e,t;const n=(e=s.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function MN(s){s.onUpdate==null||s.onUpdate(s)}function Lj(s,e){s.manual||(u9(s)?(s.left=e.width/-2,s.right=e.width/2,s.top=e.height/2,s.bottom=e.height/-2):s.aspect=e.width/e.height,s.updateProjectionMatrix(),s.updateMatrixWorld())}function lR(s){return(s.eventObject||s.object).uuid+"/"+s.index+s.instanceId}function zj(){var s;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return eb.DefaultEventPriority;switch((s=e.event)==null?void 0:s.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return eb.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return eb.ContinuousEventPriority;default:return eb.DefaultEventPriority}}function f9(s,e,t,n){const a=t.get(e);a&&(t.delete(e),t.size===0&&(s.delete(n),a.target.releasePointerCapture(n)))}function _j(s,e){const{internal:t}=s.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,a)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(a)}),t.capturedMap.forEach((n,a)=>{f9(t.capturedMap,e,n,a)})}function Dj(s){function e(d){const{internal:C}=s.getState(),A=d.offsetX-C.initialClick[0],p=d.offsetY-C.initialClick[1];return Math.round(Math.sqrt(A*A+p*p))}function t(d){return d.filter(C=>["Move","Over","Enter","Out","Leave"].some(A=>{var p;return(p=C.__r3f)==null?void 0:p.handlers["onPointer"+A]}))}function n(d,C){const A=s.getState(),p=new Set,m=[],y=C?C(A.internal.interaction):A.internal.interaction;for(let Z=0;Z<y.length;Z++){const x=k0(y[Z]);x&&(x.raycaster.camera=void 0)}A.previousRoot||A.events.compute==null||A.events.compute(d,A);function G(Z){const x=k0(Z);if(!x||!x.events.enabled||x.raycaster.camera===null)return[];if(x.raycaster.camera===void 0){var W;x.events.compute==null||x.events.compute(d,x,(W=x.previousRoot)==null?void 0:W.getState()),x.raycaster.camera===void 0&&(x.raycaster.camera=null)}return x.raycaster.camera?x.raycaster.intersectObject(Z,!0):[]}let w=y.flatMap(G).sort((Z,x)=>{const W=k0(Z.object),N=k0(x.object);return!W||!N?Z.distance-x.distance:N.events.priority-W.events.priority||Z.distance-x.distance}).filter(Z=>{const x=lR(Z);return p.has(x)?!1:(p.add(x),!0)});A.events.filter&&(w=A.events.filter(w,A));for(const Z of w){let x=Z.object;for(;x;){var R;(R=x.__r3f)!=null&&R.eventCount&&m.push({...Z,eventObject:x}),x=x.parent}}if("pointerId"in d&&A.internal.capturedMap.has(d.pointerId))for(let Z of A.internal.capturedMap.get(d.pointerId).values())p.has(lR(Z.intersection))||m.push(Z.intersection);return m}function a(d,C,A,p){const m=s.getState();if(d.length){const y={stopped:!1};for(const G of d){const w=k0(G.object)||m,{raycaster:R,pointer:Z,camera:x,internal:W}=w,N=new q(Z.x,Z.y,0).unproject(x),K=F=>{var U,le;return(U=(le=W.capturedMap.get(F))==null?void 0:le.has(G.eventObject))!=null?U:!1},T=F=>{const U={intersection:G,target:C.target};W.capturedMap.has(F)?W.capturedMap.get(F).set(G.eventObject,U):W.capturedMap.set(F,new Map([[G.eventObject,U]])),C.target.setPointerCapture(F)},L=F=>{const U=W.capturedMap.get(F);U&&f9(W.capturedMap,G.eventObject,U,F)};let k={};for(let F in C){let U=C[F];typeof U!="function"&&(k[F]=U)}let E={...G,...k,pointer:Z,intersections:d,stopped:y.stopped,delta:A,unprojectedPoint:N,ray:R.ray,camera:x,stopPropagation(){const F="pointerId"in C&&W.capturedMap.get(C.pointerId);if((!F||F.has(G.eventObject))&&(E.stopped=y.stopped=!0,W.hovered.size&&Array.from(W.hovered.values()).find(U=>U.eventObject===G.eventObject))){const U=d.slice(0,d.indexOf(G));o([...U,G])}},target:{hasPointerCapture:K,setPointerCapture:T,releasePointerCapture:L},currentTarget:{hasPointerCapture:K,setPointerCapture:T,releasePointerCapture:L},nativeEvent:C};if(p(E),y.stopped===!0)break}}return d}function o(d){const{internal:C}=s.getState();for(const A of C.hovered.values())if(!d.length||!d.find(p=>p.object===A.object&&p.index===A.index&&p.instanceId===A.instanceId)){const m=A.eventObject.__r3f,y=m==null?void 0:m.handlers;if(C.hovered.delete(lR(A)),m!=null&&m.eventCount){const G={...A,intersections:d};y.onPointerOut==null||y.onPointerOut(G),y.onPointerLeave==null||y.onPointerLeave(G)}}}function l(d,C){for(let A=0;A<C.length;A++){const p=C[A].__r3f;p==null||p.handlers.onPointerMissed==null||p.handlers.onPointerMissed(d)}}function u(d){switch(d){case"onPointerLeave":case"onPointerCancel":return()=>o([]);case"onLostPointerCapture":return C=>{const{internal:A}=s.getState();"pointerId"in C&&A.capturedMap.has(C.pointerId)&&requestAnimationFrame(()=>{A.capturedMap.has(C.pointerId)&&(A.capturedMap.delete(C.pointerId),o([]))})}}return function(A){const{onPointerMissed:p,internal:m}=s.getState();m.lastEvent.current=A;const y=d==="onPointerMove",G=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",R=n(A,y?t:void 0),Z=G?e(A):0;d==="onPointerDown"&&(m.initialClick=[A.offsetX,A.offsetY],m.initialHits=R.map(W=>W.eventObject)),G&&!R.length&&Z<=2&&(l(A,m.interaction),p&&p(A)),y&&o(R);function x(W){const N=W.eventObject,K=N.__r3f,T=K==null?void 0:K.handlers;if(K!=null&&K.eventCount)if(y){if(T.onPointerOver||T.onPointerEnter||T.onPointerOut||T.onPointerLeave){const L=lR(W),k=m.hovered.get(L);k?k.stopped&&W.stopPropagation():(m.hovered.set(L,W),T.onPointerOver==null||T.onPointerOver(W),T.onPointerEnter==null||T.onPointerEnter(W))}T.onPointerMove==null||T.onPointerMove(W)}else{const L=T[d];L?(!G||m.initialHits.includes(N))&&(l(A,m.interaction.filter(k=>!m.initialHits.includes(k))),L(W)):G&&m.initialHits.includes(N)&&l(A,m.interaction.filter(k=>!m.initialHits.includes(k)))}}a(R,A,Z,x)}}return{handlePointer:u}}const p9=s=>!!(s!=null&&s.render),m9=Fe.createContext(null),kj=(s,e)=>{const t=Gj((u,d)=>{const C=new q,A=new q,p=new q;function m(Z=d().camera,x=A,W=d().size){const{width:N,height:K,top:T,left:L}=W,k=N/K;x.isVector3?p.copy(x):p.set(...x);const E=Z.getWorldPosition(C).distanceTo(p);if(u9(Z))return{width:N/Z.zoom,height:K/Z.zoom,top:T,left:L,factor:1,distance:E,aspect:k};{const F=Z.fov*Math.PI/180,U=2*Math.tan(F/2)*E,le=U*(N/K);return{width:le,height:U,top:T,left:L,factor:N/le,distance:E,aspect:k}}}let y;const G=Z=>u(x=>({performance:{...x.performance,current:Z}})),w=new ut;return{set:u,get:d,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(Z=1)=>s(d(),Z),advance:(Z,x)=>e(Z,x,d()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new TH,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const Z=d();y&&clearTimeout(y),Z.performance.current!==Z.performance.min&&G(Z.performance.min),y=setTimeout(()=>G(d().performance.max),Z.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:m},setEvents:Z=>u(x=>({...x,events:{...x.events,...Z}})),setSize:(Z,x,W,N,K)=>{const T=d().camera,L={width:Z,height:x,top:N||0,left:K||0,updateStyle:W};u(k=>({size:L,viewport:{...k.viewport,...m(T,A,L)}}))},setDpr:Z=>u(x=>{const W=h9(Z);return{viewport:{...x.viewport,dpr:W,initialDpr:x.viewport.initialDpr||W}}}),setFrameloop:(Z="always")=>{const x=d().clock;x.stop(),x.elapsedTime=0,Z!=="never"&&(x.start(),x.elapsedTime=0),u(()=>({frameloop:Z}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:Fe.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(Z,x,W)=>{const N=d().internal;return N.priority=N.priority+(x>0?1:0),N.subscribers.push({ref:Z,priority:x,store:W}),N.subscribers=N.subscribers.sort((K,T)=>K.priority-T.priority),()=>{const K=d().internal;K!=null&&K.subscribers&&(K.priority=K.priority-(x>0?1:0),K.subscribers=K.subscribers.filter(T=>T.ref!==Z))}}}}}),n=t.getState();let a=n.size,o=n.viewport.dpr,l=n.camera;return t.subscribe(()=>{const{camera:u,size:d,viewport:C,gl:A,set:p}=t.getState();if(d.width!==a.width||d.height!==a.height||C.dpr!==o){var m;a=d,o=C.dpr,Lj(u,d),A.setPixelRatio(C.dpr);const y=(m=d.updateStyle)!=null?m:typeof HTMLCanvasElement<"u"&&A.domElement instanceof HTMLCanvasElement;A.setSize(d.width,d.height,y)}u!==l&&(l=u,p(y=>({viewport:{...y.viewport,...y.viewport.getCurrentViewport(u)}})))}),t.subscribe(u=>s(u)),t};let cR,Uj=new Set,Jj=new Set,Oj=new Set;function OM(s,e){if(s.size)for(const{callback:t}of s.values())t(e)}function U0(s,e){switch(s){case"before":return OM(Uj,e);case"after":return OM(Jj,e);case"tail":return OM(Oj,e)}}let PM,QM;function jM(s,e,t){let n=e.clock.getDelta();for(e.frameloop==="never"&&typeof s=="number"&&(n=s-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=s),PM=e.internal.subscribers,cR=0;cR<PM.length;cR++)QM=PM[cR],QM.ref.current(QM.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function Pj(s){let e=!1,t=!1,n,a,o;function l(C){a=requestAnimationFrame(l),e=!0,n=0,U0("before",C),t=!0;for(const p of s.values()){var A;o=p.store.getState(),o.internal.active&&(o.frameloop==="always"||o.internal.frames>0)&&!((A=o.gl.xr)!=null&&A.isPresenting)&&(n+=jM(C,o))}if(t=!1,U0("after",C),n===0)return U0("tail",C),e=!1,cancelAnimationFrame(a)}function u(C,A=1){var p;if(!C)return s.forEach(m=>u(m.store.getState(),A));(p=C.gl.xr)!=null&&p.isPresenting||!C.internal.active||C.frameloop==="never"||(A>1?C.internal.frames=Math.min(60,C.internal.frames+A):t?C.internal.frames=2:C.internal.frames=1,e||(e=!0,requestAnimationFrame(l)))}function d(C,A=!0,p,m){if(A&&U0("before",C),p)jM(C,p,m);else for(const y of s.values())jM(C,y.store.getState());A&&U0("after",C)}return{loop:l,invalidate:u,advance:d}}function b9(){const s=Fe.useContext(m9);if(!s)throw new Error("R3F: Hooks can only be used within the Canvas component!");return s}function Tc(s=t=>t,e){return b9()(s,e)}function jw(s,e=0){const t=b9(),n=t.getState().internal.subscribe,a=I9(s);return XG(()=>n(a,e,t),[e,n,t]),null}const QY=new WeakMap;function v9(s,e){return function(t,...n){let a=QY.get(t);return a||(a=new t,QY.set(t,a)),s&&s(a),Promise.all(n.map(o=>new Promise((l,u)=>a.load(o,d=>{d.scene&&Object.assign(d,Tj(d.scene)),l(d)},e,d=>u(new Error(`Could not load ${o}: ${d==null?void 0:d.message}`))))))}}function FG(s,e,t,n){const a=Array.isArray(e)?e:[e],o=Zj(v9(t,n),[s,...a],{equal:ia.equ});return Array.isArray(e)?o:o[0]}FG.preload=function(s,e,t){const n=Array.isArray(e)?e:[e];return Sj(v9(t),[s,...n])};FG.clear=function(s,e){const t=Array.isArray(e)?e:[e];return Rj([s,...t])};const Ib=new Map,{invalidate:jY,advance:qY}=Pj(Ib),{reconciler:gw,applyProps:Jm}=Hj(Ib,zj),Om={objects:"shallow",strict:!1},Qj=(s,e)=>{const t=typeof s=="function"?s(e):s;return p9(t)?t:new CK({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...s})};function jj(s,e){const t=typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement;if(e){const{width:n,height:a,top:o,left:l,updateStyle:u=t}=e;return{width:n,height:a,top:o,left:l,updateStyle:u}}else if(typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement&&s.parentElement){const{width:n,height:a,top:o,left:l}=s.parentElement.getBoundingClientRect();return{width:n,height:a,top:o,left:l,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas)return{width:s.width,height:s.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function qj(s){const e=Ib.get(s),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,o=n||kj(jY,qY),l=t||gw.createContainer(o,eb.ConcurrentRoot,null,!1,null,"",a,null);e||Ib.set(s,{fiber:l,store:o});let u,d=!1,C;return{configure(A={}){let{gl:p,size:m,scene:y,events:G,onCreated:w,shadows:R=!1,linear:Z=!1,flat:x=!1,legacy:W=!1,orthographic:N=!1,frameloop:K="always",dpr:T=[1,2],performance:L,raycaster:k,camera:E,onPointerMissed:F}=A,U=o.getState(),le=U.gl;U.gl||U.set({gl:le=Qj(p,s)});let ie=U.raycaster;ie||U.set({raycaster:ie=new t9});const{params:Ce,...Ge}=k||{};if(ia.equ(Ge,ie,Om)||Jm(ie,{...Ge}),ia.equ(Ce,ie.params,Om)||Jm(ie,{params:{...ie.params,...Ce}}),!U.camera||U.camera===C&&!ia.equ(C,E,Om)){C=E;const We=E instanceof SG,ke=We?E:N?new Kc(0,0,0,0,.1,1e3):new Aa(75,0,.1,1e3);We||(ke.position.z=5,E&&(Jm(ke,E),("aspect"in E||"left"in E||"right"in E||"bottom"in E||"top"in E)&&(ke.manual=!0,ke.updateProjectionMatrix())),!U.camera&&!(E!=null&&E.rotation)&&ke.lookAt(0,0,0)),U.set({camera:ke}),ie.camera=ke}if(!U.scene){let We;y!=null&&y.isScene?We=y:(We=new pH,y&&Jm(We,y)),U.set({scene:Pm(We)})}if(!U.xr){var ye;const We=(ot,Ne)=>{const tt=o.getState();tt.frameloop!=="never"&&qY(ot,!0,tt,Ne)},ke=()=>{const ot=o.getState();ot.gl.xr.enabled=ot.gl.xr.isPresenting,ot.gl.xr.setAnimationLoop(ot.gl.xr.isPresenting?We:null),ot.gl.xr.isPresenting||jY(ot)},$e={connect(){const ot=o.getState().gl;ot.xr.addEventListener("sessionstart",ke),ot.xr.addEventListener("sessionend",ke)},disconnect(){const ot=o.getState().gl;ot.xr.removeEventListener("sessionstart",ke),ot.xr.removeEventListener("sessionend",ke)}};typeof((ye=le.xr)==null?void 0:ye.addEventListener)=="function"&&$e.connect(),U.set({xr:$e})}if(le.shadowMap){const We=le.shadowMap.enabled,ke=le.shadowMap.type;if(le.shadowMap.enabled=!!R,ia.boo(R))le.shadowMap.type=nG;else if(ia.str(R)){var pe;const $e={basic:cE,percentage:mw,soft:nG,variance:Yc};le.shadowMap.type=(pe=$e[R])!=null?pe:nG}else ia.obj(R)&&Object.assign(le.shadowMap,R);(We!==le.shadowMap.enabled||ke!==le.shadowMap.type)&&(le.shadowMap.needsUpdate=!0)}const de=g9();de&&("enabled"in de?de.enabled=!W:"legacyMode"in de&&(de.legacyMode=W)),d||Jm(le,{outputEncoding:Z?3e3:3001,toneMapping:x?eu:QN}),U.legacy!==W&&U.set(()=>({legacy:W})),U.linear!==Z&&U.set(()=>({linear:Z})),U.flat!==x&&U.set(()=>({flat:x})),p&&!ia.fun(p)&&!p9(p)&&!ia.equ(p,le,Om)&&Jm(le,p),G&&!U.events.handlers&&U.set({events:G(o)});const Oe=jj(s,m);return ia.equ(Oe,U.size,Om)||U.setSize(Oe.width,Oe.height,Oe.updateStyle,Oe.top,Oe.left),T&&U.viewport.dpr!==h9(T)&&U.setDpr(T),U.frameloop!==K&&U.setFrameloop(K),U.onPointerMissed||U.set({onPointerMissed:F}),L&&!ia.equ(L,U.performance,Om)&&U.set(We=>({performance:{...We.performance,...L}})),u=w,d=!0,this},render(A){return d||this.configure(),gw.updateContainer(Il.jsx($j,{store:o,children:A,onCreated:u,rootElement:s}),l,null,()=>{}),o},unmount(){y9(s)}}}function $j({store:s,children:e,onCreated:t,rootElement:n}){return XG(()=>{const a=s.getState();a.set(o=>({internal:{...o.internal,active:!0}})),t&&t(a),s.getState().events.connected||a.events.connect==null||a.events.connect(n)},[]),Il.jsx(m9.Provider,{value:s,children:e})}function y9(s,e){const t=Ib.get(s),n=t==null?void 0:t.fiber;if(n){const a=t==null?void 0:t.store.getState();a&&(a.internal.active=!1),gw.updateContainer(null,n,null,()=>{a&&setTimeout(()=>{try{var o,l,u,d;a.events.disconnect==null||a.events.disconnect(),(o=a.gl)==null||(l=o.renderLists)==null||l.dispose==null||l.dispose(),(u=a.gl)==null||u.forceContextLoss==null||u.forceContextLoss(),(d=a.gl)!=null&&d.xr&&a.xr.disconnect(),Ej(a),Ib.delete(s)}catch{}},500)})}}gw.injectIntoDevTools({bundleType:1,rendererPackageName:"@react-three/fiber",version:Fe.version});const qM={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function e4(s){const{handlePointer:e}=Dj(s);return{priority:1,enabled:!0,compute(t,n,a){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(qM).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:a}=s.getState();(t=a.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(a.lastEvent.current)},connect:t=>{var n;const{set:a,events:o}=s.getState();o.disconnect==null||o.disconnect(),a(l=>({events:{...l.events,connected:t}})),Object.entries((n=o.handlers)!=null?n:[]).forEach(([l,u])=>{const[d,C]=qM[l];t.addEventListener(d,u,{passive:C})})},disconnect:()=>{const{set:t,events:n}=s.getState();if(n.connected){var a;Object.entries((a=n.handlers)!=null?a:[]).forEach(([o,l])=>{if(n&&n.connected instanceof HTMLElement){const[u]=qM[o];n.connected.removeEventListener(u,l)}}),t(o=>({events:{...o.events,connected:void 0}}))}}}}function $Y(s,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>s(...n),e)}}function t4({debounce:s,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const a=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,l]=Fe.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),u=Fe.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),d=s?typeof s=="number"?s:s.scroll:null,C=s?typeof s=="number"?s:s.resize:null,A=Fe.useRef(!1);Fe.useEffect(()=>(A.current=!0,()=>void(A.current=!1)));const[p,m,y]=Fe.useMemo(()=>{const Z=()=>{if(!u.current.element)return;const{left:x,top:W,width:N,height:K,bottom:T,right:L,x:k,y:E}=u.current.element.getBoundingClientRect(),F={left:x,top:W,width:N,height:K,bottom:T,right:L,x:k,y:E};u.current.element instanceof HTMLElement&&n&&(F.height=u.current.element.offsetHeight,F.width=u.current.element.offsetWidth),Object.freeze(F),A.current&&!r4(u.current.lastBounds,F)&&l(u.current.lastBounds=F)};return[Z,C?$Y(Z,C):Z,d?$Y(Z,d):Z]},[l,n,d,C]);function G(){u.current.scrollContainers&&(u.current.scrollContainers.forEach(Z=>Z.removeEventListener("scroll",y,!0)),u.current.scrollContainers=null),u.current.resizeObserver&&(u.current.resizeObserver.disconnect(),u.current.resizeObserver=null),u.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",u.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",u.current.orientationHandler))}function w(){u.current.element&&(u.current.resizeObserver=new a(y),u.current.resizeObserver.observe(u.current.element),e&&u.current.scrollContainers&&u.current.scrollContainers.forEach(Z=>Z.addEventListener("scroll",y,{capture:!0,passive:!0})),u.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",u.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",u.current.orientationHandler))}const R=Z=>{!Z||Z===u.current.element||(G(),u.current.element=Z,u.current.scrollContainers=G9(Z),w())};return i4(y,!!e),n4(m),Fe.useEffect(()=>{G(),w()},[e,y,m]),Fe.useEffect(()=>G,[]),[R,o,p]}function n4(s){Fe.useEffect(()=>{const e=s;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[s])}function i4(s,e){Fe.useEffect(()=>{if(e){const t=s;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[s,e])}function G9(s){const e=[];if(!s||s===document.body)return e;const{overflow:t,overflowX:n,overflowY:a}=window.getComputedStyle(s);return[t,n,a].some(o=>o==="auto"||o==="scroll")&&e.push(s),[...e,...G9(s.parentElement)]}const a4=["x","y","top","bottom","left","right","width","height"],r4=(s,e)=>a4.every(t=>s[t]===e[t]);var o4=Object.defineProperty,s4=Object.defineProperties,l4=Object.getOwnPropertyDescriptors,eT=Object.getOwnPropertySymbols,c4=Object.prototype.hasOwnProperty,g4=Object.prototype.propertyIsEnumerable,tT=(s,e,t)=>e in s?o4(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,nT=(s,e)=>{for(var t in e||(e={}))c4.call(e,t)&&tT(s,t,e[t]);if(eT)for(var t of eT(e))g4.call(e,t)&&tT(s,t,e[t]);return s},u4=(s,e)=>s4(s,l4(e)),iT,aT;typeof window<"u"&&((iT=window.document)!=null&&iT.createElement||((aT=window.navigator)==null?void 0:aT.product)==="ReactNative")?Fe.useLayoutEffect:Fe.useEffect;function B9(s,e,t){if(!s)return;if(t(s)===!0)return s;let n=s.child;for(;n;){const a=B9(n,e,t);if(a)return a;n=n.sibling}}function Z9(s){try{return Object.defineProperties(s,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return s}}const rT=console.error;console.error=function(){const s=[...arguments].join("");if(s!=null&&s.startsWith("Warning:")&&s.includes("useContext")){console.error=rT;return}return rT.apply(this,arguments)};const DH=Z9(Fe.createContext(null));class S9 extends Fe.Component{render(){return Fe.createElement(DH.Provider,{value:this._reactInternals},this.props.children)}}function I4(){const s=Fe.useContext(DH);if(s===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Fe.useId();return Fe.useMemo(()=>{for(const n of[s,s==null?void 0:s.alternate]){if(!n)continue;const a=B9(n,!1,o=>{let l=o.memoizedState;for(;l;){if(l.memoizedState===e)return!0;l=l.next}});if(a)return a}},[s,e])}function d4(){const s=I4(),[e]=Fe.useState(()=>new Map);e.clear();let t=s;for(;t;){if(t.type&&typeof t.type=="object"){const a=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;a&&a!==DH&&!e.has(a)&&e.set(a,Fe.useContext(Z9(a)))}t=t.return}return e}function C4(){const s=d4();return Fe.useMemo(()=>Array.from(s.keys()).reduce((e,t)=>n=>Fe.createElement(e,null,Fe.createElement(t.Provider,u4(nT({},n),{value:s.get(t)}))),e=>Fe.createElement(S9,nT({},e))),[s])}const h4=Fe.forwardRef(function({children:e,fallback:t,resize:n,style:a,gl:o,events:l=e4,eventSource:u,eventPrefix:d,shadows:C,linear:A,flat:p,legacy:m,orthographic:y,frameloop:G,dpr:w,performance:R,raycaster:Z,camera:x,scene:W,onPointerMissed:N,onCreated:K,...T},L){Fe.useMemo(()=>Nj(bj),[]);const k=C4(),[E,F]=t4({scroll:!0,debounce:{scroll:50,resize:0},...n}),U=Fe.useRef(null),le=Fe.useRef(null);Fe.useImperativeHandle(L,()=>U.current);const ie=I9(N),[Ce,Ge]=Fe.useState(!1),[ye,pe]=Fe.useState(!1);if(Ce)throw Ce;if(ye)throw ye;const de=Fe.useRef(null);XG(()=>{const We=U.current;F.width>0&&F.height>0&&We&&(de.current||(de.current=qj(We)),de.current.configure({gl:o,events:l,shadows:C,linear:A,flat:p,legacy:m,orthographic:y,frameloop:G,dpr:w,performance:R,raycaster:Z,camera:x,scene:W,size:F,onPointerMissed:(...ke)=>ie.current==null?void 0:ie.current(...ke),onCreated:ke=>{ke.events.connect==null||ke.events.connect(u?Xj(u)?u.current:u:le.current),d&&ke.setEvents({compute:($e,ot)=>{const Ne=$e[d+"X"],tt=$e[d+"Y"];ot.pointer.set(Ne/ot.size.width*2-1,-(tt/ot.size.height)*2+1),ot.raycaster.setFromCamera(ot.pointer,ot.camera)}}),K==null||K(ke)}}),de.current.render(Il.jsx(k,{children:Il.jsx(d9,{set:pe,children:Il.jsx(Fe.Suspense,{fallback:Il.jsx(Fj,{set:Ge}),children:e??null})})})))}),Fe.useEffect(()=>{const We=U.current;if(We)return()=>y9(We)},[]);const Oe=u?"none":"auto";return Il.jsx("div",{ref:le,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Oe,...a},...T,children:Il.jsx("div",{ref:E,style:{width:"100%",height:"100%"},children:Il.jsx("canvas",{ref:U,style:{display:"block"},children:t})})})}),qw=Fe.forwardRef(function(e,t){return Il.jsx(S9,{children:Il.jsx(h4,{...e,ref:t})})});function uw(){return uw=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},uw.apply(null,arguments)}const YG=new q,kH=new q,A4=new q,oT=new ut;function f4(s,e,t){const n=YG.setFromMatrixPosition(s.matrixWorld);n.project(e);const a=t.width/2,o=t.height/2;return[n.x*a+a,-(n.y*o)+o]}function p4(s,e){const t=YG.setFromMatrixPosition(s.matrixWorld),n=kH.setFromMatrixPosition(e.matrixWorld),a=t.sub(n),o=e.getWorldDirection(A4);return a.angleTo(o)>Math.PI/2}function m4(s,e,t,n){const a=YG.setFromMatrixPosition(s.matrixWorld),o=a.clone();o.project(e),oT.set(o.x,o.y),t.setFromCamera(oT,e);const l=t.intersectObjects(n,!0);if(l.length){const u=l[0].distance;return a.distanceTo(t.ray.origin)<u}return!0}function b4(s,e){if(e instanceof Kc)return e.zoom;if(e instanceof Aa){const t=YG.setFromMatrixPosition(s.matrixWorld),n=kH.setFromMatrixPosition(e.matrixWorld),a=e.fov*Math.PI/180,o=t.distanceTo(n);return 1/(2*Math.tan(a/2)*o)}else return 1}function v4(s,e,t){if(e instanceof Aa||e instanceof Kc){const n=YG.setFromMatrixPosition(s.matrixWorld),a=kH.setFromMatrixPosition(e.matrixWorld),o=n.distanceTo(a),l=(t[1]-t[0])/(e.far-e.near),u=t[1]-l*e.far;return Math.round(l*o+u)}}const NN=s=>Math.abs(s)<1e-10?0:s;function R9(s,e,t=""){let n="matrix3d(";for(let a=0;a!==16;a++)n+=NN(e[a]*s.elements[a])+(a!==15?",":")");return t+n}const y4=(s=>e=>R9(e,s))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),G4=(s=>(e,t)=>R9(e,s(t),"translate(-50%,-50%)"))(s=>[1/s,1/s,1/s,1,-1/s,-1/s,-1/s,-1,1/s,1/s,1/s,1,1,1,1,1]);function B4(s){return s&&typeof s=="object"&&"current"in s}const Z4=Fe.forwardRef(({children:s,eps:e=.001,style:t,className:n,prepend:a,center:o,fullscreen:l,portal:u,distanceFactor:d,sprite:C=!1,transform:A=!1,occlude:p,onOcclude:m,castShadow:y,receiveShadow:G,material:w,geometry:R,zIndexRange:Z=[16777271,0],calculatePosition:x=f4,as:W="div",wrapperClass:N,pointerEvents:K="auto",...T},L)=>{const{gl:k,camera:E,scene:F,size:U,raycaster:le,events:ie,viewport:Ce}=Tc(),[Ge]=Fe.useState(()=>document.createElement(W)),ye=Fe.useRef(),pe=Fe.useRef(null),de=Fe.useRef(0),Oe=Fe.useRef([0,0]),We=Fe.useRef(null),ke=Fe.useRef(null),$e=(u==null?void 0:u.current)||ie.connected||k.domElement.parentNode,ot=Fe.useRef(null),Ne=Fe.useRef(!1),tt=Fe.useMemo(()=>p&&p!=="blending"||Array.isArray(p)&&p.length&&B4(p[0]),[p]);Fe.useLayoutEffect(()=>{const Nt=k.domElement;p&&p==="blending"?(Nt.style.zIndex=`${Math.floor(Z[0]/2)}`,Nt.style.position="absolute",Nt.style.pointerEvents="none"):(Nt.style.zIndex=null,Nt.style.position=null,Nt.style.pointerEvents=null)},[p]),Fe.useLayoutEffect(()=>{if(pe.current){const Nt=ye.current=zN(Ge);if(F.updateMatrixWorld(),A)Ge.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Lt=x(pe.current,E,U);Ge.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Lt[0]}px,${Lt[1]}px,0);transform-origin:0 0;`}return $e&&(a?$e.prepend(Ge):$e.appendChild(Ge)),()=>{$e&&$e.removeChild(Ge),Nt.unmount()}}},[$e,A]),Fe.useLayoutEffect(()=>{N&&(Ge.className=N)},[N]);const bt=Fe.useMemo(()=>A?{position:"absolute",top:0,left:0,width:U.width,height:U.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:o?"translate3d(-50%,-50%,0)":"none",...l&&{top:-U.height/2,left:-U.width/2,width:U.width,height:U.height},...t},[t,o,l,U,A]),dt=Fe.useMemo(()=>({position:"absolute",pointerEvents:K}),[K]);Fe.useLayoutEffect(()=>{if(Ne.current=!1,A){var Nt;(Nt=ye.current)==null||Nt.render(Fe.createElement("div",{ref:We,style:bt},Fe.createElement("div",{ref:ke,style:dt},Fe.createElement("div",{ref:L,className:n,style:t,children:s}))))}else{var Lt;(Lt=ye.current)==null||Lt.render(Fe.createElement("div",{ref:L,style:bt,className:n,children:s}))}});const yt=Fe.useRef(!0);jw(Nt=>{if(pe.current){E.updateMatrixWorld(),pe.current.updateWorldMatrix(!0,!1);const Lt=A?Oe.current:x(pe.current,E,U);if(A||Math.abs(de.current-E.zoom)>e||Math.abs(Oe.current[0]-Lt[0])>e||Math.abs(Oe.current[1]-Lt[1])>e){const Ue=p4(pe.current,E);let Pe=!1;tt&&(Array.isArray(p)?Pe=p.map(ht=>ht.current):p!=="blending"&&(Pe=[F]));const te=yt.current;if(Pe){const ht=m4(pe.current,E,le,Pe);yt.current=ht&&!Ue}else yt.current=!Ue;te!==yt.current&&(m?m(!yt.current):Ge.style.display=yt.current?"block":"none");const Gt=Math.floor(Z[0]/2),Qe=p?tt?[Z[0],Gt]:[Gt-1,0]:Z;if(Ge.style.zIndex=`${v4(pe.current,E,Qe)}`,A){const[ht,Ct]=[U.width/2,U.height/2],Tt=E.projectionMatrix.elements[5]*Ct,{isOrthographicCamera:Rt,top:$,left:J,bottom:fe,right:ze}=E,et=y4(E.matrixWorldInverse),_e=Rt?`scale(${Tt})translate(${NN(-(ze+J)/2)}px,${NN(($+fe)/2)}px)`:`translateZ(${Tt}px)`;let At=pe.current.matrixWorld;C&&(At=E.matrixWorldInverse.clone().transpose().copyPosition(At).scale(pe.current.scale),At.elements[3]=At.elements[7]=At.elements[11]=0,At.elements[15]=1),Ge.style.width=U.width+"px",Ge.style.height=U.height+"px",Ge.style.perspective=Rt?"":`${Tt}px`,We.current&&ke.current&&(We.current.style.transform=`${_e}${et}translate(${ht}px,${Ct}px)`,ke.current.style.transform=G4(At,1/((d||10)/400)))}else{const ht=d===void 0?1:b4(pe.current,E)*d;Ge.style.transform=`translate3d(${Lt[0]}px,${Lt[1]}px,0) scale(${ht})`}Oe.current=Lt,de.current=E.zoom}}if(!tt&&ot.current&&!Ne.current)if(A){if(We.current){const Lt=We.current.children[0];if(Lt!=null&&Lt.clientWidth&&Lt!=null&&Lt.clientHeight){const{isOrthographicCamera:Ue}=E;if(Ue||R)T.scale&&(Array.isArray(T.scale)?T.scale instanceof q?ot.current.scale.copy(T.scale.clone().divideScalar(1)):ot.current.scale.set(1/T.scale[0],1/T.scale[1],1/T.scale[2]):ot.current.scale.setScalar(1/T.scale));else{const Pe=(d||10)/400,te=Lt.clientWidth*Pe,Gt=Lt.clientHeight*Pe;ot.current.scale.set(te,Gt,1)}Ne.current=!0}}}else{const Lt=Ge.children[0];if(Lt!=null&&Lt.clientWidth&&Lt!=null&&Lt.clientHeight){const Ue=1/Ce.factor,Pe=Lt.clientWidth*Ue,te=Lt.clientHeight*Ue;ot.current.scale.set(Pe,te,1),Ne.current=!0}ot.current.lookAt(Nt.camera.position)}});const zt=Fe.useMemo(()=>({vertexShader:A?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[A]);return Fe.createElement("group",uw({},T,{ref:pe}),p&&!tt&&Fe.createElement("mesh",{castShadow:y,receiveShadow:G,ref:ot},R||Fe.createElement("planeGeometry",null),w||Fe.createElement("shaderMaterial",{side:Kl,vertexShader:zt.vertexShader,fragmentShader:zt.fragmentShader})))}),S4=parseInt(yG.replace(/\D+/g,""));function sT(s,e){if(e===KE)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===ow||e===sH){let t=s.getIndex();if(t===null){const l=[],u=s.getAttribute("position");if(u!==void 0){for(let d=0;d<u.count;d++)l.push(d);s.setIndex(l),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const n=t.count-2,a=[];if(t)if(e===ow)for(let l=1;l<=n;l++)a.push(t.getX(0)),a.push(t.getX(l)),a.push(t.getX(l+1));else for(let l=0;l<n;l++)l%2===0?(a.push(t.getX(l)),a.push(t.getX(l+1)),a.push(t.getX(l+2))):(a.push(t.getX(l+2)),a.push(t.getX(l+1)),a.push(t.getX(l)));a.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=s.clone();return o.setIndex(a),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}var R4=Object.defineProperty,w4=(s,e,t)=>e in s?R4(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,x4=(s,e,t)=>(w4(s,e+"",t),t);class W4{constructor(){x4(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const a=this._listeners[e];if(a!==void 0){const o=a.indexOf(t);o!==-1&&a.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const a=n.slice(0);for(let o=0,l=a.length;o<l;o++)a[o].call(this,e);e.target=null}}}var V4=Object.defineProperty,M4=(s,e,t)=>e in s?V4(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,xn=(s,e,t)=>(M4(s,typeof e!="symbol"?e+"":e,t),t);const gR=new qA,lT=new bI,N4=Math.cos(70*(Math.PI/180)),cT=(s,e)=>(s%e+e)%e;let H4=class extends W4{constructor(e,t){super(),xn(this,"object"),xn(this,"domElement"),xn(this,"enabled",!0),xn(this,"target",new q),xn(this,"minDistance",0),xn(this,"maxDistance",1/0),xn(this,"minZoom",0),xn(this,"maxZoom",1/0),xn(this,"minPolarAngle",0),xn(this,"maxPolarAngle",Math.PI),xn(this,"minAzimuthAngle",-1/0),xn(this,"maxAzimuthAngle",1/0),xn(this,"enableDamping",!1),xn(this,"dampingFactor",.05),xn(this,"enableZoom",!0),xn(this,"zoomSpeed",1),xn(this,"enableRotate",!0),xn(this,"rotateSpeed",1),xn(this,"enablePan",!0),xn(this,"panSpeed",1),xn(this,"screenSpacePanning",!0),xn(this,"keyPanSpeed",7),xn(this,"zoomToCursor",!1),xn(this,"autoRotate",!1),xn(this,"autoRotateSpeed",2),xn(this,"reverseOrbit",!1),xn(this,"reverseHorizontalOrbit",!1),xn(this,"reverseVerticalOrbit",!1),xn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),xn(this,"mouseButtons",{LEFT:vA.ROTATE,MIDDLE:vA.DOLLY,RIGHT:vA.PAN}),xn(this,"touches",{ONE:yA.ROTATE,TWO:yA.DOLLY_PAN}),xn(this,"target0"),xn(this,"position0"),xn(this,"zoom0"),xn(this,"_domElementKeyEvents",null),xn(this,"getPolarAngle"),xn(this,"getAzimuthalAngle"),xn(this,"setPolarAngle"),xn(this,"setAzimuthalAngle"),xn(this,"getDistance"),xn(this,"getZoomScale"),xn(this,"listenToKeyEvents"),xn(this,"stopListenToKeyEvents"),xn(this,"saveState"),xn(this,"reset"),xn(this,"update"),xn(this,"connect"),xn(this,"dispose"),xn(this,"dollyIn"),xn(this,"dollyOut"),xn(this,"getScale"),xn(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>A.phi,this.getAzimuthalAngle=()=>A.theta,this.setPolarAngle=se=>{let Re=cT(se,2*Math.PI),De=A.phi;De<0&&(De+=2*Math.PI),Re<0&&(Re+=2*Math.PI);let Q=Math.abs(Re-De);2*Math.PI-Q<Q&&(Re<De?Re+=2*Math.PI:De+=2*Math.PI),p.phi=Re-De,n.update()},this.setAzimuthalAngle=se=>{let Re=cT(se,2*Math.PI),De=A.theta;De<0&&(De+=2*Math.PI),Re<0&&(Re+=2*Math.PI);let Q=Math.abs(Re-De);2*Math.PI-Q<Q&&(Re<De?Re+=2*Math.PI:De+=2*Math.PI),p.theta=Re-De,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=se=>{se.addEventListener("keydown",Zt),this._domElementKeyEvents=se},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Zt),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(a),n.update(),d=u.NONE},this.update=(()=>{const se=new q,Re=new q(0,1,0),De=new Ir().setFromUnitVectors(e.up,Re),Q=De.clone().invert(),st=new q,be=new Ir,Be=2*Math.PI;return function(){const wt=n.object.position;De.setFromUnitVectors(e.up,Re),Q.copy(De).invert(),se.copy(wt).sub(n.target),se.applyQuaternion(De),A.setFromVector3(se),n.autoRotate&&d===u.NONE&&Ce(le()),n.enableDamping?(A.theta+=p.theta*n.dampingFactor,A.phi+=p.phi*n.dampingFactor):(A.theta+=p.theta,A.phi+=p.phi);let ln=n.minAzimuthAngle,Yn=n.maxAzimuthAngle;isFinite(ln)&&isFinite(Yn)&&(ln<-Math.PI?ln+=Be:ln>Math.PI&&(ln-=Be),Yn<-Math.PI?Yn+=Be:Yn>Math.PI&&(Yn-=Be),ln<=Yn?A.theta=Math.max(ln,Math.min(Yn,A.theta)):A.theta=A.theta>(ln+Yn)/2?Math.max(ln,A.theta):Math.min(Yn,A.theta)),A.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,A.phi)),A.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(y,n.dampingFactor):n.target.add(y),n.zoomToCursor&&E||n.object.isOrthographicCamera?A.radius=ot(A.radius):A.radius=ot(A.radius*m),se.setFromSpherical(A),se.applyQuaternion(Q),wt.copy(n.target).add(se),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(p.theta*=1-n.dampingFactor,p.phi*=1-n.dampingFactor,y.multiplyScalar(1-n.dampingFactor)):(p.set(0,0,0),y.set(0,0,0));let un=!1;if(n.zoomToCursor&&E){let bn=null;if(n.object instanceof Aa&&n.object.isPerspectiveCamera){const ui=se.length();bn=ot(ui*m);const bi=ui-bn;n.object.position.addScaledVector(L,bi),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const ui=new q(k.x,k.y,0);ui.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/m)),n.object.updateProjectionMatrix(),un=!0;const bi=new q(k.x,k.y,0);bi.unproject(n.object),n.object.position.sub(bi).add(ui),n.object.updateMatrixWorld(),bn=se.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;bn!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(bn).add(n.object.position):(gR.origin.copy(n.object.position),gR.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(gR.direction))<N4?e.lookAt(n.target):(lT.setFromNormalAndCoplanarPoint(n.object.up,n.target),gR.intersectPlane(lT,n.target))))}else n.object instanceof Kc&&n.object.isOrthographicCamera&&(un=m!==1,un&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/m)),n.object.updateProjectionMatrix()));return m=1,E=!1,un||st.distanceToSquared(n.object.position)>C||8*(1-be.dot(n.object.quaternion))>C?(n.dispatchEvent(a),st.copy(n.object.position),be.copy(n.object.quaternion),un=!1,!0):!1}})(),this.connect=se=>{n.domElement=se,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",j),n.domElement.addEventListener("pointerdown",J),n.domElement.addEventListener("pointercancel",ze),n.domElement.addEventListener("wheel",At)},this.dispose=()=>{var se,Re,De,Q,st,be;n.domElement&&(n.domElement.style.touchAction="auto"),(se=n.domElement)==null||se.removeEventListener("contextmenu",j),(Re=n.domElement)==null||Re.removeEventListener("pointerdown",J),(De=n.domElement)==null||De.removeEventListener("pointercancel",ze),(Q=n.domElement)==null||Q.removeEventListener("wheel",At),(st=n.domElement)==null||st.ownerDocument.removeEventListener("pointermove",fe),(be=n.domElement)==null||be.ownerDocument.removeEventListener("pointerup",ze),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Zt)};const n=this,a={type:"change"},o={type:"start"},l={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=u.NONE;const C=1e-6,A=new WN,p=new WN;let m=1;const y=new q,G=new ut,w=new ut,R=new ut,Z=new ut,x=new ut,W=new ut,N=new ut,K=new ut,T=new ut,L=new q,k=new ut;let E=!1;const F=[],U={};function le(){return 2*Math.PI/60/60*n.autoRotateSpeed}function ie(){return Math.pow(.95,n.zoomSpeed)}function Ce(se){n.reverseOrbit||n.reverseHorizontalOrbit?p.theta+=se:p.theta-=se}function Ge(se){n.reverseOrbit||n.reverseVerticalOrbit?p.phi+=se:p.phi-=se}const ye=(()=>{const se=new q;return function(De,Q){se.setFromMatrixColumn(Q,0),se.multiplyScalar(-De),y.add(se)}})(),pe=(()=>{const se=new q;return function(De,Q){n.screenSpacePanning===!0?se.setFromMatrixColumn(Q,1):(se.setFromMatrixColumn(Q,0),se.crossVectors(n.object.up,se)),se.multiplyScalar(De),y.add(se)}})(),de=(()=>{const se=new q;return function(De,Q){const st=n.domElement;if(st&&n.object instanceof Aa&&n.object.isPerspectiveCamera){const be=n.object.position;se.copy(be).sub(n.target);let Be=se.length();Be*=Math.tan(n.object.fov/2*Math.PI/180),ye(2*De*Be/st.clientHeight,n.object.matrix),pe(2*Q*Be/st.clientHeight,n.object.matrix)}else st&&n.object instanceof Kc&&n.object.isOrthographicCamera?(ye(De*(n.object.right-n.object.left)/n.object.zoom/st.clientWidth,n.object.matrix),pe(Q*(n.object.top-n.object.bottom)/n.object.zoom/st.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function Oe(se){n.object instanceof Aa&&n.object.isPerspectiveCamera||n.object instanceof Kc&&n.object.isOrthographicCamera?m=se:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function We(se){Oe(m/se)}function ke(se){Oe(m*se)}function $e(se){if(!n.zoomToCursor||!n.domElement)return;E=!0;const Re=n.domElement.getBoundingClientRect(),De=se.clientX-Re.left,Q=se.clientY-Re.top,st=Re.width,be=Re.height;k.x=De/st*2-1,k.y=-(Q/be)*2+1,L.set(k.x,k.y,1).unproject(n.object).sub(n.object.position).normalize()}function ot(se){return Math.max(n.minDistance,Math.min(n.maxDistance,se))}function Ne(se){G.set(se.clientX,se.clientY)}function tt(se){$e(se),N.set(se.clientX,se.clientY)}function bt(se){Z.set(se.clientX,se.clientY)}function dt(se){w.set(se.clientX,se.clientY),R.subVectors(w,G).multiplyScalar(n.rotateSpeed);const Re=n.domElement;Re&&(Ce(2*Math.PI*R.x/Re.clientHeight),Ge(2*Math.PI*R.y/Re.clientHeight)),G.copy(w),n.update()}function yt(se){K.set(se.clientX,se.clientY),T.subVectors(K,N),T.y>0?We(ie()):T.y<0&&ke(ie()),N.copy(K),n.update()}function zt(se){x.set(se.clientX,se.clientY),W.subVectors(x,Z).multiplyScalar(n.panSpeed),de(W.x,W.y),Z.copy(x),n.update()}function Nt(se){$e(se),se.deltaY<0?ke(ie()):se.deltaY>0&&We(ie()),n.update()}function Lt(se){let Re=!1;switch(se.code){case n.keys.UP:de(0,n.keyPanSpeed),Re=!0;break;case n.keys.BOTTOM:de(0,-n.keyPanSpeed),Re=!0;break;case n.keys.LEFT:de(n.keyPanSpeed,0),Re=!0;break;case n.keys.RIGHT:de(-n.keyPanSpeed,0),Re=!0;break}Re&&(se.preventDefault(),n.update())}function Ue(){if(F.length==1)G.set(F[0].pageX,F[0].pageY);else{const se=.5*(F[0].pageX+F[1].pageX),Re=.5*(F[0].pageY+F[1].pageY);G.set(se,Re)}}function Pe(){if(F.length==1)Z.set(F[0].pageX,F[0].pageY);else{const se=.5*(F[0].pageX+F[1].pageX),Re=.5*(F[0].pageY+F[1].pageY);Z.set(se,Re)}}function te(){const se=F[0].pageX-F[1].pageX,Re=F[0].pageY-F[1].pageY,De=Math.sqrt(se*se+Re*Re);N.set(0,De)}function Gt(){n.enableZoom&&te(),n.enablePan&&Pe()}function Qe(){n.enableZoom&&te(),n.enableRotate&&Ue()}function ht(se){if(F.length==1)w.set(se.pageX,se.pageY);else{const De=Me(se),Q=.5*(se.pageX+De.x),st=.5*(se.pageY+De.y);w.set(Q,st)}R.subVectors(w,G).multiplyScalar(n.rotateSpeed);const Re=n.domElement;Re&&(Ce(2*Math.PI*R.x/Re.clientHeight),Ge(2*Math.PI*R.y/Re.clientHeight)),G.copy(w)}function Ct(se){if(F.length==1)x.set(se.pageX,se.pageY);else{const Re=Me(se),De=.5*(se.pageX+Re.x),Q=.5*(se.pageY+Re.y);x.set(De,Q)}W.subVectors(x,Z).multiplyScalar(n.panSpeed),de(W.x,W.y),Z.copy(x)}function Tt(se){const Re=Me(se),De=se.pageX-Re.x,Q=se.pageY-Re.y,st=Math.sqrt(De*De+Q*Q);K.set(0,st),T.set(0,Math.pow(K.y/N.y,n.zoomSpeed)),We(T.y),N.copy(K)}function Rt(se){n.enableZoom&&Tt(se),n.enablePan&&Ct(se)}function $(se){n.enableZoom&&Tt(se),n.enableRotate&&ht(se)}function J(se){var Re,De;n.enabled!==!1&&(F.length===0&&((Re=n.domElement)==null||Re.ownerDocument.addEventListener("pointermove",fe),(De=n.domElement)==null||De.ownerDocument.addEventListener("pointerup",ze)),ue(se),se.pointerType==="touch"?Xt(se):et(se))}function fe(se){n.enabled!==!1&&(se.pointerType==="touch"?An(se):_e(se))}function ze(se){var Re,De,Q;Ve(se),F.length===0&&((Re=n.domElement)==null||Re.releasePointerCapture(se.pointerId),(De=n.domElement)==null||De.ownerDocument.removeEventListener("pointermove",fe),(Q=n.domElement)==null||Q.ownerDocument.removeEventListener("pointerup",ze)),n.dispatchEvent(l),d=u.NONE}function et(se){let Re;switch(se.button){case 0:Re=n.mouseButtons.LEFT;break;case 1:Re=n.mouseButtons.MIDDLE;break;case 2:Re=n.mouseButtons.RIGHT;break;default:Re=-1}switch(Re){case vA.DOLLY:if(n.enableZoom===!1)return;tt(se),d=u.DOLLY;break;case vA.ROTATE:if(se.ctrlKey||se.metaKey||se.shiftKey){if(n.enablePan===!1)return;bt(se),d=u.PAN}else{if(n.enableRotate===!1)return;Ne(se),d=u.ROTATE}break;case vA.PAN:if(se.ctrlKey||se.metaKey||se.shiftKey){if(n.enableRotate===!1)return;Ne(se),d=u.ROTATE}else{if(n.enablePan===!1)return;bt(se),d=u.PAN}break;default:d=u.NONE}d!==u.NONE&&n.dispatchEvent(o)}function _e(se){if(n.enabled!==!1)switch(d){case u.ROTATE:if(n.enableRotate===!1)return;dt(se);break;case u.DOLLY:if(n.enableZoom===!1)return;yt(se);break;case u.PAN:if(n.enablePan===!1)return;zt(se);break}}function At(se){n.enabled===!1||n.enableZoom===!1||d!==u.NONE&&d!==u.ROTATE||(se.preventDefault(),n.dispatchEvent(o),Nt(se),n.dispatchEvent(l))}function Zt(se){n.enabled===!1||n.enablePan===!1||Lt(se)}function Xt(se){switch(qe(se),F.length){case 1:switch(n.touches.ONE){case yA.ROTATE:if(n.enableRotate===!1)return;Ue(),d=u.TOUCH_ROTATE;break;case yA.PAN:if(n.enablePan===!1)return;Pe(),d=u.TOUCH_PAN;break;default:d=u.NONE}break;case 2:switch(n.touches.TWO){case yA.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Gt(),d=u.TOUCH_DOLLY_PAN;break;case yA.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Qe(),d=u.TOUCH_DOLLY_ROTATE;break;default:d=u.NONE}break;default:d=u.NONE}d!==u.NONE&&n.dispatchEvent(o)}function An(se){switch(qe(se),d){case u.TOUCH_ROTATE:if(n.enableRotate===!1)return;ht(se),n.update();break;case u.TOUCH_PAN:if(n.enablePan===!1)return;Ct(se),n.update();break;case u.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Rt(se),n.update();break;case u.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;$(se),n.update();break;default:d=u.NONE}}function j(se){n.enabled!==!1&&se.preventDefault()}function ue(se){F.push(se)}function Ve(se){delete U[se.pointerId];for(let Re=0;Re<F.length;Re++)if(F[Re].pointerId==se.pointerId){F.splice(Re,1);return}}function qe(se){let Re=U[se.pointerId];Re===void 0&&(Re=new ut,U[se.pointerId]=Re),Re.set(se.pageX,se.pageY)}function Me(se){const Re=se.pointerId===F[0].pointerId?F[1]:F[0];return U[Re.pointerId]}this.dollyIn=(se=ie())=>{ke(se),n.update()},this.dollyOut=(se=ie())=>{We(se),n.update()},this.getScale=()=>m,this.setScale=se=>{Oe(se),n.update()},this.getZoomScale=()=>ie(),t!==void 0&&this.connect(t),this.update()}};function Iw(s){if(typeof TextDecoder<"u")return new TextDecoder().decode(s);let e="";for(let t=0,n=s.length;t<n;t++)e+=String.fromCharCode(s[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const XA="srgb",xI="srgb-linear",gT=3001,X4=3e3;class UH extends Ko{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new K4(t)}),this.register(function(t){return new L4(t)}),this.register(function(t){return new Q4(t)}),this.register(function(t){return new j4(t)}),this.register(function(t){return new q4(t)}),this.register(function(t){return new _4(t)}),this.register(function(t){return new D4(t)}),this.register(function(t){return new k4(t)}),this.register(function(t){return new U4(t)}),this.register(function(t){return new E4(t)}),this.register(function(t){return new J4(t)}),this.register(function(t){return new z4(t)}),this.register(function(t){return new P4(t)}),this.register(function(t){return new O4(t)}),this.register(function(t){return new Y4(t)}),this.register(function(t){return new $4(t)}),this.register(function(t){return new e7(t)})}load(e,t,n,a){const o=this;let l;if(this.resourcePath!=="")l=this.resourcePath;else if(this.path!==""){const C=oC.extractUrlBase(e);l=oC.resolveURL(C,this.path)}else l=oC.extractUrlBase(e);this.manager.itemStart(e);const u=function(C){a?a(C):console.error(C),o.manager.itemError(e),o.manager.itemEnd(e)},d=new Al(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(C){try{o.parse(C,l,function(A){t(A),o.manager.itemEnd(e)},u)}catch(A){u(A)}},n,u)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,a){let o;const l={},u={};if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(Iw(new Uint8Array(e.slice(0,4)))===w9){try{l[ci.KHR_BINARY_GLTF]=new t7(e)}catch(A){a&&a(A);return}o=JSON.parse(l[ci.KHR_BINARY_GLTF].content)}else o=JSON.parse(Iw(new Uint8Array(e)));else o=e;if(o.asset===void 0||o.asset.version[0]<2){a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new C7(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let C=0;C<this.pluginCallbacks.length;C++){const A=this.pluginCallbacks[C](d);A.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),u[A.name]=A,l[A.name]=!0}if(o.extensionsUsed)for(let C=0;C<o.extensionsUsed.length;++C){const A=o.extensionsUsed[C],p=o.extensionsRequired||[];switch(A){case ci.KHR_MATERIALS_UNLIT:l[A]=new T4;break;case ci.KHR_DRACO_MESH_COMPRESSION:l[A]=new n7(o,this.dracoLoader);break;case ci.KHR_TEXTURE_TRANSFORM:l[A]=new i7;break;case ci.KHR_MESH_QUANTIZATION:l[A]=new a7;break;default:p.indexOf(A)>=0&&u[A]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+A+'".')}}d.setExtensions(l),d.setPlugins(u),d.parse(n,a)}parseAsync(e,t){const n=this;return new Promise(function(a,o){n.parse(e,t,a,o)})}}function F4(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const ci={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Y4{constructor(e){this.parser=e,this.name=ci.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,a=t.length;n<a;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let a=t.cache.get(n);if(a)return a;const o=t.json,d=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let C;const A=new $t(16777215);d.color!==void 0&&A.setRGB(d.color[0],d.color[1],d.color[2],xI);const p=d.range!==void 0?d.range:0;switch(d.type){case"directional":C=new FH(A),C.target.position.set(0,0,-1),C.add(C.target);break;case"point":C=new XH(A),C.distance=p;break;case"spot":C=new HH(A),C.distance=p,d.spot=d.spot||{},d.spot.innerConeAngle=d.spot.innerConeAngle!==void 0?d.spot.innerConeAngle:0,d.spot.outerConeAngle=d.spot.outerConeAngle!==void 0?d.spot.outerConeAngle:Math.PI/4,C.angle=d.spot.outerConeAngle,C.penumbra=1-d.spot.innerConeAngle/d.spot.outerConeAngle,C.target.position.set(0,0,-1),C.add(C.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+d.type)}return C.position.set(0,0,0),C.decay=2,mI(C,d),d.intensity!==void 0&&(C.intensity=d.intensity),C.name=t.createUniqueName(d.name||"light_"+e),a=Promise.resolve(C),t.cache.add(n,a),a}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,o=n.json.nodes[e],u=(o.extensions&&o.extensions[this.name]||{}).light;return u===void 0?null:this._loadLight(u).then(function(d){return n._getNodeRef(t.cache,u,d)})}}class T4{constructor(){this.name=ci.KHR_MATERIALS_UNLIT}getMaterialType(){return Cl}extendParams(e,t,n){const a=[];e.color=new $t(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const l=o.baseColorFactor;e.color.setRGB(l[0],l[1],l[2],xI),e.opacity=l[3]}o.baseColorTexture!==void 0&&a.push(n.assignTexture(e,"map",o.baseColorTexture,XA))}return Promise.all(a)}}class E4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const a=this.parser.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=a.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class K4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const n=this.parser,a=n.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=[],l=a.extensions[this.name];if(l.clearcoatFactor!==void 0&&(t.clearcoat=l.clearcoatFactor),l.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",l.clearcoatTexture)),l.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=l.clearcoatRoughnessFactor),l.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",l.clearcoatRoughnessTexture)),l.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",l.clearcoatNormalTexture)),l.clearcoatNormalTexture.scale!==void 0)){const u=l.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ut(u,u)}return Promise.all(o)}}class L4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const a=this.parser.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=a.extensions[this.name];return t.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}}class z4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const n=this.parser,a=n.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=[],l=a.extensions[this.name];return l.iridescenceFactor!==void 0&&(t.iridescence=l.iridescenceFactor),l.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",l.iridescenceTexture)),l.iridescenceIor!==void 0&&(t.iridescenceIOR=l.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),l.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=l.iridescenceThicknessMinimum),l.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=l.iridescenceThicknessMaximum),l.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",l.iridescenceThicknessTexture)),Promise.all(o)}}class _4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const n=this.parser,a=n.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new $t(0,0,0),t.sheenRoughness=0,t.sheen=1;const l=a.extensions[this.name];if(l.sheenColorFactor!==void 0){const u=l.sheenColorFactor;t.sheenColor.setRGB(u[0],u[1],u[2],xI)}return l.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=l.sheenRoughnessFactor),l.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",l.sheenColorTexture,XA)),l.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",l.sheenRoughnessTexture)),Promise.all(o)}}class D4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const n=this.parser,a=n.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=[],l=a.extensions[this.name];return l.transmissionFactor!==void 0&&(t.transmission=l.transmissionFactor),l.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",l.transmissionTexture)),Promise.all(o)}}class k4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const n=this.parser,a=n.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=[],l=a.extensions[this.name];t.thickness=l.thicknessFactor!==void 0?l.thicknessFactor:0,l.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",l.thicknessTexture)),t.attenuationDistance=l.attenuationDistance||1/0;const u=l.attenuationColor||[1,1,1];return t.attenuationColor=new $t().setRGB(u[0],u[1],u[2],xI),Promise.all(o)}}class U4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const a=this.parser.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=a.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class J4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const n=this.parser,a=n.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=[],l=a.extensions[this.name];t.specularIntensity=l.specularFactor!==void 0?l.specularFactor:1,l.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",l.specularTexture));const u=l.specularColorFactor||[1,1,1];return t.specularColor=new $t().setRGB(u[0],u[1],u[2],xI),l.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",l.specularColorTexture,XA)),Promise.all(o)}}class O4{constructor(e){this.parser=e,this.name=ci.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const n=this.parser,a=n.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=[],l=a.extensions[this.name];return t.bumpScale=l.bumpFactor!==void 0?l.bumpFactor:1,l.bumpTexture!==void 0&&o.push(n.assignTexture(t,"bumpMap",l.bumpTexture)),Promise.all(o)}}class P4{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:zl}extendMaterialParams(e,t){const n=this.parser,a=n.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const o=[],l=a.extensions[this.name];return l.anisotropyStrength!==void 0&&(t.anisotropy=l.anisotropyStrength),l.anisotropyRotation!==void 0&&(t.anisotropyRotation=l.anisotropyRotation),l.anisotropyTexture!==void 0&&o.push(n.assignTexture(t,"anisotropyMap",l.anisotropyTexture)),Promise.all(o)}}class Q4{constructor(e){this.parser=e,this.name=ci.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,a=n.textures[e];if(!a.extensions||!a.extensions[this.name])return null;const o=a.extensions[this.name],l=t.options.ktx2Loader;if(!l){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,l)}}class j4{constructor(e){this.parser=e,this.name=ci.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,a=n.json,o=a.textures[e];if(!o.extensions||!o.extensions[t])return null;const l=o.extensions[t],u=a.images[l.source];let d=n.textureLoader;if(u.uri){const C=n.options.manager.getHandler(u.uri);C!==null&&(d=C)}return this.detectSupport().then(function(C){if(C)return n.loadTextureImage(e,l.source,d);if(a.extensionsRequired&&a.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class q4{constructor(e){this.parser=e,this.name=ci.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,a=n.json,o=a.textures[e];if(!o.extensions||!o.extensions[t])return null;const l=o.extensions[t],u=a.images[l.source];let d=n.textureLoader;if(u.uri){const C=n.options.manager.getHandler(u.uri);C!==null&&(d=C)}return this.detectSupport().then(function(C){if(C)return n.loadTextureImage(e,l.source,d);if(a.extensionsRequired&&a.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class $4{constructor(e){this.name=ci.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const a=n.extensions[this.name],o=this.parser.getDependency("buffer",a.buffer),l=this.parser.options.meshoptDecoder;if(!l||!l.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(u){const d=a.byteOffset||0,C=a.byteLength||0,A=a.count,p=a.byteStride,m=new Uint8Array(u,d,C);return l.decodeGltfBufferAsync?l.decodeGltfBufferAsync(A,p,m,a.mode,a.filter).then(function(y){return y.buffer}):l.ready.then(function(){const y=new ArrayBuffer(A*p);return l.decodeGltfBuffer(new Uint8Array(y),A,p,m,a.mode,a.filter),y})})}else return null}}class e7{constructor(e){this.name=ci.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const a=t.meshes[n.mesh];for(const C of a.primitives)if(C.mode!==Tl.TRIANGLES&&C.mode!==Tl.TRIANGLE_STRIP&&C.mode!==Tl.TRIANGLE_FAN&&C.mode!==void 0)return null;const l=n.extensions[this.name].attributes,u=[],d={};for(const C in l)u.push(this.parser.getDependency("accessor",l[C]).then(A=>(d[C]=A,d[C])));return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then(C=>{const A=C.pop(),p=A.isGroup?A.children:[A],m=C[0].count,y=[];for(const G of p){const w=new Sn,R=new q,Z=new Ir,x=new q(1,1,1),W=new KA(G.geometry,G.material,m);for(let N=0;N<m;N++)d.TRANSLATION&&R.fromBufferAttribute(d.TRANSLATION,N),d.ROTATION&&Z.fromBufferAttribute(d.ROTATION,N),d.SCALE&&x.fromBufferAttribute(d.SCALE,N),W.setMatrixAt(N,w.compose(R,Z,x));for(const N in d)if(N==="_COLOR_0"){const K=d[N];W.instanceColor=new UA(K.array,K.itemSize,K.normalized)}else N!=="TRANSLATION"&&N!=="ROTATION"&&N!=="SCALE"&&G.geometry.setAttribute(N,d[N]);gi.prototype.copy.call(W,G),this.parser.assignFinalMaterial(W),y.push(W)}return A.isGroup?(A.clear(),A.add(...y),A):y[0]}))}}const w9="glTF",J0=12,uT={JSON:1313821514,BIN:5130562};class t7{constructor(e){this.name=ci.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,J0);if(this.header={magic:Iw(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==w9)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-J0,a=new DataView(e,J0);let o=0;for(;o<n;){const l=a.getUint32(o,!0);o+=4;const u=a.getUint32(o,!0);if(o+=4,u===uT.JSON){const d=new Uint8Array(e,J0+o,l);this.content=Iw(d)}else if(u===uT.BIN){const d=J0+o;this.body=e.slice(d,d+l)}o+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class n7{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ci.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,a=this.dracoLoader,o=e.extensions[this.name].bufferView,l=e.extensions[this.name].attributes,u={},d={},C={};for(const A in l){const p=HN[A]||A.toLowerCase();u[p]=l[A]}for(const A in e.attributes){const p=HN[A]||A.toLowerCase();if(l[A]!==void 0){const m=n.accessors[e.attributes[A]],y=ib[m.componentType];C[p]=y.name,d[p]=m.normalized===!0}}return t.getDependency("bufferView",o).then(function(A){return new Promise(function(p,m){a.decodeDracoFile(A,function(y){for(const G in y.attributes){const w=y.attributes[G],R=d[G];R!==void 0&&(w.normalized=R)}p(y)},u,C,xI,m)})})}}class i7{constructor(){this.name=ci.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class a7{constructor(){this.name=ci.KHR_MESH_QUANTIZATION}}class x9 extends mb{constructor(e,t,n,a){super(e,t,n,a)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=e*a*3+a;for(let l=0;l!==a;l++)t[l]=n[o+l];return t}interpolate_(e,t,n,a){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=u*2,C=u*3,A=a-t,p=(n-t)/A,m=p*p,y=m*p,G=e*C,w=G-C,R=-2*y+3*m,Z=y-m,x=1-R,W=Z-m+p;for(let N=0;N!==u;N++){const K=l[w+N+u],T=l[w+N+d]*A,L=l[G+N+u],k=l[G+N]*A;o[N]=x*K+W*T+R*L+Z*k}return o}}const r7=new Ir;class o7 extends x9{interpolate_(e,t,n,a){const o=super.interpolate_(e,t,n,a);return r7.fromArray(o).normalize().toArray(o),o}}const Tl={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ib={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},IT={9728:_r,9729:er,9984:vw,9985:tb,9986:xA,9987:Ll},dT={33071:dl,33648:rb,10497:lC},$M={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},HN={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...S4>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},aC={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},s7={CUBICSPLINE:void 0,LINEAR:lb,STEP:sb},eN={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function l7(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new HG({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:iu})),s.DefaultMaterial}function bA(s,e,t){for(const n in t.extensions)s[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function mI(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function c7(s,e,t){let n=!1,a=!1,o=!1;for(let C=0,A=e.length;C<A;C++){const p=e[C];if(p.POSITION!==void 0&&(n=!0),p.NORMAL!==void 0&&(a=!0),p.COLOR_0!==void 0&&(o=!0),n&&a&&o)break}if(!n&&!a&&!o)return Promise.resolve(s);const l=[],u=[],d=[];for(let C=0,A=e.length;C<A;C++){const p=e[C];if(n){const m=p.POSITION!==void 0?t.getDependency("accessor",p.POSITION):s.attributes.position;l.push(m)}if(a){const m=p.NORMAL!==void 0?t.getDependency("accessor",p.NORMAL):s.attributes.normal;u.push(m)}if(o){const m=p.COLOR_0!==void 0?t.getDependency("accessor",p.COLOR_0):s.attributes.color;d.push(m)}}return Promise.all([Promise.all(l),Promise.all(u),Promise.all(d)]).then(function(C){const A=C[0],p=C[1],m=C[2];return n&&(s.morphAttributes.position=A),a&&(s.morphAttributes.normal=p),o&&(s.morphAttributes.color=m),s.morphTargetsRelative=!0,s})}function g7(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,a=t.length;n<a;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function u7(s){let e;const t=s.extensions&&s.extensions[ci.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+tN(t.attributes):e=s.indices+":"+tN(s.attributes)+":"+s.mode,s.targets!==void 0)for(let n=0,a=s.targets.length;n<a;n++)e+=":"+tN(s.targets[n]);return e}function tN(s){let e="";const t=Object.keys(s).sort();for(let n=0,a=t.length;n<a;n++)e+=t[n]+":"+s[t[n]]+";";return e}function XN(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function I7(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const d7=new Sn;class C7{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new F4,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,a=!1,o=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,o=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||a&&o<98?this.textureLoader=new _K(this.options.manager):this.textureLoader=new jK(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Al(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,a=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(l){return l._markDefs&&l._markDefs()}),Promise.all(this._invokeAll(function(l){return l.beforeRoot&&l.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(l){const u={scene:l[0][a.scene||0],scenes:l[0],animations:l[1],cameras:l[2],asset:a.asset,parser:n,userData:{}};return bA(o,u,a),mI(u,a),Promise.all(n._invokeAll(function(d){return d.afterRoot&&d.afterRoot(u)})).then(function(){for(const d of u.scenes)d.updateMatrixWorld();e(u)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let a=0,o=t.length;a<o;a++){const l=t[a].joints;for(let u=0,d=l.length;u<d;u++)e[l[u]].isBone=!0}for(let a=0,o=e.length;a<o;a++){const l=e[a];l.mesh!==void 0&&(this._addNodeRef(this.meshCache,l.mesh),l.skin!==void 0&&(n[l.mesh].isSkinnedMesh=!0)),l.camera!==void 0&&this._addNodeRef(this.cameraCache,l.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const a=n.clone(),o=(l,u)=>{const d=this.associations.get(l);d!=null&&this.associations.set(u,d);for(const[C,A]of l.children.entries())o(A,u.children[C])};return o(n,a),a.name+="_instance_"+e.uses[t]++,a}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const a=e(t[n]);if(a)return a}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let a=0;a<t.length;a++){const o=e(t[a]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let a=this.cache.get(n);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":a=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":a=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":a=this.loadSkin(t);break;case"animation":a=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":a=this.loadCamera(t);break;default:if(a=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!a)throw new Error("Unknown type: "+e);break}this.cache.add(n,a)}return a}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,a=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(a.map(function(o,l){return n.getDependency(e,l)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ci.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(o,l){n.load(oC.resolveURL(t.uri,a.path),o,void 0,function(){l(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const a=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+a)})}loadAccessor(e){const t=this,n=this.json,a=this.json.accessors[e];if(a.bufferView===void 0&&a.sparse===void 0){const l=$M[a.type],u=ib[a.componentType],d=a.normalized===!0,C=new u(a.count*l);return Promise.resolve(new Ri(C,l,d))}const o=[];return a.bufferView!==void 0?o.push(this.getDependency("bufferView",a.bufferView)):o.push(null),a.sparse!==void 0&&(o.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(o).then(function(l){const u=l[0],d=$M[a.type],C=ib[a.componentType],A=C.BYTES_PER_ELEMENT,p=A*d,m=a.byteOffset||0,y=a.bufferView!==void 0?n.bufferViews[a.bufferView].byteStride:void 0,G=a.normalized===!0;let w,R;if(y&&y!==p){const Z=Math.floor(m/y),x="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+Z+":"+a.count;let W=t.cache.get(x);W||(w=new C(u,Z*y,a.count*y/A),W=new xG(w,y/A),t.cache.add(x,W)),R=new cC(W,d,m%y/A,G)}else u===null?w=new C(a.count*d):w=new C(u,m,a.count*d),R=new Ri(w,d,G);if(a.sparse!==void 0){const Z=$M.SCALAR,x=ib[a.sparse.indices.componentType],W=a.sparse.indices.byteOffset||0,N=a.sparse.values.byteOffset||0,K=new x(l[1],W,a.sparse.count*Z),T=new C(l[2],N,a.sparse.count*d);u!==null&&(R=new Ri(R.array.slice(),R.itemSize,R.normalized));for(let L=0,k=K.length;L<k;L++){const E=K[L];if(R.setX(E,T[L*d]),d>=2&&R.setY(E,T[L*d+1]),d>=3&&R.setZ(E,T[L*d+2]),d>=4&&R.setW(E,T[L*d+3]),d>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return R})}loadTexture(e){const t=this.json,n=this.options,o=t.textures[e].source,l=t.images[o];let u=this.textureLoader;if(l.uri){const d=n.manager.getHandler(l.uri);d!==null&&(u=d)}return this.loadTextureImage(e,o,u)}loadTextureImage(e,t,n){const a=this,o=this.json,l=o.textures[e],u=o.images[t],d=(u.uri||u.bufferView)+":"+l.sampler;if(this.textureCache[d])return this.textureCache[d];const C=this.loadImageSource(t,n).then(function(A){A.flipY=!1,A.name=l.name||u.name||"",A.name===""&&typeof u.uri=="string"&&u.uri.startsWith("data:image/")===!1&&(A.name=u.uri);const m=(o.samplers||{})[l.sampler]||{};return A.magFilter=IT[m.magFilter]||er,A.minFilter=IT[m.minFilter]||Ll,A.wrapS=dT[m.wrapS]||lC,A.wrapT=dT[m.wrapT]||lC,a.associations.set(A,{textures:e}),A}).catch(function(){return null});return this.textureCache[d]=C,C}loadImageSource(e,t){const n=this,a=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(p=>p.clone());const l=a.images[e],u=self.URL||self.webkitURL;let d=l.uri||"",C=!1;if(l.bufferView!==void 0)d=n.getDependency("bufferView",l.bufferView).then(function(p){C=!0;const m=new Blob([p],{type:l.mimeType});return d=u.createObjectURL(m),d});else if(l.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const A=Promise.resolve(d).then(function(p){return new Promise(function(m,y){let G=m;t.isImageBitmapLoader===!0&&(G=function(w){const R=new fa(w);R.needsUpdate=!0,m(R)}),t.load(oC.resolveURL(p,o.path),G,void 0,y)})}).then(function(p){return C===!0&&u.revokeObjectURL(d),mI(p,l),p.userData.mimeType=l.mimeType||I7(l.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),p});return this.sourceCache[e]=A,A}assignTexture(e,t,n,a){const o=this;return this.getDependency("texture",n.index).then(function(l){if(!l)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(l=l.clone(),l.channel=n.texCoord),o.extensions[ci.KHR_TEXTURE_TRANSFORM]){const u=n.extensions!==void 0?n.extensions[ci.KHR_TEXTURE_TRANSFORM]:void 0;if(u){const d=o.associations.get(l);l=o.extensions[ci.KHR_TEXTURE_TRANSFORM].extendTexture(l,u),o.associations.set(l,d)}}return a!==void 0&&(typeof a=="number"&&(a=a===gT?XA:xI),"colorSpace"in l?l.colorSpace=a:l.encoding=a===XA?gT:X4),e[t]=l,l})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const a=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,l=t.attributes.normal===void 0;if(e.isPoints){const u="PointsMaterial:"+n.uuid;let d=this.cache.get(u);d||(d=new Hw,Zr.prototype.copy.call(d,n),d.color.copy(n.color),d.map=n.map,d.sizeAttenuation=!1,this.cache.add(u,d)),n=d}else if(e.isLine){const u="LineBasicMaterial:"+n.uuid;let d=this.cache.get(u);d||(d=new Eo,Zr.prototype.copy.call(d,n),d.color.copy(n.color),d.map=n.map,this.cache.add(u,d)),n=d}if(a||o||l){let u="ClonedMaterial:"+n.uuid+":";a&&(u+="derivative-tangents:"),o&&(u+="vertex-colors:"),l&&(u+="flat-shading:");let d=this.cache.get(u);d||(d=n.clone(),o&&(d.vertexColors=!0),l&&(d.flatShading=!0),a&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(u,d),this.associations.set(d,this.associations.get(n))),n=d}e.material=n}getMaterialType(){return HG}loadMaterial(e){const t=this,n=this.json,a=this.extensions,o=n.materials[e];let l;const u={},d=o.extensions||{},C=[];if(d[ci.KHR_MATERIALS_UNLIT]){const p=a[ci.KHR_MATERIALS_UNLIT];l=p.getMaterialType(),C.push(p.extendParams(u,o,t))}else{const p=o.pbrMetallicRoughness||{};if(u.color=new $t(1,1,1),u.opacity=1,Array.isArray(p.baseColorFactor)){const m=p.baseColorFactor;u.color.setRGB(m[0],m[1],m[2],xI),u.opacity=m[3]}p.baseColorTexture!==void 0&&C.push(t.assignTexture(u,"map",p.baseColorTexture,XA)),u.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,u.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(C.push(t.assignTexture(u,"metalnessMap",p.metallicRoughnessTexture)),C.push(t.assignTexture(u,"roughnessMap",p.metallicRoughnessTexture))),l=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),C.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,u)})))}o.doubleSided===!0&&(u.side=Kl);const A=o.alphaMode||eN.OPAQUE;if(A===eN.BLEND?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,A===eN.MASK&&(u.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&l!==Cl&&(C.push(t.assignTexture(u,"normalMap",o.normalTexture)),u.normalScale=new ut(1,1),o.normalTexture.scale!==void 0)){const p=o.normalTexture.scale;u.normalScale.set(p,p)}if(o.occlusionTexture!==void 0&&l!==Cl&&(C.push(t.assignTexture(u,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(u.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&l!==Cl){const p=o.emissiveFactor;u.emissive=new $t().setRGB(p[0],p[1],p[2],xI)}return o.emissiveTexture!==void 0&&l!==Cl&&C.push(t.assignTexture(u,"emissiveMap",o.emissiveTexture,XA)),Promise.all(C).then(function(){const p=new l(u);return o.name&&(p.name=o.name),mI(p,o),t.associations.set(p,{materials:e}),o.extensions&&bA(a,p,o),p})}createUniqueName(e){const t=Bi.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,a=this.primitiveCache;function o(u){return n[ci.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(u,t).then(function(d){return CT(d,u,t)})}const l=[];for(let u=0,d=e.length;u<d;u++){const C=e[u],A=u7(C),p=a[A];if(p)l.push(p.promise);else{let m;C.extensions&&C.extensions[ci.KHR_DRACO_MESH_COMPRESSION]?m=o(C):m=CT(new Ln,C,t),a[A]={primitive:C,promise:m},l.push(m)}}return Promise.all(l)}loadMesh(e){const t=this,n=this.json,a=this.extensions,o=n.meshes[e],l=o.primitives,u=[];for(let d=0,C=l.length;d<C;d++){const A=l[d].material===void 0?l7(this.cache):this.getDependency("material",l[d].material);u.push(A)}return u.push(t.loadGeometries(l)),Promise.all(u).then(function(d){const C=d.slice(0,d.length-1),A=d[d.length-1],p=[];for(let y=0,G=A.length;y<G;y++){const w=A[y],R=l[y];let Z;const x=C[y];if(R.mode===Tl.TRIANGLES||R.mode===Tl.TRIANGLE_STRIP||R.mode===Tl.TRIANGLE_FAN||R.mode===void 0)Z=o.isSkinnedMesh===!0?new bH(w,x):new tr(w,x),Z.isSkinnedMesh===!0&&Z.normalizeSkinWeights(),R.mode===Tl.TRIANGLE_STRIP?Z.geometry=sT(Z.geometry,sH):R.mode===Tl.TRIANGLE_FAN&&(Z.geometry=sT(Z.geometry,ow));else if(R.mode===Tl.LINES)Z=new Dc(w,x);else if(R.mode===Tl.LINE_STRIP)Z=new MI(w,x);else if(R.mode===Tl.LINE_LOOP)Z=new vH(w,x);else if(R.mode===Tl.POINTS)Z=new yH(w,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+R.mode);Object.keys(Z.geometry.morphAttributes).length>0&&g7(Z,o),Z.name=t.createUniqueName(o.name||"mesh_"+e),mI(Z,o),R.extensions&&bA(a,Z,R),t.assignFinalMaterial(Z),p.push(Z)}for(let y=0,G=p.length;y<G;y++)t.associations.set(p[y],{meshes:e,primitives:y});if(p.length===1)return o.extensions&&bA(a,p[0],o),p[0];const m=new GI;o.extensions&&bA(a,m,o),t.associations.set(m,{meshes:e});for(let y=0,G=p.length;y<G;y++)m.add(p[y]);return m})}loadCamera(e){let t;const n=this.json.cameras[e],a=n[n.type];if(!a){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Aa(gH.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):n.type==="orthographic"&&(t=new Kc(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),mI(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let a=0,o=t.joints.length;a<o;a++)n.push(this._loadNodeShallow(t.joints[a]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(a){const o=a.pop(),l=a,u=[],d=[];for(let C=0,A=l.length;C<A;C++){const p=l[C];if(p){u.push(p);const m=new Sn;o!==null&&m.fromArray(o.array,C*16),d.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[C])}return new WG(u,d)})}loadAnimation(e){const t=this.json,n=this,a=t.animations[e],o=a.name?a.name:"animation_"+e,l=[],u=[],d=[],C=[],A=[];for(let p=0,m=a.channels.length;p<m;p++){const y=a.channels[p],G=a.samplers[y.sampler],w=y.target,R=w.node,Z=a.parameters!==void 0?a.parameters[G.input]:G.input,x=a.parameters!==void 0?a.parameters[G.output]:G.output;w.node!==void 0&&(l.push(this.getDependency("node",R)),u.push(this.getDependency("accessor",Z)),d.push(this.getDependency("accessor",x)),C.push(G),A.push(w))}return Promise.all([Promise.all(l),Promise.all(u),Promise.all(d),Promise.all(C),Promise.all(A)]).then(function(p){const m=p[0],y=p[1],G=p[2],w=p[3],R=p[4],Z=[];for(let x=0,W=m.length;x<W;x++){const N=m[x],K=y[x],T=G[x],L=w[x],k=R[x];if(N===void 0)continue;N.updateMatrix&&N.updateMatrix();const E=n._createAnimationTracks(N,K,T,L,k);if(E)for(let F=0;F<E.length;F++)Z.push(E[F])}return new ub(o,void 0,Z)})}createNodeMesh(e){const t=this.json,n=this,a=t.nodes[e];return a.mesh===void 0?null:n.getDependency("mesh",a.mesh).then(function(o){const l=n._getNodeRef(n.meshCache,a.mesh,o);return a.weights!==void 0&&l.traverse(function(u){if(u.isMesh)for(let d=0,C=a.weights.length;d<C;d++)u.morphTargetInfluences[d]=a.weights[d]}),l})}loadNode(e){const t=this.json,n=this,a=t.nodes[e],o=n._loadNodeShallow(e),l=[],u=a.children||[];for(let C=0,A=u.length;C<A;C++)l.push(n.getDependency("node",u[C]));const d=a.skin===void 0?Promise.resolve(null):n.getDependency("skin",a.skin);return Promise.all([o,Promise.all(l),d]).then(function(C){const A=C[0],p=C[1],m=C[2];m!==null&&A.traverse(function(y){y.isSkinnedMesh&&y.bind(m,d7)});for(let y=0,G=p.length;y<G;y++)A.add(p[y]);return A})}_loadNodeShallow(e){const t=this.json,n=this.extensions,a=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],l=o.name?a.createUniqueName(o.name):"",u=[],d=a._invokeOne(function(C){return C.createNodeMesh&&C.createNodeMesh(e)});return d&&u.push(d),o.camera!==void 0&&u.push(a.getDependency("camera",o.camera).then(function(C){return a._getNodeRef(a.cameraCache,o.camera,C)})),a._invokeAll(function(C){return C.createNodeAttachment&&C.createNodeAttachment(e)}).forEach(function(C){u.push(C)}),this.nodeCache[e]=Promise.all(u).then(function(C){let A;if(o.isBone===!0?A=new Nw:C.length>1?A=new GI:C.length===1?A=C[0]:A=new gi,A!==C[0])for(let p=0,m=C.length;p<m;p++)A.add(C[p]);if(o.name&&(A.userData.name=o.name,A.name=l),mI(A,o),o.extensions&&bA(n,A,o),o.matrix!==void 0){const p=new Sn;p.fromArray(o.matrix),A.applyMatrix4(p)}else o.translation!==void 0&&A.position.fromArray(o.translation),o.rotation!==void 0&&A.quaternion.fromArray(o.rotation),o.scale!==void 0&&A.scale.fromArray(o.scale);return a.associations.has(A)||a.associations.set(A,{}),a.associations.get(A).nodes=e,A}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],a=this,o=new GI;n.name&&(o.name=a.createUniqueName(n.name)),mI(o,n),n.extensions&&bA(t,o,n);const l=n.nodes||[],u=[];for(let d=0,C=l.length;d<C;d++)u.push(a.getDependency("node",l[d]));return Promise.all(u).then(function(d){for(let A=0,p=d.length;A<p;A++)o.add(d[A]);const C=A=>{const p=new Map;for(const[m,y]of a.associations)(m instanceof Zr||m instanceof fa)&&p.set(m,y);return A.traverse(m=>{const y=a.associations.get(m);y!=null&&p.set(m,y)}),p};return a.associations=C(o),o})}_createAnimationTracks(e,t,n,a,o){const l=[],u=e.name?e.name:e.uuid,d=[];aC[o.path]===aC.weights?e.traverse(function(m){m.morphTargetInfluences&&d.push(m.name?m.name:m.uuid)}):d.push(u);let C;switch(aC[o.path]){case aC.weights:C=OA;break;case aC.rotation:C=PA;break;case aC.position:case aC.scale:C=QA;break;default:switch(n.itemSize){case 1:C=OA;break;case 2:case 3:default:C=QA;break}break}const A=a.interpolation!==void 0?s7[a.interpolation]:lb,p=this._getArrayFromAccessor(n);for(let m=0,y=d.length;m<y;m++){const G=new C(d[m]+"."+aC[o.path],t.array,p,A);a.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(G),l.push(G)}return l}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=XN(t.constructor),a=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o++)a[o]=t[o]*n;t=a}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const a=this instanceof PA?o7:x9;return new a(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function h7(s,e,t){const n=e.attributes,a=new ho;if(n.POSITION!==void 0){const u=t.json.accessors[n.POSITION],d=u.min,C=u.max;if(d!==void 0&&C!==void 0){if(a.set(new q(d[0],d[1],d[2]),new q(C[0],C[1],C[2])),u.normalized){const A=XN(ib[u.componentType]);a.min.multiplyScalar(A),a.max.multiplyScalar(A)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const u=new q,d=new q;for(let C=0,A=o.length;C<A;C++){const p=o[C];if(p.POSITION!==void 0){const m=t.json.accessors[p.POSITION],y=m.min,G=m.max;if(y!==void 0&&G!==void 0){if(d.setX(Math.max(Math.abs(y[0]),Math.abs(G[0]))),d.setY(Math.max(Math.abs(y[1]),Math.abs(G[1]))),d.setZ(Math.max(Math.abs(y[2]),Math.abs(G[2]))),m.normalized){const w=XN(ib[m.componentType]);d.multiplyScalar(w)}u.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(u)}s.boundingBox=a;const l=new Ao;a.getCenter(l.center),l.radius=a.min.distanceTo(a.max)/2,s.boundingSphere=l}function CT(s,e,t){const n=e.attributes,a=[];function o(l,u){return t.getDependency("accessor",l).then(function(d){s.setAttribute(u,d)})}for(const l in n){const u=HN[l]||l.toLowerCase();u in s.attributes||a.push(o(n[l],u))}if(e.indices!==void 0&&!s.index){const l=t.getDependency("accessor",e.indices).then(function(u){s.setIndex(u)});a.push(l)}return mI(s,e),h7(s,e,t),Promise.all(a).then(function(){return e.targets!==void 0?c7(s,e.targets,t):s})}const nN=new WeakMap;class A7 extends Ko{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,a){const o=new Al(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,l=>{const u={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(l,u).then(t).catch(a)},n,a)}decodeDracoFile(e,t,n,a){const o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:a||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,o).then(t)}decodeGeometry(e,t){for(const d in t.attributeTypes){const C=t.attributeTypes[d];C.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[d]=C.name)}const n=JSON.stringify(t);if(nN.has(e)){const d=nN.get(e);if(d.key===n)return d.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let a;const o=this.workerNextTaskID++,l=e.byteLength,u=this._getWorker(o,l).then(d=>(a=d,new Promise((C,A)=>{a._callbacks[o]={resolve:C,reject:A},a.postMessage({type:"decode",id:o,taskConfig:t,buffer:e},[e])}))).then(d=>this._createGeometry(d.geometry));return u.catch(()=>!0).then(()=>{a&&o&&this._releaseTask(a,o)}),nN.set(e,{key:n,promise:u}),u}_createGeometry(e){const t=new Ln;e.index&&t.setIndex(new Ri(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const a=e.attributes[n],o=a.name,l=a.array,u=a.itemSize;t.setAttribute(o,new Ri(l,u))}return t}_loadLibrary(e,t){const n=new Al(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((a,o)=>{n.load(e,a,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const a=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const o=f7.toString(),l=["/* draco decoder */",a,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const a=new Worker(this.workerSourceURL);a._callbacks={},a._taskCosts={},a._taskLoad=0,a.postMessage({type:"init",decoderConfig:this.decoderConfig}),a.onmessage=function(o){const l=o.data;switch(l.type){case"decode":a._callbacks[l.id].resolve(l);break;case"error":a._callbacks[l.id].reject(l);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+l.type+'"')}},this.workerPool.push(a)}else this.workerPool.sort(function(a,o){return a._taskLoad>o._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function f7(){let s,e;onmessage=function(l){const u=l.data;switch(u.type){case"init":s=u.decoderConfig,e=new Promise(function(A){s.onModuleLoaded=function(p){A({draco:p})},DracoDecoderModule(s)});break;case"decode":const d=u.buffer,C=u.taskConfig;e.then(A=>{const p=A.draco,m=new p.Decoder,y=new p.DecoderBuffer;y.Init(new Int8Array(d),d.byteLength);try{const G=t(p,m,y,C),w=G.attributes.map(R=>R.array.buffer);G.index&&w.push(G.index.array.buffer),self.postMessage({type:"decode",id:u.id,geometry:G},w)}catch(G){console.error(G),self.postMessage({type:"error",id:u.id,error:G.message})}finally{p.destroy(y),p.destroy(m)}});break}};function t(l,u,d,C){const A=C.attributeIDs,p=C.attributeTypes;let m,y;const G=u.GetEncodedGeometryType(d);if(G===l.TRIANGULAR_MESH)m=new l.Mesh,y=u.DecodeBufferToMesh(d,m);else if(G===l.POINT_CLOUD)m=new l.PointCloud,y=u.DecodeBufferToPointCloud(d,m);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!y.ok()||m.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const w={index:null,attributes:[]};for(const R in A){const Z=self[p[R]];let x,W;if(C.useUniqueIDs)W=A[R],x=u.GetAttributeByUniqueId(m,W);else{if(W=u.GetAttributeId(m,l[A[R]]),W===-1)continue;x=u.GetAttribute(m,W)}w.attributes.push(a(l,u,m,R,Z,x))}return G===l.TRIANGULAR_MESH&&(w.index=n(l,u,m)),l.destroy(m),w}function n(l,u,d){const A=d.num_faces()*3,p=A*4,m=l._malloc(p);u.GetTrianglesUInt32Array(d,p,m);const y=new Uint32Array(l.HEAPF32.buffer,m,A).slice();return l._free(m),{array:y,itemSize:1}}function a(l,u,d,C,A,p){const m=p.num_components(),G=d.num_points()*m,w=G*A.BYTES_PER_ELEMENT,R=o(l,A),Z=l._malloc(w);u.GetAttributeDataArrayForAllPoints(d,p,R,w,Z);const x=new A(l.HEAPF32.buffer,Z,G).slice();return l._free(Z),{name:C,array:x,itemSize:m}}function o(l,u){switch(u){case Float32Array:return l.DT_FLOAT32;case Int8Array:return l.DT_INT8;case Int16Array:return l.DT_INT16;case Int32Array:return l.DT_INT32;case Uint8Array:return l.DT_UINT8;case Uint16Array:return l.DT_UINT16;case Uint32Array:return l.DT_UINT32}}}let uR;const iN=()=>{if(uR)return uR;const s="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let a=s;WebAssembly.validate(t)&&(a=e);let o;const l=WebAssembly.instantiate(u(a),{}).then(p=>{o=p.instance,o.exports.__wasm_call_ctors()});function u(p){const m=new Uint8Array(p.length);for(let G=0;G<p.length;++G){const w=p.charCodeAt(G);m[G]=w>96?w-71:w>64?w-65:w>47?w+4:w>46?63:62}let y=0;for(let G=0;G<p.length;++G)m[y++]=m[G]<60?n[m[G]]:(m[G]-60)*64+m[++G];return m.buffer.slice(0,y)}function d(p,m,y,G,w,R){const Z=o.exports.sbrk,x=y+3&-4,W=Z(x*G),N=Z(w.length),K=new Uint8Array(o.exports.memory.buffer);K.set(w,N);const T=p(W,y,G,N,w.length);if(T===0&&R&&R(W,x,G),m.set(K.subarray(W,W+y*G)),Z(W-Z(0)),T!==0)throw new Error(`Malformed buffer data: ${T}`)}const C={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},A={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return uR={ready:l,supported:!0,decodeVertexBuffer(p,m,y,G,w){d(o.exports.meshopt_decodeVertexBuffer,p,m,y,G,o.exports[C[w]])},decodeIndexBuffer(p,m,y,G){d(o.exports.meshopt_decodeIndexBuffer,p,m,y,G)},decodeIndexSequence(p,m,y,G){d(o.exports.meshopt_decodeIndexSequence,p,m,y,G)},decodeGltfBuffer(p,m,y,G,w,R){d(o.exports[A[w]],p,m,y,G,o.exports[C[R]])}},uR};let IR=null,W9="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function V9(s=!0,e=!0,t){return n=>{t&&t(n),s&&(IR||(IR=new A7),IR.setDecoderPath(typeof s=="string"?s:W9),n.setDRACOLoader(IR)),e&&n.setMeshoptDecoder(typeof iN=="function"?iN():iN)}}const bb=(s,e,t,n)=>FG(UH,s,V9(e,t,n));bb.preload=(s,e,t,n)=>FG.preload(UH,s,V9(e,t,n));bb.clear=s=>FG.clear(UH,s);bb.setDecoderPath=s=>{W9=s};const $w=Fe.forwardRef(({makeDefault:s,camera:e,regress:t,domElement:n,enableDamping:a=!0,keyEvents:o=!1,onChange:l,onStart:u,onEnd:d,...C},A)=>{const p=Tc(T=>T.invalidate),m=Tc(T=>T.camera),y=Tc(T=>T.gl),G=Tc(T=>T.events),w=Tc(T=>T.setEvents),R=Tc(T=>T.set),Z=Tc(T=>T.get),x=Tc(T=>T.performance),W=e||m,N=n||G.connected||y.domElement,K=Fe.useMemo(()=>new H4(W),[W]);return jw(()=>{K.enabled&&K.update()},-1),Fe.useEffect(()=>(o&&K.connect(o===!0?N:o),K.connect(N),()=>void K.dispose()),[o,N,t,K,p]),Fe.useEffect(()=>{const T=E=>{p(),t&&x.regress(),l&&l(E)},L=E=>{u&&u(E)},k=E=>{d&&d(E)};return K.addEventListener("change",T),K.addEventListener("start",L),K.addEventListener("end",k),()=>{K.removeEventListener("start",L),K.removeEventListener("end",k),K.removeEventListener("change",T)}},[l,u,d,K,p,w]),Fe.useEffect(()=>{if(s){const T=Z().controls;return R({controls:K}),()=>R({controls:T})}},[s,K]),Fe.createElement("primitive",uw({ref:A,object:K,enableDamping:a},C))});function M9(s,e=.3){s.updateMatrixWorld(!0);const t=new ho;s.traverse(l=>{if(l.isMesh){l.geometry.computeBoundingBox();const u=l.geometry.boundingBox.clone().applyMatrix4(l.matrixWorld);t.union(u)}});const n=new q;t.getSize(n);const a=e/Math.max(n.x,n.y,n.z);s.scale.setScalar(a),s.updateMatrixWorld(!0);const o=new q;t.getCenter(o),s.position.sub(o.multiplyScalar(a))}function p7({baseType:s}){return s==="circle"?It.jsxDEV("mesh",{children:[It.jsxDEV("torusGeometry",{args:[.8,.1,8,16]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:12,columnNumber:17},this),It.jsxDEV("meshStandardMaterial",{color:"#8B4513"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:13,columnNumber:17},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:11,columnNumber:13},this):s==="line"?It.jsxDEV("mesh",{children:[It.jsxDEV("boxGeometry",{args:[2,.1,.1]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:21,columnNumber:17},this),It.jsxDEV("meshStandardMaterial",{color:"#8B4513"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:22,columnNumber:17},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:20,columnNumber:13},this):s==="dynamicRope"?It.jsxDEV("mesh",{children:[It.jsxDEV("torusGeometry",{args:[.8,.15,6,12]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:30,columnNumber:17},this),It.jsxDEV("meshStandardMaterial",{color:"#CD853F"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:31,columnNumber:17},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:29,columnNumber:13},this):null}function m7({url:s}){const{scene:e}=bb(s),t=e.clone();return M9(t,1),It.jsxDEV("primitive",{object:t},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:47,columnNumber:12},this)}function JH({url:s,baseType:e,name:t,selected:n,onClick:a,isDynamicRope:o,draggable:l}){const[{isDragging:u},d]=PN(()=>({type:o?"BASE_DYNAMIC_ROPE":"MODEL",item:{url:s,baseType:e,name:t},canDrag:l,collect:p=>({isDragging:p.isDragging()})}),[s,e,t,l]),C={width:100,height:100,border:n?"3px solid #4CAF50":"2px solid #333",borderRadius:8,cursor:"pointer",background:"#1a1a1a",opacity:u?.5:1,display:"flex",flexDirection:"column",alignItems:"center",padding:4},A=It.jsxDEV("div",{style:C,onClick:a,children:[It.jsxDEV("div",{style:{width:"100%",height:70,position:"relative"},children:It.jsxDEV(qw,{camera:{position:[0,0,3],fov:50},style:{width:"100%",height:"100%"},children:[It.jsxDEV("ambientLight",{intensity:.5},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:93,columnNumber:21},this),It.jsxDEV("directionalLight",{position:[2,2,2],intensity:1},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:94,columnNumber:21},this),It.jsxDEV(Fe.Suspense,{fallback:null,children:s?It.jsxDEV(m7,{url:s},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:98,columnNumber:29},this):It.jsxDEV(p7,{baseType:e},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:100,columnNumber:29},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:96,columnNumber:21},this),It.jsxDEV($w,{enableZoom:!1,enablePan:!1,autoRotate:!0,autoRotateSpeed:2},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:104,columnNumber:21},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:89,columnNumber:17},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:88,columnNumber:13},this),It.jsxDEV("div",{style:{color:"#fff",fontSize:11,textAlign:"center",marginTop:4,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:112,columnNumber:13},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:87,columnNumber:9},this);return l?It.jsxDEV("div",{ref:d,children:A},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/ModelThumbnail.tsx",lineNumber:127,columnNumber:24},this):A}function b7({models:s,onSelect:e,selectedType:t}){return It.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"18px",justifyContent:"center",alignItems:"center",padding:"4px 0"},children:s.map(n=>It.jsxDEV(JH,{baseType:n.type,name:n.name,selected:t===n.type,onClick:()=>e(n.type),isDynamicRope:n.type==="dynamicRope",draggable:n.draggable},n.type,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/BasePanel.tsx",lineNumber:15,columnNumber:17},this))},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/BasePanel.tsx",lineNumber:6,columnNumber:9},this)}function v7({model:s}){const[{isDragging:e},t]=PN(()=>({type:"STONE",item:{url:s.url,name:s.name},collect:n=>({isDragging:!!n.isDragging()})}));return It.jsxDEV("div",{ref:t,style:{opacity:e?.5:1},children:It.jsxDEV(JH,{url:s.url,name:s.name},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/StonePanel.tsx",lineNumber:15,columnNumber:13},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/StonePanel.tsx",lineNumber:14,columnNumber:9},this)}function y7({models:s}){return It.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"16px",justifyItems:"center"},children:s.map(e=>It.jsxDEV(v7,{model:e},e.url,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/StonePanel.tsx",lineNumber:29,columnNumber:17},this))},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/StonePanel.tsx",lineNumber:22,columnNumber:9},this)}function G7({model:s}){const[{isDragging:e},t]=PN(()=>({type:"UCLUK",item:{url:s.url,name:s.name},collect:n=>({isDragging:!!n.isDragging()})}));return It.jsxDEV("div",{ref:t,style:{opacity:e?.5:1},children:It.jsxDEV(JH,{url:s.url,name:s.name},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/UclukPanel.tsx",lineNumber:15,columnNumber:13},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/UclukPanel.tsx",lineNumber:14,columnNumber:9},this)}function B7({models:s}){return It.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"16px",justifyItems:"center"},children:s.map(e=>It.jsxDEV(G7,{model:e},e.url,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/UclukPanel.tsx",lineNumber:29,columnNumber:17},this))},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/UclukPanel.tsx",lineNumber:22,columnNumber:9},this)}function Z7({baseModels:s,stoneModels:e,uclukModels:t,onBaseSelect:n,onStoneAdd:a,onUclukAdd:o,selectedBaseType:l}){return It.jsxDEV("aside",{style:{width:310,minWidth:210,maxWidth:360,height:"100vh",background:"#23242a",color:"#fff",borderRight:"2px solid #2b2b2b",display:"flex",flexDirection:"column",padding:"0 0 40px 0",gap:0,boxShadow:"4px 0 24px 0 #0d12171a",overflowY:"auto"},children:[It.jsxDEV("div",{style:{padding:"24px 22px 12px 22px"},children:[It.jsxDEV("div",{style:{fontSize:17,fontWeight:700,marginBottom:12,color:"#d1ba7c"},children:"Taban Modelleri"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:126,columnNumber:17},this),It.jsxDEV(b7,{models:s,onSelect:n,selectedType:l},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:132,columnNumber:17},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:125,columnNumber:13},this),It.jsxDEV("div",{style:{padding:"18px 22px 6px 22px"},children:[It.jsxDEV("div",{style:{fontSize:17,fontWeight:700,marginBottom:12,color:"#7cc6f5"},children:"Taş Modelleri"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:139,columnNumber:17},this),It.jsxDEV(y7,{models:e,onAdd:a},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:145,columnNumber:17},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:138,columnNumber:13},this),It.jsxDEV("div",{style:{padding:"18px 22px 6px 22px"},children:[It.jsxDEV("div",{style:{fontSize:17,fontWeight:700,marginBottom:12,color:"#c38aff"},children:"Uç Modelleri"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:151,columnNumber:17},this),It.jsxDEV(B7,{models:t,onAdd:o},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:157,columnNumber:17},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:150,columnNumber:13},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/sidebar/Sidebar.tsx",lineNumber:109,columnNumber:9},this)}const FN=.3;function OH({url:s,position:e,id:t,onRemove:n,rotation:a=[0,0,0],scale:o=[1,1,1]}){const l=Fe.useRef(null),{scene:u}=bb(s),d=Fe.useMemo(()=>{const m=u.clone();return M9(m,FN),m},[u]),[C,A]=LN.useState(!1);jw(m=>{l.current&&C?l.current.position.y=e[1]+Math.sin(m.clock.elapsedTime*3)*.02:l.current&&(l.current.position.y=e[1])});const p=m=>{m.stopPropagation(),n&&n(t)};return It.jsxDEV("group",{ref:l,position:e,rotation:a,scale:o,onPointerOver:m=>{m.stopPropagation(),A(!0),document.body.style.cursor="pointer"},onPointerOut:m=>{m.stopPropagation(),A(!1),document.body.style.cursor="default"},onClick:p,children:[It.jsxDEV("primitive",{object:d},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/StoneMesh.tsx",lineNumber:73,columnNumber:7},this),C&&It.jsxDEV("mesh",{children:[It.jsxDEV("sphereGeometry",{args:[FN*.6,16,16]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/StoneMesh.tsx",lineNumber:78,columnNumber:11},this),It.jsxDEV("meshBasicMaterial",{color:"#00ff00",transparent:!0,opacity:.1,wireframe:!0},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/StoneMesh.tsx",lineNumber:79,columnNumber:11},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/StoneMesh.tsx",lineNumber:77,columnNumber:9},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/StoneMesh.tsx",lineNumber:56,columnNumber:5},this)}function N9({text:s="Model yükleniyor..."}){return It.jsxDEV(Z4,{center:!0,children:It.jsxDEV("div",{style:{color:"#444",background:"#fff8",padding:8,borderRadius:6,textAlign:"center",fontSize:14},children:s},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Loader.tsx",lineNumber:7,columnNumber:13},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Loader.tsx",lineNumber:6,columnNumber:9},this)}function S7(s,e=32){const t=[];for(let n=0;n<e;n++){const a=n/e*Math.PI*2,o=Math.cos(a)*s,l=Math.sin(a)*s;t.push({x:o,y:l,z:0,angle:a,occupied:!1,index:n})}return t}function R7(s,e){let t=-1,n=1/0;const a=new q(e[0],e[1],e[2]);for(let o=0;o<s.length;o++){const l=s[o];if(l.occupied)continue;const u=new q(l.x,l.y,l.z),d=a.distanceTo(u);d<n&&(n=d,t=o)}return t}function w7(s,e){e>=0&&e<s.length&&(s[e].occupied=!0)}function x7(s,e){e>=0&&e<s.length&&(s[e].occupied=!1)}function W7({radius:s=1.5}){const e=[];for(let t=0;t<=64;t++){const n=t/64*Math.PI*2;e.push(new q(Math.cos(n)*s,Math.sin(n)*s,0))}return new Ln().setFromPoints(e),It.jsxDEV("mesh",{children:[It.jsxDEV("torusGeometry",{args:[s,.02,8,100]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:44,columnNumber:7},this),It.jsxDEV("meshBasicMaterial",{color:"#8B4513"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:45,columnNumber:7},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:43,columnNumber:5},this)}function V7({stones:s,onStoneAdd:e,onStoneRemove:t}){const[o,l]=Fe.useState(()=>S7(1.5,32)),u=Fe.useRef(null),d=Fe.useRef(new Map),C=Fe.useCallback((m,y)=>{if(!u.current)return[0,0,0];const G=u.current.getBoundingClientRect(),w=(m-G.left)/G.width*2-1,R=-((y-G.top)/G.height)*2+1,Z=w*2.5,x=R*2.5;return[Z,x,0]},[]),[,A]=pw({accept:"STONE",drop:(m,y)=>{const G=y.getClientOffset();if(!G)return;const w=C(G.x,G.y),R=R7(o,w);if(R===-1){console.warn("Çember üzerinde boş pozisyon bulunamadı");return}const Z=o[R];l(W=>{const N=[...W];return w7(N,R),N});const x=`${m.url}_${Date.now()}_${Math.random()}`;d.current&&d.current.set(x,R),e({url:m.url,position:[Z.x,Z.y,Z.z+.1]})}}),p=Fe.useCallback(m=>{const y=d.current.get(m);y!==void 0&&(l(G=>{const w=[...G];return x7(w,y),w}),d.current.delete(m)),t(m)},[t]);return It.jsxDEV("div",{ref:m=>{m&&(u.current=m,A(m))},style:{width:"100%",height:"100%"},children:It.jsxDEV(qw,{camera:{position:[0,0,5],fov:50},style:{width:"100%",height:"100%"},children:[It.jsxDEV("ambientLight",{intensity:.5},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:154,columnNumber:9},this),It.jsxDEV("directionalLight",{position:[10,10,5],intensity:1},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:155,columnNumber:9},this),It.jsxDEV("directionalLight",{position:[-10,-10,-5],intensity:.3},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:156,columnNumber:9},this),It.jsxDEV(LN.Suspense,{fallback:It.jsxDEV(N9,{},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:158,columnNumber:35},this),children:[It.jsxDEV(W7,{radius:1.5},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:160,columnNumber:11},this),s.map(m=>It.jsxDEV(OH,{url:m.url,position:m.position,id:m.id,onRemove:p,rotation:[0,0,0]},m.id,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:164,columnNumber:13},this))]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:158,columnNumber:9},this),It.jsxDEV($w,{enablePan:!1},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:176,columnNumber:9},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:150,columnNumber:7},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/BraceletCanvas.tsx",lineNumber:141,columnNumber:5},this)}function M7(s,e=20,t=.3){const n=[];for(let a=0;a<e;a++){const l=((e===1?.5:a/(e-1))-.5)*s;n.push({x:l,y:0,z:0,occupied:!1,index:a})}return n}function N7(s,e){let t=-1,n=1/0;const a=new q(e[0],e[1],e[2]);for(let o=0;o<s.length;o++){const l=s[o];if(l.occupied)continue;const u=new q(l.x,l.y,l.z),d=a.distanceTo(u);d<n&&(n=d,t=o)}return t}function H7(s,e){e>=0&&e<s.length&&(s[e].occupied=!0)}function X7(s,e){e>=0&&e<s.length&&(s[e].occupied=!1)}function F7({length:s=4}){const e=[new q(-s/2,0,0),new q(s/2,0,0)];return new Ln().setFromPoints(e),It.jsxDEV("mesh",{children:[It.jsxDEV("boxGeometry",{args:[s,.05,.05]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:39,columnNumber:7},this),It.jsxDEV("meshBasicMaterial",{color:"#8B4513"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:40,columnNumber:7},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:38,columnNumber:5},this)}function Y7({stones:s,onStoneAdd:e,onStoneRemove:t}){const[o,l]=Fe.useState(()=>M7(4,FN,20)),u=Fe.useRef(null),d=Fe.useRef(new Map),C=Fe.useCallback((m,y)=>{if(!u.current)return[0,0,0];const G=u.current.getBoundingClientRect(),w=(m-G.left)/G.width*2-1,R=-((y-G.top)/G.height)*2+1,Z=w*2.5,x=R*2.5;return[Z,x,0]},[]),[,A]=pw({accept:"STONE",drop:(m,y)=>{const G=y.getClientOffset();if(!G)return;const w=C(G.x,G.y),R=N7(o,w);if(R===-1){console.warn("İp üzerinde boş pozisyon bulunamadı");return}const Z=o[R];l(W=>{const N=[...W];return H7(N,R),N});const x=`${m.url}_${Date.now()}_${Math.random()}`;d.current.set(x,R),e({url:m.url,position:[Z.x,Z.y+.1,Z.z]})}}),p=Fe.useCallback(m=>{const y=d.current.get(m);y!==void 0&&(l(G=>{const w=[...G];return X7(w,y),w}),d.current.delete(m)),t(m)},[t]);return It.jsxDEV("div",{ref:m=>{m&&(u.current=m,A(m))},style:{width:"100%",height:"100%"},children:It.jsxDEV(qw,{camera:{position:[0,0,5],fov:50},style:{width:"100%",height:"100%"},children:[It.jsxDEV("ambientLight",{intensity:.5},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:147,columnNumber:9},this),It.jsxDEV("directionalLight",{position:[10,10,5],intensity:1},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:148,columnNumber:9},this),It.jsxDEV("directionalLight",{position:[-10,-10,-5],intensity:.3},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:149,columnNumber:9},this),It.jsxDEV(LN.Suspense,{fallback:It.jsxDEV(N9,{},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:151,columnNumber:35},this),children:[It.jsxDEV(F7,{length:4},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:153,columnNumber:11},this),s.map(m=>It.jsxDEV(OH,{url:m.url,position:m.position,id:m.id,onRemove:p,rotation:[0,0,0]},m.id,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:157,columnNumber:13},this))]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:151,columnNumber:9},this),It.jsxDEV($w,{enablePan:!1},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:168,columnNumber:9},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:143,columnNumber:7},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/RopeCanvas.tsx",lineNumber:134,columnNumber:5},this)}function T7({baseType:s,stones:e,ucluks:t,onStoneAdd:n,onStoneRemove:a,onUclukAdd:o,onUclukRemove:l}){return s==="circle"?It.jsxDEV(V7,{stones:e,onStoneAdd:n,onStoneRemove:a},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/MultiStoneCanvas.tsx",lineNumber:35,columnNumber:13},this):s==="line"?It.jsxDEV(Y7,{stones:e,onStoneAdd:n,onStoneRemove:a},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/MultiStoneCanvas.tsx",lineNumber:45,columnNumber:13},this):It.jsxDEV("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0",color:"#666"},children:["Bilinmeyen taban tipi: ",s]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/MultiStoneCanvas.tsx",lineNumber:55,columnNumber:9},this)}var PH={exports:{}},ab=typeof Reflect=="object"?Reflect:null,hT=ab&&typeof ab.apply=="function"?ab.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},GR;ab&&typeof ab.ownKeys=="function"?GR=ab.ownKeys:Object.getOwnPropertySymbols?GR=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:GR=function(e){return Object.getOwnPropertyNames(e)};function E7(s){console&&console.warn&&console.warn(s)}var H9=Number.isNaN||function(e){return e!==e};function ji(){ji.init.call(this)}PH.exports=ji;PH.exports.once=_7;ji.EventEmitter=ji;ji.prototype._events=void 0;ji.prototype._eventsCount=0;ji.prototype._maxListeners=void 0;var AT=10;function ex(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(ji,"defaultMaxListeners",{enumerable:!0,get:function(){return AT},set:function(s){if(typeof s!="number"||s<0||H9(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");AT=s}});ji.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ji.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||H9(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function X9(s){return s._maxListeners===void 0?ji.defaultMaxListeners:s._maxListeners}ji.prototype.getMaxListeners=function(){return X9(this)};ji.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var a=e==="error",o=this._events;if(o!==void 0)a=a&&o.error===void 0;else if(!a)return!1;if(a){var l;if(t.length>0&&(l=t[0]),l instanceof Error)throw l;var u=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw u.context=l,u}var d=o[e];if(d===void 0)return!1;if(typeof d=="function")hT(d,this,t);else for(var C=d.length,A=K9(d,C),n=0;n<C;++n)hT(A[n],this,t);return!0};function F9(s,e,t,n){var a,o,l;if(ex(t),o=s._events,o===void 0?(o=s._events=Object.create(null),s._eventsCount=0):(o.newListener!==void 0&&(s.emit("newListener",e,t.listener?t.listener:t),o=s._events),l=o[e]),l===void 0)l=o[e]=t,++s._eventsCount;else if(typeof l=="function"?l=o[e]=n?[t,l]:[l,t]:n?l.unshift(t):l.push(t),a=X9(s),a>0&&l.length>a&&!l.warned){l.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=s,u.type=e,u.count=l.length,E7(u)}return s}ji.prototype.addListener=function(e,t){return F9(this,e,t,!1)};ji.prototype.on=ji.prototype.addListener;ji.prototype.prependListener=function(e,t){return F9(this,e,t,!0)};function K7(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Y9(s,e,t){var n={fired:!1,wrapFn:void 0,target:s,type:e,listener:t},a=K7.bind(n);return a.listener=t,n.wrapFn=a,a}ji.prototype.once=function(e,t){return ex(t),this.on(e,Y9(this,e,t)),this};ji.prototype.prependOnceListener=function(e,t){return ex(t),this.prependListener(e,Y9(this,e,t)),this};ji.prototype.removeListener=function(e,t){var n,a,o,l,u;if(ex(t),a=this._events,a===void 0)return this;if(n=a[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,l=n.length-1;l>=0;l--)if(n[l]===t||n[l].listener===t){u=n[l].listener,o=l;break}if(o<0)return this;o===0?n.shift():L7(n,o),n.length===1&&(a[e]=n[0]),a.removeListener!==void 0&&this.emit("removeListener",e,u||t)}return this};ji.prototype.off=ji.prototype.removeListener;ji.prototype.removeAllListeners=function(e){var t,n,a;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),l;for(a=0;a<o.length;++a)l=o[a],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this};function T9(s,e,t){var n=s._events;if(n===void 0)return[];var a=n[e];return a===void 0?[]:typeof a=="function"?t?[a.listener||a]:[a]:t?z7(a):K9(a,a.length)}ji.prototype.listeners=function(e){return T9(this,e,!0)};ji.prototype.rawListeners=function(e){return T9(this,e,!1)};ji.listenerCount=function(s,e){return typeof s.listenerCount=="function"?s.listenerCount(e):E9.call(s,e)};ji.prototype.listenerCount=E9;function E9(s){var e=this._events;if(e!==void 0){var t=e[s];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}ji.prototype.eventNames=function(){return this._eventsCount>0?GR(this._events):[]};function K9(s,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=s[n];return t}function L7(s,e){for(;e+1<s.length;e++)s[e]=s[e+1];s.pop()}function z7(s){for(var e=new Array(s.length),t=0;t<e.length;++t)e[t]=s[t].listener||s[t];return e}function _7(s,e){return new Promise(function(t,n){function a(l){s.removeListener(e,o),n(l)}function o(){typeof s.removeListener=="function"&&s.removeListener("error",a),t([].slice.call(arguments))}L9(s,e,o,{once:!0}),e!=="error"&&D7(s,a,{once:!0})})}function D7(s,e,t){typeof s.on=="function"&&L9(s,"error",e,t)}function L9(s,e,t,n){if(typeof s.on=="function")n.once?s.once(e,t):s.on(e,t);else if(typeof s.addEventListener=="function")s.addEventListener(e,function a(o){n.once&&s.removeEventListener(e,a),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var k7=PH.exports;function U7(s,e){var t=atob(s);return t}function J7(s,e,t){var n=U7(s),a=n.indexOf(`
`,10)+1,o=n.substring(a)+"",l=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(l)}function O7(s,e,t){var n;return function(o){return n=n||J7(s),new Worker(n,o)}}var P7=O7("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK");class Q7 extends k7{constructor(t){let{allowSleep:n=!1,axisIndex:a=0,broadphase:o="Naive",defaultContactMaterial:l={contactEquationStiffness:1e6},frictionGravity:u=null,gravity:d=[0,-9.81,0],iterations:C=5,quatNormalizeFast:A=!1,quatNormalizeSkip:p=0,size:m=1e3,solver:y="GS",tolerance:G=.001}=t;super();OV(this,"messageQueue",[]);OV(this,"worker",null);this.config={allowSleep:n,axisIndex:a,broadphase:o,defaultContactMaterial:l,frictionGravity:u,gravity:d,iterations:C,quatNormalizeFast:A,quatNormalizeSkip:p,size:m,solver:y,tolerance:G},this.buffers={positions:new Float32Array(m*3),quaternions:new Float32Array(m*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(t){this.config.axisIndex=t,this.postMessage({op:"setAxisIndex",props:t})}get broadphase(){return this.config.broadphase}set broadphase(t){this.config.broadphase=t,this.postMessage({op:"setBroadphase",props:t})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(t){this.config.frictionGravity=t,this.postMessage({op:"setFrictionGravity",props:t})}get gravity(){return this.config.gravity}set gravity(t){this.config.gravity=t,this.postMessage({op:"setGravity",props:t})}get iterations(){return this.config.iterations}set iterations(t){this.config.iterations=t,this.postMessage({op:"setIterations",props:t})}get tolerance(){return this.config.tolerance}set tolerance(t){this.config.tolerance=t,this.postMessage({op:"setTolerance",props:t})}addBodies(t){let{props:n,type:a,uuid:o}=t;this.postMessage({op:"addBodies",props:n,type:a,uuid:o})}addConstraint(t){let{props:[n,a,o],type:l,uuid:u}=t;this.postMessage({op:"addConstraint",props:[n,a,o],type:l,uuid:u})}addContactMaterial(t){let{props:n,uuid:a}=t;this.postMessage({op:"addContactMaterial",props:n,uuid:a})}addRay(t){let{props:n,uuid:a}=t;this.postMessage({op:"addRay",props:n,uuid:a})}addRaycastVehicle(t){let{props:[n,a,o,l,u,d],uuid:C}=t;this.postMessage({op:"addRaycastVehicle",props:[n,a,o,l,u,d],uuid:C})}addSpring(t){let{props:[n,a,o],uuid:l}=t;this.postMessage({op:"addSpring",props:[n,a,o],uuid:l})}applyForce(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyForce",props:n,uuid:a})}applyImpulse(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyImpulse",props:n,uuid:a})}applyLocalForce(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyLocalForce",props:n,uuid:a})}applyLocalImpulse(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyLocalImpulse",props:n,uuid:a})}applyRaycastVehicleEngineForce(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyRaycastVehicleEngineForce",props:n,uuid:a})}applyTorque(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyTorque",props:n,uuid:a})}connect(){this.worker=new P7,this.worker.onmessage=t=>{if(t.data.op==="frame"){this.buffers.positions=t.data.positions,this.buffers.quaternions=t.data.quaternions,this.emit(t.data.op,t.data);return}this.emit(t.data.type,t.data)};for(const t of this.messageQueue)this.worker.postMessage(t);this.messageQueue.length=0}disableConstraint(t){let{uuid:n}=t;this.postMessage({op:"disableConstraint",uuid:n})}disableConstraintMotor(t){let{uuid:n}=t;this.postMessage({op:"disableConstraintMotor",uuid:n})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(t){let{uuid:n}=t;this.postMessage({op:"enableConstraint",uuid:n})}enableConstraintMotor(t){let{uuid:n}=t;this.postMessage({op:"enableConstraintMotor",uuid:n})}init(){const{allowSleep:t,axisIndex:n,broadphase:a,defaultContactMaterial:o,frictionGravity:l,gravity:u,iterations:d,quatNormalizeFast:C,quatNormalizeSkip:A,solver:p,tolerance:m}=this.config;this.postMessage({op:"init",props:{allowSleep:t,axisIndex:n,broadphase:a,defaultContactMaterial:o,frictionGravity:l,gravity:u,iterations:d,quatNormalizeFast:C,quatNormalizeSkip:A,solver:p,tolerance:m}})}removeBodies(t){let{uuid:n}=t;this.postMessage({op:"removeBodies",uuid:n})}removeConstraint(t){let{uuid:n}=t;this.postMessage({op:"removeConstraint",uuid:n})}removeContactMaterial(t){let{uuid:n}=t;this.postMessage({op:"removeContactMaterial",uuid:n})}removeRay(t){let{uuid:n}=t;this.postMessage({op:"removeRay",uuid:n})}removeRaycastVehicle(t){let{uuid:n}=t;this.postMessage({op:"removeRaycastVehicle",uuid:n})}removeSpring(t){let{uuid:n}=t;this.postMessage({op:"removeSpring",uuid:n})}setAllowSleep(t){let{props:n,uuid:a}=t;this.postMessage({op:"setAllowSleep",props:n,uuid:a})}setAngularDamping(t){let{props:n,uuid:a}=t;this.postMessage({op:"setAngularDamping",props:n,uuid:a})}setAngularFactor(t){let{props:n,uuid:a}=t;this.postMessage({op:"setAngularFactor",props:n,uuid:a})}setAngularVelocity(t){let{props:n,uuid:a}=t;this.postMessage({op:"setAngularVelocity",props:n,uuid:a})}setCollisionFilterGroup(t){let{props:n,uuid:a}=t;this.postMessage({op:"setCollisionFilterGroup",props:n,uuid:a})}setCollisionFilterMask(t){let{props:n,uuid:a}=t;this.postMessage({op:"setCollisionFilterMask",props:n,uuid:a})}setCollisionResponse(t){let{props:n,uuid:a}=t;this.postMessage({op:"setCollisionResponse",props:n,uuid:a})}setConstraintMotorMaxForce(t){let{props:n,uuid:a}=t;this.postMessage({op:"setConstraintMotorMaxForce",props:n,uuid:a})}setConstraintMotorSpeed(t){let{props:n,uuid:a}=t;this.postMessage({op:"setConstraintMotorSpeed",props:n,uuid:a})}setFixedRotation(t){let{props:n,uuid:a}=t;this.postMessage({op:"setFixedRotation",props:n,uuid:a})}setIsTrigger(t){let{props:n,uuid:a}=t;this.postMessage({op:"setIsTrigger",props:n,uuid:a})}setLinearDamping(t){let{props:n,uuid:a}=t;this.postMessage({op:"setLinearDamping",props:n,uuid:a})}setLinearFactor(t){let{props:n,uuid:a}=t;this.postMessage({op:"setLinearFactor",props:n,uuid:a})}setMass(t){let{props:n,uuid:a}=t;this.postMessage({op:"setMass",props:n,uuid:a})}setMaterial(t){let{props:n,uuid:a}=t;this.postMessage({op:"setMaterial",props:n,uuid:a})}setPosition(t){let{props:n,uuid:a}=t;this.postMessage({op:"setPosition",props:n,uuid:a})}setQuaternion(t){let{props:[n,a,o,l],uuid:u}=t;this.postMessage({op:"setQuaternion",props:[n,a,o,l],uuid:u})}setRaycastVehicleBrake(t){let{props:n,uuid:a}=t;this.postMessage({op:"setRaycastVehicleBrake",props:n,uuid:a})}setRaycastVehicleSteeringValue(t){let{props:n,uuid:a}=t;this.postMessage({op:"setRaycastVehicleSteeringValue",props:n,uuid:a})}setRotation(t){let{props:n,uuid:a}=t;this.postMessage({op:"setRotation",props:n,uuid:a})}setSleepSpeedLimit(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSleepSpeedLimit",props:n,uuid:a})}setSleepTimeLimit(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSleepTimeLimit",props:n,uuid:a})}setSpringDamping(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSpringDamping",props:n,uuid:a})}setSpringRestLength(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSpringRestLength",props:n,uuid:a})}setSpringStiffness(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSpringStiffness",props:n,uuid:a})}setUserData(t){let{props:n,uuid:a}=t;this.postMessage({op:"setUserData",props:n,uuid:a})}setVelocity(t){let{props:n,uuid:a}=t;this.postMessage({op:"setVelocity",props:n,uuid:a})}sleep(t){let{uuid:n}=t;this.postMessage({op:"sleep",uuid:n})}step(t){var n;const{buffers:{positions:a,quaternions:o}}=this;!a.byteLength&&!o.byteLength||(n=this.worker)==null||n.postMessage({op:"step",positions:a,props:t,quaternions:o},[a.buffer,o.buffer])}subscribe(t){let{props:{id:n,target:a,type:o},uuid:l}=t;this.postMessage({op:"subscribe",props:{id:n,target:a,type:o},uuid:l})}terminate(){var t;(t=this.worker)==null||t.terminate(),this.worker=null}unsubscribe(t){let{props:n}=t;this.postMessage({op:"unsubscribe",props:n})}wakeUp(t){let{uuid:n}=t;this.postMessage({op:"wakeUp",uuid:n})}postMessage(t){if(this.worker)return this.worker.postMessage(t);this.messageQueue.push(t)}}class ZI{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ae);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ae);const n=this.elements,a=e.x,o=e.y,l=e.z;return t.x=n[0]*a+n[1]*o+n[2]*l,t.y=n[3]*a+n[4]*o+n[5]*l,t.z=n[6]*a+n[7]*o+n[8]*l,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new ZI);const n=this.elements,a=e.elements,o=t.elements,l=n[0],u=n[1],d=n[2],C=n[3],A=n[4],p=n[5],m=n[6],y=n[7],G=n[8],w=a[0],R=a[1],Z=a[2],x=a[3],W=a[4],N=a[5],K=a[6],T=a[7],L=a[8];return o[0]=l*w+u*x+d*K,o[1]=l*R+u*W+d*T,o[2]=l*Z+u*N+d*L,o[3]=C*w+A*x+p*K,o[4]=C*R+A*W+p*T,o[5]=C*Z+A*N+p*L,o[6]=m*w+y*x+G*K,o[7]=m*R+y*W+G*T,o[8]=m*Z+y*N+G*L,t}scale(e,t){t===void 0&&(t=new ZI);const n=this.elements,a=t.elements;for(let o=0;o!==3;o++)a[3*o+0]=e.x*n[3*o+0],a[3*o+1]=e.y*n[3*o+1],a[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new ae);const n=3,a=4,o=[];let l,u;for(l=0;l<n*a;l++)o.push(0);for(l=0;l<3;l++)for(u=0;u<3;u++)o[l+a*u]=this.elements[l+3*u];o[3+4*0]=e.x,o[3+4*1]=e.y,o[3+4*2]=e.z;let d=3;const C=d;let A;const p=4;let m;do{if(l=C-d,o[l+a*l]===0){for(u=l+1;u<C;u++)if(o[l+a*u]!==0){A=p;do m=p-A,o[m+a*l]+=o[m+a*u];while(--A);break}}if(o[l+a*l]!==0)for(u=l+1;u<C;u++){const y=o[l+a*u]/o[l+a*l];A=p;do m=p-A,o[m+a*u]=m<=l?0:o[m+a*u]-o[m+a*l]*y;while(--A)}}while(--d);if(t.z=o[2*a+3]/o[2*a+2],t.y=(o[1*a+3]-o[1*a+2]*t.z)/o[1*a+1],t.x=(o[0*a+3]-o[0*a+2]*t.z-o[0*a+1]*t.y)/o[0*a+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new ZI);const t=3,n=6,a=j7;let o,l;for(o=0;o<3;o++)for(l=0;l<3;l++)a[o+n*l]=this.elements[o+3*l];a[3+6*0]=1,a[3+6*1]=0,a[3+6*2]=0,a[4+6*0]=0,a[4+6*1]=1,a[4+6*2]=0,a[5+6*0]=0,a[5+6*1]=0,a[5+6*2]=1;let u=3;const d=u;let C;const A=n;let p;do{if(o=d-u,a[o+n*o]===0){for(l=o+1;l<d;l++)if(a[o+n*l]!==0){C=A;do p=A-C,a[p+n*o]+=a[p+n*l];while(--C);break}}if(a[o+n*o]!==0)for(l=o+1;l<d;l++){const m=a[o+n*l]/a[o+n*o];C=A;do p=A-C,a[p+n*l]=p<=o?0:a[p+n*l]-a[p+n*o]*m;while(--C)}}while(--u);o=2;do{l=o-1;do{const m=a[o+n*l]/a[o+n*o];C=n;do p=n-C,a[p+n*l]=a[p+n*l]-a[p+n*o]*m;while(--C)}while(l--)}while(--o);o=2;do{const m=1/a[o+n*o];C=n;do p=n-C,a[p+n*o]=a[p+n*o]*m;while(--C)}while(o--);o=2;do{l=2;do{if(p=a[t+l+n*o],isNaN(p)||p===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,l,p)}while(l--)}while(o--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,a=e.z,o=e.w,l=t+t,u=n+n,d=a+a,C=t*l,A=t*u,p=t*d,m=n*u,y=n*d,G=a*d,w=o*l,R=o*u,Z=o*d,x=this.elements;return x[3*0+0]=1-(m+G),x[3*0+1]=A-Z,x[3*0+2]=p+R,x[3*1+0]=A+Z,x[3*1+1]=1-(C+G),x[3*1+2]=y-w,x[3*2+0]=p-R,x[3*2+1]=y+w,x[3*2+2]=1-(C+m),this}transpose(e){e===void 0&&(e=new ZI);const t=this.elements,n=e.elements;let a;return n[0]=t[0],n[4]=t[4],n[8]=t[8],a=t[1],n[1]=t[3],n[3]=a,a=t[2],n[2]=t[6],n[6]=a,a=t[5],n[5]=t[7],n[7]=a,e}}const j7=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ae{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new ae);const n=e.x,a=e.y,o=e.z,l=this.x,u=this.y,d=this.z;return t.x=u*o-d*a,t.y=d*n-l*o,t.z=l*a-u*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new ae(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new ae(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new ZI([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,a=Math.sqrt(e*e+t*t+n*n);if(a>0){const o=1/a;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return a}unit(e){e===void 0&&(e=new ae);const t=this.x,n=this.y,a=this.z;let o=Math.sqrt(t*t+n*n+a*a);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=a*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,a=this.z,o=e.x,l=e.y,u=e.z;return Math.sqrt((o-t)*(o-t)+(l-n)*(l-n)+(u-a)*(u-a))}distanceSquared(e){const t=this.x,n=this.y,a=this.z,o=e.x,l=e.y,u=e.z;return(o-t)*(o-t)+(l-n)*(l-n)+(u-a)*(u-a)}scale(e,t){t===void 0&&(t=new ae);const n=this.x,a=this.y,o=this.z;return t.x=e*n,t.y=e*a,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new ae),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new ae),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ae),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const a=q7,o=1/n;a.set(this.x*o,this.y*o,this.z*o);const l=$7;Math.abs(a.x)<.9?(l.set(1,0,0),a.cross(l,e)):(l.set(0,1,0),a.cross(l,e)),a.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const a=this.x,o=this.y,l=this.z;n.x=a+(e.x-a)*t,n.y=o+(e.y-o)*t,n.z=l+(e.z-l)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(fT),fT.almostEquals(e,t)}clone(){return new ae(this.x,this.y,this.z)}}ae.ZERO=new ae(0,0,0);ae.UNIT_X=new ae(1,0,0);ae.UNIT_Y=new ae(0,1,0);ae.UNIT_Z=new ae(0,0,1);const q7=new ae,$7=new ae,fT=new ae;class _l{constructor(e){e===void 0&&(e={}),this.lowerBound=new ae,this.upperBound=new ae,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,a){const o=this.lowerBound,l=this.upperBound,u=n;o.copy(e[0]),u&&u.vmult(o,o),l.copy(o);for(let d=1;d<e.length;d++){let C=e[d];u&&(u.vmult(C,pT),C=pT),C.x>l.x&&(l.x=C.x),C.x<o.x&&(o.x=C.x),C.y>l.y&&(l.y=C.y),C.y<o.y&&(o.y=C.y),C.z>l.z&&(l.z=C.z),C.z<o.z&&(o.z=C.z)}return t&&(t.vadd(o,o),t.vadd(l,l)),a&&(o.x-=a,o.y-=a,o.z-=a,l.x+=a,l.y+=a,l.z+=a),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new _l().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,a=e.lowerBound,o=e.upperBound,l=a.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,u=a.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,d=a.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return l&&u&&d}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,a=e.lowerBound,o=e.upperBound;return t.x<=a.x&&n.x>=o.x&&t.y<=a.y&&n.y>=o.y&&t.z<=a.z&&n.z>=o.z}getCorners(e,t,n,a,o,l,u,d){const C=this.lowerBound,A=this.upperBound;e.copy(C),t.set(A.x,C.y,C.z),n.set(A.x,A.y,C.z),a.set(C.x,A.y,A.z),o.set(A.x,C.y,A.z),l.set(C.x,A.y,C.z),u.set(C.x,C.y,A.z),d.copy(A)}toLocalFrame(e,t){const n=mT,a=n[0],o=n[1],l=n[2],u=n[3],d=n[4],C=n[5],A=n[6],p=n[7];this.getCorners(a,o,l,u,d,C,A,p);for(let m=0;m!==8;m++){const y=n[m];e.pointToLocal(y,y)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=mT,a=n[0],o=n[1],l=n[2],u=n[3],d=n[4],C=n[5],A=n[6],p=n[7];this.getCorners(a,o,l,u,d,C,A,p);for(let m=0;m!==8;m++){const y=n[m];e.pointToWorld(y,y)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,a=1/t.x,o=1/t.y,l=1/t.z,u=(this.lowerBound.x-n.x)*a,d=(this.upperBound.x-n.x)*a,C=(this.lowerBound.y-n.y)*o,A=(this.upperBound.y-n.y)*o,p=(this.lowerBound.z-n.z)*l,m=(this.upperBound.z-n.z)*l,y=Math.max(Math.max(Math.min(u,d),Math.min(C,A)),Math.min(p,m)),G=Math.min(Math.min(Math.max(u,d),Math.max(C,A)),Math.max(p,m));return!(G<0||y>G)}}const pT=new ae,mT=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae];class as{constructor(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),a===void 0&&(a=1),this.x=e,this.y=t,this.z=n,this.w=a}set(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new ae),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=e8,a=t8;e.tangents(n,a),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new as);const n=this.x,a=this.y,o=this.z,l=this.w,u=e.x,d=e.y,C=e.z,A=e.w;return t.x=n*A+l*u+a*C-o*d,t.y=a*A+l*d+o*u-n*C,t.z=o*A+l*C+n*d-a*u,t.w=l*A-n*u-a*d-o*C,t}inverse(e){e===void 0&&(e=new as);const t=this.x,n=this.y,a=this.z,o=this.w;this.conjugate(e);const l=1/(t*t+n*n+a*a+o*o);return e.x*=l,e.y*=l,e.z*=l,e.w*=l,e}conjugate(e){return e===void 0&&(e=new as),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ae);const n=e.x,a=e.y,o=e.z,l=this.x,u=this.y,d=this.z,C=this.w,A=C*n+u*o-d*a,p=C*a+d*n-l*o,m=C*o+l*a-u*n,y=-l*n-u*a-d*o;return t.x=A*C+y*-l+p*-d-m*-u,t.y=p*C+y*-u+m*-l-A*-d,t.z=m*C+y*-d+A*-u-p*-l,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,a,o;const l=this.x,u=this.y,d=this.z,C=this.w;switch(t){case"YZX":const A=l*u+d*C;if(A>.499&&(n=2*Math.atan2(l,C),a=Math.PI/2,o=0),A<-.499&&(n=-2*Math.atan2(l,C),a=-Math.PI/2,o=0),n===void 0){const p=l*l,m=u*u,y=d*d;n=Math.atan2(2*u*C-2*l*d,1-2*m-2*y),a=Math.asin(2*A),o=Math.atan2(2*l*C-2*u*d,1-2*p-2*y)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=a,e.x=o}setFromEuler(e,t,n,a){a===void 0&&(a="XYZ");const o=Math.cos(e/2),l=Math.cos(t/2),u=Math.cos(n/2),d=Math.sin(e/2),C=Math.sin(t/2),A=Math.sin(n/2);return a==="XYZ"?(this.x=d*l*u+o*C*A,this.y=o*C*u-d*l*A,this.z=o*l*A+d*C*u,this.w=o*l*u-d*C*A):a==="YXZ"?(this.x=d*l*u+o*C*A,this.y=o*C*u-d*l*A,this.z=o*l*A-d*C*u,this.w=o*l*u+d*C*A):a==="ZXY"?(this.x=d*l*u-o*C*A,this.y=o*C*u+d*l*A,this.z=o*l*A+d*C*u,this.w=o*l*u-d*C*A):a==="ZYX"?(this.x=d*l*u-o*C*A,this.y=o*C*u+d*l*A,this.z=o*l*A-d*C*u,this.w=o*l*u+d*C*A):a==="YZX"?(this.x=d*l*u+o*C*A,this.y=o*C*u+d*l*A,this.z=o*l*A-d*C*u,this.w=o*l*u-d*C*A):a==="XZY"&&(this.x=d*l*u-o*C*A,this.y=o*C*u-d*l*A,this.z=o*l*A+d*C*u,this.w=o*l*u+d*C*A),this}clone(){return new as(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new as);const a=this.x,o=this.y,l=this.z,u=this.w;let d=e.x,C=e.y,A=e.z,p=e.w,m,y,G,w,R;return y=a*d+o*C+l*A+u*p,y<0&&(y=-y,d=-d,C=-C,A=-A,p=-p),1-y>1e-6?(m=Math.acos(y),G=Math.sin(m),w=Math.sin((1-t)*m)/G,R=Math.sin(t*m)/G):(w=1-t,R=t),n.x=w*a+R*d,n.y=w*o+R*C,n.z=w*l+R*A,n.w=w*u+R*p,n}integrate(e,t,n,a){a===void 0&&(a=new as);const o=e.x*n.x,l=e.y*n.y,u=e.z*n.z,d=this.x,C=this.y,A=this.z,p=this.w,m=t*.5;return a.x+=m*(o*p+l*A-u*C),a.y+=m*(l*p+u*d-o*A),a.z+=m*(u*p+o*C-l*d),a.w+=m*(-o*d-l*C-u*A),a}}const e8=new ae,t8=new ae,n8={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class pn{constructor(e){e===void 0&&(e={}),this.id=pn.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,a){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}pn.idCounter=0;pn.types=n8;class xs{constructor(e){e===void 0&&(e={}),this.position=new ae,this.quaternion=new as,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return xs.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return xs.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ae),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,a){return a===void 0&&(a=new ae),n.vsub(e,a),t.conjugate(bT),bT.vmult(a,a),a}static pointToWorldFrame(e,t,n,a){return a===void 0&&(a=new ae),t.vmult(n,a),a.vadd(e,a),a}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new ae),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,a){return a===void 0&&(a=new ae),t.w*=-1,t.vmult(n,a),t.w*=-1,a}}const bT=new as;new ae;new ae;new ae;new ae;new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae;new ae;new as;new _l;new ZI;new ZI;new ZI;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new as;new ae;new ae;new ae;new ae;class YN{constructor(){this.rayFromWorld=new ae,this.rayToWorld=new ae,this.hitNormalWorld=new ae,this.hitPointWorld=new ae,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,a,o,l,u){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(a),this.shape=o,this.body=l,this.distance=u}}let z9,_9,D9,k9,U9,J9,O9;const QH={CLOSEST:1,ANY:2,ALL:4};z9=pn.types.SPHERE;_9=pn.types.PLANE;D9=pn.types.BOX;k9=pn.types.CYLINDER;U9=pn.types.CONVEXPOLYHEDRON;J9=pn.types.HEIGHTFIELD;O9=pn.types.TRIMESH;class Fo{get[z9](){return this._intersectSphere}get[_9](){return this._intersectPlane}get[D9](){return this._intersectBox}get[k9](){return this._intersectConvex}get[U9](){return this._intersectConvex}get[J9](){return this._intersectHeightfield}get[O9](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ae),t===void 0&&(t=new ae),this.from=e.clone(),this.to=t.clone(),this.direction=new ae,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Fo.ANY,this.result=new YN,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Fo.ANY,this.result=t.result||new YN,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(vT),aN.length=0,e.broadphase.aabbQuery(e,vT,aN),this.intersectBodies(aN),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const a=i8,o=a8;for(let l=0,u=e.shapes.length;l<u;l++){const d=e.shapes[l];if(!(n&&!d.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[l],o),e.quaternion.vmult(e.shapeOffsets[l],a),a.vadd(e.position,a),this.intersectShape(d,o,a,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,a=e.length;!this.result.shouldStop&&n<a;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,a){const o=this.from;if(p8(o,this.direction,n)>e.boundingSphereRadius)return;const u=this[e.type];u&&u.call(this,e,t,n,a,e)}_intersectBox(e,t,n,a,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,a,o)}_intersectPlane(e,t,n,a,o){const l=this.from,u=this.to,d=this.direction,C=new ae(0,0,1);t.vmult(C,C);const A=new ae;l.vsub(n,A);const p=A.dot(C);u.vsub(n,A);const m=A.dot(C);if(p*m>0||l.distanceTo(u)<p)return;const y=C.dot(d);if(Math.abs(y)<this.precision)return;const G=new ae,w=new ae,R=new ae;l.vsub(n,G);const Z=-C.dot(G)/y;d.scale(Z,w),l.vadd(w,R),this.reportIntersection(C,R,o,a,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,a=this.to,o=this.from;t.x=Math.min(a.x,o.x),t.y=Math.min(a.y,o.y),t.z=Math.min(a.z,o.z),n.x=Math.max(a.x,o.x),n.y=Math.max(a.y,o.y),n.z=Math.max(a.z,o.z)}_intersectHeightfield(e,t,n,a,o){e.data,e.elementSize;const l=r8;l.from.copy(this.from),l.to.copy(this.to),xs.pointToLocalFrame(n,t,l.from,l.from),xs.pointToLocalFrame(n,t,l.to,l.to),l.updateDirection();const u=o8;let d,C,A,p;d=C=0,A=p=e.data.length-1;const m=new _l;l.getAABB(m),e.getIndexOfPosition(m.lowerBound.x,m.lowerBound.y,u,!0),d=Math.max(d,u[0]),C=Math.max(C,u[1]),e.getIndexOfPosition(m.upperBound.x,m.upperBound.y,u,!0),A=Math.min(A,u[0]+1),p=Math.min(p,u[1]+1);for(let y=d;y<A;y++)for(let G=C;G<p;G++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(y,G,m),!!m.overlapsRay(l)){if(e.getConvexTrianglePillar(y,G,!1),xs.pointToWorldFrame(n,t,e.pillarOffset,dR),this._intersectConvex(e.pillarConvex,t,dR,a,o,yT),this.result.shouldStop)return;e.getConvexTrianglePillar(y,G,!0),xs.pointToWorldFrame(n,t,e.pillarOffset,dR),this._intersectConvex(e.pillarConvex,t,dR,a,o,yT)}}}_intersectSphere(e,t,n,a,o){const l=this.from,u=this.to,d=e.radius,C=(u.x-l.x)**2+(u.y-l.y)**2+(u.z-l.z)**2,A=2*((u.x-l.x)*(l.x-n.x)+(u.y-l.y)*(l.y-n.y)+(u.z-l.z)*(l.z-n.z)),p=(l.x-n.x)**2+(l.y-n.y)**2+(l.z-n.z)**2-d**2,m=A**2-4*C*p,y=s8,G=l8;if(!(m<0))if(m===0)l.lerp(u,m,y),y.vsub(n,G),G.normalize(),this.reportIntersection(G,y,o,a,-1);else{const w=(-A-Math.sqrt(m))/(2*C),R=(-A+Math.sqrt(m))/(2*C);if(w>=0&&w<=1&&(l.lerp(u,w,y),y.vsub(n,G),G.normalize(),this.reportIntersection(G,y,o,a,-1)),this.result.shouldStop)return;R>=0&&R<=1&&(l.lerp(u,R,y),y.vsub(n,G),G.normalize(),this.reportIntersection(G,y,o,a,-1))}}_intersectConvex(e,t,n,a,o,l){const u=c8,d=GT,C=l&&l.faceList||null,A=e.faces,p=e.vertices,m=e.faceNormals,y=this.direction,G=this.from,w=this.to,R=G.distanceTo(w),Z=C?C.length:A.length,x=this.result;for(let W=0;!x.shouldStop&&W<Z;W++){const N=C?C[W]:W,K=A[N],T=m[N],L=t,k=n;d.copy(p[K[0]]),L.vmult(d,d),d.vadd(k,d),d.vsub(G,d),L.vmult(T,u);const E=y.dot(u);if(Math.abs(E)<this.precision)continue;const F=u.dot(d)/E;if(!(F<0)){y.scale(F,Ss),Ss.vadd(G,Ss),Xc.copy(p[K[0]]),L.vmult(Xc,Xc),k.vadd(Xc,Xc);for(let U=1;!x.shouldStop&&U<K.length-1;U++){Pg.copy(p[K[U]]),Qg.copy(p[K[U+1]]),L.vmult(Pg,Pg),L.vmult(Qg,Qg),k.vadd(Pg,Pg),k.vadd(Qg,Qg);const le=Ss.distanceTo(G);!(Fo.pointInTriangle(Ss,Xc,Pg,Qg)||Fo.pointInTriangle(Ss,Pg,Xc,Qg))||le>R||this.reportIntersection(u,Ss,o,a,N)}}}}_intersectTrimesh(e,t,n,a,o,l){const u=g8,d=A8,C=f8,A=GT,p=u8,m=I8,y=d8,G=h8,w=C8,R=e.indices;e.vertices;const Z=this.from,x=this.to,W=this.direction;C.position.copy(n),C.quaternion.copy(t),xs.vectorToLocalFrame(n,t,W,p),xs.pointToLocalFrame(n,t,Z,m),xs.pointToLocalFrame(n,t,x,y),y.x*=e.scale.x,y.y*=e.scale.y,y.z*=e.scale.z,m.x*=e.scale.x,m.y*=e.scale.y,m.z*=e.scale.z,y.vsub(m,p),p.normalize();const N=m.distanceSquared(y);e.tree.rayQuery(this,C,d);for(let K=0,T=d.length;!this.result.shouldStop&&K!==T;K++){const L=d[K];e.getNormal(L,u),e.getVertex(R[L*3],Xc),Xc.vsub(m,A);const k=p.dot(u),E=u.dot(A)/k;if(E<0)continue;p.scale(E,Ss),Ss.vadd(m,Ss),e.getVertex(R[L*3+1],Pg),e.getVertex(R[L*3+2],Qg);const F=Ss.distanceSquared(m);!(Fo.pointInTriangle(Ss,Pg,Xc,Qg)||Fo.pointInTriangle(Ss,Xc,Pg,Qg))||F>N||(xs.vectorToWorldFrame(t,u,w),xs.pointToWorldFrame(n,t,Ss,G),this.reportIntersection(w,G,o,a,L))}d.length=0}reportIntersection(e,t,n,a,o){const l=this.from,u=this.to,d=l.distanceTo(t),C=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(C.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case Fo.ALL:this.hasHit=!0,C.set(l,u,e,t,n,a,d),C.hasHit=!0,this.callback(C);break;case Fo.CLOSEST:(d<C.distance||!C.hasHit)&&(this.hasHit=!0,C.hasHit=!0,C.set(l,u,e,t,n,a,d));break;case Fo.ANY:this.hasHit=!0,C.hasHit=!0,C.set(l,u,e,t,n,a,d),C.shouldStop=!0;break}}static pointInTriangle(e,t,n,a){a.vsub(t,RA),n.vsub(t,O0),e.vsub(t,rN);const o=RA.dot(RA),l=RA.dot(O0),u=RA.dot(rN),d=O0.dot(O0),C=O0.dot(rN);let A,p;return(A=d*u-l*C)>=0&&(p=o*C-l*u)>=0&&A+p<o*d-l*l}}Fo.CLOSEST=QH.CLOSEST;Fo.ANY=QH.ANY;Fo.ALL=QH.ALL;const vT=new _l,aN=[],O0=new ae,rN=new ae,i8=new ae,a8=new as,Ss=new ae,Xc=new ae,Pg=new ae,Qg=new ae;new ae;new YN;const yT={faceList:[0]},dR=new ae,r8=new Fo,o8=[],s8=new ae,l8=new ae,c8=new ae;new ae;new ae;const GT=new ae,g8=new ae,u8=new ae,I8=new ae,d8=new ae,C8=new ae,h8=new ae;new _l;const A8=[],f8=new xs,RA=new ae,CR=new ae;function p8(s,e,t){t.vsub(s,RA);const n=RA.dot(e);return e.scale(n,CR),CR.vadd(s,CR),t.distanceTo(CR)}new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new Fo;new ae;new ae;new ae;new ae(1,0,0),new ae(0,1,0),new ae(0,0,1);new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new _l;new ae;new _l;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new _l;new ae;new xs;new _l;pn.types.SPHERE,pn.types.SPHERE|pn.types.PLANE,pn.types.BOX|pn.types.BOX,pn.types.SPHERE|pn.types.BOX,pn.types.PLANE|pn.types.BOX,pn.types.CONVEXPOLYHEDRON,pn.types.SPHERE|pn.types.CONVEXPOLYHEDRON,pn.types.PLANE|pn.types.CONVEXPOLYHEDRON,pn.types.BOX|pn.types.CONVEXPOLYHEDRON,pn.types.SPHERE|pn.types.HEIGHTFIELD,pn.types.BOX|pn.types.HEIGHTFIELD,pn.types.CONVEXPOLYHEDRON|pn.types.HEIGHTFIELD,pn.types.PARTICLE|pn.types.SPHERE,pn.types.PLANE|pn.types.PARTICLE,pn.types.BOX|pn.types.PARTICLE,pn.types.PARTICLE|pn.types.CONVEXPOLYHEDRON,pn.types.CYLINDER,pn.types.SPHERE|pn.types.CYLINDER,pn.types.PLANE|pn.types.CYLINDER,pn.types.BOX|pn.types.CYLINDER,pn.types.CONVEXPOLYHEDRON|pn.types.CYLINDER,pn.types.HEIGHTFIELD|pn.types.CYLINDER,pn.types.PARTICLE|pn.types.CYLINDER,pn.types.SPHERE|pn.types.TRIMESH,pn.types.PLANE|pn.types.TRIMESH;new ae;new ae;new ae;new ae;new ae;new as;new as;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new _l;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae,new ae,new ae,new ae,new ae,new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new as;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new ae;new _l;new Fo;const P0=globalThis.performance||{};if(!P0.now){let s=Date.now();P0.timing&&P0.timing.navigationStart&&(s=P0.timing.navigationStart),P0.now=()=>Date.now()-s}new ae;class SI{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new re);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new re);const n=this.elements,a=e.x,o=e.y,l=e.z;return t.x=n[0]*a+n[1]*o+n[2]*l,t.y=n[3]*a+n[4]*o+n[5]*l,t.z=n[6]*a+n[7]*o+n[8]*l,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new SI);const n=this.elements,a=e.elements,o=t.elements,l=n[0],u=n[1],d=n[2],C=n[3],A=n[4],p=n[5],m=n[6],y=n[7],G=n[8],w=a[0],R=a[1],Z=a[2],x=a[3],W=a[4],N=a[5],K=a[6],T=a[7],L=a[8];return o[0]=l*w+u*x+d*K,o[1]=l*R+u*W+d*T,o[2]=l*Z+u*N+d*L,o[3]=C*w+A*x+p*K,o[4]=C*R+A*W+p*T,o[5]=C*Z+A*N+p*L,o[6]=m*w+y*x+G*K,o[7]=m*R+y*W+G*T,o[8]=m*Z+y*N+G*L,t}scale(e,t){t===void 0&&(t=new SI);const n=this.elements,a=t.elements;for(let o=0;o!==3;o++)a[3*o+0]=e.x*n[3*o+0],a[3*o+1]=e.y*n[3*o+1],a[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new re);const n=3,a=4,o=[];let l,u;for(l=0;l<n*a;l++)o.push(0);for(l=0;l<3;l++)for(u=0;u<3;u++)o[l+a*u]=this.elements[l+3*u];o[3+4*0]=e.x,o[3+4*1]=e.y,o[3+4*2]=e.z;let d=3;const C=d;let A;const p=4;let m;do{if(l=C-d,o[l+a*l]===0){for(u=l+1;u<C;u++)if(o[l+a*u]!==0){A=p;do m=p-A,o[m+a*l]+=o[m+a*u];while(--A);break}}if(o[l+a*l]!==0)for(u=l+1;u<C;u++){const y=o[l+a*u]/o[l+a*l];A=p;do m=p-A,o[m+a*u]=m<=l?0:o[m+a*u]-o[m+a*l]*y;while(--A)}}while(--d);if(t.z=o[2*a+3]/o[2*a+2],t.y=(o[1*a+3]-o[1*a+2]*t.z)/o[1*a+1],t.x=(o[0*a+3]-o[0*a+2]*t.z-o[0*a+1]*t.y)/o[0*a+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new SI);const t=3,n=6,a=m8;let o,l;for(o=0;o<3;o++)for(l=0;l<3;l++)a[o+n*l]=this.elements[o+3*l];a[3+6*0]=1,a[3+6*1]=0,a[3+6*2]=0,a[4+6*0]=0,a[4+6*1]=1,a[4+6*2]=0,a[5+6*0]=0,a[5+6*1]=0,a[5+6*2]=1;let u=3;const d=u;let C;const A=n;let p;do{if(o=d-u,a[o+n*o]===0){for(l=o+1;l<d;l++)if(a[o+n*l]!==0){C=A;do p=A-C,a[p+n*o]+=a[p+n*l];while(--C);break}}if(a[o+n*o]!==0)for(l=o+1;l<d;l++){const m=a[o+n*l]/a[o+n*o];C=A;do p=A-C,a[p+n*l]=p<=o?0:a[p+n*l]-a[p+n*o]*m;while(--C)}}while(--u);o=2;do{l=o-1;do{const m=a[o+n*l]/a[o+n*o];C=n;do p=n-C,a[p+n*l]=a[p+n*l]-a[p+n*o]*m;while(--C)}while(l--)}while(--o);o=2;do{const m=1/a[o+n*o];C=n;do p=n-C,a[p+n*o]=a[p+n*o]*m;while(--C)}while(o--);o=2;do{l=2;do{if(p=a[t+l+n*o],isNaN(p)||p===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,l,p)}while(l--)}while(o--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,a=e.z,o=e.w,l=t+t,u=n+n,d=a+a,C=t*l,A=t*u,p=t*d,m=n*u,y=n*d,G=a*d,w=o*l,R=o*u,Z=o*d,x=this.elements;return x[3*0+0]=1-(m+G),x[3*0+1]=A-Z,x[3*0+2]=p+R,x[3*1+0]=A+Z,x[3*1+1]=1-(C+G),x[3*1+2]=y-w,x[3*2+0]=p-R,x[3*2+1]=y+w,x[3*2+2]=1-(C+m),this}transpose(e){e===void 0&&(e=new SI);const t=this.elements,n=e.elements;let a;return n[0]=t[0],n[4]=t[4],n[8]=t[8],a=t[1],n[1]=t[3],n[3]=a,a=t[2],n[2]=t[6],n[6]=a,a=t[5],n[5]=t[7],n[7]=a,e}}const m8=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class re{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new re);const n=e.x,a=e.y,o=e.z,l=this.x,u=this.y,d=this.z;return t.x=u*o-d*a,t.y=d*n-l*o,t.z=l*a-u*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new re(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new re(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new SI([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,a=Math.sqrt(e*e+t*t+n*n);if(a>0){const o=1/a;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return a}unit(e){e===void 0&&(e=new re);const t=this.x,n=this.y,a=this.z;let o=Math.sqrt(t*t+n*n+a*a);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=a*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,a=this.z,o=e.x,l=e.y,u=e.z;return Math.sqrt((o-t)*(o-t)+(l-n)*(l-n)+(u-a)*(u-a))}distanceSquared(e){const t=this.x,n=this.y,a=this.z,o=e.x,l=e.y,u=e.z;return(o-t)*(o-t)+(l-n)*(l-n)+(u-a)*(u-a)}scale(e,t){t===void 0&&(t=new re);const n=this.x,a=this.y,o=this.z;return t.x=e*n,t.y=e*a,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new re),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new re),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new re),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const a=b8,o=1/n;a.set(this.x*o,this.y*o,this.z*o);const l=v8;Math.abs(a.x)<.9?(l.set(1,0,0),a.cross(l,e)):(l.set(0,1,0),a.cross(l,e)),a.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const a=this.x,o=this.y,l=this.z;n.x=a+(e.x-a)*t,n.y=o+(e.y-o)*t,n.z=l+(e.z-l)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(BT),BT.almostEquals(e,t)}clone(){return new re(this.x,this.y,this.z)}}re.ZERO=new re(0,0,0);re.UNIT_X=new re(1,0,0);re.UNIT_Y=new re(0,1,0);re.UNIT_Z=new re(0,0,1);const b8=new re,v8=new re,BT=new re;class Dl{constructor(e){e===void 0&&(e={}),this.lowerBound=new re,this.upperBound=new re,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,a){const o=this.lowerBound,l=this.upperBound,u=n;o.copy(e[0]),u&&u.vmult(o,o),l.copy(o);for(let d=1;d<e.length;d++){let C=e[d];u&&(u.vmult(C,ZT),C=ZT),C.x>l.x&&(l.x=C.x),C.x<o.x&&(o.x=C.x),C.y>l.y&&(l.y=C.y),C.y<o.y&&(o.y=C.y),C.z>l.z&&(l.z=C.z),C.z<o.z&&(o.z=C.z)}return t&&(t.vadd(o,o),t.vadd(l,l)),a&&(o.x-=a,o.y-=a,o.z-=a,l.x+=a,l.y+=a,l.z+=a),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Dl().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,a=e.lowerBound,o=e.upperBound,l=a.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,u=a.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,d=a.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return l&&u&&d}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,a=e.lowerBound,o=e.upperBound;return t.x<=a.x&&n.x>=o.x&&t.y<=a.y&&n.y>=o.y&&t.z<=a.z&&n.z>=o.z}getCorners(e,t,n,a,o,l,u,d){const C=this.lowerBound,A=this.upperBound;e.copy(C),t.set(A.x,C.y,C.z),n.set(A.x,A.y,C.z),a.set(C.x,A.y,A.z),o.set(A.x,C.y,A.z),l.set(C.x,A.y,C.z),u.set(C.x,C.y,A.z),d.copy(A)}toLocalFrame(e,t){const n=ST,a=n[0],o=n[1],l=n[2],u=n[3],d=n[4],C=n[5],A=n[6],p=n[7];this.getCorners(a,o,l,u,d,C,A,p);for(let m=0;m!==8;m++){const y=n[m];e.pointToLocal(y,y)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=ST,a=n[0],o=n[1],l=n[2],u=n[3],d=n[4],C=n[5],A=n[6],p=n[7];this.getCorners(a,o,l,u,d,C,A,p);for(let m=0;m!==8;m++){const y=n[m];e.pointToWorld(y,y)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,a=1/t.x,o=1/t.y,l=1/t.z,u=(this.lowerBound.x-n.x)*a,d=(this.upperBound.x-n.x)*a,C=(this.lowerBound.y-n.y)*o,A=(this.upperBound.y-n.y)*o,p=(this.lowerBound.z-n.z)*l,m=(this.upperBound.z-n.z)*l,y=Math.max(Math.max(Math.min(u,d),Math.min(C,A)),Math.min(p,m)),G=Math.min(Math.min(Math.max(u,d),Math.max(C,A)),Math.max(p,m));return!(G<0||y>G)}}const ZT=new re,ST=[new re,new re,new re,new re,new re,new re,new re,new re];class rs{constructor(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),a===void 0&&(a=1),this.x=e,this.y=t,this.z=n,this.w=a}set(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new re),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=y8,a=G8;e.tangents(n,a),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new rs);const n=this.x,a=this.y,o=this.z,l=this.w,u=e.x,d=e.y,C=e.z,A=e.w;return t.x=n*A+l*u+a*C-o*d,t.y=a*A+l*d+o*u-n*C,t.z=o*A+l*C+n*d-a*u,t.w=l*A-n*u-a*d-o*C,t}inverse(e){e===void 0&&(e=new rs);const t=this.x,n=this.y,a=this.z,o=this.w;this.conjugate(e);const l=1/(t*t+n*n+a*a+o*o);return e.x*=l,e.y*=l,e.z*=l,e.w*=l,e}conjugate(e){return e===void 0&&(e=new rs),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new re);const n=e.x,a=e.y,o=e.z,l=this.x,u=this.y,d=this.z,C=this.w,A=C*n+u*o-d*a,p=C*a+d*n-l*o,m=C*o+l*a-u*n,y=-l*n-u*a-d*o;return t.x=A*C+y*-l+p*-d-m*-u,t.y=p*C+y*-u+m*-l-A*-d,t.z=m*C+y*-d+A*-u-p*-l,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,a,o;const l=this.x,u=this.y,d=this.z,C=this.w;switch(t){case"YZX":const A=l*u+d*C;if(A>.499&&(n=2*Math.atan2(l,C),a=Math.PI/2,o=0),A<-.499&&(n=-2*Math.atan2(l,C),a=-Math.PI/2,o=0),n===void 0){const p=l*l,m=u*u,y=d*d;n=Math.atan2(2*u*C-2*l*d,1-2*m-2*y),a=Math.asin(2*A),o=Math.atan2(2*l*C-2*u*d,1-2*p-2*y)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=a,e.x=o}setFromEuler(e,t,n,a){a===void 0&&(a="XYZ");const o=Math.cos(e/2),l=Math.cos(t/2),u=Math.cos(n/2),d=Math.sin(e/2),C=Math.sin(t/2),A=Math.sin(n/2);return a==="XYZ"?(this.x=d*l*u+o*C*A,this.y=o*C*u-d*l*A,this.z=o*l*A+d*C*u,this.w=o*l*u-d*C*A):a==="YXZ"?(this.x=d*l*u+o*C*A,this.y=o*C*u-d*l*A,this.z=o*l*A-d*C*u,this.w=o*l*u+d*C*A):a==="ZXY"?(this.x=d*l*u-o*C*A,this.y=o*C*u+d*l*A,this.z=o*l*A+d*C*u,this.w=o*l*u-d*C*A):a==="ZYX"?(this.x=d*l*u-o*C*A,this.y=o*C*u+d*l*A,this.z=o*l*A-d*C*u,this.w=o*l*u+d*C*A):a==="YZX"?(this.x=d*l*u+o*C*A,this.y=o*C*u+d*l*A,this.z=o*l*A-d*C*u,this.w=o*l*u-d*C*A):a==="XZY"&&(this.x=d*l*u-o*C*A,this.y=o*C*u-d*l*A,this.z=o*l*A+d*C*u,this.w=o*l*u+d*C*A),this}clone(){return new rs(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new rs);const a=this.x,o=this.y,l=this.z,u=this.w;let d=e.x,C=e.y,A=e.z,p=e.w,m,y,G,w,R;return y=a*d+o*C+l*A+u*p,y<0&&(y=-y,d=-d,C=-C,A=-A,p=-p),1-y>1e-6?(m=Math.acos(y),G=Math.sin(m),w=Math.sin((1-t)*m)/G,R=Math.sin(t*m)/G):(w=1-t,R=t),n.x=w*a+R*d,n.y=w*o+R*C,n.z=w*l+R*A,n.w=w*u+R*p,n}integrate(e,t,n,a){a===void 0&&(a=new rs);const o=e.x*n.x,l=e.y*n.y,u=e.z*n.z,d=this.x,C=this.y,A=this.z,p=this.w,m=t*.5;return a.x+=m*(o*p+l*A-u*C),a.y+=m*(l*p+u*d-o*A),a.z+=m*(u*p+o*C-l*d),a.w+=m*(-o*d-l*C-u*A),a}}const y8=new re,G8=new re,B8={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class mn{constructor(e){e===void 0&&(e={}),this.id=mn.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,a){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}mn.idCounter=0;mn.types=B8;class Ws{constructor(e){e===void 0&&(e={}),this.position=new re,this.quaternion=new rs,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Ws.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Ws.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new re),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,a){return a===void 0&&(a=new re),n.vsub(e,a),t.conjugate(RT),RT.vmult(a,a),a}static pointToWorldFrame(e,t,n,a){return a===void 0&&(a=new re),t.vmult(n,a),a.vadd(e,a),a}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new re),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,a){return a===void 0&&(a=new re),t.w*=-1,t.vmult(n,a),t.w*=-1,a}}const RT=new rs;new re;new re;new re;new re;new re,new re,new re,new re,new re,new re,new re,new re;new re;new rs;new Dl;new SI;new SI;new SI;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new rs;new re;new re;new re;new re;class TN{constructor(){this.rayFromWorld=new re,this.rayToWorld=new re,this.hitNormalWorld=new re,this.hitPointWorld=new re,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,a,o,l,u){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(a),this.shape=o,this.body=l,this.distance=u}}let P9,Q9,j9,q9,$9,e1,t1;const jH={CLOSEST:1,ANY:2,ALL:4};P9=mn.types.SPHERE;Q9=mn.types.PLANE;j9=mn.types.BOX;q9=mn.types.CYLINDER;$9=mn.types.CONVEXPOLYHEDRON;e1=mn.types.HEIGHTFIELD;t1=mn.types.TRIMESH;class Yo{get[P9](){return this._intersectSphere}get[Q9](){return this._intersectPlane}get[j9](){return this._intersectBox}get[q9](){return this._intersectConvex}get[$9](){return this._intersectConvex}get[e1](){return this._intersectHeightfield}get[t1](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new re),t===void 0&&(t=new re),this.from=e.clone(),this.to=t.clone(),this.direction=new re,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Yo.ANY,this.result=new TN,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Yo.ANY,this.result=t.result||new TN,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(wT),oN.length=0,e.broadphase.aabbQuery(e,wT,oN),this.intersectBodies(oN),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const a=Z8,o=S8;for(let l=0,u=e.shapes.length;l<u;l++){const d=e.shapes[l];if(!(n&&!d.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[l],o),e.quaternion.vmult(e.shapeOffsets[l],a),a.vadd(e.position,a),this.intersectShape(d,o,a,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,a=e.length;!this.result.shouldStop&&n<a;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,a){const o=this.from;if(K8(o,this.direction,n)>e.boundingSphereRadius)return;const u=this[e.type];u&&u.call(this,e,t,n,a,e)}_intersectBox(e,t,n,a,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,a,o)}_intersectPlane(e,t,n,a,o){const l=this.from,u=this.to,d=this.direction,C=new re(0,0,1);t.vmult(C,C);const A=new re;l.vsub(n,A);const p=A.dot(C);u.vsub(n,A);const m=A.dot(C);if(p*m>0||l.distanceTo(u)<p)return;const y=C.dot(d);if(Math.abs(y)<this.precision)return;const G=new re,w=new re,R=new re;l.vsub(n,G);const Z=-C.dot(G)/y;d.scale(Z,w),l.vadd(w,R),this.reportIntersection(C,R,o,a,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,a=this.to,o=this.from;t.x=Math.min(a.x,o.x),t.y=Math.min(a.y,o.y),t.z=Math.min(a.z,o.z),n.x=Math.max(a.x,o.x),n.y=Math.max(a.y,o.y),n.z=Math.max(a.z,o.z)}_intersectHeightfield(e,t,n,a,o){e.data,e.elementSize;const l=R8;l.from.copy(this.from),l.to.copy(this.to),Ws.pointToLocalFrame(n,t,l.from,l.from),Ws.pointToLocalFrame(n,t,l.to,l.to),l.updateDirection();const u=w8;let d,C,A,p;d=C=0,A=p=e.data.length-1;const m=new Dl;l.getAABB(m),e.getIndexOfPosition(m.lowerBound.x,m.lowerBound.y,u,!0),d=Math.max(d,u[0]),C=Math.max(C,u[1]),e.getIndexOfPosition(m.upperBound.x,m.upperBound.y,u,!0),A=Math.min(A,u[0]+1),p=Math.min(p,u[1]+1);for(let y=d;y<A;y++)for(let G=C;G<p;G++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(y,G,m),!!m.overlapsRay(l)){if(e.getConvexTrianglePillar(y,G,!1),Ws.pointToWorldFrame(n,t,e.pillarOffset,hR),this._intersectConvex(e.pillarConvex,t,hR,a,o,xT),this.result.shouldStop)return;e.getConvexTrianglePillar(y,G,!0),Ws.pointToWorldFrame(n,t,e.pillarOffset,hR),this._intersectConvex(e.pillarConvex,t,hR,a,o,xT)}}}_intersectSphere(e,t,n,a,o){const l=this.from,u=this.to,d=e.radius,C=(u.x-l.x)**2+(u.y-l.y)**2+(u.z-l.z)**2,A=2*((u.x-l.x)*(l.x-n.x)+(u.y-l.y)*(l.y-n.y)+(u.z-l.z)*(l.z-n.z)),p=(l.x-n.x)**2+(l.y-n.y)**2+(l.z-n.z)**2-d**2,m=A**2-4*C*p,y=x8,G=W8;if(!(m<0))if(m===0)l.lerp(u,m,y),y.vsub(n,G),G.normalize(),this.reportIntersection(G,y,o,a,-1);else{const w=(-A-Math.sqrt(m))/(2*C),R=(-A+Math.sqrt(m))/(2*C);if(w>=0&&w<=1&&(l.lerp(u,w,y),y.vsub(n,G),G.normalize(),this.reportIntersection(G,y,o,a,-1)),this.result.shouldStop)return;R>=0&&R<=1&&(l.lerp(u,R,y),y.vsub(n,G),G.normalize(),this.reportIntersection(G,y,o,a,-1))}}_intersectConvex(e,t,n,a,o,l){const u=V8,d=WT,C=l&&l.faceList||null,A=e.faces,p=e.vertices,m=e.faceNormals,y=this.direction,G=this.from,w=this.to,R=G.distanceTo(w),Z=C?C.length:A.length,x=this.result;for(let W=0;!x.shouldStop&&W<Z;W++){const N=C?C[W]:W,K=A[N],T=m[N],L=t,k=n;d.copy(p[K[0]]),L.vmult(d,d),d.vadd(k,d),d.vsub(G,d),L.vmult(T,u);const E=y.dot(u);if(Math.abs(E)<this.precision)continue;const F=u.dot(d)/E;if(!(F<0)){y.scale(F,Rs),Rs.vadd(G,Rs),Fc.copy(p[K[0]]),L.vmult(Fc,Fc),k.vadd(Fc,Fc);for(let U=1;!x.shouldStop&&U<K.length-1;U++){jg.copy(p[K[U]]),qg.copy(p[K[U+1]]),L.vmult(jg,jg),L.vmult(qg,qg),k.vadd(jg,jg),k.vadd(qg,qg);const le=Rs.distanceTo(G);!(Yo.pointInTriangle(Rs,Fc,jg,qg)||Yo.pointInTriangle(Rs,jg,Fc,qg))||le>R||this.reportIntersection(u,Rs,o,a,N)}}}}_intersectTrimesh(e,t,n,a,o,l){const u=M8,d=T8,C=E8,A=WT,p=N8,m=H8,y=X8,G=Y8,w=F8,R=e.indices;e.vertices;const Z=this.from,x=this.to,W=this.direction;C.position.copy(n),C.quaternion.copy(t),Ws.vectorToLocalFrame(n,t,W,p),Ws.pointToLocalFrame(n,t,Z,m),Ws.pointToLocalFrame(n,t,x,y),y.x*=e.scale.x,y.y*=e.scale.y,y.z*=e.scale.z,m.x*=e.scale.x,m.y*=e.scale.y,m.z*=e.scale.z,y.vsub(m,p),p.normalize();const N=m.distanceSquared(y);e.tree.rayQuery(this,C,d);for(let K=0,T=d.length;!this.result.shouldStop&&K!==T;K++){const L=d[K];e.getNormal(L,u),e.getVertex(R[L*3],Fc),Fc.vsub(m,A);const k=p.dot(u),E=u.dot(A)/k;if(E<0)continue;p.scale(E,Rs),Rs.vadd(m,Rs),e.getVertex(R[L*3+1],jg),e.getVertex(R[L*3+2],qg);const F=Rs.distanceSquared(m);!(Yo.pointInTriangle(Rs,jg,Fc,qg)||Yo.pointInTriangle(Rs,Fc,jg,qg))||F>N||(Ws.vectorToWorldFrame(t,u,w),Ws.pointToWorldFrame(n,t,Rs,G),this.reportIntersection(w,G,o,a,L))}d.length=0}reportIntersection(e,t,n,a,o){const l=this.from,u=this.to,d=l.distanceTo(t),C=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(C.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case Yo.ALL:this.hasHit=!0,C.set(l,u,e,t,n,a,d),C.hasHit=!0,this.callback(C);break;case Yo.CLOSEST:(d<C.distance||!C.hasHit)&&(this.hasHit=!0,C.hasHit=!0,C.set(l,u,e,t,n,a,d));break;case Yo.ANY:this.hasHit=!0,C.hasHit=!0,C.set(l,u,e,t,n,a,d),C.shouldStop=!0;break}}static pointInTriangle(e,t,n,a){a.vsub(t,wA),n.vsub(t,Q0),e.vsub(t,sN);const o=wA.dot(wA),l=wA.dot(Q0),u=wA.dot(sN),d=Q0.dot(Q0),C=Q0.dot(sN);let A,p;return(A=d*u-l*C)>=0&&(p=o*C-l*u)>=0&&A+p<o*d-l*l}}Yo.CLOSEST=jH.CLOSEST;Yo.ANY=jH.ANY;Yo.ALL=jH.ALL;const wT=new Dl,oN=[],Q0=new re,sN=new re,Z8=new re,S8=new rs,Rs=new re,Fc=new re,jg=new re,qg=new re;new re;new TN;const xT={faceList:[0]},hR=new re,R8=new Yo,w8=[],x8=new re,W8=new re,V8=new re;new re;new re;const WT=new re,M8=new re,N8=new re,H8=new re,X8=new re,F8=new re,Y8=new re;new Dl;const T8=[],E8=new Ws,wA=new re,AR=new re;function K8(s,e,t){t.vsub(s,wA);const n=wA.dot(e);return e.scale(n,AR),AR.vadd(s,AR),t.distanceTo(AR)}new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Yo;new re;new re;new re;new re(1,0,0),new re(0,1,0),new re(0,0,1);new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Dl;new re;new Dl;new re;new re;new re;new re;new re;new re;new re;new Dl;new re;new Ws;new Dl;mn.types.SPHERE,mn.types.SPHERE|mn.types.PLANE,mn.types.BOX|mn.types.BOX,mn.types.SPHERE|mn.types.BOX,mn.types.PLANE|mn.types.BOX,mn.types.CONVEXPOLYHEDRON,mn.types.SPHERE|mn.types.CONVEXPOLYHEDRON,mn.types.PLANE|mn.types.CONVEXPOLYHEDRON,mn.types.BOX|mn.types.CONVEXPOLYHEDRON,mn.types.SPHERE|mn.types.HEIGHTFIELD,mn.types.BOX|mn.types.HEIGHTFIELD,mn.types.CONVEXPOLYHEDRON|mn.types.HEIGHTFIELD,mn.types.PARTICLE|mn.types.SPHERE,mn.types.PLANE|mn.types.PARTICLE,mn.types.BOX|mn.types.PARTICLE,mn.types.PARTICLE|mn.types.CONVEXPOLYHEDRON,mn.types.CYLINDER,mn.types.SPHERE|mn.types.CYLINDER,mn.types.PLANE|mn.types.CYLINDER,mn.types.BOX|mn.types.CYLINDER,mn.types.CONVEXPOLYHEDRON|mn.types.CYLINDER,mn.types.HEIGHTFIELD|mn.types.CYLINDER,mn.types.PARTICLE|mn.types.CYLINDER,mn.types.SPHERE|mn.types.TRIMESH,mn.types.PLANE|mn.types.TRIMESH;new re;new re;new re;new re;new re;new rs;new rs;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Dl;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re,new re,new re,new re,new re,new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new rs;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Dl;new Yo;const j0=globalThis.performance||{};if(!j0.now){let s=Date.now();j0.timing&&j0.timing.navigationStart&&(s=j0.timing.navigationStart),j0.now=()=>Date.now()-s}new re;const L8=Fe.createContext(null),z8=()=>Fe.useContext(L8),n1=Fe.createContext(null),i1=()=>{const s=Fe.useContext(n1);if(!s)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return s};new q(1,1,1);new q;new Sn;const VT=new gi;function EN(s){const e=Fe.useRef(null);return s&&typeof s!="function"?s:e}function MT(s){return s.charAt(0).toUpperCase()+s.slice(1)}function Co(s,e){const t=e===void 0?"":`/${e}`;return typeof s=="function"?null:s&&s.current&&`${s.current.uuid}${t}`}const _8=new Hs,D8=new Ir,k8=s=>e=>s(_8.setFromQuaternion(D8.fromArray(e)).toArray());let a1=0;function lN(s,e,t,n,a,o){return o===void 0&&(o="bodies"),l=>{const u=a1++;t[u]={[n]:l};const d=Co(s,a);return d&&e.subscribe({props:{id:u,target:o,type:n},uuid:d}),()=>{delete t[u],e.unsubscribe({props:u})}}}function NT(s,e){let{position:t=[0,0,0],rotation:n=[0,0,0],userData:a={}}=e;s.userData=a,s.position.set(...t),s.rotation.set(...n),s.updateMatrix()}function HT(s,e,t){let{onCollide:n,onCollideBegin:a,onCollideEnd:o}=e;s[t]={collide:n,collideBegin:a,collideEnd:o}}function r1(s,e,t,n,a){n===void 0&&(n=null),a===void 0&&(a=[]);const o=EN(n),{events:l,refs:u,scaleOverrides:d,subscriptions:C,worker:A}=i1(),p=z8();Fe.useLayoutEffect(()=>{o.current||(o.current=new gi);const y=o.current,G=A,w=y instanceof KA?(y.instanceMatrix.setUsage(jE),y.count):1,R=y instanceof KA?new Array(w).fill(0).map((x,W)=>`${y.uuid}/${W}`):[y.uuid],Z=y instanceof KA?R.map((x,W)=>{const N=e(W);return NT(VT,N),y.setMatrixAt(W,VT.matrix),y.instanceMatrix.needsUpdate=!0,u[x]=y,p==null||p.add(x,N,s),HT(l,N,x),{...N,args:t(N.args)}}):R.map((x,W)=>{const N=e(W);return NT(y,N),u[x]=y,p==null||p.add(x,N,s),HT(l,N,x),{...N,args:t(N.args)}});return G.addBodies({props:Z.map(x=>{let{onCollide:W,onCollideBegin:N,onCollideEnd:K,...T}=x;return{onCollide:!!W,...T}}),type:s,uuid:R}),()=>{R.forEach(x=>{delete u[x],p==null||p.remove(x),delete l[x]}),G.removeBodies({uuid:R})}},a);const m=Fe.useMemo(()=>{const y=(W,N)=>{const K=`set${MT(W)}`;return{set:T=>{const L=Co(o,N);L&&A[K]({props:T,uuid:L})},subscribe:lN(o,A,C,W,N)}},G=W=>({copy:K=>{let{w:T,x:L,y:k,z:E}=K;const F=Co(o,W);F&&A.setQuaternion({props:[L,k,E,T],uuid:F})},set:(K,T,L,k)=>{const E=Co(o,W);E&&A.setQuaternion({props:[K,T,L,k],uuid:E})},subscribe:lN(o,A,C,"quaternion",W)}),w=W=>({copy:N=>{let{x:K,y:T,z:L}=N;const k=Co(o,W);k&&A.setRotation({props:[K,T,L],uuid:k})},set:(N,K,T)=>{const L=Co(o,W);L&&A.setRotation({props:[N,K,T],uuid:L})},subscribe:N=>{const K=a1++,T="bodies",L="quaternion",k=Co(o,W);return C[K]={[L]:k8(N)},k&&A.subscribe({props:{id:K,target:T,type:L},uuid:k}),()=>{delete C[K],A.unsubscribe({props:K})}}}),R=(W,N)=>{const K=`set${MT(W)}`;return{copy:T=>{let{x:L,y:k,z:E}=T;const F=Co(o,N);F&&A[K]({props:[L,k,E],uuid:F})},set:(T,L,k)=>{const E=Co(o,N);E&&A[K]({props:[T,L,k],uuid:E})},subscribe:lN(o,A,C,W,N)}};function Z(W){return{allowSleep:y("allowSleep",W),angularDamping:y("angularDamping",W),angularFactor:R("angularFactor",W),angularVelocity:R("angularVelocity",W),applyForce(N,K){const T=Co(o,W);T&&A.applyForce({props:[N,K],uuid:T})},applyImpulse(N,K){const T=Co(o,W);T&&A.applyImpulse({props:[N,K],uuid:T})},applyLocalForce(N,K){const T=Co(o,W);T&&A.applyLocalForce({props:[N,K],uuid:T})},applyLocalImpulse(N,K){const T=Co(o,W);T&&A.applyLocalImpulse({props:[N,K],uuid:T})},applyTorque(N){const K=Co(o,W);K&&A.applyTorque({props:[N],uuid:K})},collisionFilterGroup:y("collisionFilterGroup",W),collisionFilterMask:y("collisionFilterMask",W),collisionResponse:y("collisionResponse",W),fixedRotation:y("fixedRotation",W),isTrigger:y("isTrigger",W),linearDamping:y("linearDamping",W),linearFactor:R("linearFactor",W),mass:y("mass",W),material:y("material",W),position:R("position",W),quaternion:G(W),rotation:w(W),scaleOverride(N){const K=Co(o,W);K&&(d[K]=new q(...N))},sleep(){const N=Co(o,W);N&&A.sleep({uuid:N})},sleepSpeedLimit:y("sleepSpeedLimit",W),sleepTimeLimit:y("sleepTimeLimit",W),userData:y("userData",W),velocity:R("velocity",W),wakeUp(){const N=Co(o,W);N&&A.wakeUp({uuid:N})}}}const x={};return{...Z(void 0),at:W=>x[W]||(x[W]=Z(W))}},[]);return[o,m]}function U8(s,e,t){return r1("Plane",s,()=>[],e,t)}function J8(s,e,t){return r1("Sphere",s,function(n){if(n===void 0&&(n=[1]),!Array.isArray(n))throw new Error("useSphere args must be an array");return[n[0]]},e,t)}function O8(s,e,t,n,a){n===void 0&&(n={}),a===void 0&&(a=[]);const{worker:o}=i1(),l=gH.generateUUID(),u=EN(e),d=EN(t);Fe.useEffect(()=>{if(u.current&&d.current)return o.addConstraint({props:[u.current.uuid,d.current.uuid,n],type:s,uuid:l}),()=>o.removeConstraint({uuid:l})},a);const C=Fe.useMemo(()=>({disable:()=>o.disableConstraint({uuid:l}),enable:()=>o.enableConstraint({uuid:l})}),a);return[u,d,C]}function P8(s,e,t,n){return s===void 0&&(s=null),e===void 0&&(e=null),n===void 0&&(n=[]),O8("PointToPoint",s,e,t,n)}const Q8=new q,j8=new q(1,1,1),q8=new Ir,fR=new Sn;function XT(s,e,t,n,a){return n===void 0&&(n=j8),s!==void 0?(fR.compose(Q8.fromArray(e,s*3),q8.fromArray(t,s*4),n),a&&(a.matrixAutoUpdate=!1,a.matrix.copy(fR)),fR):fR.identity()}const $8=()=>{const s=[];return e=>s.includes(e)?!1:!!s.push(e)};function eq(s){let{allowSleep:e=!1,axisIndex:t=0,broadphase:n="Naive",children:a,defaultContactMaterial:o={contactEquationStiffness:1e6},frictionGravity:l=null,gravity:u=[0,-9.81,0],isPaused:d=!1,iterations:C=5,maxSubSteps:A=10,quatNormalizeFast:p=!1,quatNormalizeSkip:m=0,shouldInvalidate:y=!0,size:G=1e3,solver:w="GS",stepSize:R=1/60,tolerance:Z=.001}=s;const{invalidate:x}=Tc(),[{bodies:W,events:N,refs:K,scaleOverrides:T,subscriptions:L,worker:k}]=Fe.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new Q7({allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:o,frictionGravity:l,gravity:u,iterations:C,quatNormalizeFast:p,quatNormalizeSkip:m,size:G,solver:w,tolerance:Z})}));let E=0;const F=Fe.useCallback((pe,de)=>{d||(E+=de,k.step({maxSubSteps:A,stepSize:R,timeSinceLastCalled:E}),E=0)},[d,A,R]),U=pe=>{var de;let{body:Oe,contact:{bi:We,bj:ke,...$e},target:ot,...Ne}=pe;const tt=(de=N[ot])==null?void 0:de.collide;tt&&tt({body:K[Oe],contact:{bi:K[We],bj:K[ke],...$e},target:K[ot],...Ne})},le=pe=>{var de,Oe;let{bodyA:We,bodyB:ke}=pe;const $e=(de=N[We])==null?void 0:de.collideBegin;$e&&$e({body:K[ke],op:"event",target:K[We],type:"collideBegin"});const ot=(Oe=N[ke])==null?void 0:Oe.collideBegin;ot&&ot({body:K[We],op:"event",target:K[ke],type:"collideBegin"})},ie=pe=>{var de,Oe;let{bodyA:We,bodyB:ke}=pe;const $e=(de=N[We])==null?void 0:de.collideEnd;$e&&$e({body:K[ke],op:"event",target:K[We],type:"collideEnd"});const ot=(Oe=N[ke])==null?void 0:Oe.collideEnd;ot&&ot({body:K[We],op:"event",target:K[ke],type:"collideEnd"})},Ce=pe=>{let{active:de,bodies:Oe=[],observations:We,positions:ke,quaternions:$e}=pe;for(let ot=0;ot<Oe.length;ot++)W[Oe[ot]]=ot;if(We.forEach(ot=>{let[Ne,tt,bt]=ot;const yt=(L[Ne]||{})[bt];yt&&yt(tt)}),!!de){for(const ot of Object.values(K).filter($8()))if(ot instanceof KA)for(let Ne=0;Ne<ot.count;Ne++){const tt=`${ot.uuid}/${Ne}`,bt=W[tt];bt!==void 0&&(ot.setMatrixAt(Ne,XT(bt,ke,$e,T[tt])),ot.instanceMatrix.needsUpdate=!0)}else{const Ne=T[ot.uuid]||ot.scale;XT(W[ot.uuid],ke,$e,Ne,ot)}y&&x()}},Ge=pe=>{var de;let{body:Oe,ray:{uuid:We,...ke},...$e}=pe;const ot=(de=N[We])==null?void 0:de.rayhit;ot&&ot({body:Oe?K[Oe]:null,ray:{uuid:We,...ke},...$e})};jw(F),Fe.useEffect(()=>(k.connect(),k.init(),k.on("collide",U),k.on("collideBegin",le),k.on("collideEnd",ie),k.on("frame",Ce),k.on("rayhit",Ge),()=>{k.terminate(),k.removeAllListeners()}),[]),Fe.useEffect(()=>{k.axisIndex=t},[t]),Fe.useEffect(()=>{k.broadphase=n},[n]),Fe.useEffect(()=>{k.gravity=u},[u]),Fe.useEffect(()=>{k.iterations=C},[C]),Fe.useEffect(()=>{k.tolerance=Z},[Z]);const ye=Fe.useMemo(()=>({bodies:W,events:N,refs:K,scaleOverrides:T,subscriptions:L,worker:k}),[W,N,K,L,k]);return Il.jsx(n1.Provider,{value:ye,children:a})}const FT=({position:s,onDrag:e})=>{const t=Fe.useRef(null),[n,a]=Fe.useState(!1),{camera:o,gl:l}=Tc(),{scene:u}=bb("/models/Box.glb"),d=p=>{p.stopPropagation(),a(!0),l.domElement.style.cursor="grabbing"},C=()=>{a(!1),l.domElement.style.cursor="auto"},A=p=>{if(!n||!t.current)return;p.stopPropagation();const m=p.movementX||0,y=p.movementY||0,G=.01,w=t.current.position.x+m*G,R=t.current.position.y-y*G,Z=t.current.position.z;t.current.position.set(w,R,Z),e([w,R,Z])};return It.jsxDEV("group",{ref:t,position:s,onPointerDown:d,onPointerUp:C,onPointerMove:A,children:[It.jsxDEV("primitive",{object:u.clone(),scale:[.1,.1,.1]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Hook.tsx",lineNumber:56,columnNumber:7},void 0),It.jsxDEV("mesh",{rotation:[0,0,Math.PI/2],children:[It.jsxDEV("cylinderGeometry",{args:[.02,.02,.3,8]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Hook.tsx",lineNumber:59,columnNumber:9},void 0),It.jsxDEV("meshStandardMaterial",{color:"#666666",metalness:.8,roughness:.2},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Hook.tsx",lineNumber:60,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Hook.tsx",lineNumber:58,columnNumber:7},void 0),It.jsxDEV("mesh",{position:[.15,0,0],children:[It.jsxDEV("sphereGeometry",{args:[.03]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Hook.tsx",lineNumber:64,columnNumber:9},void 0),It.jsxDEV("meshStandardMaterial",{color:"#444444",metalness:.9,roughness:.1},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Hook.tsx",lineNumber:65,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Hook.tsx",lineNumber:63,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Hook.tsx",lineNumber:49,columnNumber:5},void 0)};function tq(){const[s]=U8(()=>({rotation:[-Math.PI/2,0,0],position:[0,-1,0],args:[10,10]}));return It.jsxDEV("mesh",{ref:s,receiveShadow:!0,children:[It.jsxDEV("planeGeometry",{args:[10,10]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Ground.tsx",lineNumber:13,columnNumber:7},this),It.jsxDEV("meshStandardMaterial",{color:"#f0f0f0"},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Ground.tsx",lineNumber:14,columnNumber:7},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/Ground.tsx",lineNumber:12,columnNumber:5},this)}function nq(s,e,t){const n=[],[a,o,l]=s,[u,d,C]=e,p=Math.sqrt(Math.pow(u-a,2)+Math.pow(d-o,2)+Math.pow(C-l,2))*.1;for(let m=0;m<=t;m++){const y=m/t,G=a+(u-a)*y,w=o+(d-o)*y,R=l+(C-l)*y,Z=Math.sin(Math.PI*y)*p,x=w-Z;n.push({position:[G,x,R],index:m})}return n}function iq(s,e){let t=0,n=1/0;const[a,o,l]=e;return s.forEach((u,d)=>{const[C,A,p]=u.position,m=Math.sqrt(Math.pow(C-a,2)+Math.pow(A-o,2)+Math.pow(p-l,2));m<n&&(n=m,t=d)}),t}function aq({position:s,isFixed:e=!1,index:t,segmentRefs:n,hookPositions:a}){const[o,l]=J8(()=>({mass:e?0:.05,position:s,args:[.025],material:{friction:.3,restitution:.1},linearDamping:.9,angularDamping:.9,type:e?"Static":"Dynamic"}));return Fe.useEffect(()=>{n.current[t]=l},[l,t,n]),Fe.useEffect(()=>{e&&(t===0?l.position.set(...a[0]):l.position.set(...a[1]))},[l,a,t,e]),It.jsxDEV("mesh",{ref:o,castShadow:!0,children:[It.jsxDEV("sphereGeometry",{args:[.025]},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:56,columnNumber:13},this),It.jsxDEV("meshStandardMaterial",{color:"#8B4513",roughness:.8,metalness:.1},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:57,columnNumber:13},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:55,columnNumber:9},this)}function rq({bodyA:s,bodyB:e,distance:t=.15}){return P8(s,e,{pivotA:[0,0,0],pivotB:[0,0,0]}),null}function oq({stones:s,onStoneAdd:e,onStoneRemove:t}){const[n,a]=Fe.useState([-2,2,0]),[o,l]=Fe.useState([2,2,0]),u=20,d=Fe.useRef(Array(u).fill(null)),C=Fe.useMemo(()=>nq(n,o,u),[n,o,u]),A=(m,y)=>{const G=(m/window.innerWidth-.5)*6,w=-(y/window.innerHeight-.5)*4;return[G,w,0]},[,p]=pw({accept:"STONE",drop:(m,y)=>{const G=y.getClientOffset();if(!G)return;const w=A(G.x,G.y),R=iq(C,w),Z=C[R];Z&&e({url:m.url,position:[Z.position[0],Z.position[1]+.1,Z.position[2]]})}});return It.jsxDEV("div",{ref:p,style:{width:"100vw",height:"100vh"},children:It.jsxDEV(qw,{camera:{position:[0,2,8],fov:50},style:{width:"100%",height:"100%"},shadows:!0,children:[It.jsxDEV("ambientLight",{intensity:.4},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:148,columnNumber:17},this),It.jsxDEV("directionalLight",{position:[5,10,5],intensity:.8,castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:149,columnNumber:17},this),It.jsxDEV(eq,{gravity:[0,-9.81,0],defaultContactMaterial:{restitution:.3,friction:.5},children:It.jsxDEV(Fe.Suspense,{fallback:null,children:[It.jsxDEV(FT,{position:n,onDrag:m=>a(m)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:163,columnNumber:25},this),It.jsxDEV(FT,{position:o,onDrag:m=>l(m)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:166,columnNumber:25},this),C.map((m,y)=>It.jsxDEV(aq,{position:m.position,isFixed:y===0||y===C.length-1,index:y,segmentRefs:d,hookPositions:[n,o]},y,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:170,columnNumber:29},this)),C.slice(1).map((m,y)=>It.jsxDEV(rq,{bodyA:d.current[y],bodyB:d.current[y+1]},`constraint-${y}`,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:182,columnNumber:29},this)),It.jsxDEV(tq,{},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:190,columnNumber:25},this),s.map(m=>It.jsxDEV(OH,{url:m.url,position:m.position,id:m.id,onRemove:t,rotation:[0,0,0]},m.id,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:194,columnNumber:29},this))]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:161,columnNumber:21},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:157,columnNumber:17},this),It.jsxDEV($w,{enablePan:!0,enableZoom:!0},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:206,columnNumber:17},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:143,columnNumber:13},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/components/three/NewDynamicRope.tsx",lineNumber:139,columnNumber:9},this)}const sq=[{type:"circle",name:"Halka",draggable:!1},{type:"line",name:"Düz İp",draggable:!1},{type:"dynamicRope",name:"Dynamic İp",draggable:!0}];function lq(){const[s,e]=Fe.useState([]),[t,n]=Fe.useState([]),[a,o]=Fe.useState("dynamicRope"),[l,u]=Fe.useState([]),[d,C]=Fe.useState([]),[A,p]=Fe.useState([]);Fe.useEffect(()=>{fetch("/models/models.json").then(x=>x.json()).then(x=>{e(x),n(x)}).catch(x=>{console.error("Model verileri yüklenirken hata:",x);const W=[{name:"Avocado",url:"/models/Avocado.glb"},{name:"BoomBox",url:"/models/BoomBox.glb"},{name:"Box",url:"/models/Box.glb"},{name:"Duck",url:"/models/duck.glb"}];e(W),n(W)})},[]);const m=x=>o(x),y=({url:x,position:W})=>{u(N=>[...N,{url:x,id:`${x}_${Date.now()}_${Math.random()}`,position:W}])},G=({url:x,position:W,scale:N})=>{C([{url:x,id:`${x}_${Date.now()}_${Math.random()}`,position:W,scale:N}])},w=x=>u(W=>W.filter(N=>N.id!==x)),R=x=>C(W=>W.filter(N=>N.id!==x)),Z=(x,W=[0,0,0])=>{p(N=>[...N,{url:x,position:W,mass:.2,scale:.15}])};return It.jsxDEV(W_,{backend:b3,children:It.jsxDEV(cq,{models:s,uclukModels:t,baseType:a,selectedStones:l,selectedUcluks:d,stones:A,handleBaseSelect:m,handleStoneAdd:y,handleUclukAdd:G,handleStoneRemove:w,handleUclukRemove:R,handleDropStone:Z,setBaseType:o},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:75,columnNumber:7},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:74,columnNumber:5},this)}function cq({models:s,uclukModels:e,baseType:t,selectedStones:n,selectedUcluks:a,stones:o,handleBaseSelect:l,handleStoneAdd:u,handleUclukAdd:d,handleStoneRemove:C,handleUclukRemove:A,handleDropStone:p,setBaseType:m}){const[,y]=pw({accept:"BASE_DYNAMIC_ROPE",drop:()=>{m("dynamicRope")}});return It.jsxDEV("div",{style:{display:"flex",height:"100vh",overflow:"hidden",background:"linear-gradient(120deg, #fcfafb 70%, #d9e7ff 100%)"},children:[It.jsxDEV(Z7,{baseModels:sq,stoneModels:s,uclukModels:e,onBaseSelect:l,onStoneAdd:t==="dynamicRope"?p:u,onUclukAdd:d,selectedBaseType:t},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:123,columnNumber:7},this),It.jsxDEV("main",{ref:y,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",overflow:"hidden"},children:It.jsxDEV(Fe.Suspense,{fallback:It.jsxDEV("div",{children:"Yükleniyor..."},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:143,columnNumber:29},this),children:t==="dynamicRope"?It.jsxDEV(oq,{stones:n,onStoneAdd:u,onStoneRemove:C},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:145,columnNumber:13},this):It.jsxDEV("div",{style:{width:"660px",height:"540px",background:"#fff",borderRadius:"32px",boxShadow:"0 10px 32px 0 #353d4e17, 0 0 0 1px #e2e6f0",display:"flex",alignItems:"center",justifyContent:"center"},children:It.jsxDEV(T7,{baseType:t,stones:n,ucluks:a,onStoneAdd:u,onStoneRemove:C,onUclukAdd:d,onUclukRemove:A},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:161,columnNumber:15},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:151,columnNumber:13},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:143,columnNumber:9},this)},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:132,columnNumber:7},this)]},void 0,!0,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/App.tsx",lineNumber:117,columnNumber:5},this)}zN(document.getElementById("root")).render(It.jsxDEV(lq,{},void 0,!1,{fileName:"C:/ai_otomasyon/replit_v1/replit_deneme_v1/customize-app/ThreeDModelViewer/client/src/main.tsx",lineNumber:5,columnNumber:53},void 0));
